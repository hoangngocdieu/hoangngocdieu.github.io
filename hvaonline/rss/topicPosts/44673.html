<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0">
	<channel>
		<title><![CDATA[Latest posts for the topic "Hỏi đáp về file desciptor"]]></title>
		<link>/hvaonline/posts/list/24.html</link>
		<description><![CDATA[Latest messages posted in the topic "Hỏi đáp về file desciptor"]]></description>
		<generator>JForum - http://www.jforum.net</generator>
			<item>
				<title>Hỏi đáp về file desciptor</title>
				<description><![CDATA[ Em được biết file descriptor trong linux là các file đại diện cho stdin, stdout và stderr của một process. Bất cứ process nào muốn thực hiện đọc ghi file đều phải cần các file descriptor. 

Em viết một script đơn giản rồi chạy nó đến bước đợi nhập từ bàn phím thì em xem PID của chương trình rồi tìm trong /proc/PID/fd thì em thấy các file 0,1,2,255. Em đã cố thử thay vì input data qua bàn phím thì ghi thẳng data đó vào file desciptor 0 nhưng vô hiệu. Em cũng xem khi input data từ bàn phím thì có gì trong file desciptor 0 nhưng khi cat nó thì không thấy gì cả. 

Mọi người có thể giải thích cho em hoặc cho em tài liệu giải thích về cách một process sử dụng file descriptor để đọc ghi data không ạ ?]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/44673.html#275407</guid>
				<link>/hvaonline/posts/list/44673.html#275407</link>
				<pubDate><![CDATA[Fri, 3 May 2013 04:32:08]]> GMT</pubDate>
				<author><![CDATA[ explorer88]]></author>
			</item>
			<item>
				<title>Hỏi đáp về file desciptor</title>
				<description><![CDATA[ Sao chẳng ai trả lời em à. Dạo này đi hỏi chẳng ai trả lời cả, buồn ghê cơ :((]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/44673.html#275460</guid>
				<link>/hvaonline/posts/list/44673.html#275460</link>
				<pubDate><![CDATA[Sun, 5 May 2013 03:09:05]]> GMT</pubDate>
				<author><![CDATA[ explorer88]]></author>
			</item>
			<item>
				<title>Hỏi đáp về file desciptor</title>
				<description><![CDATA[ file descriptor của một process do kernel quản lý. Còn cái bạn thấy trong file system là một cái file system ảo, chỉ để cho biết thông tin mà thôi, mình không nghĩ là bạn có khả năng thay đổi trong cái /proc đó đâu.

Nếu bạn muốn truyền dữ liệu từ stdout của 1 process sang stdin của process khác, bạn có thể dùng pipeline.]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/44673.html#275461</guid>
				<link>/hvaonline/posts/list/44673.html#275461</link>
				<pubDate><![CDATA[Sun, 5 May 2013 04:34:21]]> GMT</pubDate>
				<author><![CDATA[ Stanley_00]]></author>
			</item>
			<item>
				<title>Hỏi đáp về file desciptor</title>
				<description><![CDATA[ Ừm mình cứ nghĩ cơ chế làm việc của process với file trong linux là các data input và output được đẩy vào các file descriptor và các file descriptor này có thể can thiệp trực tiếp được nên mới thử nghiệm thế :(]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/44673.html#275474</guid>
				<link>/hvaonline/posts/list/44673.html#275474</link>
				<pubDate><![CDATA[Sun, 5 May 2013 12:02:32]]> GMT</pubDate>
				<author><![CDATA[ explorer88]]></author>
			</item>
			<item>
				<title>Hỏi đáp về file desciptor</title>
				<description><![CDATA[ Hello explorer88, 

Bạn thử ghi dữ liệu vào fd 0 của script bằng cách nào? Vô hiệu là vô hiệu sao?

khoai]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/44673.html#275682</guid>
				<link>/hvaonline/posts/list/44673.html#275682</link>
				<pubDate><![CDATA[Mon, 13 May 2013 12:10:44]]> GMT</pubDate>
				<author><![CDATA[ Mr.Khoai]]></author>
			</item>
			<item>
				<title>Hỏi đáp về file desciptor</title>
				<description><![CDATA[ <p></p>
		<cite class="blockquote">Mr.Khoai wrote:</cite><br>
		<blockquote>Hello explorer88, 

Bạn thử ghi dữ liệu vào fd 0 của script bằng cách nào? Vô hiệu là vô hiệu sao?

khoai&nbsp;
		</blockquote>

Hôm nay lặp lại thí nghiệm em thử echo &quot;text&quot; &gt; /proc/PID/fd/0 hay mở file 0 ra bằng vi rồi ghi thẳng lên thì thấy dữ liệu đẩy thẳng vào terminal của em. Không hiểu sao trước mình làm gì mà không được nhỉ :D Kiếm tra thì thấy các file 0,1,2 đều là symbolic link trỏ đến terminal mà em đang chạy script nên việc dữ liệu hiển thị thế là đúng rồi. 

Nhưng ở đây em thấy có một điều lạ là em đẩy dữ liệu vào có dấu xuống dòng echo -e &quot;test\n&quot; hay echo -e &quot;test\n\r&quot; thì script của em vẫn không kết thúc lệnh đọc dữ liệu. 

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>#!/bin/bash
echo &quot;pid = $$&quot;
read -p &quot;Enter name: &quot; test
echo $test
exit 0</pre>
		</div>

Em phải vô trong terminal đang chạy script gõ trực tiếp test rồi enter thì đoạn đợi nhập mới qua. Lúc này biến test được in chỉ chứa những gì em nhập trực tiếp còn những gì em echo vào fd0 đều không có. Vậy thì file 0 đó đâu phải là stdin của process đâu ? Nó chỉ là đường tắt đến terminal. Sao chả thấy ăn nhập với lý thuyết gì cả, lùng bùng hết cả lên, các anh có chỉ dẫn gì hay có tài liệu gì về file descriptor không ạ ?



]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/44673.html#275812</guid>
				<link>/hvaonline/posts/list/44673.html#275812</link>
				<pubDate><![CDATA[Sat, 18 May 2013 13:46:42]]> GMT</pubDate>
				<author><![CDATA[ explorer88]]></author>
			</item>
			<item>
				<title>Hỏi đáp về file desciptor</title>
				<description><![CDATA[ <blockquote>Nhưng ở đây em thấy có một điều lạ là em đẩy dữ liệu vào có dấu xuống dòng echo -e &quot;test\n&quot; hay echo -e &quot;test\n\r&quot; thì script của em vẫn không kết thúc lệnh đọc dữ liệu.&nbsp;
		</blockquote>

Đúng rồi bạn, bạn echo như vậy thì script không kết thúc đâu, đọc man của read, bạn sẽ thấy:

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>On success, the number of bytes read is returned &#40;zero indicates end of file&#41;</pre>
		</div>

Bạn thử làm lại như trên, nhưng đến bước echo -e thì thêm lệnh strace vào để xem sẽ thấy kết quả:

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>write&#40;1, &quot;test\n&quot;, 5&#41;                   = 5
write&#40;1, &quot;\n&quot;, 1&#41;                       = 1
close&#40;1&#41;                                = 0
munmap&#40;0x7f8be7e52000, 4096&#41;            = 0
close&#40;2&#41;                                = 0
exit_group&#40;0&#41;                           = ?</pre>
		</div>

Rất đúng với lý thuyết, return value là 5 bytes, khác 0 --&gt; read hiểu rằng chưa phải EOF.


Còn việc

<blockquote>Em phải vô trong terminal đang chạy script gõ trực tiếp test rồi enter thì đoạn đợi nhập mới qua. Lúc này biến test được in chỉ chứa những gì em nhập trực tiếp còn những gì em echo vào fd0 đều không có. Vậy thì file 0 đó đâu phải là stdin của process đâu ?&nbsp;
		</blockquote>

thì hơi vô lý, bạn thử check xem có khi nào bạn chạy lại script rồi, lúc này nó có PID khác nhưng bạn vẫn echo vào PID cũ không?]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/44673.html#275818</guid>
				<link>/hvaonline/posts/list/44673.html#275818</link>
				<pubDate><![CDATA[Sun, 19 May 2013 01:51:38]]> GMT</pubDate>
				<author><![CDATA[ bino1810]]></author>
			</item>
			<item>
				<title>Hỏi đáp về file desciptor</title>
				<description><![CDATA[ Hình như bạn bino1810 nhầm thì phải, man của read bạn nói là  của system call, còn read mình dùng là một built in command trong bash shell mà. Man cho built in read này thì mình tìm thấy ở đấy: <span class="link"> http://wiki.bash-hackers.org/commands/builtin/read</span> chứ không có trên máy.

Về câu hỏi mình nêu thì tiện đây, mình viết lại những thu lượm của mình luôn. Hi vọng sẽ có ích cho các bạn có cùng bối rối.

Mình có nói là tất cả những gì mình echo đẩy vào fd0 đều không được nhận vào input data cho shell script mình viết, bằng chứng là lệnh read -p không kết thúc cho đến khi mình nhập trực tiếp và biến test chỉ nhận những gì gõ trực tiếp qua terminal. Lý do ở đây là mình đang truyền dữ liệu vào terminal chứ không phải là process đang chạy script của mình. Ở đây terminal hay bash shell cũng chính là parent của process đang chạy script. Một process được sinh ra trên linux bằng cách sử dụng fork. Tìm đọc trong man fork thì được biết parent và child process sẽ chia sẻ nhau file descriptor. 

File descriptor lúc nào cũng trỏ đến một file. Khi nào lệnh thực hiện có kèm với wwwection thì những file descriptor này sẽ thay đổi trỏ đến file muốn dùng làm input data, output hay err. Mình có viết thử một script chạy liên tục echo &quot;text&quot; &gt; fileTest.txt và một script nữa cũng chạy liên tục song song với script trên chỉ với nhiệm vụ là ls -l /proc/PID of script/fd &gt; output. Sau khi xem trong file kết quả output lệnh ls -l trên thì thấy fd1 thay đổi trỏ đến fileTest.txt

Quay về vấn đề của mình, mục đích ban đầu của mình là kiểm tra xem liệu có thể đẩy input data trực tiếp vào fd0 không. Lúc này mình thấy fd0 của child process kế thừa từ parent luôn trỏ đến terminal nên mình thử thay đổi file trỏ bởi fd0 của child ngay từ trong script:

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>echo &quot;test123test&quot; &gt; ~/input.txt</pre>
		</div>

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>#!/bin/bash
echo &quot;pid = $$&quot;
exec 0&lt;&quot;/home/username/input.txt&quot;
read -p &quot;Enter name: &quot; test
echo &quot;---&gt;$test&lt;----&quot;
exit 0</pre>
		</div>

Kết quả là bước đợi nhập bàn phím của read -p bị bỏ qua và hiện ra ---&gt;test123test&lt;--- 
Lý do bước read -p bị bỏ qua vì lệnh read -p sẽ kết thúc khi gặp ký tự xuống dòng. Mình đẩy dữ liệu vào input.txt bằng echo nên mặc định ở cuối có ký tự \n. Trường hợp mình dùng echo -n  để loại ký tự xuống dòng trong input.txt thì lệnh read -p vẫn bị bỏ qua. Lúc này lý do lại bởi system call read trả về 0 -&gt; EOF nên kết thúc việc đọc. Cái này mình biết được cũng nhờ mình kiểm tra bằng lệnh strace mà bạn bino1810 có nhắc đến :)

Cám ơn bạn bino1810 và mọi người đã giúp đỡ.]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/44673.html#275845</guid>
				<link>/hvaonline/posts/list/44673.html#275845</link>
				<pubDate><![CDATA[Mon, 20 May 2013 09:31:13]]> GMT</pubDate>
				<author><![CDATA[ explorer88]]></author>
			</item>
	</channel>
</rss>
