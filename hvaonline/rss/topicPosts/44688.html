<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0">
	<channel>
		<title><![CDATA[Latest posts for the topic "Tại sao export command không làm việc đúng trong shell script"]]></title>
		<link>http://www.hvaonline.net/hvaonline/posts/list/24.html</link>
		<description><![CDATA[Latest messages posted in the topic "Tại sao export command không làm việc đúng trong shell script"]]></description>
		<generator>JForum - http://www.jforum.net</generator>
			<item>
				<title>Tại sao export command không làm việc đúng trong shell script</title>
				<description><![CDATA[ Em được biết export command trong linux sẽ làm cho các biến trong parent process được nhìn thấy trong các sub process.

Em thử trong terminal:
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>export test=123
bash
echo $test</pre>
		</div>

thì ra kết quả 123

Nhưng khi thử trong shell script
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>#!/bin/bash
export test=123
bash
echo $test</pre>
		</div>

thì không thấy gì cả

Tại sao lại xảy ra hiện tượng đó ạ ? Mong mọi người giải đáp giúp ạ.]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/44688.html#275475</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/44688.html#275475</link>
				<pubDate><![CDATA[Sun, 5 May 2013 12:14:44]]> GMT</pubDate>
				<author><![CDATA[ explorer88]]></author>
			</item>
			<item>
				<title>Tại sao export command không làm việc đúng trong shell script</title>
				<description><![CDATA[ Viết cái shell script mà không thực thi nó thì những command trong shell script đó có tác dụng gì?]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/44688.html#275485</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/44688.html#275485</link>
				<pubDate><![CDATA[Sun, 5 May 2013 20:57:25]]> GMT</pubDate>
				<author><![CDATA[ quangteospk]]></author>
			</item>
			<item>
				<title>Tại sao export command không làm việc đúng trong shell script</title>
				<description><![CDATA[ Tất nhiên là chạy shell rồi chứ :|]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/44688.html#275549</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/44688.html#275549</link>
				<pubDate><![CDATA[Tue, 7 May 2013 18:36:47]]> GMT</pubDate>
				<author><![CDATA[ explorer88]]></author>
			</item>
			<item>
				<title>Tại sao export command không làm việc đúng trong shell script</title>
				<description><![CDATA[ Cái shell script của bạn chạy tới lệnh thứ hai (bash) thì nó mở thêm một cái shell khác rồi, nó có chạy được tới lệnh echo đâu mà hiện ra cái gì được...]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/44688.html#275550</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/44688.html#275550</link>
				<pubDate><![CDATA[Tue, 7 May 2013 19:49:07]]> GMT</pubDate>
				<author><![CDATA[ Stanley_00]]></author>
			</item>
			<item>
				<title>Tại sao export command không làm việc đúng trong shell script</title>
				<description><![CDATA[ <p></p>
		<cite class="blockquote">explorer88 wrote:</cite><br>
		<blockquote>Tất nhiên là chạy shell rồi chứ :|&nbsp;
		</blockquote>

Chạy cái script đó mà "không thấy gì" á  :-O 

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>#!/bin/bash
export test=123
echo $test</pre>
		</div>

vầy là đủ, thêm bash làm gì. Kể cả khi gõ trong Terminal cũng vậy, chỉa cần export rồi echo là đc, đâu cần thêm command bash làm gỉ?]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/44688.html#275578</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/44688.html#275578</link>
				<pubDate><![CDATA[Wed, 8 May 2013 10:45:12]]> GMT</pubDate>
				<author><![CDATA[ quangteospk]]></author>
			</item>
			<item>
				<title>Tại sao export command không làm việc đúng trong shell script</title>
				<description><![CDATA[ @quangteospk: bạn chưa hiểu câu hỏi của explorer88 rồi.

@explorer88: bạn thử sửa lại thành thế này xem:
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>#!/bin/bash
export test=123
bash -c "echo $test"</pre>
		</div>]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/44688.html#275580</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/44688.html#275580</link>
				<pubDate><![CDATA[Wed, 8 May 2013 10:55:34]]> GMT</pubDate>
				<author><![CDATA[ quanta]]></author>
			</item>
			<item>
				<title>Tại sao export command không làm việc đúng trong shell script</title>
				<description><![CDATA[ Em cám ơn Stanley_00 và anh quanta

Em hiểu rồi
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>#!/bin/bash
export test=123
bash
echo $test</pre>
		</div>

không hoạt động vì lệnh bash sẽ mở ra một sub bash shell mới tại đó nó đợi nhập command từ người dùng. Bằng chứng là khi em chạy script đó: không có hiện tượng gì xảy ra nhưng khi gõ exit để thoát sub bash shell đó thì biến test được in ra nhưng lúc này biến test lại được in ra trong parent shell script nên không thể dùng đoạn shell script trên để kiểm tra được tính chất của export command.

Tham khảo ý của Stanley_00 và anh quanta thì em đã sửa lại và test được tính chất export command như sau:

Em viết hai shell script đặt trong cùng thư mục: test1.sh và test2.sh

test1.sh
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>#!/bin/bash
export test=123
bash "test2.sh" # lệnh tương đương sh "test2.sh"</pre>
		</div>

test2.sh
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>#!/bin/bash
echo "$test"</pre>
		</div>

test trong hai trường hợp có và không dùng export command thấy đúng như lý thuyết luôn

Còn theo hướng dẫn của anh quanta sử dụng one-line bash script trực tiếp không cần đến test2.sh nữa thì
#!/bin/bash
export test=123
bash -c 'echo $test'

cũng cho ra kết quả đúng như lý thuyết nhưng có một điểm lạ là string đằng sau bash -c phải đặt trong single quote chứ nếu đặt trong double quote dù có export hay không có export thì giá trị test vẫn được in ra. Em đang dùng bash shell version 4.2.24(1)-release (i686-pc-linux-gnu).]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/44688.html#275584</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/44688.html#275584</link>
				<pubDate><![CDATA[Wed, 8 May 2013 12:20:55]]> GMT</pubDate>
				<author><![CDATA[ explorer88]]></author>
			</item>
			<item>
				<title>Tại sao export command không làm việc đúng trong shell script</title>
				<description><![CDATA[ <p></p>
		<cite class="blockquote">explorer88 wrote:</cite><br>
		<blockquote>
...
sử dụng one-line bash script trực tiếp không cần đến test2.sh nữa thì
#!/bin/bash
export test=123
bash -c 'echo $test'

cũng cho ra kết quả đúng như lý thuyết nhưng có một điểm lạ là string đằng sau bash -c phải đặt trong single quote chứ nếu đặt trong double quote dù có export hay không có export thì giá trị test vẫn được in ra. Em đang dùng bash shell version 4.2.24(1)-release (i686-pc-linux-gnu).&nbsp;
		</blockquote>
Có khi nào `test` env variable vẫn đang có giá trị là "123" do bạn chạy `export` từ ngoài command line từ trước rồi không.

Thử tìm hiểu xem: với bash, single quotes với double quotes khác nhau như nào.]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/44688.html#275602</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/44688.html#275602</link>
				<pubDate><![CDATA[Wed, 8 May 2013 22:36:18]]> GMT</pubDate>
				<author><![CDATA[ quanta]]></author>
			</item>
			<item>
				<title>Tại sao export command không làm việc đúng trong shell script</title>
				<description><![CDATA[ <p></p>
		<cite class="blockquote">quanta wrote:</cite><br>
		<blockquote><p></p>
		<cite class="blockquote">explorer88 wrote:</cite><br>
		<blockquote>
...
sử dụng one-line bash script trực tiếp không cần đến test2.sh nữa thì
#!/bin/bash
export test=123
bash -c 'echo $test'

cũng cho ra kết quả đúng như lý thuyết nhưng có một điểm lạ là string đằng sau bash -c phải đặt trong single quote chứ nếu đặt trong double quote dù có export hay không có export thì giá trị test vẫn được in ra. Em đang dùng bash shell version 4.2.24(1)-release (i686-pc-linux-gnu).&nbsp;
		</blockquote>
Có khi nào `test` env variable vẫn đang có giá trị là "123" do bạn chạy `export` từ ngoài command line từ trước rồi không.

Thử tìm hiểu xem: với bash, single quotes với double quotes khác nhau như nào.&nbsp;
		</blockquote>

Em tìm hiểu thì biết: Double quote sẽ cho phép bash diễn dịch các ký tự đặc biệt như $ * @ trong string. Còn single quote sẽ ngăn cản sự diễn dịch của bash lên các ký tự đặc biệt đó. Thay vì phải dùng backslash character để escape các ký tự đặc biệt này trong double quote thì chỉ cần bao ngoài string bằng single quote.

Em đã chạy thử lại ví dụ với double quote
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>#!/bin/bash
export test=123
bash -c "echo $test"</pre>
		</div>
 
Nhưng kết quả vẫn thế giá trị biến test được in ra dù có hay không có được export. Em bèn sửa lại:
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>#!/bin/bash
export test=123
echo "pid of parent shell = $$"
bash -c "echo pid of new shell = $$ and value of test var = $test"</pre>
		</div>

Kết quả là lúc nào pid của new shell cũng trùng với pid của parent shell. Em kết luận là trước khi mở một sub process cho new shell này, parent shell đã thực hiện diễn dịch đoạn string thành 'echo pid of new shell = 1234 and value of test var = 123'. Đoạn string mới này khi đi vào new shell sẽ cứ thế được in ra vì chẳng còn ký tự đặc biệt nào để diễn dịch cả. Cũng vì được parent shell diễn dịch trước đó rồi nên giá trị test lúc nào cũng được in dù có hay không có được export.

Em thử đoạn script với single quote:
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>#!/bin/bash
export test=123
echo "pid of parent shell = $$"
bash -c 'echo pid of new shell = $$ and value of test var = $test'</pre>
		</div>

Thì kết quả cho ra pid của new shell khác với pid của parent shell. Lúc này em nghĩ parent shell sẽ không diễn dịch được đoạn string sau bash -c vì nó được bao bởi single quote nên lúc này đoạn string đó đi vào new shell mới được diễn dịch nên có pid của new shell và khi đó biến test cũng được in chỉ khi nào được export.

Chà có mỗi cái thử nghiệm hiệu lực của export thôi mà dính mắc đến lắm thứ thật :D 

Em cám ơn mọi người đã giúp đỡ ạ.]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/44688.html#275606</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/44688.html#275606</link>
				<pubDate><![CDATA[Thu, 9 May 2013 03:40:24]]> GMT</pubDate>
				<author><![CDATA[ explorer88]]></author>
			</item>
	</channel>
</rss>
