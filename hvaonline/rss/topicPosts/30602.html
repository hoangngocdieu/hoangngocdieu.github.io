<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0">
	<channel>
		<title><![CDATA[Latest posts for the topic "Lập trình socket với *Nix "]]></title>
		<link>http://www.hvaonline.net/hvaonline/posts/list/24.html</link>
		<description><![CDATA[Latest messages posted in the topic "Lập trình socket với *Nix "]]></description>
		<generator>JForum - http://www.jforum.net</generator>
			<item>
				<title>Lập trình socket với *Nix </title>
				<description><![CDATA[  Tớ xin chia sẻ chút ít kiến thức về lập trình socket trên *Nix, để đọc bài viết này một số kiến thức về network và socket được yêu cầu, bài viết với mục đích chia sẻ cho các bạn muốn bắt đầu học lập trình mạng bằng C nhưng chưa biết bắt đầu ra sao. Hi vọng sẽ giúp được phần nào cho mọi người.
 Để demo cho bài viết xin được lấy ví dụ là wargame level1 của vortex.

Đầu tiên các bạn cần có một bảng tra cứu các system call về network trên Linux.
Có 1 cái cơ bản ở đây và từ đó các bạn có thể tra cứu ra các system call khác :
<span class="link"> http://isomerica.net/~dpn/socketcall1.pdf</span>

Chúng ta bắt đầu : Đọc đề !
<blockquote>Your goal is to connect to port 5842 on vortex.labs.pulltheplug.org and read in 4 unsigned integers. Add these integers together and send back the results to get a username and password for level 1.&nbsp;
		</blockquote>

Chúng ta xác định bước đầu tiên khi muốn connect tới một địa chỉ trên mạng là phải tạo ra 1 socket và từ socket này mới có thể trao đổi dữ liệu được. Chúng ta sẽ tham khảo manpage cho lệnh tạo socket :
<span class="link"> http://www.manpagez.com/man/2/socket/</span>

Tất nhiên chúng ta chỉ việc gõ vào console : man socket là sẽ có cái này, ở đây mình chỉ muốn đưa cho các bạn thấy trực tiếp mà không cần phải vào terminal. Chúng ta sẽ chú ý đến những điểm chính sau:


<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>#include &lt;sys/types.h&gt;
           #include &lt;sys/socket.h&gt;
 
  int
     socket&#40;int domain, int type, int protocol&#41;;</pre>
		</div>
     The domain parameter specifies a communications domain within which com-
     munication will take place; this selects the protocol family which should
     be used.  These families are defined in the include file &lt;sys/socket.h&gt;.
     The currently understood formats are

       <blockquote>    AF_UNIX         (UNIX internal protocols),
           AF_INET         (ARPA Internet protocols),
           AF_ISO          (ISO protocols),
           AF_NS           (Xerox Network Systems protocols), and
           AF_IMPLINK      (IMP host at IMP link layer).&nbsp;
		</blockquote>

     The socket has the indicated type, which specifies the semantics of com-
     munication.  Currently defined types are:

       <blockquote>    SOCK_STREAM
           SOCK_DGRAM
           SOCK_RAW
           SOCK_SEQPACKET
           SOCK_RDM&nbsp;
		</blockquote>


Như vậy chương trình của chúng ta sẽ bắt đầu như sau:


<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>#include &lt;stdio.h&gt;
#include &lt;sys/types.h&gt;


int main&#40;int argc, chả **argv&#41;

{
       int sockfd;



      sockfd = socket &#40; AF_INET, SOCK_STREAM,0&#41;; // chúng ta dùng AF_INET và SOCK_STREAM để tạo socket dùng cho mạng internet và theo giao thức TCP.


}</pre>
		</div>

Từ manpage này mà ta có các system call khác để có thể tham khảo :
<blockquote> accept(2), bind(2), connect(2), getsockname(2), getsockopt(2), ioctl(2),
     listen(2), read(2), recv(2), select(2), send(2), shutdown(2),
     socketpair(2), write(2), getprotoent(3), inet(4), inet6(4), unix(4),
     compat(5)
&nbsp;
		</blockquote>

Sau khi tạo ra socket chúng ta cần connect nó tới đích. CHúng ta thấy ở trên có system call là connect chúng ta sẽ coi manpage của nó :

<span class="link"> http://www.manpagez.com/man/2/connect/</span>

Và cũng chú ý một số điểm sau:
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>int
     connect&#40;int socket, const struct sockaddr *address,
         socklen_t address_len&#41;;</pre>
		</div>
Thông thường chúng ta sẽ dùng sockaddr_in cho địa chỉ của host cần connect tới.
Google một chút là ta có trang này để tham khảo :
<span class="link"> http://www.csc.villanova.edu/~mdamian/Sockets/TcpSockets.htm</span>

Chúng ta sẽ thêm vào chương trình của mình như sau:

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>#include &lt;stdio.h&gt;
#include &lt;sys/types.h&gt;


int main&#40;int argc, chả **argv&#41;

{
    
      

       if&#40;argc != 3&#41;
        {
                fprintf&#40;stderr, &quot;usage: %s hostname portno \n&quot;, argv&#91;0&#93;&#41;;
                return 1;
        }
       //Dùng để yêu cầu user nhập vào hostname và port 
         int sockfd,portno;
          portno = atoi&#40;argv&#91;2&#93;&#41;;
         struct sockaddr_in server_addr;
         server_addr.sin_family = AF_INET;
         server_addr.sin_port = htons &#40;portno&#41;;



      sockfd = socket &#40; AF_INET, SOCK_STREAM,0&#41;;
       // chúng ta dùng AF_INET và SOCK_STREAM để tạo socket dùng cho mạng internet và theo giao thức TCP.
       if&#40;connect &#40;sockfd, &server_addr, sizeof&#40;server_addr&#41;&#41; == 0&#41;
        {
                perror&#40;&quot;Socket connection&quot;&#41;;
        }



}</pre>
		</div>

Tạm thời chúng ta chưa có   struct in_addr sin_addr. Chúng ta chỉ có địa chỉ website là :vortex.labs.pulltheplug.org.
Chúng ta sẽ chuyển qua một system call là gethostbyname : nó sẽ trả về cho chúng ta địa chỉ IP của một domain. Xem xét manpage của nó :
[url]<span class="link"> http://www.manpagez.com/man/3/gethostbyname/</span>[/url]

Để phục vụ cho mục đích lấy IP chúng ta cần một cấu trúc mới là hostent bởi vì system call gethostbyname sẽ nhận vào url và trả ra một cấu trúc hostent trong đó có cái chúng ta cần là IP address.

Google ta tìm được một ví dụ về gethostbyname :
<span class="link"> http://www.logix.cz/michal/devel/various/gethostbyname.c.xp</span>

Ứng dụng vào đoạn code của chúng ta sẽ có được :

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>......
struct hostent *he;
 struct in_addr addr;
 he = gethostbyname &#40; argv&#91;1&#93;&#41;;
 bcopy&#40; *he-&gt;h_addr_list ,&#40;char *&#41; &addr, sizeof&#40;addr&#41;&#41;;</pre>
		</div>


Bây giờ thì đã có IP của host , ta sẽ làm đầy cấu trúc sockaddr_in:
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>server_addr.sin_addr = addr;</pre>
		</div>

Sau khi đã connect xong chúng ta sẽ nhận dữ liệu từ host bằng lệnh recv. Tiếp tục manpage :
<span class="link"> http://www.manpagez.com/man/2/recv/</span>
Ta lại có :
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>unsigned int a ;
        int sum = 0;
        int i = 0;
        while &#40; i &lt; 4&#41;
        {
                recv&#40; sockfd, &#40;unsigned int&#41; &a,sizeof&#40;unsigned int&#41;,0 &#41;;

                printf&#40;&quot;%i\n&quot;,a&#41;;
                sum += a;
                i++;
        }

        printf &#40;&quot;Sum is : %i\n&quot;,sum&#41;;</pre>
		</div>

Và send ngược lại kết quả cho host :
<span class="link"> http://www.manpagez.com/man/2/send/</span>

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>send &#40;sockfd, &sum , sizeof&#40;int&#41;,0&#41;;</pre>
		</div>

Và nhận về kết quả :

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>char account&#91;128&#93;;
        recv&#40;sockfd,account,128,0&#41;;
        printf&#40;&quot;%s&quot;,account&#41;;</pre>
		</div>



Với bấy nhiêu đó các bạn đã có một chương trình để hoàn thành yêu cầu của đề :
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>#include &lt;stdio.h&gt;
#include &lt;netdb.h&gt;
#include &lt;netinet/in.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;sys/socket.h&gt;

struct sockaddr_in server_addr;
struct hostent *he;

int main&#40;int argc, char **argv&#41;
{
        if&#40;argc != 3&#41;
        {
                fprintf&#40;stderr, &quot;usage: %s hostname portno \n&quot;, argv&#91;0&#93;&#41;;
                return 1;
        }
        struct in_addr addr;
        int sockfd,portno;
        unsigned int a;


        he = gethostbyname &#40; argv&#91;1&#93;&#41;;
        portno = atoi&#40;argv&#91;2&#93;&#41;;

        bcopy&#40; *he-&gt;h_addr_list ,&#40;char *&#41; &addr, sizeof&#40;addr&#41;&#41;;
        printf&#40;&quot;address: %s\n&quot;, inet_ntoa&#40;addr&#41;&#41;;

        server_addr.sin_family = AF_INET;
        server_addr.sin_port = htons &#40;portno&#41;;
        server_addr.sin_addr = addr;

        sockfd = socket&#40;PF_INET, SOCK_STREAM, 0&#41;;

        if&#40;connect &#40;sockfd, &server_addr, sizeof&#40;server_addr&#41;&#41; == 0&#41;
        {
                perror&#40;&quot;Socket connection&quot;&#41;;
        }
        int sum = 0;
        int i = 0;
        while &#40; i &lt; 4&#41;
        {
                recv&#40; sockfd, &#40;unsigned int&#41; &a,sizeof&#40;unsigned int&#41;,0 &#41;;
                 printf&#40;&quot;%i\n&quot;,a&#41;;
                sum += a;
                i++;
        }

        printf &#40;&quot;Sum is : %i\n&quot;,sum&#41;;
        send &#40;sockfd, &sum , sizeof&#40;int&#41;,0&#41;;

        char account&#91;128&#93;;
        recv&#40;sockfd,account,128,0&#41;;
        printf&#40;&quot;%s&quot;,account&#41;;
}</pre>
		</div>

và :
$gcc -o level0 level0.c
$./level0 vortex.labs.pulltheplug.org 5842

Bingo ! chúng ta có account cho level1 với một chút ít kiến thức về mạng và dựa vào tra cứu tự tìm tòi là chính. Cám ơn các bạn đã đọc bài. Hi vọng nhận được sự góp ý từ mọi người.



]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/30602.html#188726</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/30602.html#188726</link>
				<pubDate><![CDATA[Tue, 4 Aug 2009 22:15:52]]> GMT</pubDate>
				<author><![CDATA[ H3x4]]></author>
			</item>
			<item>
				<title>Lập trình socket với *Nix </title>
				<description><![CDATA[ bài anh viết hay lắm rất kỹ đúng là thứ em cần mà cho em hỏi :
           perror là gì vậy anh]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/30602.html#265909</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/30602.html#265909</link>
				<pubDate><![CDATA[Sun, 1 Jul 2012 11:12:55]]> GMT</pubDate>
				<author><![CDATA[ fcbacktrack]]></author>
			</item>
			<item>
				<title>Lập trình socket với *Nix </title>
				<description><![CDATA[ thông báo lỗi đó bạn.]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/30602.html#267106</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/30602.html#267106</link>
				<pubDate><![CDATA[Thu, 19 Jul 2012 04:22:53]]> GMT</pubDate>
				<author><![CDATA[ theblueocean1003]]></author>
			</item>
	</channel>
</rss>
