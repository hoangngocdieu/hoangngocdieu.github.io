<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0">
	<channel>
		<title><![CDATA[Latest posts for the topic "Squid - Access Control"]]></title>
		<link>/hvaonline/posts/list/24.html</link>
		<description><![CDATA[Latest messages posted in the topic "Squid - Access Control"]]></description>
		<generator>JForum - http://www.jforum.net</generator>
			<item>
				<title>Squid - Access Control</title>
				<description><![CDATA[ Do trình độ có hạn nên bài viết còn sơ sài , mong mọi người góp ý.

Squid có khoảng 25 loại ACL khác nhau, một số trong chúng được sử dụng khá phổ biến.

File cấu hình chính của Squid là <b>squid.conf ( /etc/squid/squid.conf )</b> , mọi thay đổi ở file này bạn <b>cần restart lại squid để có hiệu lực</b>.

<b>1.Hạn chế truy cập web theo thời gian</b>:

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>acl home_network src 192.168.1.0/24
acl allow_hours time M T W H F 9:00-17:00
acl RestrictedHost src 192.168.1.23

http_access deny RestrictedHost
http_access allow home_network allow_hours</pre>
		</div>

Nếu bạn có các dòng trên trong file squid.conf thì các máy trong mạng nội bộ chỉ truy cập được vào mạng vào các ngày thứ 3 đến thứ 6 và trong thời gian 9h đến 17h.
Trừ máy 192.168.1.23, vì bị cấm tất cả.

M, T, W, H, F là viết tắt các ngày trong tuần ( chủ nhật : S, thứ bảy : A)
Có thể dùng D để thay bằng các ngày trong tuần ( M - F )

<b>2.Hạn chế truy cập các website được ấn định trước :</b>

Đầu tiên tạo 2 file ở trong thư mục /etc/squid là allowed-sites.squid và restricted-sites.squid để chứa tên các domain cho phép truy cập và cấm truy cập.

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre># File: /squid/allowed-sites.squid
www.hvaonline.net
fotech.org

# File: /etc/squid/restricted-sites.squid
www.sex.com
xxx.net</pre>
		</div>

Nếu bạn muốn trong thời gian làm việc, cấm vào một số site và cho phép vào một số site nó thì :

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>acl home_network src 192.168.1.0/24
acl work_hours time M T W H F 9:00-17:00
acl GoodSites dstdomain "/etc/squid/allowed-sites.squid"
acl BadSites  dstdomain "/etc/squid/restricted-sites.squid"

http_access deny BadSites
http_access allow home_network work_hours GoodSites</pre>
		</div>

Bạn có thể dùng url_regex để hạn chế vào các domain name được ấn định:
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>acl domainname url_regex -i ^http://www
http_access deny domainname</pre>
		</div>

<b>3.Hạn chế truy cập web theo địa chỉ ip :</b>

Bạn có thể tạo một access control list để hạn chế truy cập web trên một mạng nào đó.

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>acl home_network src 192.168.1.0/255.255.255.0
http_access allow home_network

acl localhost dst 127.0.0.0/8
http_access allow localhost</pre>
		</div>

<b>4.Hạn chế nội dung các file download:</b>

Tạo một file chứ nội dung các phần đuôi của các tập tin mà bạn muốn hạn chế là blocks.files.acl nằm trong <b>/etc/squid</b>
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>\.&#91;Ee&#93;&#91;Xx&#93;&#91;Ee&#93;$
\.&#91;Aa&#93;&#91;Vv&#93;&#91;Ii&#93;$
\.&#91;Mm&#93;&#91;Pp&#93;&#91;Gg&#93;$
\.&#91;Mm&#93;&#91;Pp&#93;&#91;Ee&#93;&#91;Gg&#93;$
\.&#91;Mm&#93;&#91;Pp&#93;3$</pre>
		</div>

Thêm vào<b> squid.conf</b> dòng

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>acl blockfiles urlpath_regex “/etc/squid/blocks.files.acl”
http_access deny blockfiles</pre>
		</div>

<b>5.Hạn chế truy cập theo cổng :</b>

vd
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>acl httpports port 80 8000-8010 8080
http_access allow httpports</pre>
		</div>

Các bạn nên duy trì và allow một số cổng. Dưới đây là một số cổng được cho là an toàn ( mặc định tỏng file squid.conf )
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>acl safe_ports port 80 # http
acl safe_ports port 21 # ftp
acl safe_ports port 443 563 # https snews
acl safe_ports port 70 # gopher
acl safe_ports port 210 # wais
acl safe_ports port 1025-65535 # unregistered ports
acl safe_ports port 280 # http-mgmt
acl safe_ports port 480 # gss-http
acl safe_ports port 591 # filemaker
acl safe_ports port 777 # multiling http

http_access deny !safe_ports</pre>
		</div>

<b>6.Hạn chế truy cập thep giao thức :</b> 

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>acl FTP proto FTP
http_access deny FTP</pre>
		</div>

<b>7.Dùng NCSA kiểm định password</b>:

đầu tiên tạo một file password,vd <b>/etc/squid/squid_passwd</b>
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>touch /etc/squid/squid_passwd
chmod o+r /etc/squid/squid_passwd</pre>
		</div>
Dùng htpasswd để add user vào pass vào file squid_passwd đó
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>htpasswd /etc/squid/squid_passwd vicki
New password:
Re-type new password:
Adding password for user vicki</pre>
		</div>

giờ thêm vào file squid.conf
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>auth_param basic program /usr/lib/squid/ncsa_auth /etc/squid/squid_passwd
acl ncsa_users proxy_auth REQUIRED
http_access allow ncsa_users</pre>
		</div>

Như vậy phải dùng user và pass được add vào file squid_passwd mới có thể truy cập vào internet được.
Cũng có thể kết hợp thời gian để bắt kiểm định pass vào mốc thời gian nhất định ( tham khảo đầu bài )


Nếu bạn muốn mọi deny đều có một thông báo cho người dùng biết thì :
Tạo một file deny.php với nội dung tùy bạn, đặt vào /var/www chẳng hạn.
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>acl blacklist url_regex yahoo\.com vietnamnet\.vn
http_access deny blacklist
deny_info domain/deny.php blacklist</pre>
		</div>

Bài viết chỉ lấy VD ở mỗi phần, bạn có thể tùy cơ ứng biến.
Tham khảo thêm nội dung file <b>squid.conf</b> mặc định để hiểu thêm.

<b>Vickizw</b>
]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/12859.html#75833</guid>
				<link>/hvaonline/posts/list/12859.html#75833</link>
				<pubDate><![CDATA[Wed, 1 Aug 2007 16:44:30]]> GMT</pubDate>
				<author><![CDATA[ Vickizw]]></author>
			</item>
			<item>
				<title>Squid - Access Control</title>
				<description><![CDATA[ Bài viết rất chi tiết và dễ hiểu . Thanks for share]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/12859.html#75838</guid>
				<link>/hvaonline/posts/list/12859.html#75838</link>
				<pubDate><![CDATA[Wed, 1 Aug 2007 17:06:08]]> GMT</pubDate>
				<author><![CDATA[ qhoa83]]></author>
			</item>
			<item>
				<title>Squid - Access Control</title>
				<description><![CDATA[ Bài của bạn rất khá, chẳng biết bạn dịch từ đâu, nhưng nên để nguyên comments nếu có.

ví dụ phần Htpasswd auth:

bạn nên để comment như sau:
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>#
# Add this to the auth_param section of squid.conf
#
auth_param basic program /usr/lib/squid/ncsa_auth /etc/squid/squid_passwd
 
#
# Add this to the bottom of the ACL section of squid.conf
#
acl ncsa_users proxy_auth REQUIRED
 
#
# Add this at the top of the http_access section of squid.conf
#
http_access allow ncsa_users</pre>
		</div>

như vậy user sẽ biết cần phải đặt code ở đâu trong file squid.conf
không thể cứ copy code rùi phang thẳng vào squid.conf, như vậy sẽ ko hoạt động được.

]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/12859.html#75930</guid>
				<link>/hvaonline/posts/list/12859.html#75930</link>
				<pubDate><![CDATA[Wed, 1 Aug 2007 21:42:07]]> GMT</pubDate>
				<author><![CDATA[ nora]]></author>
			</item>
			<item>
				<title>Squid - Access Control</title>
				<description><![CDATA[ <p></p>
		<cite class="blockquote">nora wrote:</cite><br>
		<blockquote>Bài của bạn rất khá, chẳng biết bạn dịch từ đâu, nhưng nên để nguyên comments nếu có.

ví dụ phần Htpasswd auth:

bạn nên để comment như sau:
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>#
# Add this to the auth_param section of squid.conf
#
auth_param basic program /usr/lib/squid/ncsa_auth /etc/squid/squid_passwd
 
#
# Add this to the bottom of the ACL section of squid.conf
#
acl ncsa_users proxy_auth REQUIRED
 
#
# Add this at the top of the http_access section of squid.conf
#
http_access allow ncsa_users</pre>
		</div>

như vậy user sẽ biết cần phải đặt code ở đâu trong file squid.conf
không thể cứ copy code rùi phang thẳng vào squid.conf, như vậy sẽ ko hoạt động được.

&nbsp;
		</blockquote>
Chào nora.
Cám ơn bạn đã quan tâm và góp ý.
Mình không dịch từ đâu cả, dựa vào những kiến thức đọc được và đã test qua mới viết bài này. Cho nên không viết comment được.
Nếu một người hiểu được bài viết này thì cũng có thể biết nên đặt code ở đâu và đặt như thế nào để nó có thể hoạt động.]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/12859.html#75933</guid>
				<link>/hvaonline/posts/list/12859.html#75933</link>
				<pubDate><![CDATA[Wed, 1 Aug 2007 21:51:26]]> GMT</pubDate>
				<author><![CDATA[ Vickizw]]></author>
			</item>
			<item>
				<title>Re:Squid - Access Control</title>
				<description><![CDATA[ sorry, vậy bạn nên chỉ ra những chỗ cần lưu ý khi đưa code vào squid.conf thì hơn, theo tôi nếu bạn đã test thì ít nhiều cũng gặp trục trặc :)]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/12859.html#75937</guid>
				<link>/hvaonline/posts/list/12859.html#75937</link>
				<pubDate><![CDATA[Wed, 1 Aug 2007 22:06:47]]> GMT</pubDate>
				<author><![CDATA[ nora]]></author>
			</item>
			<item>
				<title>Re:Squid - Access Control</title>
				<description><![CDATA[ <p></p>
		<cite class="blockquote">nora wrote:</cite><br>
		<blockquote>sorry, vậy bạn nên chỉ ra những chỗ cần lưu ý khi đưa code vào squid.conf thì hơn, theo tôi nếu bạn đã test thì ít nhiều cũng gặp trục trặc :)&nbsp;
		</blockquote>
Ừ, để nói qua nhé.
Khi sửa file squid.conf .
VD thêm đoạn này vào file squid.conf
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>auth_param basic program /usr/lib/squid/ncsa_auth /etc/squid/squid_passwd</pre>
		</div>

tìm trong file squid.conf với từ <b>auth_param</b>, và chèn đoạn code trên ngay dưới phần comment của nó.

Rất mong mọi sự góp ý của mọi người.]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/12859.html#76015</guid>
				<link>/hvaonline/posts/list/12859.html#76015</link>
				<pubDate><![CDATA[Thu, 2 Aug 2007 01:00:03]]> GMT</pubDate>
				<author><![CDATA[ Vickizw]]></author>
			</item>
			<item>
				<title>Squid - Access Control</title>
				<description><![CDATA[ vậy nếu file squid.conf ko có sẵn auth_param thì chèn vào đâu nhỉ? và tìm ở chỗ nào vậy?]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/12859.html#76759</guid>
				<link>/hvaonline/posts/list/12859.html#76759</link>
				<pubDate><![CDATA[Sat, 4 Aug 2007 09:52:09]]> GMT</pubDate>
				<author><![CDATA[ nora]]></author>
			</item>
			<item>
				<title>Squid - Access Control</title>
				<description><![CDATA[ <p></p>
		<cite class="blockquote">nora wrote:</cite><br>
		<blockquote>vậy nếu file squid.conf ko có sẵn auth_param thì chèn vào đâu nhỉ? và tìm ở chỗ nào vậy?&nbsp;
		</blockquote>
File squid.conf mặc định đều có đầy đủ các comment và example của tất cả các access list.
Còn file squid.conf không phải là mặc định nữa ( được loại bỏ comment ) thi tùy cơ ứng biến thôi, lúc đó thì nội dung squid.conf cũng không dài lắm đâu.]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/12859.html#76832</guid>
				<link>/hvaonline/posts/list/12859.html#76832</link>
				<pubDate><![CDATA[Sat, 4 Aug 2007 13:35:18]]> GMT</pubDate>
				<author><![CDATA[ Vickizw]]></author>
			</item>
			<item>
				<title>Re: Squid - Access Control</title>
				<description><![CDATA[ <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>acl abdc src	192.168.1.1/24
	acl work_hours time M T W H F 9:00-17:00
	acl GoodSites dstdomain &quot;/etc/squid/allowed-sites.squid&quot;
	acl BadSites dstdomain &quot;/etc/squid/restricted-sites.squid&quot;	
	
	http_access deny BadSites
	http_access allow  abdc work_hours GoodSites</pre>
		</div>
Cho em hỏi trong file cấu hình trên em có đoạn <font color='yellow'>acl work_hours time M T W H F 9:00-17:00 </font>, em ấn định chỉ cho phép kết nối ra ngoài vào các ngày thứ 2,3,4,5,6 thì vẫn kết nối được những trang cho phép, còn khi kết nối đến những trang cấm thi không ra di ra ngoài được bởi những site có trong nội dung <b>restricted-site.squid</b>, =&gt; <b>work_hours</b> không có tác dụng.

Mong các anh chỉ giúm !!!]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/12859.html#107524</guid>
				<link>/hvaonline/posts/list/12859.html#107524</link>
				<pubDate><![CDATA[Tue, 1 Jan 2008 02:49:04]]> GMT</pubDate>
				<author><![CDATA[ ngocxdy]]></author>
			</item>
			<item>
				<title>Squid - Access Control</title>
				<description><![CDATA[ Em đang cấu hình squid trên máy ảo. 
Máy server em dùng CentOS, em để card mạng eth0 mặc định là NAT. Máy clent ubuntu để test, có eth0 là NAT. 2 máy này thông nhau rồi.
Em thêm 1 card mạng để thông trực tiếp tới máy thật, là bridge (replicate....). Sau đó vào chỉnh sửa ở thư mục /etc/sysconfig/network-scripts/
Thêm 1 file ifcfg-eth1 có nội dung:
DEVICE=eth1
TYPE=Ethernet
ONBOOT=yes
BOOTPROTO=dhcp
Em reboot rồi và nó vẫn không nhận card mạng này. Liệu em có làm sai ở đâu không? Ai có kinh nghiệm chỉ em phần này với. Em cảm ơn ạ!]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/12859.html#280661</guid>
				<link>/hvaonline/posts/list/12859.html#280661</link>
				<pubDate><![CDATA[Wed, 14 May 2014 23:36:49]]> GMT</pubDate>
				<author><![CDATA[ startbkhn]]></author>
			</item>
	</channel>
</rss>
