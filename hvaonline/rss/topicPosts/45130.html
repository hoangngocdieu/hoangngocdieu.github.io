<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0">
	<channel>
		<title><![CDATA[Latest posts for the topic "Nguyên nhân thông số CPU iowait  tăng cao"]]></title>
		<link>/hvaonline/posts/list/24.html</link>
		<description><![CDATA[Latest messages posted in the topic "Nguyên nhân thông số CPU iowait  tăng cao"]]></description>
		<generator>JForum - http://www.jforum.net</generator>
			<item>
				<title>Nguyên nhân thông số CPU iowait  tăng cao</title>
				<description><![CDATA[ Đây là một số output, mọi người xem và cho mình hướng kiểm tra cụ thể hơn nhé.
<font color='green'>sar</font>
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>CPU     %user     %nice   %system   %iowait    %steal     %idle
  all      4.38      0.00      3.00     72.12      0.00     20.50
  all     15.11      0.00     13.23     64.54      0.00      7.12
  all      3.00      0.00      3.50     93.50      0.00      0.00
  all      2.50      0.00      4.24     87.02      0.00      6.24
  all      0.00      0.00      0.75     99.00      0.00      0.25</pre>
		</div>

<font color='red'>iotop</font>
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>Total DISK READ: 354.60 K/s | Total DISK WRITE: 77.40 M/s
  TID  PRIO  USER     DISK READ  DISK WRITE  SWAPIN     IO&gt;    COMMAND
1022227 be/4 root        0.00 B/s    0.00 B/s  0.00 % 99.99 % &#91;pdflush&#93;
1022228 be/4 root        0.00 B/s    0.00 B/s  0.00 % 99.99 % &#91;pdflush&#93;
1022225 be/4 root        0.00 B/s    0.00 B/s  0.00 % 99.99 % &#91;pdflush&#93;
1021961 be/4 root        0.00 B/s    0.00 B/s  0.00 % 99.99 % &#91;pdflush&#93;
1020591 be/4 root        0.00 B/s    0.00 B/s  0.00 % 99.99 % &#91;pdflush&#93;
1020915 be/4 root        0.00 B/s    0.00 B/s  0.00 % 99.99 % &#91;pdflush&#93;
1020592 be/4 root        0.00 B/s    0.00 B/s  0.00 % 99.99 % &#91;pdflush&#93;
1022226 be/4 root        0.00 B/s    0.00 B/s  0.00 % 92.47 % &#91;pdflush&#93;
1020507 be/4 root        0.00 B/s    0.00 B/s  0.00 % 92.45 % &#91;pdflush&#93;
1022229 be/4 root        0.00 B/s    0.00 B/s  0.00 % 92.32 % &#91;pdflush&#93;</pre>
		</div>
]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/45130.html#278349</guid>
				<link>/hvaonline/posts/list/45130.html#278349</link>
				<pubDate><![CDATA[Mon, 2 Sep 2013 22:06:17]]> GMT</pubDate>
				<author><![CDATA[ emdinoiay]]></author>
			</item>
			<item>
				<title>Nguyên nhân thông số CPU iowait  tăng cao</title>
				<description><![CDATA[ Cho mình xem kết quả khi chạy:
- `top`
- `iotop -o`

PS: nhớ đưa vào [ code ] tag nhé (biểu tượng {} ấy)]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/45130.html#278350</guid>
				<link>/hvaonline/posts/list/45130.html#278350</link>
				<pubDate><![CDATA[Mon, 2 Sep 2013 22:46:44]]> GMT</pubDate>
				<author><![CDATA[ quanta]]></author>
			</item>
			<item>
				<title>Nguyên nhân thông số CPU iowait  tăng cao</title>
				<description><![CDATA[ Cám ơn anh quanta đã quan tâm topic, đây là các thông số anh yêu cầu.

<font color='red'>iotop -o</font>

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>Total DISK READ: 117.94 K/s | Total DISK WRITE: 9.57 M/s
  TID  PRIO  USER     DISK READ  DISK WRITE  SWAPIN     IO&gt;    COMMAND
1018731 be/4 mysql       0.00 B/s    0.00 B/s  0.00 % 99.99 % mysqld --basedir=/ --datadir=/var/lib/mysql --user=mysql ~it=50000 --pid-file=/var/lib/mysql/server.demo.com.pid
  888 be/4 root       11.06 K/s    0.00 B/s  0.00 % 99.99 % exim -q
53579 be/4 mysql       0.00 B/s    0.00 B/s  0.00 % 99.99 % mysqld --basedir=/ --datadir=/var/lib/mysql --user=mysql -~mit=50000 --pid-file=/var/lib/mysql/server.demo.com.pid
 5059 be/3 root        0.00 B/s    0.00 B/s  0.00 % 99.99 % &#91;kjournald&#93;
 2991 be/4 root        0.00 B/s    3.69 K/s  0.00 % 99.99 % &#91;pdflush&#93;
 2515 be/4 root        0.00 B/s    3.69 K/s  0.00 % 99.99 % &#91;pdflush&#93;
 2461 be/4 root        0.00 B/s    7.37 K/s  0.00 % 99.99 % &#91;pdflush&#93;
 2971 be/4 root        0.00 B/s    7.37 K/s  0.00 % 99.99 % &#91;pdflush&#93;
 2997 be/4 root        0.00 B/s    0.00 B/s  0.00 % 92.14 % &#91;pdflush&#93;
 2975 be/4 root        0.00 B/s    3.69 K/s  0.00 % 92.14 % &#91;pdflush&#93;</pre>
		</div>

<font color='red'>top</font>

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>top - 10:59:50 up 7 days, 12:07,  2 users,  load average: 10.32, 7.89, 6.30
Tasks: 256 total,   2 running, 229 sleeping,   0 stopped,  25 zombie
Cpu&#40;s&#41;:  6.7%us,  4.8%sy,  0.0%ni,  8.2%id, 79.6%wa,  0.0%hi,  0.7%si,  0.0%st
Mem:  12276180k total, 10335344k used,  1940836k free,   930728k buffers
Swap: 16777208k total,      112k used, 16777096k free,  5411144k cached

    PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
  51847 mysql     15   0 1274m 1.0g 5296 S 16.6  8.7 427:48.47 mysqld
   4332 mailnull  15   0 71312 5384 3196 S  1.3  0.0   0:00.16 exim
1034286 nobody    15   0  510m  86m 6768 S  1.3  0.7   0:30.29 httpd
1034551 nobody    15   0  510m  74m 6784 S  1.3  0.6   0:31.65 httpd
   4178 mailnull  15   0 71312 5384 3196 S  1.0  0.0   0:00.68 exim
1034347 nobody    15   0  503m  73m 6764 S  1.0  0.6   0:28.92 httpd
1033186 nobody    15   0  515m  81m 2524 S  0.7  0.7   0:28.25 httpd
1034423 nobody    18   0  493m  66m 6772 S  0.7  0.6   0:27.35 httpd
1036585 nobody    15   0  490m  61m 6764 S  0.7  0.5   0:22.84 httpd
   2152 root      -1  -5     0    0    0 D  0.3  0.0  58:32.66 kjournald
   4273 root      15   0     0    0    0 D  0.3  0.0   0:00.01 pdflush
   4281 root      16   0 12896 1252  828 R  0.3  0.0   0:00.11 top
 997505 nobody    16   0  115m  19m  996 S  0.3  0.2   0:02.22 httpd
      1 root      15   0 10372  708  600 S  0.0  0.0   0:33.06 init
      3 root      39  19     0    0    0 S  0.0  0.0   0:00.00 ksoftirqd/0
      5 root      34  19     0    0    0 S  0.0  0.0   0:00.00 ksoftirqd/1
      7 root      34  19     0    0    0 S  0.0  0.0   0:00.00 ksoftirqd/2</pre>
		</div>

<b><font color='green'>p/S</font></b>: Em đã thử tag [code] nhưng thấy output lằng nhằng, không theo thứ tự lắm anh:D.]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/45130.html#278351</guid>
				<link>/hvaonline/posts/list/45130.html#278351</link>
				<pubDate><![CDATA[Mon, 2 Sep 2013 23:09:56]]> GMT</pubDate>
				<author><![CDATA[ emdinoiay]]></author>
			</item>
			<item>
				<title>Nguyên nhân thông số CPU iowait  tăng cao</title>
				<description><![CDATA[ Ram 12G mà gần max rồi. Mysql cũng treo rất lâu rồi. Bạn thử khởi động lại chưa?]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/45130.html#278365</guid>
				<link>/hvaonline/posts/list/45130.html#278365</link>
				<pubDate><![CDATA[Wed, 4 Sep 2013 06:32:28]]> GMT</pubDate>
				<author><![CDATA[ __ikaZuchi]]></author>
			</item>
			<item>
				<title>Nguyên nhân thông số CPU iowait  tăng cao</title>
				<description><![CDATA[ <p></p>
		<cite class="blockquote">__ikaZuchi wrote:</cite><br>
		<blockquote>Ram 12G mà gần max rồi. 
&nbsp;
		</blockquote>
Ram gần hết là chuyện... bình thường mà.
<p></p>
		<cite class="blockquote">__ikaZuchi wrote:</cite><br>
		<blockquote>
Mysql cũng treo rất lâu rồi. 
&nbsp;
		</blockquote>
Dựa vào đâu bạn cho rằng MySQL bị treo vậy? Hơn nữa, "treo" theo ý bạn nghĩa là thế nào?
<p></p>
		<cite class="blockquote">__ikaZuchi wrote:</cite><br>
		<blockquote>
Bạn thử khởi động lại chưa?&nbsp;
		</blockquote><span class="link"> /hvaonline/posts/list/42715.html</span>]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/45130.html#278366</guid>
				<link>/hvaonline/posts/list/45130.html#278366</link>
				<pubDate><![CDATA[Wed, 4 Sep 2013 06:57:22]]> GMT</pubDate>
				<author><![CDATA[ quanta]]></author>
			</item>
			<item>
				<title>Nguyên nhân thông số CPU iowait  tăng cao</title>
				<description><![CDATA[ 1. Về ram thì em tham khảo theo bài viết này:
<span class="link"> /hvaonline/posts/list/37695.html</span>
2. Mysql bị treo thì do em thấy ở cột TIME+ = 427:48.47 khi chạy lệnh <b>top</b>. 
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>man top</pre>
		</div>
<blockquote>      l: TIME  --  CPU Time
          Total CPU time the task has used since it started.  When âCumulative modeâ is On, each process  is
          listed  with  the  cpu  time that it and its dead children has used.  You toggle âCumulative modeâ
          with âSâ, which is a command-line option and an interactive command.  See the âSâ interactive com-
          mand for additional information regarding this mode.

       m: TIME+  --  CPU Time, hundredths
          The same as âTIMEâ, but reflecting more granularity through hundredths of a second.&nbsp;
		</blockquote>
]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/45130.html#278367</guid>
				<link>/hvaonline/posts/list/45130.html#278367</link>
				<pubDate><![CDATA[Wed, 4 Sep 2013 07:23:27]]> GMT</pubDate>
				<author><![CDATA[ __ikaZuchi]]></author>
			</item>
			<item>
				<title>Nguyên nhân thông số CPU iowait  tăng cao</title>
				<description><![CDATA[ <p></p>
		<cite class="blockquote">emdinoiay wrote:</cite><br>
		<blockquote>Cám ơn anh quanta đã quan tâm topic, đây là các thông số anh yêu cầu.

<font color='red'>iotop -o</font>

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>Total DISK READ: 117.94 K/s | Total DISK WRITE: 9.57 M/s
  TID  PRIO  USER     DISK READ  DISK WRITE  SWAPIN     IO&gt;    COMMAND
1018731 be/4 mysql       0.00 B/s    0.00 B/s  0.00 % 99.99 % mysqld --basedir=/ --datadir=/var/lib/mysql --user=mysql ~it=50000 --pid-file=/var/lib/mysql/server.demo.com.pid
  888 be/4 root       11.06 K/s    0.00 B/s  0.00 % 99.99 % exim -q
53579 be/4 mysql       0.00 B/s    0.00 B/s  0.00 % 99.99 % mysqld --basedir=/ --datadir=/var/lib/mysql --user=mysql -~mit=50000 --pid-file=/var/lib/mysql/server.demo.com.pid
 5059 be/3 root        0.00 B/s    0.00 B/s  0.00 % 99.99 % &#91;kjournald&#93;
 2991 be/4 root        0.00 B/s    3.69 K/s  0.00 % 99.99 % &#91;pdflush&#93;
 2515 be/4 root        0.00 B/s    3.69 K/s  0.00 % 99.99 % &#91;pdflush&#93;
 2461 be/4 root        0.00 B/s    7.37 K/s  0.00 % 99.99 % &#91;pdflush&#93;
 2971 be/4 root        0.00 B/s    7.37 K/s  0.00 % 99.99 % &#91;pdflush&#93;
 2997 be/4 root        0.00 B/s    0.00 B/s  0.00 % 92.14 % &#91;pdflush&#93;
 2975 be/4 root        0.00 B/s    3.69 K/s  0.00 % 92.14 % &#91;pdflush&#93;</pre>
		</div>
&nbsp;
		</blockquote>

1 loạt tiến trình <b>[pdflush]</b> được gọi và thực thi việc ghi dữ liệu lên đĩa. <b>Total DISK WRITE: 9.57 M/s</b> theo mình đoán là toàn của pdflush. Bạn thử gõ lệnh này hộ mình xem có bao nhiêu thread của pdflush
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>cat /proc/sys/vm/nr_pdflush_threads</pre>
		</div>

Có thể các thread <b>pdflush</b> này chiếm dụng cpu nên các process sau đó không có khả năng xử lý: <b>kjournald,mysqld.</b>

<b>Tại thời điểm treo</b>, bạn post tiếp cho mình các thông số sau:

<b>/proc/meminfo
/proc/sys/vm/dirty_background_ratio
/proc/sys/vm/dirty_ratio      
/proc/sys/vm/dirty_expire_centisecs
/proc/sys/vm/dirty_writeback_centisecs</b>
]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/45130.html#278369</guid>
				<link>/hvaonline/posts/list/45130.html#278369</link>
				<pubDate><![CDATA[Wed, 4 Sep 2013 09:20:15]]> GMT</pubDate>
				<author><![CDATA[ __ikaZuchi]]></author>
			</item>
			<item>
				<title>Nguyên nhân thông số CPU iowait  tăng cao</title>
				<description><![CDATA[ Xem tốc độ read/write của HDD như vậy là thấp rồi. Dùng thêm hdparm, smartctl để check kỹ HDD xem sao, bên cạnh đó thử Optimize thêm MySQL. ]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/45130.html#278370</guid>
				<link>/hvaonline/posts/list/45130.html#278370</link>
				<pubDate><![CDATA[Wed, 4 Sep 2013 09:24:57]]> GMT</pubDate>
				<author><![CDATA[ azteam]]></author>
			</item>
			<item>
				<title>Nguyên nhân thông số CPU iowait  tăng cao</title>
				<description><![CDATA[ Hì trước hết cám ơn mọi người đã quan tâm topic.
- Nguyên nhân em  xác định không phải do MYSQL. Vì đã tắt nhưng thông số vẫn nhảy thất thường (iowait và idle) và trong khi status service MYSQL vẫn ở trạng thái S, không bị treo như anh ikaZuchi nói:D
 <font color='green'>CPU    %user   %nice  %system  %iowait  %steal     %idle
  all      5.76      0.00      3.26     60.90      0.00     30.08
  all     20.95      0.00     29.18     39.15      0.00     10.72
  all     26.25      0.00     30.50     42.50      0.00      0.75
  all      4.49      0.00      3.99     60.85      0.00     30.67
  all      2.00      0.00      2.00     71.07      0.00     24.94
  all      7.02      0.00      3.01     74.94      0.00     15.04</font>
- Thông số  /proc/sys/vm/nr_pdflush_threads tại thời điểm đó là : <font color='red'>8</font>. 
<font color='green'>cat /proc/sys/vm/nr_pdflush_threads</font>
8
<font color='green'>cat /proc/sys/vm/dirty_background_ratio</font>
10
<font color='green'>cat /proc/sys/vm/dirty_ratio</font>
40
<font color='green'>cat /proc/sys/vm/dirty_expire_centisecs</font>
3000
<font color='green'>cat /proc/sys/vm/dirty_writeback_centisecs</font>
500


Mong tiếp tục nhận được góp ý từ mọi người :D.]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/45130.html#278374</guid>
				<link>/hvaonline/posts/list/45130.html#278374</link>
				<pubDate><![CDATA[Wed, 4 Sep 2013 20:49:20]]> GMT</pubDate>
				<author><![CDATA[ emdinoiay]]></author>
			</item>
			<item>
				<title>Nguyên nhân thông số CPU iowait  tăng cao</title>
				<description><![CDATA[ <p></p>
		<cite class="blockquote">emdinoiay wrote:</cite><br>
		<blockquote>Hì trước hết cám ơn mọi người đã quan tâm topic.
- Nguyên nhân em  xác định không phải do MYSQL. Vì đã tắt nhưng thông số vẫn nhảy thất thường (iowait và idle) và trong khi status service MYSQL vẫn ở trạng thái S, không bị treo như anh ikaZuchi nói:D
 <font color='green'>CPU    %user   %nice  %system  %iowait  %steal     %idle
  all      5.76      0.00      3.26     60.90      0.00     30.08
  all     20.95      0.00     29.18     39.15      0.00     10.72
  all     26.25      0.00     30.50     42.50      0.00      0.75
  all      4.49      0.00      3.99     60.85      0.00     30.67
  all      2.00      0.00      2.00     71.07      0.00     24.94
  all      7.02      0.00      3.01     74.94      0.00     15.04</font>
Mong tiếp tục nhận được góp ý từ mọi người :D.&nbsp;
		</blockquote>
Màu mè quá nhỉ?:D Nhưng mà mình thích thế;;)
Mà mình có nói nguyên nhân do MySQL đâu nhỉ, chắc bạn hiểu nhầm ý mình. 
<blockquote>Có thể các thread pdflush này chiếm dụng cpu nên các process sau đó không có khả năng xử lý: kjournald,mysqld.&nbsp;
		</blockquote>
<p></p>
		<cite class="blockquote">emdinoiay wrote:</cite><br>
		<blockquote>- Thông số  /proc/sys/vm/nr_pdflush_threads tại thời điểm đó là : <font color='red'>8</font>. 
<font color='green'>cat /proc/sys/vm/nr_pdflush_threads</font>
8
<font color='green'>cat /proc/sys/vm/dirty_background_ratio</font>
10
<font color='green'>cat /proc/sys/vm/dirty_ratio</font>
40
<font color='green'>cat /proc/sys/vm/dirty_expire_centisecs</font>
3000
<font color='green'>cat /proc/sys/vm/dirty_writeback_centisecs</font>
500&nbsp;
		</blockquote>
Bạn post thiếu phần quan trọng nhất
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>/proc/meminfo</pre>
		</div> 
pdflush thread có 8 là thế quái nào nhỉ? Trong lệnh<b> iotop -o</b> của bạn thì <b>Total DISK WRITE: 9.57 M/s</b> mà mỗi 1 process pdflush write có <b>3.69 K/s</b>
Các thông số bạn đưa ra, mình sẽ giúp bạn chỉnh sửa sau khi có nhiều thông tin hơn.
Ngoài ra, bạn bổ sung thêm cho mình các thông tin sau
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>iostat -m -x 2 5 | awk '{print $12}'</pre>
		</div>
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>for x in `seq 1 1 3`; do ps -eo state,pid,cmd | grep "^D"; echo "---";sleep 3; done</pre>
		</div>
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>cat /proc/&lt;pid&gt;/io</pre>
		</div>
Trong đó &lt;pid&gt; là id của process có IO &gt;99% ở câu lệnh <b>iotop -o</b>
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>lsof -p &lt;pid&gt;</pre>
		</div>
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>free</pre>
		</div>
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>iostat -kd 1 1</pre>
		</div>
<i>P/S: Bạn thực hiện lại toàn bộ các câu lệnh: <b>top, iotop -o</b> và các câu lệnh mới thêm ở cùng 1 thời điểm để dễ chẩn đoán hơn</i>]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/45130.html#278382</guid>
				<link>/hvaonline/posts/list/45130.html#278382</link>
				<pubDate><![CDATA[Thu, 5 Sep 2013 09:47:08]]> GMT</pubDate>
				<author><![CDATA[ __ikaZuchi]]></author>
			</item>
			<item>
				<title>Nguyên nhân thông số CPU iowait  tăng cao</title>
				<description><![CDATA[ Cám ơn anh ikaZuchi đã sớm phản hồi. Một chú ý là thông số DISK WRITE trong iotop nhảy rất thất thường (từ mấy chục Kb/s lên vài trăm Mb/s, khi này em toàn thấy tiến trình pdflush)
Đây là các thông số anh cần:

<font color='red'>cat /proc/meminfo</font>
MemTotal:     12276152 kB
MemFree:       1335936 kB
Buffers:        651664 kB
Cached:        7831208 kB
SwapCached:          0 kB
Active:        8059352 kB
Inactive:      2110416 kB
HighTotal:           0 kB
HighFree:            0 kB
LowTotal:     12276152 kB
LowFree:       1335936 kB
SwapTotal:    16777208 kB
SwapFree:     16777096 kB
Dirty:         1545084 kB
Writeback:         376 kB
AnonPages:     1686680 kB
Mapped:          38476 kB
Slab:           655600 kB
PageTables:      22416 kB
NFS_Unstable:        0 kB
Bounce:              0 kB
CommitLimit:  22915284 kB
Committed_AS:  4119172 kB
VmallocTotal: 34359738364 kB
VmallocUsed:    323064 kB
VmallocChunk: 34359413900 kB
HugePages_Total:     0
HugePages_Free:      0
HugePages_Rsvd:      0
Hugepagesize:     2048 kB


<font color='red'>iostat -m -x 2 5 | awk '{print $12}'</font>

%util
96.44
0.01
96.44
96.45
0.00

%util
100.05
0.00
100.05
100.10
0.00

%util
99.65
0.00
99.65
99.60
0.00

%util
100.05
0.00
100.05
100.05
0.00
--

<font color='red'>for x in `seq 1 1 3`; do ps -eo state,pid,cmd | grep "^D"; echo "---";sleep 3; done</font>

D    2154 [kjournald]
D    5082 [loop0]
D    7116 syslogd -m 0
D   10330 /usr/bin/python -tt /usr/sbin/lvestats-server
D  989305 [pdflush]
D  989361 /usr/sbin/sendmail -f root -t
D  989420 [pdflush]
---
D    2154 [kjournald]
D    7116 syslogd -m 0
D   10330 /usr/bin/python -tt /usr/sbin/lvestats-server
D  989305 [pdflush]
D  989361 /usr/sbin/sendmail -f root -t
D  989420 [pdflush]
---
D    2154 [kjournald]
D    7116 syslogd -m 0
D   10330 /usr/bin/python -tt /usr/sbin/lvestats-server
D  989305 [pdflush]
D  989361 /usr/sbin/sendmail -f root -t
D  989420 [pdflush]

---
<font color='red'>cat /proc/989483/io</font>
rchar: 0
wchar: 0
syscr: 0
syscw: 0
read_bytes: 0
write_bytes: 26509312
cancelled_write_bytes: 0
<font color='red'> lsof -p 989483</font>
COMMAND    PID USER   FD      TYPE DEVICE SIZE/OFF NODE NAME
pdflush 989483 root  cwd       DIR  253,0     4096    2 /
pdflush 989483 root  rtd       DIR  253,0     4096    2 /
pdflush 989483 root  txt   unknown                      /proc/989483/exe
free 
             total       used       free     shared    buffers     cached
Mem:      12276152   12211308      64844          0     565560    7210292
-/+ buffers/cache:    4435456    7840696
Swap:     16777208        112   16777096

<font color='red'>iostat -kd 1 1</font>

Device:            tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn
sda             223.45       420.07     13846.98   86628600 2855610956
sda1              0.00         0.01         0.00       1211         12
sda2            223.45       420.06     13846.98   86627249 2855610944
dm-0           3498.06       420.06     13847.07   86626633 2855629204
dm-1              0.00         0.00         0.00        624        116

p/S: Hơi đau mắt, mong mọi người bỏ tí thời gian xem qua. Biết đâu sau này rơi vào trường hợp này;).]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/45130.html#278383</guid>
				<link>/hvaonline/posts/list/45130.html#278383</link>
				<pubDate><![CDATA[Thu, 5 Sep 2013 20:59:01]]> GMT</pubDate>
				<author><![CDATA[ emdinoiay]]></author>
			</item>
			<item>
				<title>Nguyên nhân thông số CPU iowait  tăng cao</title>
				<description><![CDATA[ Dựa trên những thông tin bạn đưa, mình có 1 số nhận định như này:
<p></p>
		<cite class="blockquote">emdinoiay wrote:</cite><br>
		<blockquote>cat /proc/meminfo
MemTotal: 12276152 kB
MemFree: 1335936 kB
Buffers: 651664 kB
Cached: 7831208 kB
SwapCached: 0 kB
Active: 8059352 kB
Inactive: 2110416 kB
HighTotal: 0 kB
HighFree: 0 kB
LowTotal: 12276152 kB
LowFree: 1335936 kB
SwapTotal: 16777208 kB
SwapFree: 16777096 kB
Dirty: 1545084 kB
Writeback: 376 kB
AnonPages: 1686680 kB
Mapped: 38476 kB
Slab: 655600 kB
PageTables: 22416 kB
NFS_Unstable: 0 kB
Bounce: 0 kB
CommitLimit: 22915284 kB
Committed_AS: 4119172 kB
VmallocTotal: 34359738364 kB
VmallocUsed: 323064 kB
VmallocChunk: 34359413900 kB
HugePages_Total: 0
HugePages_Free: 0
HugePages_Rsvd: 0
Hugepagesize: 2048 kB &nbsp;
		</blockquote>
<p></p>
		<cite class="blockquote">emdinoiay wrote:</cite><br>
		<blockquote>cat /proc/sys/vm/dirty_background_ratio
10 &nbsp;
		</blockquote>
Đây là điều kiện thứ 2 để gọi thread pdflush, với server của bạn thì hàm sẽ được gọi ra khi dung lượng của Dirty "xấp xỉ" 910MB, nhưng ở đây Dirty đã lên đến hơn 1500MB. 
Cộng với thông tin này: 
<p></p>
		<cite class="blockquote">emdinoiay wrote:</cite><br>
		<blockquote>- Thông số /proc/sys/vm/nr_pdflush_threads tại thời điểm đó là : 8.
cat /proc/sys/vm/nr_pdflush_threads
8 &nbsp;
		</blockquote>
8 là giá trị mặc định lớn nhất cho phép số lượng thread gọi ra. Có thể chỉnh sửa số lượng thread cho phép này nhưng không nên. Vậy nên điều này cho thấy pdflush đã làm việc hết công suất nhưng cũng không xử lí được hết các dirty pages.
<p></p>
		<cite class="blockquote">emdinoiay wrote:</cite><br>
		<blockquote>iostat -kd 1 1

Device: tps kB_read/s kB_wrtn/s kB_read kB_wrtn
sda 223.45 420.07 13846.98 86628600 2855610956
sda1 0.00 0.01 0.00 1211 12
sda2 223.45 420.06 13846.98 86627249 2855610944
dm-0 3498.06 420.06 13847.07 86626633 2855629204
dm-1 0.00 0.00 0.00 624 116 &nbsp;
		</blockquote>
Tốc độ ghi đĩa của bạn khoảng <b>15MB/s</b>
Độ ưu tiên của các thông số, từ trên xuống dưới:
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>/proc/sys/vm/dirty_expire_centisecs 
/proc/sys/vm/dirty_background_ratio 
/proc/sys/vm/dirty_ratio</pre>
		</div>
Bây giờ bạn thử chỉnh sửa lại cho mình như này:
Ghi thông số của Dirty trong /proc/meminfo ở thời điểm hiện tại gọi là: <b>$dirty_current</b> (MB)
Ghi thông số của Dirty trong /proc/meminfo <b>5s sau đó</b> gọi là: <b>$dirty_later</b> (MB)
Chỉnh sửa <b>/proc/sys/vm/dirty_expire_centisecs</b> theo công thức như sau:
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>/proc/sys/vm/dirty_expire_centisecs = 3000*15*5/&#40;$dirty_later - $dirty_current&#41;</pre>
		</div>
Sau đó khởi động lại. Nếu trên <font color='red'>500 </font>thì tiếp tục theo dõi, còn nếu nhỏ hơn thì báo mình.]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/45130.html#278409</guid>
				<link>/hvaonline/posts/list/45130.html#278409</link>
				<pubDate><![CDATA[Mon, 9 Sep 2013 00:53:10]]> GMT</pubDate>
				<author><![CDATA[ __ikaZuchi]]></author>
			</item>
			<item>
				<title>Nguyên nhân thông số CPU iowait  tăng cao</title>
				<description><![CDATA[ Cám ơn anh ikaZuchi nhiều:D, mấy hôm nay về quê nên không phản hồi anh được, có gì em sẽ sớm phản hồi nhé.]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/45130.html#278427</guid>
				<link>/hvaonline/posts/list/45130.html#278427</link>
				<pubDate><![CDATA[Tue, 10 Sep 2013 22:22:32]]> GMT</pubDate>
				<author><![CDATA[ emdinoiay]]></author>
			</item>
	</channel>
</rss>
