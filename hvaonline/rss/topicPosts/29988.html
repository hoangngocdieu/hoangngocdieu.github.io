<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0">
	<channel>
		<title><![CDATA[Latest posts for the topic "Auto Backup DB và gửi vào email chọn trước với Cronjob"]]></title>
		<link>http://www.hvaonline.net/hvaonline/posts/list/23.html</link>
		<description><![CDATA[Latest messages posted in the topic "Auto Backup DB và gửi vào email chọn trước với Cronjob"]]></description>
		<generator>JForum - http://www.jforum.net</generator>
			<item>
				<title>Auto Backup DB và gửi vào email chọn trước với Cronjob</title>
				<description><![CDATA[ Với những ai làm Web có DB thì việc mất DB thật sự là một thảm họa. Nhưng cũng có cách để hạn chế điều đó, đơn giản nhất là backup DB thường xuyên. Nhưng hiếm ai đủ thời gian để làm việc đó manually. Nên chúng ta có thể kết hợp 1 đoạn script PHP + CronJob làm việc này tự động. Đầu tiên ta có thể dùng đoạn script sau:
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>&lt;?php
/*
* Backup script on server.
*
* Runs on the server, called by Cron. Connects to the mySQL
* database and creates a backup file of the whole database.
* Saves to file in current directory.
*
* @author Cow &lt;cow@invisionize.com&gt;
* @version 0.2
* @date 18/08/2004
* @package Backup Server
* Upgraded Ver 2.0 &#40;sending sql backup as attachment
* as email attachment, or send to a remote ftp server by
* @co-authors Cool Surfer&lt;Coolsurfer@gmail.com&gt; and
* Neagu Mihai&lt;neagumihai@hotmail.com&gt;
*/

set_time_limit&#40;0&#41;;
$date = date&#40;"mdy-hia"&#41;;
$dbserver = "localhost";
$dbuser = "user";
$dbpass = "pass";
$dbname = "database_name";
$file = "Blog-$date.sql.gz";
$gzip = TRUE;
$silent = TRUE;

function write&#40;$contents&#41; {
if &#40;$GLOBALS&#91;'gzip'&#93;&#41; {
gzwrite&#40;$GLOBALS&#91;'fp'&#93;, $contents&#41;;
} else {
fwrite&#40;$GLOBALS&#91;'fp'&#93;, $contents&#41;;
}
}

mysql_connect &#40;$dbserver, $dbuser, $dbpass&#41;;
mysql_select_db&#40;$dbname&#41;;

if &#40;$gzip&#41; {
$fp = gzopen&#40;$file, "w"&#41;;
} else {
$fp = fopen&#40;$file, "w"&#41;;
}

$tables = mysql_query &#40;"SHOW TABLES"&#41;;
while &#40;$i = mysql_fetch_array&#40;$tables&#41;&#41; {
$i = $i&#91;'Tables_in_'.$dbname&#93;;

if &#40;!$silent&#41; {
echo "Backing up table ".$i."\n";
}

// Create DB code
$create = mysql_fetch_array&#40;mysql_query &#40;"SHOW CREATE TABLE ".$i&#41;&#41;;

write&#40;$create&#91;'Create Table'&#93;.";\n\n"&#41;;

// DB Table content itself
$sql = mysql_query &#40;"SELECT * FROM ".$i&#41;;
if &#40;mysql_num_rows&#40;$sql&#41;&#41; {
while &#40;$row = mysql_fetch_row&#40;$sql&#41;&#41; {
foreach &#40;$row as $j =&gt; $k&#41; {
$row&#91;$j&#93; = "'".mysql_escape_string&#40;$k&#41;."'";
}

write&#40;"INSERT INTO $i VALUES&#40;".implode&#40;",", $row&#41;."&#41;;\n"&#41;;
}
}
}

$gzip ? gzclose&#40;$fp&#41; : fclose &#40;$fp&#41;;

// Optional Options You May Optionally Configure

$use_gzip = "yes"; // Set to No if you don't want the files sent in .gz format
$remove_sql_file = "yes"; // Set this to yes if you want to remove the sql file after gzipping. Yes is recommended.
$remove_gzip_file = "no"; // Set this to yes if you want to delete the gzip file also. I recommend leaving it to "no"

// Configure the path that this script resides on your server.

$savepath = ""; // Full path to this directory. Do not use trailing slash!

$send_email = "yes"; /* Do you want this database backup sent to your email? Yes/No? If Yes, Fill out the next 2 lines */
$to = "email_can_gui_den@domain.com"; // Who to send the emails to, enter ur correct id.
$from = "email_gui_di@domain.com"; // Who should the emails be sent from?, may change it.

$senddate = date&#40;"j F Y"&#41;;

$subject = "MySQL Database Backup - $senddate"; // Subject in the email to be sent.
$message = "Your MySQL database has been backed up and is attached to this email"; // Brief Message.

$use_ftp = "no"; // Do you want this database backup uploaded to an ftp server? Fill out the next 4 lines
$ftp_server = "ftp.diendanpascal.com"; // FTP hostname
$ftp_user_name = "mutsu"; // FTP username
$ftp_user_pass = "leauwater"; // FTP password
$ftp_path = "/"; // This is the path to upload on your ftp server!

// Do not Modify below this line! It will void your warranty &lt;img src="http://bigball.info/wp-includes/images/smilies/icon_biggrin.gif" alt=":-D" class="wp-smiley"&gt; !

$date = date&#40;"mdy-hia"&#41;;
$filename = "$savepath/$dbname-$date.sql";

if&#40;$use_gzip=="yes"&#41;{
$filename2 = $file;
} else {
$filename2 = "$savepath/$dbname-$date.sql";
}

if&#40;$send_email == "yes" &#41;{
$fileatt_type = filetype&#40;$filename2&#41;;
$fileatt_name = "".$dbname."-".$date."_sql.tar.gz";

$headers = "From: $from";

// Read the file to be attached &#40;'rb' = read binary&#41;
echo "Openning archive for attaching:".$filename2;
$file = fopen&#40;$filename2,'rb'&#41;;
$data = fread&#40;$file,filesize&#40;$filename2&#41;&#41;;
fclose&#40;$file&#41;;

// Generate a boundary string
$semi_rand = md5&#40;time&#40;&#41;&#41;;
$mime_boundary = "==Multipart_Boundary_x{$semi_rand}x";

// Add the headers for a file attachment
$headers .= "\nMIME-Version: 1.0\n" ."Content-Type: multipart/mixed;\n" ." boundary=\"{$mime_boundary}\"";

// Add a multipart boundary above the plain message
$message = "This is a multi-part message in MIME format.\n\n"."--{$mime_boundary}\n" ."Content-Type: text/plain; charset=\"iso-8859-1\"\n" ."Content-Transfer-Encoding: 7bit\n\n" .
$message . "\n\n";

// Base64 encode the file data
$data = chunk_split&#40;base64_encode&#40;$data&#41;&#41;;

// Add file attachment to the message
echo "|{$mime_boundary}|{$fileatt_type}|{$fileatt_name}| {$fileatt_name}|{$mime_boundary}|&lt;BR&gt;";
$message .= "--{$mime_boundary}\n" ."Content-Type: {$fileatt_type};\n" ." name=\"{$fileatt_name}\"\n"."Content-Disposition: attachment;\n" ." filename=\"{$fileatt_name}\"\n" ."Content-Transfer-Encoding: base64\n\n" .
$data . "\n\n" ."--{$mime_boundary}--\n";
//$message.= "--{$mime_boundary}\n" ."Content-Type: {$fileatt_type};\n" ." name=\"{$fileatt_name}\"\n" "Content-Disposition: attachment;\n" ." filename=\"{$fileatt_name}\"\n" ."Content-Transfer-Encoding: base64\n\n" .
// $data . "\n\n" ."--{$mime_boundary}--\n";

// Send the message
$ok = @mail&#40;$to, $subject, $message, $headers&#41;;
if &#40;$ok&#41; {
echo "&lt;h4&gt;&lt;center&gt;&lt;bg color=black&gt;&lt;font color= blue&gt;Database backup created and sent! File name $filename2 &lt;/p&gt;
Idea Conceived By coolsurfer@gmail.com
Programmer email: neagumihai@hotmail.com&lt;/p&gt;
This is our first humble effort, pl report bugs, if U find any...&lt;/p&gt;
Email me at &lt;&gt;coolsurfer@gmail.com nJoY!! &lt;img src="http://bigball.info/wp-includes/images/smilies/icon_smile.gif" alt=":&#41;" class="wp-smiley"&gt;
&lt;/color&gt;&lt;/center&gt;&lt;/h4&gt;";

} else {
echo "&lt;h4&gt;&lt;center&gt;Mail could not be sent. Sorry!&lt;/center&gt;&lt;/h4&gt;";
}
}

if&#40;$use_ftp == "yes"&#41;{
$ftpconnect = "ncftpput -u $ftp_user_name -p $ftp_user_pass -d debsender_ftplog.log -e dbsender_ftplog2.log -a -E -V $ftp_server $ftp_path $filename2";
shell_exec&#40;$ftpconnect&#41;;
echo "&lt;h4&gt;&lt;center&gt;$filename2 Was created and uploaded to your FTP server!&lt;/center&gt;&lt;/h4&gt;";

}

if&#40;$remove_gzip_file=="yes"&#41;{
exec&#40;"rm -r -f $filename2"&#41;;
}
?&gt;</pre>
		</div>
Script này mình tìm được trên net. Các bạn thay thế user + pass + db name + email email mà DB sẽ được gửi đến + email gửi đi cho phù hợp. Save lại thành backup.php và sau đó up lên host test thử.<span class="link"> http://domaincuaban.com/backup.php.</span> Vào mail kiểm tra nếu thấy DB được gửi về là mọi chuyện đã Ok. Xong được 50%.

<b>Tiếp thao là phần Cronjob:</b>
Vì ko phải hosting nào cũng hỗ trợ nên đơn giản nhất là chúng ta dùng 1 cronjob của service nào đó trên net. Mình đang dùng<span class="link"> http://cronless.com.</span> Vào đó reg 1 acc xong login vào. Tiến hành setup cronjob.
Chọn Create New Job
<br>
			<div align="center" class="limitview"><img src='http://img265.imageshack.us/img265/6950/cronjob.png' border="0" onload="maxImg(this, 500px);" /></div>
<b> Nhận tên của Job vào (tùy ý)</b>

<b>Nhập đường dẫn file backup (ở đây là<span class="link"> http://domaincuaban.com/backup.php</span>)</b>

<b>Intraval chọn tùy ý (có thể là 2 lần 1 ngày, 1 lần 1 ngày, 10 phút 1 lần) theo mình nên chọn 1 ngày 1 lần là hợp lý.</b>

<b>Start Date thì chọn  Now (hoặc nhu cầu)</b>

Bấm<b> Create Job.</b>

Thế là xong rồi. DB sẽ được backup hàng ngày và sẽ được gửi về mail của bạn. Khỏi sợ sự cố hosting nữa nhé (hack, suspend, error,...).

Chúc thành công!]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/29988.html#185004</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/29988.html#185004</link>
				<pubDate><![CDATA[Mon, 29 Jun 2009 19:51:29]]> GMT</pubDate>
				<author><![CDATA[ BigballVN]]></author>
			</item>
			<item>
				<title>Auto Backup DB và gửi vào email chọn trước với Cronjob</title>
				<description><![CDATA[ xếp cho hỏi cái với những trang data nó thuộc loại khủng như kiểu hva, ddth, softvnn thì có cách nào hay hơn ko ví dụ lần sau nó send thêm phần thêm hoặc thay đổi cho mình chứ send hết thế này thì chắc chả có mail nào chứa nổi :D]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/29988.html#185012</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/29988.html#185012</link>
				<pubDate><![CDATA[Mon, 29 Jun 2009 20:23:17]]> GMT</pubDate>
				<author><![CDATA[ phanledaivuong]]></author>
			</item>
			<item>
				<title>Auto Backup DB và gửi vào email chọn trước với Cronjob</title>
				<description><![CDATA[ Đã thử qua một số dạng script auto backup như thế này (Backup script on server, MySQL database backup ...), nhưng đều bị lỗi như sau

<blockquote>Fatal error: Allowed memory size of 25165824 bytes exhausted (tried to allocate 15700421 bytes)&nbsp;
		</blockquote>

Kiểm tra lại file php.ini trên host đang dùng thì thấy memory_limit = 24 MB.

Search thông báo lỗi trên google, có thử qua 4 cái thủ thuật này rồi, nhưng không cách nào xài được cả.

<blockquote>To fix the problem, there are 4 actions that you can take...

Fix 1.
If you have access to the php.ini configuration file on your server, you can simply edit the php.ini directive that set the amount of memory to allocate to your php scripts, you would need to edit the line that reads...

memory_limit = 8M
or
memory_limit = 16M

to...

memory_limit = 24M
or
memory_limit = 32M

(note: add the line to the php.ini file if it is missing)
Editing the main php.ini file will probably require a restart of your webserver (apache?)


Fix 2.
If your server allows you to create a php.ini file in your webspace, you can create a simple text file called 'php.ini' with the line 'memory_limit = 24M' in it.
you can upload this file to your webserver into the web document root, eg. public_html or ht_docs folder (where your php script is / html files etc) however it would be better to place it outside of your web document root for security reasons, so uploading it to the parent folder of your web document root folder would be better, and please remember to set the file permissions on it to read only (chmod 644)

Fix 3.
If you do not have access to php.ini but your webspace is able to handle ".htaccess" files then you should be able to set it by adding the following line to your .htaccess file (create a .htaccess file if you don't have one)...

php_value memory_limit 24M

The .htaccess file should be located in your web document root folder. (although it can also be located 'higher' up the server file system)

Fix 4.
At the top of your php script file you can add the following line right after the opening '&lt; ? php' tag...

ini_set("memory_limit","24M");

The above line is a built in php function which will allow you to set the memory size allocated to your php script.

You will only need to use one of the Fixes, not all of them !&nbsp;
		</blockquote>

Nguồn<span class="link"> http://www.codingforums.com/showthread.php?t=157152</span>

Có bạn nào biết cách giải quyết khác không?]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/29988.html#185515</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/29988.html#185515</link>
				<pubDate><![CDATA[Sun, 5 Jul 2009 20:53:15]]> GMT</pubDate>
				<author><![CDATA[ jforum3000]]></author>
			</item>
			<item>
				<title>Auto Backup DB và gửi vào email chọn trước với Cronjob</title>
				<description><![CDATA[ cái này nguy hiểm lắm đừng dùng nha mún tím hiểu thì vào http://vietvbb.vn hay http://hoiquantinhoc.com mà coi đừng tin cái bạn này]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/29988.html#185574</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/29988.html#185574</link>
				<pubDate><![CDATA[Mon, 6 Jul 2009 11:59:40]]> GMT</pubDate>
				<author><![CDATA[ lenhan555]]></author>
			</item>
			<item>
				<title>Auto Backup DB và gửi vào email chọn trước với Cronjob</title>
				<description><![CDATA[ lenhan555, mình xem code thấy có chỗ nào gọi là "nguy hiểm" đâu?]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/29988.html#185583</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/29988.html#185583</link>
				<pubDate><![CDATA[Mon, 6 Jul 2009 13:10:15]]> GMT</pubDate>
				<author><![CDATA[ jforum3000]]></author>
			</item>
	</channel>
</rss>
