<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0">
	<channel>
		<title><![CDATA[Latest posts for the topic "Thảo luận lỗi "RTNETLINK answers: File exists" khi restart network?"]]></title>
		<link>/hvaonline/posts/list/24.html</link>
		<description><![CDATA[Latest messages posted in the topic "Thảo luận lỗi "RTNETLINK answers: File exists" khi restart network?"]]></description>
		<generator>JForum - http://www.jforum.net</generator>
			<item>
				<title>Thảo luận lỗi "RTNETLINK answers: File exists" khi restart network?</title>
				<description><![CDATA[ Sơ đồ mạng: 
<blockquote>Internet &lt;-----&gt; Modem &lt;-----&gt; LAN (chỉ gồm 1 máy duy nhất)&nbsp;
		</blockquote>

Tôi dùng Fedora 9, cấu hình địa chỉ IP tĩnh với thông số như sau:
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre># cat /etc/sysconfig/network-scripts/ifcfg-eth0
# Marvell Technology Group Ltd. 88E8036 PCI-E Fast Ethernet Controller
DEVICE=eth0
BOOTPROTO=none
HWADDR=00:13:a9:4f:84:44
ONBOOT=yes
NM_CONTROLLED=yes
TYPE=Ethernet
USERCTL=yes
PEERDNS=yes
IPV6INIT=no
DHCP_HOSTNAME=xx
DNS1=192.168.1.1
IPADDR=192.168.1.3
NETMASK=255.255.255.0
GATEWAY=192.168.1.1</pre>
		</div>

Thi thoảng, khi restart network, tôi gặp cảnh báo sau:
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre># service network restart
Shutting down interface eth0:                              &#91;  OK  &#93;
Shutting down loopback interface:                          &#91;  OK  &#93;
Disabling IPv4 packet forwarding:  net.ipv4.ip_forward = 0
                                                           &#91;  OK  &#93;
Bringing up loopback interface:                            &#91;  OK  &#93;
Bringing up interface eth0:  RTNETLINK answers: File exists
Error adding address 192.168.1.3 for eth0.
                                                           &#91;  OK  &#93;</pre>
		</div>

Mọi người thử thảo luận xem tại sao lại xuất hiện cảnh báo này? Cách khắc phục như thế nào?
]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/22679.html#134999</guid>
				<link>/hvaonline/posts/list/22679.html#134999</link>
				<pubDate><![CDATA[Wed, 11 Jun 2008 01:47:43]]> GMT</pubDate>
				<author><![CDATA[ quanta]]></author>
			</item>
			<item>
				<title>Re: Thảo luận lỗi "RTNETLINK answers: File exists" khi restart network?</title>
				<description><![CDATA[ Nếu tôi dùng DHCP:
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre># cat /etc/sysconfig/network-scripts/ifcfg-eth0
# Marvell Technology Group Ltd. 88E8036 PCI-E Fast Ethernet Controller
DEVICE=eth0
BOOTPROTO=dhcp
HWADDR=00:13:a9:4f:84:44
ONBOOT=yes
DNS1=192.168.1.1
SEARCH=xx
NM_CONTROLLED=yes
TYPE=Ethernet
USERCTL=yes
PEERDNS=yes
IPV6INIT=no
DHCP_HOSTNAME=xx</pre>
		</div>
thì khi restart network lại gặp cảnh báo sau (mặc dù sau đó vẫn truy cập Internet bình thường)
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre># service network restart
Shutting down interface eth0:                              &#91;  OK  &#93;
Shutting down interface wlan0:                             &#91;  OK  &#93;
Shutting down loopback interface:                          &#91;  OK  &#93;
Bringing up loopback interface:                            &#91;  OK  &#93;
Bringing up interface eth0:  
Determining IP information for eth0...dhclient&#40;28656&#41; is already running - exiting. 

This version of ISC DHCP is based on the release available
on ftp.isc.org.  Features have been added and other changes
have been made to the base software release in order to make
it work better with this distribution.

Please report for this software via the Red Hat Bugzilla site:
   <span class="link"> http://bugzilla.redhat.com</span>

exiting.
 failed.
                                                           &#91;FAILED&#93;</pre>
		</div>
Có ai có hứng thú tìm hiểu nguyên nhân của mấy cái này không nhỉ?]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/22679.html#135956</guid>
				<link>/hvaonline/posts/list/22679.html#135956</link>
				<pubDate><![CDATA[Tue, 17 Jun 2008 03:46:00]]> GMT</pubDate>
				<author><![CDATA[ quanta]]></author>
			</item>
			<item>
				<title>Re: Thảo luận lỗi "RTNETLINK answers: File exists" khi restart network</title>
				<description><![CDATA[ Hì hì, anh chưa gặp tình trạng này bao giờ nên không thể tham gia chủ đề này được em ạ  :P ]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/22679.html#135974</guid>
				<link>/hvaonline/posts/list/22679.html#135974</link>
				<pubDate><![CDATA[Tue, 17 Jun 2008 09:52:35]]> GMT</pubDate>
				<author><![CDATA[ conmale]]></author>
			</item>
			<item>
				<title>Re: Thảo luận lỗi "RTNETLINK answers: File exists" khi restart network?</title>
				<description><![CDATA[ Hi quanta,

Mình dạo quanh google tìm ra được cái này : <span class="link"> http://www.coreth.com/~mpearce/techref/workstation/dhcp.html </span>

Upgrade dhcpclient ver 2 lên ver 3 thử xem :) ]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/22679.html#135976</guid>
				<link>/hvaonline/posts/list/22679.html#135976</link>
				<pubDate><![CDATA[Tue, 17 Jun 2008 10:31:20]]> GMT</pubDate>
				<author><![CDATA[ dabu]]></author>
			</item>
			<item>
				<title>Re: Thảo luận lỗi "RTNETLINK answers: File exists" khi restart network?</title>
				<description><![CDATA[ <p></p>
		<cite class="blockquote">dabu wrote:</cite><br>
		<blockquote>Hi quanta,

Mình dạo quanh google tìm ra được cái này : <span class="link"> http://www.coreth.com/~mpearce/techref/workstation/dhcp.html </span>

Upgrade dhcpclient ver 2 lên ver 3 thử xem :) &nbsp;
		</blockquote>
Hì, đây anh:
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>$ dhclient --version
isc-dhclient-4.0.0</pre>
		</div>
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>$ dhclient -V
Internet Systems Consortium DHCP Client 4.0.0
Copyright 2004-2007 Internet Systems Consortium.
All rights reserved.
For info, please visit<span class="link"> http://www.isc.org/sw/dhcp/</span></pre>
		</div>

Có vài chỗ cần phải tìm hiểu. Ở trường hợp 1 (private static IP):
+ RTNETLINK là cái gì?
+ Đoạn script nào sẽ chạy khi restart network và nó làm những gì? 

Ở trường hợp 2, khi dùng DHCP, /sbin/dhclient-script đóng vai trò gì, tại sao sau khi shutdown eth0, mà dhclient vẫn chạy?]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/22679.html#135996</guid>
				<link>/hvaonline/posts/list/22679.html#135996</link>
				<pubDate><![CDATA[Tue, 17 Jun 2008 12:31:18]]> GMT</pubDate>
				<author><![CDATA[ quanta]]></author>
			</item>
			<item>
				<title>Re: Thảo luận lỗi "RTNETLINK answers: File exists" khi restart network?</title>
				<description><![CDATA[ Hi quanta,

+ Thằng RTNETLINK đọc và setup các route,... Nếu khi thiết lập cho thằng eth0, RTNETLINK thấy đã có route tồn tại rồi (192.168..1.3 -&gt; 192.168.1.1) thì nó sẽ báo là file exists. Đây không phải là lỗi, và mạng vẫn làm việc bình thường.

+ Thằng dhclient theo mặc định luôn chạy khi khởi động. Sau đó mới tìm đến tất cả Network interface, xem cái nào có hỗ trợ DHCP, BOOTP thì nó phun script ra. Bởi vậy nên có shutdown thằng eth0 rồi thì nó vẫn chạy như thường. (Kill chắc nó ko chạy nữa :D)

+ Cái script dhclient-script chỉ là hiện thực hóa những thiết lập trong dhclient.conf thôi. ]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/22679.html#136019</guid>
				<link>/hvaonline/posts/list/22679.html#136019</link>
				<pubDate><![CDATA[Tue, 17 Jun 2008 13:31:22]]> GMT</pubDate>
				<author><![CDATA[ FaL]]></author>
			</item>
			<item>
				<title>Re: Thảo luận lỗi "RTNETLINK answers: File exists" khi restart network?</title>
				<description><![CDATA[ Hình như lỗi này xảy ra khi Add thêm vào 1 default Gateway trong route nữa.
Kiểm tra thử xem trong Script có thằng nào add thêm gateway cho nó không.
Thử xài lệnh ip route sẽ ra hết các Default Gateway. Nó chạy bình thường là đúng vì máy vẫn giữ IP đó. Nhưng nếu khi đổi IP của gateway vả Restart network lại thì có thể sẽ không vào mạng nữa lúc đó phải xài lệnh ip route del để xóa Gateway đó rồi ip route add để thêm vào lại.
À thử   
ip route del default
trước khi restart lại netword xem có còn bị lỗi đó không]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/22679.html#136213</guid>
				<link>/hvaonline/posts/list/22679.html#136213</link>
				<pubDate><![CDATA[Wed, 18 Jun 2008 12:56:08]]> GMT</pubDate>
				<author><![CDATA[ afterlastangel]]></author>
			</item>
			<item>
				<title>Re: Thảo luận lỗi "RTNETLINK answers: File exists" khi restart network?</title>
				<description><![CDATA[ <p></p>
		<cite class="blockquote">FaL wrote:</cite><br>
		<blockquote>Hi quanta,

+ Thằng RTNETLINK đọc và setup các route,... Nếu khi thiết lập cho thằng eth0, RTNETLINK thấy đã có route tồn tại rồi (192.168..1.3 -&gt; 192.168.1.1) thì nó sẽ báo là file exists. Đây không phải là lỗi, và mạng vẫn làm việc bình thường.
&nbsp;
		</blockquote>
OK. Cảm ơn bác. Sẽ điều chế từng "em" một.
<p></p>
		<cite class="blockquote">FaL wrote:</cite><br>
		<blockquote>
+ Thằng dhclient theo mặc định luôn chạy khi khởi động. Sau đó mới tìm đến tất cả Network interface, xem cái nào có hỗ trợ DHCP, BOOTP thì nó phun script ra. <font color='orange'><i>Bởi vậy nên có shutdown thằng eth0 rồi thì nó (dhclient) vẫn chạy như thường</i></font>. (Kill chắc nó ko chạy nữa :D)

+ Cái script dhclient-script chỉ là hiện thực hóa những thiết lập trong dhclient.conf thôi. &nbsp;
		</blockquote>
<font color='orange'>--&gt;</font> Cái này thì không đúng:
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>&#91;root@home ~&#93;# ps aux | grep dhclient
root      2192  0.0  0.0   2576  1168 ?        S    16:22   0:00 /sbin/dhclient -d -sf /usr/libexec/nm-dhcp-client.action -pf /var/run/dhclient-eth0.pid -lf /var/run/dhclient-eth0.lease -cf /etc/dhclient-eth0.conf eth0
root      3265  0.0  0.0   4192   780 pts/1    S+   16:24   0:00 grep dhclient
&#91;root@home ~&#93;# ifdown eth0
&#91;root@home ~&#93;# ps aux | grep dhclient
root      3417  0.0  0.0   4188   760 pts/1    R+   16:25   0:00 grep dhclient</pre>
		</div>

Như vậy là khi start (hoặc up) thì mới có vấn đề:
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre># sh -x ifup eth0
+ unset WINDOW
+ . /etc/init.d/functions
++ TEXTDOMAIN=initscripts
++ umask 022
++ PATH=/sbin:/usr/sbin:/bin:/usr/bin
++ export PATH
++ '&#91;' -z '' '&#93;'
++ COLUMNS=80
++ '&#91;' -z '' '&#93;'
+++ /sbin/consoletype
++ CONSOLETYPE=pty
++ '&#91;' -f /etc/sysconfig/i18n -a -z '' -a -z '' '&#93;'
++ . /etc/profile.d/lang.sh
+++ sourced=0
+++ '&#91;' -n en_US.UTF-8 '&#93;'
+++ saved_lang=en_US.UTF-8
+++ '&#91;' -f /root/.i18n '&#93;'
+++ LANG=en_US.UTF-8
+++ unset saved_lang
+++ '&#91;' 0 = 1 '&#93;'
+++ unset sourced
+++ unset langfile
++ unset LANGSH_SOURCED
++ '&#91;' -z '' '&#93;'
++ '&#91;' -f /etc/sysconfig/init '&#93;'
++ . /etc/sysconfig/init
+++ BOOTUP=color
+++ GRAPHICAL=yes
+++ RES_COL=60
+++ MOVE_TO_COL='echo -en \033&#91;60G'
+++ SETCOLOR_SUCCESS='echo -en \033&#91;0;32m'
+++ SETCOLOR_FAILURE='echo -en \033&#91;0;31m'
+++ SETCOLOR_WARNING='echo -en \033&#91;0;33m'
+++ SETCOLOR_NORMAL='echo -en \033&#91;0;39m'
+++ LOGLEVEL=3
+++ PROMPT=yes
+++ AUTOSWAP=no
++ '&#91;' pty = serial '&#93;'
++ '&#91;' color '!=' verbose '&#93;'
++ INITLOG_ARGS=-q
++ __sed_discard_ignored_files='/\&#40;~\|\.bak\|\.orig\|\.rpmnew\|\.rpmorig\|\.rpmsave\&#41;$/d'
+ cd /etc/sysconfig/network-scripts
+ . ./network-functions
++ PATH=/sbin:/usr/sbin:/bin:/usr/bin
++ export PATH
++ '&#91;' -z '/\&#40;~\|\.bak\|\.orig\|\.rpmnew\|\.rpmorig\|\.rpmsave\&#41;$/d' '&#93;'
+ '&#91;' -f ../network '&#93;'
+ . ../network
++ NETWORKING=yes
++ NETWORKING_IPV6=no
++ HOSTNAME=home.kitty.com
+ CONFIG=eth0
+ '&#91;' -z eth0 '&#93;'
+ need_config eth0
+ local nconfig
+ CONFIG=ifcfg-eth0
+ '&#91;' -f ifcfg-eth0 '&#93;'
+ return
+ '&#91;' -f ifcfg-eth0 '&#93;'
+ '&#91;' 0 '!=' 0 '&#93;'
+ source_config
++ sed 's/^ifcfg-//g'
++ basename ifcfg-eth0
+ DEVNAME=eth0
+ echo ifcfg-eth0
+ grep -q '&#91;^g&#93;-'
+ . ifcfg-eth0
++ DEVICE=eth0
++ BOOTPROTO=dhcp
++ HWADDR=00:13:a9:4f:84:44
++ ONBOOT=yes
++ NM_CONTROLLED=yes
++ TYPE=Ethernet
++ USERCTL=yes
++ PEERDNS=yes
++ IPV6INIT=no
++ DHCP_HOSTNAME=home.kitty.com
++ DNS2=192.168.1.1
++ DNS1=192.168.1.1
+ '&#91;' -r keys-eth0 '&#93;'
+ case "$TYPE" in
+ DEVICETYPE=eth
+ '&#91;' -z eth '&#93;'
+ '&#91;' -z '' -a -n '' '&#93;'
+ '&#91;' -z '' '&#93;'
+ REALDEVICE=eth0
+ '&#91;' eth0 '!=' eth0 '&#93;'
+ ISALIAS=no
+ '&#91;' -n 00:13:a9:4f:84:44 '&#93;'
++ echo 00:13:a9:4f:84:44
++ awk '{ print toupper&#40;$0&#41; }'
+ HWADDR=00:13:A9:4F:84:44
+ '&#91;' -n '' '&#93;'
+ '&#91;' foo = fooboot '&#93;'
+ '&#91;' -n '' '&#93;'
+ '&#91;' -n '' -a Ethernet = Bridge '&#93;'
+ '&#91;' -x /sbin/vconfig -a '' = yes -a no = no '&#93;'
+ '&#91;' '' = yes '&#93;'
+ '&#91;' dhcp = bootp -o dhcp = dhcp '&#93;'
+ DYNCONFIG=true
+ '&#91;' -x /sbin/ifup-pre-local '&#93;'
+ OTHERSCRIPT=/etc/sysconfig/network-scripts/ifup-eth
+ '&#91;' '!' -x /etc/sysconfig/network-scripts/ifup-eth '&#93;'
+ exec /etc/sysconfig/network-scripts/ifup-eth ifcfg-eth0
dhclient&#40;3848&#41; is already running - exiting. 

This version of ISC DHCP is based on the release available
on ftp.isc.org.  Features have been added and other changes
have been made to the base software release in order to make
it work better with this distribution.

Please report for this software via the Red Hat Bugzilla site:
   <span class="link"> http://bugzilla.redhat.com</span>

exiting.</pre>
		</div>

Trong <b>/etc/sysconfig/network-scripts/ifup-eth</b>, có đoạn này:
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>if &#91; -n "${DYNCONFIG}" -a -x /sbin/dhclient &#93;; then
    # Remove any temporary references which were previously added to dhclient config
    if &#91; -w /etc/dhclient-${DEVICE}.conf &#93; ; then
        LC_ALL=C grep -v "# temporary RHL ifup addition" /etc/dhclient-${DEVICE}.conf &gt; /etc/dhclient-${DEVICE}.conf.ifupnew 2&gt; /dev/null
        cat /etc/dhclient-${DEVICE}.conf.ifupnew &gt; /etc/dhclient-${DEVICE}.conf
        rm -f /etc/dhclient-${DEVICE}.conf.ifupnew
    fi
    if &#91;&#91; "${PERSISTENT_DHCLIENT}" =  &#91;yY1&#93;* &#93;&#93;; then
       ONESHOT="";
    else
       ONESHOT="-1";
    fi;
    if &#91; -n "${DHCP_HOSTNAME}" &#93;; then
       # Send a host-name to the DHCP server &#40;requ. by some dhcp servers&#41;.
       if &#91; -w /etc/dhclient-${DEVICE}.conf &#93; ; then
           if ! LC_ALL=C grep "send *host-name *\"${DHCP_HOSTNAME}\"" /etc/dhclient-${DEVICE}.conf &gt; /dev/null 2&gt;&1 ; then
               echo "send host-name \"${DHCP_HOSTNAME}\";  # temporary RHL ifup addition" &gt;&gt; /etc/dhclient-${DEVICE}.conf
           fi
       elif ! &#91; -e /etc/dhclient-${DEVICE}.conf &#93; ; then
           echo "send host-name \"${DHCP_HOSTNAME}\";  # temporary RHL ifup addition" &gt;&gt; /etc/dhclient-${DEVICE}.conf
       fi
    fi
    # allow users to use generic '/etc/dhclient.conf' &#40;as documented in manpage!&#41; 
    # if per-device file doesn't exist or is empty
    if &#91; -s /etc/dhclient-${DEVICE}.conf &#93;; then
       DHCLIENTCONF="-cf /etc/dhclient-${DEVICE}.conf";
    else
       DHCLIENTCONF='';
    fi;
    # copy any lease obtained by the initrd
    if &#91; -f /dev/.dhclient-${DEVICE}.leases &#93; ; then
    	mv -f /dev/.dhclient-${DEVICE}.leases /var/lib/dhclient/dhclient-${DEVICE}.leases
	&#91; -x /sbin/restorecon &#93; && restorecon /var/lib/dhclient/dhclient-${DEVICE}.leases &gt; /dev/null 2&gt;&1
    fi
    DHCLIENTARGS="${DHCLIENTARGS} ${ONESHOT} -q ${DHCLIENTCONF} -lf /var/lib/dhclient/dhclient-${DEVICE}.leases -pf /var/run/dhclient-${DEVICE}.pid"
    echo
    echo -n $"Determining IP information for ${DEVICE}..."
    if &#91;&#91; "${PERSISTENT_DHCLIENT}" !=  &#91;yY1&#93;* &#93;&#93; && check_link_down ${DEVICE}; then
	echo $" failed; no link present.  Check cable?"
	ip link set dev ${DEVICE} down &gt;/dev/null 2&gt;&1
	exit 1
    fi

    if &#91; -n "$ETHTOOL_OPTS" &#93; ; then
        /sbin/ethtool -s ${REALDEVICE} $ETHTOOL_OPTS
    fi

    if /sbin/dhclient ${DHCLIENTARGS} ${DEVICE} ; then
	echo $" done."
    else
	echo $" failed."
	exit 1
    fi
# end dynamic device configuration</pre>
		</div>

Stop network và chạy thử lệnh:
<b># sh -x /etc/sysconfig/network-scripts/ifup-eth /etc/sysconfig/network-scripts/ifcfg-eth0</b>

thì được:
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>...
+ /sbin/dhclient -1 -q -cf /etc/dhclient-eth0.conf -lf /var/lib/dhclient/dhclient-eth0.leases -pf /var/run/dhclient-eth0.pid eth0
dhclient&#40;7169&#41; is already running - exiting. 

This version of ISC DHCP is based on the release available
on ftp.isc.org.  Features have been added and other changes
have been made to the base software release in order to make
it work better with this distribution.

Please report for this software via the Red Hat Bugzilla site:
   <span class="link"> http://bugzilla.redhat.com</span>

exiting.
+ echo ' failed.'
 failed.
+ exit 1</pre>
		</div>

Như vậy là cái warning trên do thằng /sbin/dhclient phun ra. Có thể khẳng định thêm bằng cách:
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre># grep -lir "is already running - exiting" /sbin
/sbin/dhclient</pre>
		</div>

Có lẽ cần phải download source code của dhclient về và compile lại xem thế nào? ]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/22679.html#136285</guid>
				<link>/hvaonline/posts/list/22679.html#136285</link>
				<pubDate><![CDATA[Wed, 18 Jun 2008 19:11:26]]> GMT</pubDate>
				<author><![CDATA[ quanta]]></author>
			</item>
			<item>
				<title>Re: Thảo luận lỗi "RTNETLINK answers: File exists" khi restart network?</title>
				<description><![CDATA[ Lạ nhỉ, không bạn nào dùng F9 và gặp cái lỗi giống tôi sao?

Gác thằng DHCP sang một bên, ta quay lại điều chế "em" này:
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre># service network restart
Shutting down interface eth0:                              &#91;  OK  &#93;
Shutting down loopback interface:                          &#91;  OK  &#93;
Disabling IPv4 packet forwarding:  net.ipv4.ip_forward = 0
                                                           &#91;  OK  &#93;
Bringing up loopback interface:                            &#91;  OK  &#93;
Bringing up interface eth0:  RTNETLINK answers: File exists
Error adding address 192.168.1.3 for eth0.
                                                           &#91;  OK  &#93;</pre>
		</div>

Dự đoán nguyên nhân thì đúng như <b>FaL</b> và <b>afterlastangel</b> nói rồi. Giờ ta thử "debug" xem nó phun ra từ đâu.

- Stop network lại
- Start nó lên ở chế độ "debug":
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre># sh -x /etc/init.d/network start
...

+ action 'Bringing up interface eth0: ' ./ifup eth0 boot
+ local STRING rc
+ STRING='Bringing up interface eth0: '
+ echo -n 'Bringing up interface eth0:  '
Bringing up interface eth0:  + '&#91;' '' '!=' '' -a -w /etc/rhgb/temp/rhgb-console '&#93;'
+ shift
+ ./ifup eth0 boot
RTNETLINK answers: File exists
Error adding address 192.168.1.99 for eth0.
+ success 'Bringing up interface eth0: '
...</pre>
		</div>
Như vậy là nó "chết" ở:
<blockquote><font color='orange'>./ifup eth0 boot</font>&nbsp;
		</blockquote>

Lại stop network và chạy tiếp lệnh trên ở "debug mode":
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre># sh -x /etc/sysconfig/network-scripts/ifup eth0 boot
...

+ OTHERSCRIPT=/etc/sysconfig/network-scripts/ifup-eth
+ '&#91;' '!' -x /etc/sysconfig/network-scripts/ifup-eth '&#93;'
+ exec /etc/sysconfig/network-scripts/ifup-eth ifcfg-eth0 boot
RTNETLINK answers: File exists
Error adding address 192.168.1.99 for eth0.</pre>
		</div>

Tiếp tục:
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre># sh -x /etc/sysconfig/network-scripts/ifup-eth ifcfg-eth0 boot
...

+ LC_ALL=C
+ ip addr ls eth0
+ LC_ALL=C
+ grep -q 192.168.1.99/24
+ arping -q -c 2 -w 3 -D -I eth0 192.168.1.99
+ ip addr add 192.168.1.99/24 brd 192.168.1.255 dev eth0 label eth0
RTNETLINK answers: File exists
+ echo 'Error adding address 192.168.1.99 for eth0.'
Error adding address 192.168.1.99 for eth0.</pre>
		</div>

OK, như vậy là đoạn code này:
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>if ! ip addr add ${IPADDR}/${PREFIX} \
            brd ${BROADCAST:-+} dev ${REALDEVICE} ${SCOPE} label ${DEVICE}; then
            echo $"Error adding address ${IPADDR} for ${DEVICE}."
       fi</pre>
		</div>
trong file <b>/etc/sysconfig/network-scripts/ifup-eth</b> phun ra cái warning trên.

Sửa lại đoạn script trên để xem "routing table" trước và sau khi chạy lệnh đó, đồng thời bỏ tùy chọn <b>-q</b> (quiet) trong lệnh <b>arping</b> xem nó  phun ra cái gì:
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>if ! LC_ALL=C ip addr ls ${REALDEVICE} | LC_ALL=C grep -q "${IPADDR}/${PREFIX}" ; then
         route -n
         if ! arping -c 2 -w 3 -D -I ${REALDEVICE} ${IPADDR} ; then
            echo $"Error, some other host already uses address ${IPADDR}."
            exit 1
         fi
         route -n
         if ! ip addr add ${IPADDR}/${PREFIX} \
            brd ${BROADCAST:-+} dev ${REALDEVICE} ${SCOPE} label ${DEVICE}; then
            echo $"Error adding address ${IPADDR} for ${DEVICE}."
         fi
    fi</pre>
		</div>

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre># sh -x /etc/sysconfig/network-scripts/ifup-eth ifcfg-eth0 boot
...

+ LC_ALL=C
+ ip addr ls eth0
+ LC_ALL=C
+ grep -q 192.168.1.99/24
+ route -n
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
+ arping -c 2 -w 3 -D -I eth0 192.168.1.99
ARPING 192.168.1.99 from 0.0.0.0 eth0
Sent 2 probes &#40;2 broadcast&#40;s&#41;&#41;
Received 0 response&#40;s&#41;
+ route -n
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
192.168.1.0     0.0.0.0         255.255.255.0   U     0      0        0 eth0
0.0.0.0         192.168.1.1     0.0.0.0         UG    0      0        0 eth0
+ ip addr add 192.168.1.99/24 brd 192.168.1.255 dev eth0 label eth0
RTNETLINK answers: File exists
+ echo 'Error adding address 192.168.1.99 for eth0.'
Error adding address 192.168.1.99 for eth0.</pre>
		</div>

Tóm lại, vấn đề mấu chốt là mời mọi người thảo luận về đoạn script ở trên:
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>#        if ! ip addr add ${IPADDR}/${PREFIX} \
#           brd ${BROADCAST:-+} dev ${REALDEVICE} ${SCOPE} label ${DEVICE}; then
#           echo $"Error adding address ${IPADDR} for ${DEVICE}."
#        fi</pre>
		</div>
xem <font color='orange'>nó có cần thiết hay không</font>? Bởi vì nếu tôi comment đoạn đó lại và restart network thì mọi chuyện suôn sẻ:
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre># s network restart
Shutting down interface eth0:                              &#91;  OK  &#93;
Shutting down loopback interface:                          &#91;  OK  &#93;
Bringing up loopback interface:                            &#91;  OK  &#93;
Bringing up interface eth0:  Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
ARPING 192.168.1.99 from 0.0.0.0 eth0
Sent 2 probes &#40;2 broadcast&#40;s&#41;&#41;
Received 0 response&#40;s&#41;
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
192.168.1.0     0.0.0.0         255.255.255.0   U     0      0        0 eth0
0.0.0.0         192.168.1.1     0.0.0.0         UG    0      0        0 eth0
                                                           &#91;  OK  &#93;</pre>
		</div>]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/22679.html#146987</guid>
				<link>/hvaonline/posts/list/22679.html#146987</link>
				<pubDate><![CDATA[Fri, 15 Aug 2008 00:17:22]]> GMT</pubDate>
				<author><![CDATA[ quanta]]></author>
			</item>
			<item>
				<title>Re: Thảo luận lỗi "RTNETLINK answers: File exists" khi restart network?</title>
				<description><![CDATA[ mình bị lỗi như của bạn. Sau khi tham khảo va chỉnh sửa thì nó ra thế này.
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>&#91;root@serverhome ~&#93;# /etc/init.d/network restart
Shutting down loopback interface:                          &#91;  OK  &#93;
Bringing up loopback interface:                            &#91;  OK  &#93;
Bringing up interface eth0:                                &#91;  OK  &#93;
RTNETLINK answers: File exists
RTNETLINK answers: File exists
RTNETLINK answers: File exists
RTNETLINK answers: File exists
RTNETLINK answers: File exists
RTNETLINK answers: File exists
RTNETLINK answers: File exists
RTNETLINK answers: File exists
RTNETLINK answers: File exists</pre>
		</div>]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/22679.html#178518</guid>
				<link>/hvaonline/posts/list/22679.html#178518</link>
				<pubDate><![CDATA[Sat, 25 Apr 2009 20:18:05]]> GMT</pubDate>
				<author><![CDATA[ Phó Hồng Tuyết]]></author>
			</item>
			<item>
				<title>Re: Thảo luận lỗi "RTNETLINK answers: File exists" khi restart network?</title>
				<description><![CDATA[ @quanta: mấy cái lỗi nhỏ lẻ mà ít phổ biến thế này không debug không xong. Mình thấy cũng thú vị nhưng chưa có thời gian setup scenario. Mình nghĩ là setup scenario thì lâu hơn là debug.]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/22679.html#178882</guid>
				<link>/hvaonline/posts/list/22679.html#178882</link>
				<pubDate><![CDATA[Tue, 28 Apr 2009 19:38:52]]> GMT</pubDate>
				<author><![CDATA[ StarGhost]]></author>
			</item>
	</channel>
</rss>
