<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0">
	<channel>
		<title><![CDATA[Latest posts for the topic "Xin xem xét dùm bảo mật site rongchaua.net"]]></title>
		<link>/hvaonline/posts/list/12.html</link>
		<description><![CDATA[Latest messages posted in the topic "Xin xem xét dùm bảo mật site rongchaua.net"]]></description>
		<generator>JForum - http://www.jforum.net</generator>
			<item>
				<title>Xin xem xét dùm bảo mật site rongchaua.net</title>
				<description><![CDATA[ Chào mọi người,
vừa rồi mình vừa nhận một comment trên blog là file proxy.php của mình làm lộ toàn bộ local files. 

Xem comment ở đây: http://rongchaua.net/blog/html5-audio-tag-cross-domain

Xử lý:
- Thay đổi proxy.php thành proxy.txt
- Thay đổi thông tin trên file config của Wordpress và password administrator.
- Đang tiến hàng quyét virus trên host.
- và nên làm gì tiếp theo???

Câu hỏi:
- File proxy.php ở đây http://rongchaua.net/Web/Tmp/proxy.php mình đã đổi thành http://rongchaua.net/Web/Tmp/proxy.txt . Mình muốn hỏi là với cấu trúc code như trên thì làm thế nào có thể view được local files của mình?
- Các bước tiếp theo nên làm gì???

Cám ơn.]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/39745.html#244738</guid>
				<link>/hvaonline/posts/list/39745.html#244738</link>
				<pubDate><![CDATA[Mon, 8 Aug 2011 02:35:07]]> GMT</pubDate>
				<author><![CDATA[ rongchaua]]></author>
			</item>
			<item>
				<title>Xin xem xét dùm bảo mật site rongchaua.net</title>
				<description><![CDATA[ Đúng rồi đấy, anh dùng Web Vulnerability Scanner quét một cái, toàn bộ Web, blog, file, source của em lòi ra hết !]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/39745.html#244745</guid>
				<link>/hvaonline/posts/list/39745.html#244745</link>
				<pubDate><![CDATA[Mon, 8 Aug 2011 03:34:54]]> GMT</pubDate>
				<author><![CDATA[ TQN]]></author>
			</item>
			<item>
				<title>Xin xem xét dùm bảo mật site rongchaua.net</title>
				<description><![CDATA[ Cám ơn anh, thật ra thì những cái trên web em đều mang tính public. Em muốn tìm hiểu kỹ vì không biết nó có show được tới thư mục mail hay không vì như thế cũng hơi phiền một chút.

Nhưng vấn đề là cái "proxy.php", code nó bị bug gì mà nó có thể cho xem cả những file không thể xem được ví dụ như file này "http://rongchaua.net/blog/wp-config.php". Vì trong file này sẽ lưu password và username kết nối đến database đằng sau đó. Và thằng proxy.php bằng lỗi gì đó, có thể thông qua lỗi đó mà xem thông tin toàn bộ thư mục hoặc ví dụ như là show thông tin thằng wp-config.php.

Cái này em nghĩ là chắc chắn đã bị dính đòn vì acc Twitter (dùng để ghi chú chơi game :D) của em nó cũng báo trong ngày đó là có người thâm nhập do cái pass này với pass bên Twitter là cùng một pass.
]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/39745.html#244747</guid>
				<link>/hvaonline/posts/list/39745.html#244747</link>
				<pubDate><![CDATA[Mon, 8 Aug 2011 04:12:46]]> GMT</pubDate>
				<author><![CDATA[ rongchaua]]></author>
			</item>
			<item>
				<title>Xin xem xét dùm bảo mật site rongchaua.net</title>
				<description><![CDATA[ Anh rongchaua set permission thế nào ?

Nếu cấu trúc file như thế chẳng phải là chỉ cần

proxy.php?url=proxy.php

là download được file proxy.php về sao ? cho dù header là file nhạc nhưng nội dung vẫn là text ?]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/39745.html#244750</guid>
				<link>/hvaonline/posts/list/39745.html#244750</link>
				<pubDate><![CDATA[Mon, 8 Aug 2011 04:23:48]]> GMT</pubDate>
				<author><![CDATA[ WinDak]]></author>
			</item>
			<item>
				<title>Xin xem xét dùm bảo mật site rongchaua.net</title>
				<description><![CDATA[ <p></p>
		<cite class="blockquote">rongchaua wrote:</cite><br>
		<blockquote>Chào mọi người,
vừa rồi mình vừa nhận một comment trên blog là file proxy.php của mình làm lộ toàn bộ local files. 

Xem comment ở đây:<span class="link"> http://rongchaua.net/blog/html5-audio-tag-cross-domain</span>

Xử lý:
- Thay đổi proxy.php thành proxy.txt
- Thay đổi thông tin trên file config của Wordpress và password administrator.
- Đang tiến hàng quyét virus trên host.
- và nên làm gì tiếp theo???

Câu hỏi:
- File proxy.php ở đây<span class="link"> http://rongchaua.net/Web/Tmp/proxy.php</span> mình đã đổi thành<span class="link"> http://rongchaua.net/Web/Tmp/proxy.txt</span> . Mình muốn hỏi là với cấu trúc code như trên thì làm thế nào có thể view được local files của mình?
- Các bước tiếp theo nên làm gì???

Cám ơn.&nbsp;
		</blockquote>

Nếu em dùng php module trực tiếp với apache thì cách an toàn nhất là:

1. Tạo một thư mục duy nhất cho phép chạy php và chmod thành read only cho thư mục ấy tất cả các file trong thư mục ấy. Ví dụ, thư mục ấy ở /home/someone/public_html/src chẳng hạn thì chuyển sang thư mục ấy và: <b>chmod ugo-wx .</b> (để ý dấu chấm) và <b>chmod ugo-wx *</b>

2. Trên apache config (httpd.conf hoặc bất cứ config cụ thể nào được Include với httpd.conf có liên quan đến site của em), thêm mấy thứ như sau:

a. Set ngay trong &lt;VirtualHost....&gt; &lt;/VirtualHost&gt; directive:
<b>php_admin_value open_basedir <font color='red'>/home/someone/public_html/</font>
php_admin_value doc_root <font color='red'>/home/someone/public_html/</font>
php_admin_value upload_tmp_dir /home/someone/public_html/tmp
php_admin_value upload_max_filesize <font color='orange'>8M</font>
php_admin_value <font color='yellow'>include_path none</font></b>

trong đó, phần màu đỏ là thư mục chứa trang web của em phần màu cam là ấn định kích thước file tối đa được upload (nếu em cho phép upload). Phần màu vàng rất quan trọng vì nó giới hạn chặt chẽ không cho phép include bên ngoài "doc_root" của em.

b. Tạo directive &lt;Location&gt; cụ thể cho khu vực không được chạy php. Ví dụ:
<b>&lt;Location /files/&gt;
                <font color='red'>RemoveHandler .php
                php_flag engine off
                Options -Includes -Indexes</font>
&lt;/Location&gt;

&lt;Location /site/images/&gt;
                <font color='red'>RemoveHandler .php
                php_flag engine off
                Options -Includes -Indexes</font>
&lt;/Location&gt;
</b>

trong, đó thư mục "files" chỉ chứa các file nào đó chớ chẳng có php, thư mục "site/images" chỉ chứa hình chớ chẳng có php file nào hết.

Các flag màu đỏ cực kỳ quan trọng vì nó hoàn toàn huỷ bỏ handler php nên không thể parse và run php ở những thư mục ấy. Chẳng những vậy nó còn huỷ bỏ khả năng "Include" từ những thư mục ấy để đề phòng trường hợp ai đó upload một file php nhưng giả mạo như một gif file chẳng hạn rồi thực thi "include".

Nói chung, 2 lỗ hổng lớn nhất của php là cho phép: include + run bất kể nơi nào. Nếu thắt chặt 2 điểm này thì php an toàn. Nếu paranoid hơn nữa thì nên compile apache để thực hiện chế độ Suexec và buộc account nào đó run php hoàn toàn tách rời và có chủ quyền rất giới hạn trên filesystem.

Good luck.

PS: nếu được, nên chạy php-fpm để isolate giữa công tác parse + run php và công tác i/o files trên apache thì vững hơn.
]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/39745.html#244751</guid>
				<link>/hvaonline/posts/list/39745.html#244751</link>
				<pubDate><![CDATA[Mon, 8 Aug 2011 04:57:21]]> GMT</pubDate>
				<author><![CDATA[ conmale]]></author>
			</item>
			<item>
				<title>Xin xem xét dùm bảo mật site rongchaua.net</title>
				<description><![CDATA[ Hi anh conmale,
cám ơn góp ý của anh nhưng em đang dùng share host (của Bluehost) nên không biết có chỉnh được không nhưng em chắc chắn sẽ xem lại sau giờ làm vào tối nay. 
Thân.]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/39745.html#244754</guid>
				<link>/hvaonline/posts/list/39745.html#244754</link>
				<pubDate><![CDATA[Mon, 8 Aug 2011 06:11:33]]> GMT</pubDate>
				<author><![CDATA[ rongchaua]]></author>
			</item>
			<item>
				<title>Xin xem xét dùm bảo mật site rongchaua.net</title>
				<description><![CDATA[ Bác cho em hỏi
<p></p>
		<cite class="blockquote">conmale wrote:</cite><br>
		<blockquote>
                <font color='red'>RemoveHandler .php
                php_flag engine off
                Options -Includes -Indexes</font>
&nbsp;
		</blockquote>
Nếu ở directory bị mất kiểm soát được/bị override ngược lại thì việc thiết lập trên có hiệu quả không bác? ví dụ:
<font color='red'>AddHandler .php
                php_flag engine on
                Options +Includes +Indexes</font>
<p></p>
		<cite class="blockquote">conmale wrote:</cite><br>
		<blockquote>
PS: nếu được, nên chạy php-fpm để isolate giữa công tác parse + run php và công tác i/o files trên apache thì vững hơn.
&nbsp;
		</blockquote>
Em vào trang<span class="link"> http://php-fpm.org</span> thấy không được bác ạ. Bác cho em ý niệm về việc isolate này hoặc hint cho em chỗ vọc được không?]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/39745.html#244759</guid>
				<link>/hvaonline/posts/list/39745.html#244759</link>
				<pubDate><![CDATA[Mon, 8 Aug 2011 07:44:06]]> GMT</pubDate>
				<author><![CDATA[ cino]]></author>
			</item>
			<item>
				<title>Xin xem xét dùm bảo mật site rongchaua.net</title>
				<description><![CDATA[ // Website url to open
$daurl = $_GET['url'];

// Get that website's content
$handle = fopen($daurl, "r");


giờ nếu tui để proxy.php?url=/etc/passwd thì fopen thành fopen('/etc/passwd',"r")

giải pháp:
- chỉnh httpd.conf để không cho access vào / (&lt;Directory&gt; &lt;/Directory&gt;), cái này chắc host provider đã làm
- check $daurl và chỉ pass cho fopen() những gì bạn muốn access

Nguyên tắc: không bao giờ trust client's input
]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/39745.html#244762</guid>
				<link>/hvaonline/posts/list/39745.html#244762</link>
				<pubDate><![CDATA[Mon, 8 Aug 2011 08:56:15]]> GMT</pubDate>
				<author><![CDATA[ vd_]]></author>
			</item>
			<item>
				<title>Xin xem xét dùm bảo mật site rongchaua.net</title>
				<description><![CDATA[ chẹp, ai viết cái proxy.php ghia vậy trời.

rm proxy.php]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/39745.html#244770</guid>
				<link>/hvaonline/posts/list/39745.html#244770</link>
				<pubDate><![CDATA[Mon, 8 Aug 2011 10:29:08]]> GMT</pubDate>
				<author><![CDATA[ cr4zyb0y]]></author>
			</item>
			<item>
				<title>Xin xem xét dùm bảo mật site rongchaua.net</title>
				<description><![CDATA[ <p></p>
		<cite class="blockquote">cino wrote:</cite><br>
		<blockquote>Bác cho em hỏi
<p></p>
		<cite class="blockquote">conmale wrote:</cite><br>
		<blockquote>
                <font color='red'>RemoveHandler .php
                php_flag engine off
                Options -Includes -Indexes</font>
&nbsp;
		</blockquote>
Nếu ở directory bị mất kiểm soát được/bị override ngược lại thì việc thiết lập trên có hiệu quả không bác? ví dụ:
<font color='red'>AddHandler .php
                php_flag engine on
                Options +Includes +Indexes</font>
&nbsp;
		</blockquote>
Bồ nên đọc thêm ở đây:
<span class="link"> http://httpd.apache.org/docs/2.2/howto/htaccess.html</span>

Nếu sử dụng "shared host" thì vấn đề bảo mật nằm trong tay của nhà cung cấp dịch vụ. Muốn bảo mật thì cần kiện toàn, muốn kiện toàn thì cần quyền điều chỉnh mà nhà cung cấp dịch vụ kiểm soát quyền điều chỉnh thì đành... bó tay.

<p></p>
		<cite class="blockquote">cino wrote:</cite><br>
		<blockquote>
<p></p>
		<cite class="blockquote">conmale wrote:</cite><br>
		<blockquote>
PS: nếu được, nên chạy php-fpm để isolate giữa công tác parse + run php và công tác i/o files trên apache thì vững hơn.
&nbsp;
		</blockquote>
Em vào trang<span class="link"> http://php-fpm.org</span> thấy không được bác ạ. Bác cho em ý niệm về việc isolate này hoặc hint cho em chỗ vọc được không?&nbsp;
		</blockquote>
php-fpm đã được đưa vào php chính thức từ 5.3.x trở đi (nhưng bồ phải compile lại thì mới có). Binaries tiêu chuẩn của nhiều distro vẫn chưa enable php-fpm.

Nếu bồ xem trong php-fpm.org thì ngay trang đầu nó có những thông tin sau:

What is PHP-FPM?
<blockquote>PHP-FPM (FastCGI Process Manager) is an alternative PHP FastCGI implementation with some additional features useful for sites of any size, especially busier sites.

These features include:

    Adaptive process spawning (NEW!)
    Basic statistics (ala Apache's mod_status) (NEW!)
    Advanced process management with graceful stop/start
    <font color='red'>Ability to start workers with different uid/gid/chroot/environment and different php.ini (replaces safe_mode)</font>
    Stdout & stderr logging
    Emergency restart in case of accidental opcode cache destruction
    Accelerated upload support
    Support for a "slowlog"
    Enhancements to FastCGI, such as fastcgi_finish_request() - a special function to finish request & flush all data while continuing to do something time-consuming (video converting, stats processing, etc.)


... and much more.

It was not designed with virtual hosting in mind (large amounts of pools) however it can be adapted for any usage model.&nbsp;
		</blockquote>


]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/39745.html#244777</guid>
				<link>/hvaonline/posts/list/39745.html#244777</link>
				<pubDate><![CDATA[Mon, 8 Aug 2011 17:59:36]]> GMT</pubDate>
				<author><![CDATA[ conmale]]></author>
			</item>
			<item>
				<title>Xin xem xét dùm bảo mật site rongchaua.net</title>
				<description><![CDATA[ Bro sử dụng thêm $allowedFileType để kiểm tra đầu vào

Ngoài ra mình có 1 đoạn code nhỏ để phòng chống sql injection

Bạn lưu lại thành file .php rồi include vào file php bạn muốn bảo vệ

Ngoài ra bạn có thể thêm vào $wormprotector các câu truy vấn nhạy cảm hoặc có thể là những text nhạy cảm.

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>&lt;?php


  $sqlinjectiontrack = $_SERVER&#91;'QUERY_STRING'&#93;;
  $wormprotector = array&#40;'chr&#40;', 'chr=', 'chr%20', '%20chr', 'wget%20', '%20wget', 'wget&#40;',
                 'cmd=', '%20cmd', 'cmd%20', 'rush=', '%20rush', 'rush%20',
                   'union%20', '%20union', 'union&#40;', 'union=', 'echr&#40;', '%20echr', 'echr%20', 'echr=',
                   'esystem&#40;', 'esystem%20', 'cp%20', '%20cp', 'cp&#40;', 'mdir%20', '%20mdir', 'mdir&#40;',
                   'mcd%20', 'mrd%20', 'rm%20', '%20mcd', '%20mrd', '%20rm',
                   'mcd&#40;', 'mrd&#40;', 'rm&#40;', 'mcd=', 'mrd=', 'mv%20', 'rmdir%20', 'mv&#40;', 'rmdir&#40;',
                   'chmod&#40;', 'chmod%20', '%20chmod', 'chmod&#40;', 'chmod=', 'chown%20', 'chgrp%20', 'chown&#40;', 'chgrp&#40;',
                   'locate%20', 'grep%20', 'locate&#40;', 'grep&#40;', 'diff%20', 'kill%20', 'kill&#40;', 'killall',
                   'passwd%20', '%20passwd', 'passwd&#40;', 'telnet%20', 'vi&#40;', 'vi%20',
                   'insert%20into', 'select%20', 'nigga&#40;', '%20nigga', 'nigga%20', 'fopen', 'fwrite', '%20like', 'like%20',
                   '$_request', '$_get', '$request', '$get', '.system', 'HTTP_PHP', '&aim', '%20getenv', 'getenv%20',
                   'new_password', '&icq','/etc/password','/etc/shadow', '/etc/groups', '/etc/gshadow',
                   'HTTP_USER_AGENT', 'HTTP_HOST', '/bin/ps', 'wget%20', 'uname\x20-a', '/usr/bin/id',
                   '/bin/echo', '/bin/kill', '/bin/', '/chgrp', '/chown', '/usr/bin', 'g\+\+', 'bin/python',
                   'bin/tclsh', 'bin/nasm', 'perl%20', 'traceroute%20', 'ping%20', '.pl', '/usr/X11R6/bin/xterm', 'lsof%20',
                   '/bin/mail', '.conf', 'motd%20', 'HTTP/1.', '.inc.php', 'config.php', 'cgi-', '.eml',
                   'file\://', 'window.open', '&lt;SCRIPT&gt;', 'javascript\://','img src', 'img%20src','.jsp','ftp.exe',
                   'xp_enumdsn', 'xp_availablemedia', 'xp_filelist', 'xp_cmdshell', 'nc.exe', '.htpasswd',
                   'servlet', '/etc/passwd', 'wwwacl', '~root', '~ftp', '.js', '.jsp', 'admin_', '.history',
                   'bash_history', '.bash_history', '~nobody', 'server-info', 'server-status', 'reboot%20', 'halt%20',
                   'powerdown%20', '/home/ftp', '/home/www', 'secure_site, ok', 'chunked', 'org.apache', '/servlet/con',
                   '&lt;script', '/robot.txt' ,'/perl' ,'mod_gzip_status', 'db_mysql.inc', '.inc', 'select%20from',
                   'select from', 'drop%20', '.system', 'getenv', 'http_', '_php', 'php_', 'phpinfo&#40;&#41;', '&gt;&lt;?php', '?&gt;', 'sql='&#41;;

  $checkworm = str_replace&#40;$wormprotector, '*', $sqlinjectiontrack&#41;;

  if &#40;$sqlinjectiontrack != $checkworm&#41;
    {
      $cremotead = $_SERVER&#91;'REMOTE_ADDR'&#93;;
      $cuseragent = $_SERVER&#91;'HTTP_USER_AGENT'&#93;;

      die&#40; &quot;Attack detected! &lt;br /&gt;&lt;br /&gt;&lt;b&gt;This attack was detected and blocked:&lt;/b&gt;&lt;br /&gt;$cremotead - $cuseragent&quot; &#41;;
    }

?&gt;</pre>
		</div>

]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/39745.html#244784</guid>
				<link>/hvaonline/posts/list/39745.html#244784</link>
				<pubDate><![CDATA[Mon, 8 Aug 2011 21:05:49]]> GMT</pubDate>
				<author><![CDATA[ mv1098]]></author>
			</item>
			<item>
				<title>Xin xem xét dùm bảo mật site rongchaua.net</title>
				<description><![CDATA[ <p></p>
		<cite class="blockquote">conmale wrote:</cite><br>
		<blockquote>
Bồ nên đọc thêm ở đây:<span class="link"> http://httpd.apache.org/docs/2.2/howto/htaccess.html</span>
&nbsp;
		</blockquote>
Cảm ơn bác,

Vậy là phải thiết lập <blockquote>AllowOverride None&nbsp;
		</blockquote> và edit trong httpd.conf; Em muốn hỏi bác thêm là có cách nào chỉ enable cho .htaccess cấu hình với rewrite_url (mod_rewrite) ở directory mà không cho phép override các thứ khác ngoài rewrite không.

<p></p>
		<cite class="blockquote">conmale wrote:</cite><br>
		<blockquote>
bồ xem trong php-fpm.org thì ngay trang đầu nó có những thông tin sau:

What is PHP-FPM?
<blockquote>Ability to start workers with different uid/gid/chroot/environment and different php.ini (replaces safe_mode)&nbsp;
		</blockquote>
&nbsp;
		</blockquote>
Xin lỗi bác, lúc em vào là nó bị 'không truy cập được'.
Nhưng em vẫn chưa hiểu rõ đoạn
<p></p>
		<cite class="blockquote">conmale wrote:</cite><br>
		<blockquote>nên chạy php-fpm để isolate giữa công tác parse + run php và công tác i/o files trên apache thì vững hơn. &nbsp;
		</blockquote>
và đoạn bôi của bác
<blockquote>Ability to start workers with different uid/gid/chroot/environment and different php.ini (replaces safe_mode)&nbsp;
		</blockquote>
thì có khác gì với chroot cho apache khi có delicated server cho 1 site hông.
- Và gữa php-fpm, suhosin hay một implementation nào đó có chức năng củng cố bảo mật thì cái nào "ngon" nhất (theo bác). Performance kèm theo có bị ảnh hưởng gì không, hay đó là cái phải đánh đổi.

PS: Cảm ơn rongchaua vì cái topic này nhé! Hồi cách đây mấy năm mình cũng khá 'ái mộ' một số topic (hướng dẫn) 'decrypt' trên site của bạn (do google được). Tiếc là đến giờ trình vẫn còi vì cái gì cũng thích nhúng mũi vào.]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/39745.html#244793</guid>
				<link>/hvaonline/posts/list/39745.html#244793</link>
				<pubDate><![CDATA[Mon, 8 Aug 2011 23:52:56]]> GMT</pubDate>
				<author><![CDATA[ cino]]></author>
			</item>
			<item>
				<title>Xin xem xét dùm bảo mật site rongchaua.net</title>
				<description><![CDATA[ <p></p>
		<cite class="blockquote">cino wrote:</cite><br>
		<blockquote><p></p>
		<cite class="blockquote">conmale wrote:</cite><br>
		<blockquote>
Bồ nên đọc thêm ở đây:<span class="link"> http://httpd.apache.org/docs/2.2/howto/htaccess.html</span>
&nbsp;
		</blockquote>
Cảm ơn bác,

Vậy là phải thiết lập <blockquote>AllowOverride None&nbsp;
		</blockquote> và edit trong httpd.conf; Em muốn hỏi bác thêm là có cách nào chỉ enable cho .htaccess cấu hình với rewrite_url (mod_rewrite) ở directory mà không cho phép override các thứ khác ngoài rewrite không.
&nbsp;
		</blockquote>
Cái này do httpd.conf hoặc bất cứ cấu hình nào dành cho virtualhost quyết định. Nếu ở level trên mà áp đặt <blockquote>AllowOverride None&nbsp;
		</blockquote> thì tất cả những ấn định trong .htaccess cho từng directory cũng vô ích vì chẳng có giá trị nào hết. Bởi vậy, bảo mật ở cấp độ này hoàn toàn phụ thuộc vào nhà cung cấp dịch vụ.

<p></p>
		<cite class="blockquote">cino wrote:</cite><br>
		<blockquote>
<p></p>
		<cite class="blockquote">conmale wrote:</cite><br>
		<blockquote>
bồ xem trong php-fpm.org thì ngay trang đầu nó có những thông tin sau:

What is PHP-FPM?
<blockquote>Ability to start workers with different uid/gid/chroot/environment and different php.ini (replaces safe_mode)&nbsp;
		</blockquote>
&nbsp;
		</blockquote>
Xin lỗi bác, lúc em vào là nó bị 'không truy cập được'.
Nhưng em vẫn chưa hiểu rõ đoạn
<p></p>
		<cite class="blockquote">conmale wrote:</cite><br>
		<blockquote>nên chạy php-fpm để isolate giữa công tác parse + run php và công tác i/o files trên apache thì vững hơn. &nbsp;
		</blockquote>
và đoạn bôi của bác
<blockquote>Ability to start workers with different uid/gid/chroot/environment and different php.ini (replaces safe_mode)&nbsp;
		</blockquote>
thì có khác gì với chroot cho apache khi có delicated server cho 1 site hông.
&nbsp;
		</blockquote>
Hai câu trên tương tự nhau. Tính "isolation" nằm ở chỗ thay đổi (hoặc tách rời) uid/gid cho process chạy php-fpm chính là sự tách rời công tác parse + run php mà không động chạm đến read & write. Ví dụ, process chạy php-fpm gán cho account A để nó parse các file trong thư mục /abc chẳng hạn. Thư mục /abc này lại do account B own. Bởi vậy, php-fpm chỉ có thể parse + run php mà không thể upload (write) bất cứ thứ gì trên /abc cả. Bởi vậy, mọi cố gắng "up shell" để exploit đều thất bại. 

Cũng trong tinh thần này, nếu website được account A chạy php-fpm và muốn cho phép upload hình ảnh lên thư mục /abc/xyz chẳng hạn thì có thể chỉnh để account A owns /abc/xyz nhưng lại set để "remove handler" và turn off php engine trên từng thư mục. Tất nhiên là httpd.conf trong môi trường "shared host" phải không được chi phối. Trên bình diện cấu hình cho php-fpm, có thể áp dụng trong php-fpm.ini những ấn định cho mỗi virtualhost tương tự như:

<font color='red'>php_admin_value[open_basedir] = /home/someone/public_html/
php_admin_value[doc_root] = /home/someone/public_html/
php_admin_value[upload_tmp_dir] = /home/someone/public_html/tmp
php_admin_value[upload_max_filesize] = 8M
php_flag[cgi.force_wwwect] = 1</font>

Làm như vậy, mọi ý định "remote include" đều không thể thực hiện được.

Tất nhiên, nếu webmaster mà tự ý upload một cái proxy.php củ chuối nào đó đầy lỗ hổng thì có trời mới cứu được vì đây không phải là lỗi của php hoặc php-fpm hoặc apache mà do chính người quản trị.

Trong trường hợp cực đoan, chroot cũng là một biện pháp tốt nếu muốn hoàn toàn isolate mỗi "khách hàng" trong một shared host server bởi vì khách hàng này không thể "include" files của khách hành kia hoặc một con php shell chạy bằng account chung để khởi tạo apache có thể thấy hết tất cả mọi thứ do apache own (thì chết toi).

<p></p>
		<cite class="blockquote">cino wrote:</cite><br>
		<blockquote>
- Và gữa php-fpm, suhosin hay một implementation nào đó có chức năng củng cố bảo mật thì cái nào "ngon" nhất (theo bác). Performance kèm theo có bị ảnh hưởng gì không, hay đó là cái phải đánh đổi.
&nbsp;
		</blockquote>
Cái này không thể so sánh được vì nó giống như so sánh cái nền nhà bằng xi măng với cái vách tường bằng gạch. Suhosin là một áp dụng cố gắng bảo vệ tránh những exploits thuộc dạng buffer và string format. Trong khi đó, php-fpm hoặc suexec hoặc chroot, uid, gid là những cố gắng tạo isolation. Suhosin giống như cái nền nhà không cho chuột đục thủng còn php-fpm hoặc chroot thì giống như ngăn cái nhà ra nhiều phòng cách biệt vậy ;).]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/39745.html#244798</guid>
				<link>/hvaonline/posts/list/39745.html#244798</link>
				<pubDate><![CDATA[Tue, 9 Aug 2011 01:43:01]]> GMT</pubDate>
				<author><![CDATA[ conmale]]></author>
			</item>
			<item>
				<title>Xin xem xét dùm bảo mật site rongchaua.net</title>
				<description><![CDATA[ Hôm qua đổi password của HVA mà quên thay pass nên không log vào được. Dùng chức năng reset password thì bị firewall HVA chặn. Hôm nay mới biết cách reset là copy cái link vào diễn đàn. Gà quá. 

Tối qua sau khi xem xét lại thì đã phát hiện ra lỗi do tay nghề code php quá kém dẫn đến việc thông qua hàm fopen và file_get_contents mở local file. Ví dụ như sau:

http://rongchaua.net/Web/Tmp/proxy.php?url=/homeXXX/YYY/public_html/ZZZ/blog/wp-config.php
http://rongchaua.net/Web/Source/RSS%20Reader/proxy.php?url=/homeXXX/YYY/public_html/ZZZ/blog/wp-config.php

Hiện tại tạm thời xoá các file proxy.php để demo code. Sẽ sửa lại sau. Lần sau sẽ cẩn thận hơn trong việc post file php lên host. Cám ơn mọi người.]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/39745.html#244810</guid>
				<link>/hvaonline/posts/list/39745.html#244810</link>
				<pubDate><![CDATA[Tue, 9 Aug 2011 06:28:06]]> GMT</pubDate>
				<author><![CDATA[ rongchaua]]></author>
			</item>
			<item>
				<title>Xin xem xét dùm bảo mật site rongchaua.net</title>
				<description><![CDATA[ Bro có thể tham khảo đoạn code dưới đây
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>&lt;?php
@ob_end_clean&#40;&#41;;
// Only allow mp3 files
$allowedFileType = &quot;mp3&quot;;

// Set the filename based on the URL's query string
$theFile = $_REQUEST&#91;'theFile'&#93;;

// Get info about the file
$f = pathinfo&#40;$theFile&#41;;

// Check the extension against allowed file types
if&#40;strtolower&#40;$f&#91;'extension'&#93;&#41; != strtolower&#40;$allowedFileType&#41;&#41; exit;

// Make sure the file exists
if &#40;!file_exists&#40;$theFile&#41;&#41; exit;

// Set headers
header&#40;&quot;Pragma: public&quot;&#41;;
header&#40;&quot;Expires: Thu, 19 Nov 1981 08:52:00 GMT&quot;&#41;;
header&#40;&quot;Cache-Control: must-revalidate, post-check=0, pre-check=0&quot;&#41;;
header&#40;&quot;Cache-Control: no-store, no-cache, must-revalidate&quot;&#41;;
header&#40;&quot;Cache-Control: private&quot;&#41;;
header&#40;&quot;Content-Transfer-Encoding: binary&quot;&#41;;
header&#40;&quot;Content-Type: audio/x-mpeg, audio/x-mpeg-3, audio/mpeg3&quot;&#41;;
// Length required for Internet Explorer
header&#40;&quot;Content-Length: &quot;.@urldecode&#40;@filesize&#40;$theFile&#41;&#41;&#41;;

// Open file
if &#40;&#40;$f = fopen&#40;$theFile, 'rb'&#41;&#41; === false&#41; exit;

// Push file
while &#40;!feof&#40;$f&#41;&#41; {
    echo fread&#40;$f, &#40;1*&#40;1024*1024&#41;&#41;&#41;;
    flush&#40;&#41;;
    @ob_flush&#40;&#41;;
}

// Close file
fclose&#40;$f&#41;;
exit;

?&gt;</pre>
		</div>]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/39745.html#244811</guid>
				<link>/hvaonline/posts/list/39745.html#244811</link>
				<pubDate><![CDATA[Tue, 9 Aug 2011 06:36:18]]> GMT</pubDate>
				<author><![CDATA[ mv1098]]></author>
			</item>
			<item>
				<title>Xin xem xét dùm bảo mật site rongchaua.net</title>
				<description><![CDATA[ <p></p>
		<cite class="blockquote">conmale wrote:</cite><br>
		<blockquote>
<font color='red'>php_admin_value[open_basedir] = /home/someone/public_html/
php_admin_value[doc_root] = /home/someone/public_html/
php_admin_value[upload_tmp_dir] = /home/someone/public_html/tmp
php_admin_value[upload_max_filesize] = 8M
php_flag[cgi.force_wwwect] = 1</font>

Làm như vậy, mọi ý định "remote include" đều không thể thực hiện được.

Tất nhiên, nếu webmaster mà tự ý upload một cái proxy.php củ chuối nào đó đầy lỗ hổng thì <b>có trời mới cứu được</b> vì đây không phải là lỗi của php hoặc php-fpm hoặc apache mà do chính người quản trị.
&nbsp;
		</blockquote>
Chào bác. Cảm ơn bác đã phân tích chi tiết. Em đã rõ cái "isolation" nhờ php-fpm mà bác nói, nhưng trở lại vấn đề file "proxy.php" (vấn đề theo bác là "có trời mới cứu được"). 
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>$handle = fopen&#40;$daurl, "r"&#41;;
$buffer = fgets&#40;$handle, 4096&#41;;
echo $buffer;</pre>
		</div>
Nếu webmaster đã "isolate" open_basedir, doc_root, upload_tmp, <b>cấm .htaccess</b>, php-fpm, cấm eval() của php... thì với lỗi không kiểm soát fopen, file_get_contents.... này của proxy.php sẽ gây tổn hại gì cho hệ thống? (cứ cho là thông tin db sẽ bị mất, nhưng db đó không chấp nhận remote connection thì làm sao, nếu là mã nguồn có bị lộ thì hệ thống cũng đâu bị ảnh hưởng gì?)]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/39745.html#245081</guid>
				<link>/hvaonline/posts/list/39745.html#245081</link>
				<pubDate><![CDATA[Mon, 15 Aug 2011 12:30:05]]> GMT</pubDate>
				<author><![CDATA[ cino]]></author>
			</item>
			<item>
				<title>Xin xem xét dùm bảo mật site rongchaua.net</title>
				<description><![CDATA[ <p></p>
		<cite class="blockquote">cino wrote:</cite><br>
		<blockquote>
Chào bác. Cảm ơn bác đã phân tích chi tiết. Em đã rõ cái "isolation" nhờ php-fpm mà bác nói, nhưng trở lại vấn đề file "proxy.php" (vấn đề theo bác là "có trời mới cứu được"). 
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>$handle = fopen&#40;$daurl, "r"&#41;;
$buffer = fgets&#40;$handle, 4096&#41;;
echo $buffer;</pre>
		</div>
Nếu webmaster đã "isolate" open_basedir, doc_root, upload_tmp, <b>cấm .htaccess</b>, php-fpm, cấm eval() của php... thì với lỗi không kiểm soát fopen, file_get_contents.... này của proxy.php sẽ gây tổn hại gì cho hệ thống? (cứ cho là thông tin db sẽ bị mất, nhưng db đó không chấp nhận remote connection thì làm sao, nếu là mã nguồn có bị lộ thì hệ thống cũng đâu bị ảnh hưởng gì?)&nbsp;
		</blockquote>

Ở trên bồ đưa ra một loạt "cấm" thì có nghĩa bồ đã có một số biện pháp ngăn ngừa rồi. Càng nhiều ngăn ngừa, càng giảm thiểu tác hại. 

- Nếu đã ấn định mức độ isolation chặt chẽ thì việc bị fopen cũng sẽ bị giới hạn. Đặc biệt là giới hạn "fopen" đến những chỗ "nhạy cảm" trên hệ thống.

- Nếu không cho truy cập csdl từ xa thì dẫu có lộ db's username và password cũng không thể truy nhập được.

- Nếu mã nguồn bị lộ và trong cái bị lộ này lại "lộ" ra những điểm yếu nào đó có thể khai thác thì sự ảnh hưởng tuỳ thuộc vào những điểm yếu ấy có trầm trọng hay không mà thôi. Đối với bảo mật, một dịch vụ mà để chường source, configuration và csdl thì tính bảo mật đã bị huỷ hoại. Nên nhớ, source (open) được bày trên Internet hoàn toàn có tính chất khác với source của một trang web đang hoạt động mà lại được bày ra do tắc trách.]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/39745.html#245083</guid>
				<link>/hvaonline/posts/list/39745.html#245083</link>
				<pubDate><![CDATA[Mon, 15 Aug 2011 15:41:41]]> GMT</pubDate>
				<author><![CDATA[ conmale]]></author>
			</item>
			<item>
				<title>Xin xem xét dùm bảo mật site rongchaua.net</title>
				<description><![CDATA[ <p></p>
		<cite class="blockquote">conmale wrote:</cite><br>
		<blockquote>Nên nhớ, source (open) được bày trên Internet hoàn toàn có tính chất khác với source của một trang web đang hoạt động mà lại được bày ra do tắc trách.&nbsp;
		</blockquote>
Cảm ơn bác rất nhiều.

-c]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/39745.html#245092</guid>
				<link>/hvaonline/posts/list/39745.html#245092</link>
				<pubDate><![CDATA[Mon, 15 Aug 2011 21:33:28]]> GMT</pubDate>
				<author><![CDATA[ cino]]></author>
			</item>
			<item>
				<title>Xin xem xét dùm bảo mật site rongchaua.net</title>
				<description><![CDATA[ Mình cũng dùng .htaccess để security nhưng folder co khả năng gây ra nguy hiểm ...

Folder admn tốt nhất nên để nên để login .htaccess , foldder không cần run script nên remove run script đi]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/39745.html#246523</guid>
				<link>/hvaonline/posts/list/39745.html#246523</link>
				<pubDate><![CDATA[Mon, 5 Sep 2011 04:04:23]]> GMT</pubDate>
				<author><![CDATA[ micr0vnn]]></author>
			</item>
			<item>
				<title>Xin xem xét dùm bảo mật site rongchaua.net</title>
				<description><![CDATA[ Mình đang vọc CentOS với ý định tự manage 1 VPS. Đọc xong bài này thấy "oải" quá ! :(]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/39745.html#250574</guid>
				<link>/hvaonline/posts/list/39745.html#250574</link>
				<pubDate><![CDATA[Thu, 1 Dec 2011 10:22:39]]> GMT</pubDate>
				<author><![CDATA[ TheShinichi]]></author>
			</item>
	</channel>
</rss>
