<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0">
	<channel>
		<title><![CDATA[Latest posts for the topic "Làm sao để thiết lập các WebServer trong Lan qua máy chủ  Squid,Iptabl"]]></title>
		<link>/hvaonline/posts/list/24.html</link>
		<description><![CDATA[Latest messages posted in the topic "Làm sao để thiết lập các WebServer trong Lan qua máy chủ  Squid,Iptabl"]]></description>
		<generator>JForum - http://www.jforum.net</generator>
			<item>
				<title>Làm sao để thiết lập các WebServer trong Lan qua máy chủ  Squid,Iptabl</title>
				<description><![CDATA[ Hiện tại từ Internet bên ngoài chỉ mới truy cập được vào website của WebServer1: 192.168.2.115  với tên miền là abc.com.vn

Hiện tại mình gặp vấn đề còn lại mong mọi người giúp đỡ, cám ơn mọi người

Chưa thiết lập được để Internet bên ngoài truy cập được vào website của WebServer2: 192.168.2.119 với tên miền là def.com.vn

Khi truy cập tên miền def.com.vn thì nó chạy vào nội dung website tên miền websever1: 192.168.2.115


<b>Thiết lập mạng</b>
<font color='red'>Firewall: CentOS 6 gồm Iptables, squid
Eth0 (card mạng ngoài): 192.168.1.2
Eth1 (card mạng trong): 192.168.2.111</font>

Các WebServer trong LAN, sử dụng mỗi tên miền cho website riêng

<font color='red'>WebServer1: 192.168.2.115  (abc.com.vn)

WebServer2: 192.168.2.119 (def.com.vn)</font>

<b>Hiện tại cấu hình Iptables như sau:</b>

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>iptables -t nat -A PREROUTING -p tcp --dport 80 -d 192.168.1.2 -i eth0 -j DNAT --to 192.168.2.115:80
iptables -t nat -A PREROUTING -p tcp --dport 80 -d 192.168.1.2 -i eth0 -j DNAT --to 192.168.2.119:80
iptables -t nat -A POSTROUTING -p tcp --dport 80 -o eth0 -j SNAT --to 192.168.1.2

iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
iptables -A FORWARD -i eth0 -o eth1 -m state --state RELATED,ESTABLISHED -j ACCEPT
/sbin/iptables -A FORWARD -i eth1 -o eth0 -j ACCEPT

iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport 80 -j ACCEPT 
iptables -A INPUT -i eth0 -p tcp -m tcp --dport 8080 -j ACCEPT

iptables -A INPUT -m tcp -p tcp --dport 53 -j ACCEPT
iptables -A INPUT -m udp -p tcp --dport 53 -j ACCEPT</pre>
		</div>

Tập tin <b>/etc/sysconfig/iptables</b>

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre># Generated by iptables-save v1.4.7 on Thu Jul 11 16:46:05 2013
*nat
:PREROUTING ACCEPT &#91;26:5297&#93;
:POSTROUTING ACCEPT &#91;0:0&#93;
:OUTPUT ACCEPT &#91;34:2040&#93;
-A PREROUTING -d 192.168.1.2/32 -i eth0 -p tcp -m tcp --dport 80 -j DNAT --to-destination 192.168.2.115:80
-A PREROUTING -d 192.168.1.2/32 -i eth0 -p tcp -m tcp --dport 80 -j DNAT --to-destination 192.168.2.119:80
-A POSTROUTING -o eth0 -p tcp -m tcp --dport 80 -j SNAT --to-source 192.168.1.2
-A POSTROUTING -o eth0 -j MASQUERADE
COMMIT
# Completed on Thu Jul 11 16:46:05 2013
# Generated by iptables-save v1.4.7 on Thu Jul 11 16:46:05 2013
*filter
:INPUT ACCEPT &#91;0:0&#93;
:FORWARD ACCEPT &#91;0:0&#93;
:OUTPUT ACCEPT &#91;366:198764&#93;
-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT -p icmp -j ACCEPT
-A INPUT -i lo -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 80 -j ACCEPT
-A INPUT -i eth1 -p tcp -m tcp --dport 8080 -j ACCEPT
-A INPUT -m tcp -p tcp --dport 53 -j ACCEPT
-A INPUT -m udp -p tcp --dport 53 -j ACCEPT
-A INPUT -j REJECT --reject-with icmp-host-prohibited
-A FORWARD -j REJECT --reject-with icmp-host-prohibited
-A FORWARD -i eth0 -o eth1 -m state --state RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -i eth1 -o eth0 -j ACCEPT
COMMIT
# Completed on Thu Jul 11 16:46:05 2013</pre>
		</div>
]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/44941.html#277352</guid>
				<link>/hvaonline/posts/list/44941.html#277352</link>
				<pubDate><![CDATA[Thu, 11 Jul 2013 04:46:01]]> GMT</pubDate>
				<author><![CDATA[ lyphuong]]></author>
			</item>
			<item>
				<title>Làm sao để thiết lập các WebServer trong Lan qua máy chủ  Squid,Iptabl</title>
				<description><![CDATA[ - iptables hoạt động ở tầng nào? Trong khi đó cái hostname kia (def.com.vn) nằm ở tầng nào? Một request từ ngoài vào, đến 192.168.1.2, cổng 80 làm sao iptables biết chuyển nó đi đâu?
- Thứ tự xử lý các rules của iptables ra sao?
]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/44941.html#277733</guid>
				<link>/hvaonline/posts/list/44941.html#277733</link>
				<pubDate><![CDATA[Wed, 24 Jul 2013 11:47:46]]> GMT</pubDate>
				<author><![CDATA[ quanta]]></author>
			</item>
			<item>
				<title>Làm sao để thiết lập các WebServer trong Lan qua máy chủ  Squid,Iptabl</title>
				<description><![CDATA[ <blockquote>- iptables hoạt động ở tầng nào? Trong khi đó cái hostname kia (def.com.vn) nằm ở tầng nào? Một request từ ngoài vào, đến 192.168.1.2, cổng 80 làm sao iptables biết chuyển nó đi đâu?
- Thứ tự xử lý các rules của iptables ra sao? &nbsp;
		</blockquote>

Dù abc.com.vn hay def.com.vn đi vào nó đều phân giải thành cùng một IP do đó nó thực thi ưu tiên rule từ trên xuống 
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>iptables -t nat -A PREROUTING -p tcp --dport 80 -d 192.168.1.2 -i eth0 -j DNAT --to 192.168.2.115:80</pre>
		</div>
Nên lúc nào nó cũng đi vào nội dung website tên miền websever1: 192.168.2.115

Quanta cho mình hỏi Có lẽ phải NAT thêm port 53 DNS cho nó để nó hiểu được là abc.com.vn hay def.com.vn để đi đúng vào hostname hỏng biết phải không để mai mình thử xem sao
]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/44941.html#277760</guid>
				<link>/hvaonline/posts/list/44941.html#277760</link>
				<pubDate><![CDATA[Thu, 25 Jul 2013 08:44:02]]> GMT</pubDate>
				<author><![CDATA[ lyphuong]]></author>
			</item>
			<item>
				<title>Làm sao để thiết lập các WebServer trong Lan qua máy chủ  Squid,Iptabl</title>
				<description><![CDATA[ Trên firewall cùng 1 interface cùng 1 port làm sao nó phân biệt được request muốn tới webserver nào để mà forward?]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/44941.html#277770</guid>
				<link>/hvaonline/posts/list/44941.html#277770</link>
				<pubDate><![CDATA[Thu, 25 Jul 2013 20:38:38]]> GMT</pubDate>
				<author><![CDATA[ bigname]]></author>
			</item>
			<item>
				<title>Làm sao để thiết lập các WebServer trong Lan qua máy chủ  Squid,Iptabl</title>
				<description><![CDATA[ theo mình nghĩ ở đây bạn nên dựng 1 dns server cho mạng LAN cũng như để phân giải các tên miền.
 ]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/44941.html#277772</guid>
				<link>/hvaonline/posts/list/44941.html#277772</link>
				<pubDate><![CDATA[Thu, 25 Jul 2013 20:49:41]]> GMT</pubDate>
				<author><![CDATA[ lhthanh]]></author>
			</item>
			<item>
				<title>Làm sao để thiết lập các WebServer trong Lan qua máy chủ  Squid,Iptabl</title>
				<description><![CDATA[ Tuỳ theo tên miền mà route traffic, như vậy việc quyết định route traffic là ở lớp application -&gt; iptable không thể dùng được, phải dùng reverse proxy. 

Squid có thể đươc, tuy không chuyên.

Thường người ta sẽ dùng nginx, mod_proxy, haproxy, varnish v.v... để làm việc này.]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/44941.html#277774</guid>
				<link>/hvaonline/posts/list/44941.html#277774</link>
				<pubDate><![CDATA[Thu, 25 Jul 2013 21:21:52]]> GMT</pubDate>
				<author><![CDATA[ vd_]]></author>
			</item>
			<item>
				<title>Làm sao để thiết lập các WebServer trong Lan qua máy chủ  Squid,Iptabl</title>
				<description><![CDATA[ <p></p>
		<cite class="blockquote">vd_ wrote:</cite><br>
		<blockquote>Tuỳ theo tên miền mà route traffic, như vậy việc quyết định route traffic là ở lớp application -&gt; iptable không thể dùng được, phải dùng reverse proxy. 

Squid có thể đươc, tuy không chuyên.

Thường người ta sẽ dùng nginx, mod_proxy, haproxy, varnish v.v... để làm việc này.&nbsp;
		</blockquote>

Mình vẫn còn đang lây quây vấn đề này vấn chưa xong, vấn đề của mình một WebServer1 là HĐH Windows 2003, còn một WebServer2 CentOS 6

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>WebServer1: 192.168.2.115 &#40;abc.com.vn&#41;

WebServer2: 192.168.2.119 &#40;def.com.vn&#41;</pre>
		</div>

]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/44941.html#277833</guid>
				<link>/hvaonline/posts/list/44941.html#277833</link>
				<pubDate><![CDATA[Sun, 28 Jul 2013 01:22:53]]> GMT</pubDate>
				<author><![CDATA[ lyphuong]]></author>
			</item>
			<item>
				<title>Làm sao để thiết lập các WebServer trong Lan qua máy chủ  Squid,Iptabl</title>
				<description><![CDATA[ <p></p>
		<cite class="blockquote">lyphuong wrote:</cite><br>
		<blockquote>vấn đề của mình một WebServer1 là HĐH Windows 2003, còn một WebServer2 CentOS 6
&nbsp;
		</blockquote>
Backend web servers chạy hệ điều hành nào không liên quan gì ở đây cả. Vấn đề là iptables không làm được điều mà bạn đang định làm (lý do thì mình và <b>vd_</b> đã nói ở trên rồi). 

Tuy nhiên, `squid` có thể làm được. Tham khảo:<span class="link"> http://wiki.squid-cache.org/ConfigExamples/Reverse/MultipleWebservers</span>]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/44941.html#277840</guid>
				<link>/hvaonline/posts/list/44941.html#277840</link>
				<pubDate><![CDATA[Sun, 28 Jul 2013 10:58:37]]> GMT</pubDate>
				<author><![CDATA[ quanta]]></author>
			</item>
			<item>
				<title>Làm sao để thiết lập các WebServer trong Lan qua máy chủ  Squid,Iptabl</title>
				<description><![CDATA[ Mình cố gắng tìm hiểu cấu hình cho được vụ này chứ hỏi hoài cũng hỏng ổn, mà lay hoay cũng chưa ra.

Theo <b>quanta</b> mình sử dụng squid cấu hình cho Webserver public vẫn chưa được, chưa tìm ra lỗi gì; và <b>vd_</b> dùng nginx vẫn chưa được

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>cache_peer 192.168.2.115 parent 80 0 no-query originserver name=centos6
cache_peer_domain centos6 abc.com.vn
cache_peer 192.168.2.119 parent 80 0 no-query originserver name=servertv
cache_peer_domain servertv def.com.vn</pre>
		</div>

Mình sử dụng nginx cấu hình vẫn không được: nginx.conf
Firewall: CentOS 6 gồm Iptables, squid 
<font color='red'>Eth0 (card mạng ngoài): 192.168.1.2 
Eth1 (card mạng trong): 192.168.2.111

WebServer1: 192.168.2.115 (abc.com.vn)</font> vì mình hỏng dám đưa tên miền thật lên trong file cấu hình

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    log_format  main  '$remote_addr - $remote_user &#91;$time_local&#93; "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';

    access_log  /var/log/nginx/access.log  main;

    sendfile        on;
    #tcp_nopush     on;

    #keepalive_timeout  0;
    keepalive_timeout  65;

    #gzip  on;

## Basic reverse proxy server ##
## Apache backend for abc.com.vn ##
upstream apachephp  {
      server 192.168.2.115:80; 
}


## Start abc.com.vn##
server {
    listen     192.168.1.2:80;
    server_name  abc.com.vn;

    access_log  /var/log/nginx/abc.com.vn.access.log  main;
    error_log  /var/log/nginx/abc.com.vn.error.log;
    #root   /usr/share/nginx/html;
    #index  index.html index.htm;

    ## send request back to apache1 ##
    location / {
     proxy_pass <span class="link"> http://apachephp;</span>
     include        /etc/nginx/conf.d/proxy.conf;
   }
}
## End thongtinkhcn.vinhlong.gov.vn##

}</pre>
		</div>

/etc/nginx/conf.d/proxy.conf

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>proxy_wwwect          off;
proxy_set_header Host $host;
proxy_set_header X-Real-IP $remote_addr;
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

client_max_body_size 100M;
client_body_buffer_size 1m;
proxy_intercept_errors on;
proxy_buffering on;
proxy_buffer_size 128k;
proxy_buffers 256 16k;
proxy_busy_buffers_size 256k;
proxy_temp_file_write_size 256k;
proxy_max_temp_file_size 0;
proxy_read_timeout 300;</pre>
		</div>

Các tập tin log không ghi vào được dung lượng là 0:
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>-rw-r--r--.  1 nginx root     0 Aug 20 21:09 access.log
-rw-r--r--.  1 nginx root     0 Aug 26 21:48 error.log
-rw-r--r--.  1 nginx root     0 Aug 21 15:09 abc.com.vn.access.log
-rw-r--r--.  1 nginx root     0 Aug 21 15:09 abc.com.vn.error.log</pre>
		</div>

Mình sử dụng nginx reverse proxy websever backends trong nội bộ LAN thì truy cập được không không thể public ra ngoài Internet
]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/44941.html#278436</guid>
				<link>/hvaonline/posts/list/44941.html#278436</link>
				<pubDate><![CDATA[Thu, 12 Sep 2013 02:21:16]]> GMT</pubDate>
				<author><![CDATA[ lyphuong]]></author>
			</item>
			<item>
				<title>Làm sao để thiết lập các WebServer trong Lan qua máy chủ  Squid,Iptabl</title>
				<description><![CDATA[ Tôi chưa đọc đến phần IPtables, nhưng vì bạn không đề cập đến public IP nên tôi muốn hỏi lại để làm rõ đề bài.

Tôi hiểu đề bài như dưới đây, không biết có đúng không?
 - Bạn có 01 public IP
 - Và 02 domain (ABC và XYZ) cùng map về Public IP ở trên
 - Mỗi domain nằm trên 1 server khác nhau.

Vấn đề: 
- Từ Internet vào ABC hay XYZ luôn bị lấy dữ liệu của domain ABC

Nếu như tôi hiểu đúng đề bài, thì về nguyên tắc phải có thiết bị/phần mềm hiểu được HTTP request: để tiếp nhận và từ đó chuyển tiếp yêu cầu đến đúng đích. Theo tôi, ý của bạn <b>vd_</b> ở trên là đúng hướng rồi. Vấn đề chính không phải là firewall hay hệ điều hành, mà là phân tích được thông tin về domain trong gói tin HTTP để chuyển tiếp.

Chúc bạn thành công,]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/44941.html#278462</guid>
				<link>/hvaonline/posts/list/44941.html#278462</link>
				<pubDate><![CDATA[Sun, 15 Sep 2013 05:46:22]]> GMT</pubDate>
				<author><![CDATA[ zinxu]]></author>
			</item>
			<item>
				<title>Làm sao để thiết lập các WebServer trong Lan qua máy chủ  Squid,Iptabl</title>
				<description><![CDATA[ Tình trạng của mình đúng như bạn <b>zinxu</b> mô tả là có 1 IP public và 02 domain nằm tên 02 sever khác nhau
Theo <b>vd_</b> và <b>quanta</b> dùng squid hoặc nginx để giải quyết trường hợp của mình.
Mình đã dùng squid hoặc nginx để cấu hình nhưng chưa thành công, không biết lỗi gì trong tập tin cấu hình.

<p></p>
		<cite class="blockquote">zinxu wrote:</cite><br>
		<blockquote>Tôi chưa đọc đến phần IPtables, nhưng vì bạn không đề cập đến public IP nên tôi muốn hỏi lại để làm rõ đề bài.

Tôi hiểu đề bài như dưới đây, không biết có đúng không?
 - Bạn có 01 public IP
 - Và 02 domain (ABC và XYZ) cùng map về Public IP ở trên
 - Mỗi domain nằm trên 1 server khác nhau.

Vấn đề: 
- Từ Internet vào ABC hay XYZ luôn bị lấy dữ liệu của domain ABC

Nếu như tôi hiểu đúng đề bài, thì về nguyên tắc phải có thiết bị/phần mềm hiểu được HTTP request: để tiếp nhận và từ đó chuyển tiếp yêu cầu đến đúng đích. Theo tôi, ý của bạn <b>vd_</b> ở trên là đúng hướng rồi. Vấn đề chính không phải là firewall hay hệ điều hành, mà là phân tích được thông tin về domain trong gói tin HTTP để chuyển tiếp.

Chúc bạn thành công,&nbsp;
		</blockquote>]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/44941.html#278465</guid>
				<link>/hvaonline/posts/list/44941.html#278465</link>
				<pubDate><![CDATA[Mon, 16 Sep 2013 03:06:27]]> GMT</pubDate>
				<author><![CDATA[ lyphuong]]></author>
			</item>
			<item>
				<title>Làm sao để thiết lập các WebServer trong Lan qua máy chủ  Squid,Iptabl</title>
				<description><![CDATA[ @lyphuong: Với Nginx, phần cấu hình cho def.com.vn trỏ về 2.119 đâu bạn?]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/44941.html#278468</guid>
				<link>/hvaonline/posts/list/44941.html#278468</link>
				<pubDate><![CDATA[Mon, 16 Sep 2013 21:56:28]]> GMT</pubDate>
				<author><![CDATA[ quanta]]></author>
			</item>
			<item>
				<title>Làm sao để thiết lập các WebServer trong Lan qua máy chủ  Squid,Iptabl</title>
				<description><![CDATA[ <p></p>
		<cite class="blockquote">quanta wrote:</cite><br>
		<blockquote>@lyphuong: Với Nginx, phần cấu hình cho def.com.vn trỏ về 2.119 đâu bạn?&nbsp;
		</blockquote>

Mình có sửa lại, đây là phần cấu hình hiện tại

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    log_format  main  '$remote_addr - $remote_user &#91;$time_local&#93; "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';

    access_log  /var/log/nginx/access.log  main;

    sendfile        on;
    #tcp_nopush     on;

    #keepalive_timeout  0;
    keepalive_timeout  65;

    #gzip  on;

upstream  abc.com.vn  {
        server   192.168.2.115:80;
}
server
{
        listen  192.168.1.2:80;
        server_name  abc.com.vn;
        location / {
                 proxy_pass       <span class="link"> http://abc.com.vn;</span>
                 include        /etc/nginx/conf.d/proxy.conf;
                 #proxy_set_header   Host             $host;
                 #proxy_set_header   X-Real-IP        $remote_addr;
                 #proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
        }
}
upstream  def.com.vn  {
        server   192.168.2.119:80;
}
server
{
        listen  192.168.1.2:80;
        server_name  def.com.vn;
        location / {
                 proxy_pass       <span class="link"> http://def.com.vn;</span>
                 include        /etc/nginx/conf.d/proxy.conf;
                 #proxy_set_header   Host             $host;
                 #proxy_set_header   X-Real-IP        $remote_addr;
                 #proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
        }
        
}

}</pre>
		</div>

/etc/nginx/conf.d/proxy.conf 

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>proxy_wwwect          off;
proxy_set_header Host $host;
proxy_set_header X-Real-IP $remote_addr;
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

client_max_body_size 100M;
client_body_buffer_size 1m;
proxy_intercept_errors on;
proxy_buffering on;
proxy_buffer_size 128k;
proxy_buffers 256 16k;
proxy_busy_buffers_size 256k;
proxy_temp_file_write_size 256k;
proxy_max_temp_file_size 0;
proxy_read_timeout 300;</pre>
		</div>
]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/44941.html#278472</guid>
				<link>/hvaonline/posts/list/44941.html#278472</link>
				<pubDate><![CDATA[Tue, 17 Sep 2013 03:09:44]]> GMT</pubDate>
				<author><![CDATA[ lyphuong]]></author>
			</item>
			<item>
				<title>Làm sao để thiết lập các WebServer trong Lan qua máy chủ  Squid,Iptabl</title>
				<description><![CDATA[ 1. Thông báo lỗi của nginx là gì?
2. Bạn dùng upstream server1 {... } & upstream server2 {... } rồi reference đến server1 và server2  trong proxy_pass thay vì dùng full domain như hiện tại. Theo tui đoán thì khi bạn dùng proxy_pass http://def.com.vn; thì nginx không biết bạn muốn  pass đến server def.com.vn thực tế hay phần upstream def.com.vn trước đó.
]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/44941.html#278542</guid>
				<link>/hvaonline/posts/list/44941.html#278542</link>
				<pubDate><![CDATA[Tue, 24 Sep 2013 04:37:24]]> GMT</pubDate>
				<author><![CDATA[ vd_]]></author>
			</item>
			<item>
				<title>Làm sao để thiết lập các WebServer trong Lan qua máy chủ  Squid,Iptabl</title>
				<description><![CDATA[ <p></p>
		<cite class="blockquote">vd_ wrote:</cite><br>
		<blockquote>1. Thông báo lỗi của nginx là gì?
2. Bạn dùng upstream server1 {... } & upstream server2 {... } rồi reference đến server1 và server2  trong proxy_pass thay vì dùng full domain như hiện tại. Theo tui đoán thì khi bạn dùng proxy_pass<span class="link"> http://def.com.vn;</span> thì nginx không biết bạn muốn  pass đến server def.com.vn thực tế hay phần upstream def.com.vn trước đó.
&nbsp;
		</blockquote>


Các tập tin log sao nó không ghi vào được dung lượng là 0: 
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>-rw-r--r--.  1 nginx root     0 Aug 20 21:09 access.log
-rw-r--r--.  1 nginx root     0 Aug 26 21:48 error.log</pre>
		</div>

Mình sửa lại upstream bằng tên và  proxy_pass theo tên proxy_pass       <span class="link"> http://thuvien</span> nhưng vẫn chưa có kết quả khả quan.

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    log_format  main  '$remote_addr - $remote_user &#91;$time_local&#93; "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';

    access_log  /var/log/nginx/access.log  main;

    sendfile        on;
    #tcp_nopush     on;

    #keepalive_timeout  0;
    keepalive_timeout  65;

    #gzip  on;

upstream  apachephp  {
        server   192.168.2.115:80;
}
server
{
        listen  192.168.1.2:80;
        server_name  abc.com.vn;
        location / {
                 proxy_pass       <span class="link"> http://apachephp;</span>
                 include        /etc/nginx/conf.d/proxy.conf;
                 #proxy_set_header   Host             $host;
                 #proxy_set_header   X-Real-IP        $remote_addr;
                 #proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
        }
}
upstream  thuvien  {
        server   192.168.2.119:80;
}
server
{
        listen  192.168.1.2:80;
        server_name  def.com.vn;
        location / {
                 proxy_pass       <span class="link"> http://thuvien;</span>
                 include        /etc/nginx/conf.d/proxy.conf;
                 #proxy_set_header   Host             $host;
                 #proxy_set_header   X-Real-IP        $remote_addr;
                 #proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
        }
        
}

}</pre>
		</div>]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/44941.html#278558</guid>
				<link>/hvaonline/posts/list/44941.html#278558</link>
				<pubDate><![CDATA[Wed, 25 Sep 2013 04:24:40]]> GMT</pubDate>
				<author><![CDATA[ lyphuong]]></author>
			</item>
			<item>
				<title>Làm sao để thiết lập các WebServer trong Lan qua máy chủ  Squid,Iptabl</title>
				<description><![CDATA[ - khi vào 2 site bằng browser thì hiện ra cái gì?
- dns đã trỏ abc.com.vn và def.com.vn vào 192.168.1.2 chưa?]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/44941.html#278589</guid>
				<link>/hvaonline/posts/list/44941.html#278589</link>
				<pubDate><![CDATA[Sun, 29 Sep 2013 23:07:22]]> GMT</pubDate>
				<author><![CDATA[ vd_]]></author>
			</item>
			<item>
				<title>Làm sao để thiết lập các WebServer trong Lan qua máy chủ  Squid,Iptabl</title>
				<description><![CDATA[ <p></p>
		<cite class="blockquote">vd_ wrote:</cite><br>
		<blockquote>- khi vào 2 site bằng browser thì hiện ra cái gì?
- dns đã trỏ abc.com.vn và def.com.vn vào 192.168.1.2 chưa?&nbsp;
		</blockquote>

Vấn đề đã giải quyết được rồi, cám ơn <b>vd_</b> và <b>quanta</b> đã định hướng và giúp đỡ cho mình hoàn thành vụ này. làm việc với mấy vụ này dễ bị điên wá !
Thank mọi người !]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/44941.html#278794</guid>
				<link>/hvaonline/posts/list/44941.html#278794</link>
				<pubDate><![CDATA[Fri, 18 Oct 2013 01:59:57]]> GMT</pubDate>
				<author><![CDATA[ lyphuong]]></author>
			</item>
			<item>
				<title>Làm sao để thiết lập các WebServer trong Lan qua máy chủ  Squid,Iptabl</title>
				<description><![CDATA[ bạn nên chia sẻ thêm là bạn giải quyết như thế nào, các bạn khác cũng như tôi sẽ học hỏi được thêm các case để xử lý.]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/44941.html#278845</guid>
				<link>/hvaonline/posts/list/44941.html#278845</link>
				<pubDate><![CDATA[Thu, 24 Oct 2013 02:45:34]]> GMT</pubDate>
				<author><![CDATA[ vd_]]></author>
			</item>
			<item>
				<title>Làm sao để thiết lập các WebServer trong Lan qua máy chủ  Squid,Iptabl</title>
				<description><![CDATA[ <p></p>
		<cite class="blockquote">vd_ wrote:</cite><br>
		<blockquote>bạn nên chia sẻ thêm là bạn giải quyết như thế nào, các bạn khác cũng như tôi sẽ học hỏi được thêm các case để xử lý.&nbsp;
		</blockquote>

Khi dns trỏ abc.com.vn và def.com.vn vào (2 máy chủ web) 192.168.115 và 192.168.2.119 các máy trong lan dùng browser truy cập vào 2 site (đi thẳng đến máy webserver) không đi qua máy nginx front end proxy (Các tập tin log nginx sẽ không ghi vào được dung lượng là 0)

Khi dns trỏ abc.com.vn và def.com.vn vào 192.168.1.2  (máy nginx front end proxy, iptables) các máy trong lan dùng browser truy cập vào 2 site  đi qua máy nginx front end proxy (Các tập tin log nginx nội dung sẽ được ghi)

Đến thời điểm này phần cấu hình nginx hoạt động tốt (nginx.conf, proxy.conf )

Nhưng các browser từ bên ngoài Internet vẫn không truy cập 2 site với tên miền abc.com.vn và def.com.vn.

Vấn đề xét đến các rule của iptables và đây là rule cuối cùng mình thêm thì các browser từ bên ngoài Internet truy cập 2 site.

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>-A PREROUTING  -p tcp -dport 80 -j REDIRECT --to-ports 80</pre>
		</div>

Rule này nó đè làm mất tác dụng các rule để transparent proxy with Squid


<font color='red'><b>Mình tóm lại trường hợp và cách giải quyết để các bạn tham khảo: (Public 2 site ở 2 server  khác nhau qua Internet)</b></font>
  
- Có 01 public IP 
- Và 02 domain (ABC và XYZ) cùng map về Public IP ở trên 
- Mỗi domain nằm trên 1 server khác nhau. 

<b><font color='red'>Cài đặt và cấu hình server Firewall: </font></b>
1. Squid để các máy trong lan truy cập Internet.
2. Cài  đặt và cấu hình nginx (nginx multiple backend web servers) như trên.
3. Thiết lập rule cần thiết cho iptables và thêm rule.

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>-A PREROUTING  -p tcp -dport 80 -j REDIRECT --to-ports 80</pre>
		</div>
]]></description>
				<guid isPermaLink="true">/hvaonline/posts/list/44941.html#278936</guid>
				<link>/hvaonline/posts/list/44941.html#278936</link>
				<pubDate><![CDATA[Sat, 2 Nov 2013 03:33:22]]> GMT</pubDate>
				<author><![CDATA[ lyphuong]]></author>
			</item>
	</channel>
</rss>
