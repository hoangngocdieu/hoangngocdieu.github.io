<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0">
	<channel>
		<title><![CDATA[Latest posts for the topic "Luật chống lại Timing Attack (PHP)"]]></title>
		<link>http://www.hvaonline.net/hvaonline/posts/list/12.html</link>
		<description><![CDATA[Latest messages posted in the topic "Luật chống lại Timing Attack (PHP)"]]></description>
		<generator>JForum - http://www.jforum.net</generator>
			<item>
				<title>Luật chống lại Timing Attack (PHP)</title>
				<description><![CDATA[ Em vẫn đang tiếp tục phát triển mấy cái module cần thiết cho việc xây dựng website. Sau khi vượt qua một số trở ngại khá đáng kể thì lại có thêm trở ngại mới xuất hiện. Vì nghĩ việc lập trình liên quan rất lớn tới phát triển và bảo mật sau này nên cũng cất công tìm hiểu đôi chút.

Lần này vấn đề em gặp phải là <font color='red'>blind sql injection/timing attack</font> sau đây là luật em xây dựng để ngăn chặn việc ấy xãy ra. Timing attack là gì em nêu ở dưới nguồn từ<span class="link"> https://www.owasp.org/.</span> Rất mong được cùng mọi người thảo luận xung quanh vấn đề.

1. Phá luật được em tạo ra bên dưới như thế nào.

2. Cách sửa đổi các luật ấy để có thể không block nhầm dữ liệu và sửa thế nào cho hợp lý.

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>&lt;?php

$str = &quot;99' union select top 1 table_name from --etes twa another data&quot;; //data

if&#40;preg_match&#40;&quot;/^&#40;&#91;\'\&#41;\&quot;a-zA-Z0-9&#93;&#41;+&#40;&#91;0-255&#91;:ascii:&#93;&#93;&#41;+select+&#40;&#91;0-255&#91;:ascii:&#93;&#93;&#41;+&#40;&#91;\-&#93;&#41;+&#40;&#91;0-255&#91;:ascii:&#93;&#93;&#41;+$/&quot;,strtolower&#40;$str&#41;&#41;||preg_match&#40;&quot;/^&#40;&#91;\'\&#41;\&quot;\&#40;a-zA-Z0-9&#93;&#41;+&#40;&#91;0-255&#91;:ascii:&#93;&#93;&#41;+benchmark+&#40;&#91;0-255&#91;:ascii:&#93;&#93;&#41;+&#40;&#91;\-&#93;&#41;+&#40;&#91;0-255&#91;:ascii:&#93;&#93;&#41;+$/&quot;,strtolower&#40;$str&#41;&#41;&#41;{
	echo&#40;&quot;Attack report !.&quot;&#41;;
}
?&gt;</pre>
		</div>

<blockquote><font size='+2'>Timing Attack</font>

A Timing Attack depends upon injecting the following MySQL query: 
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>SELECT IF&#40;expression, true, false&#41;</pre>
		</div>

Using some time-taking operation e.g. BENCHMARK(), will delay server responses if the expression is True. 
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>BENCHMARK&#40;5000000,ENCODE&#40;'MSG','by 5 seconds'&#41;&#41;</pre>
		</div>
 - will execute 5000000 times the ENCODE function. 

Depending on the database server performence and its load, it should take just a moment to finish this operation. The important thing is, from the attacker's point of view, to specify high number of BENCHMARK() function repetitons, which should affect the server response time in a noticeable way. 

Example combination of both queries: 
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>1 UNION SELECT IF&#40;SUBSTRING&#40;user_password,1,1&#41; = CHAR&#40;50&#41;,BENCHMARK&#40;5000000,ENCODE&#40;'MSG','by 5 seconds'&#41;&#41;,null&#41; FROM users WHERE user_id = 1;</pre>
		</div>

If the server response was quite long we may expect that the first user password character with user_id = 1 is character '2'. 
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>&#40;CHAR&#40;50&#41; == '2'&#41;</pre>
		</div>

Using this method for the rest of characters, it's possible to get to know entire password stored in the database. This method works even when the attacker injects the SQL queries and the content of the vulnerable page doesn't change. 

Obviously, in this example the names of the tables and the number of columns was specified. However, it's possible to guess them or check with a trial and error method. 

Other databases than MySQL also have implemented functions which allow them to use timing attacks:&nbsp;
		</blockquote>]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/39497.html#242948</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/39497.html#242948</link>
				<pubDate><![CDATA[Wed, 6 Jul 2011 16:30:13]]> GMT</pubDate>
				<author><![CDATA[ chiro8x]]></author>
			</item>
			<item>
				<title>Luật chống lại Timing Attack (PHP)</title>
				<description><![CDATA[ <font size='+1'><b><span class="link"> http://weakpoint.org/sqli.php</span>
Link test blind sql ijection / timing attack.</b></font>

2 luật trên đã được em sửa như sau.
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>/^&#40;?&#40;?=&#91;0-255&#91;:ascii:&#93;&#93;&#41;&#91;0-255&#91;:ascii:&#93;&#93;|&#91;\'\&#41;\"a-zA-Z0-9&#93;&#41;+select+&#40;&#91;0-255&#91;:ascii:&#93;&#93;&#41;+&#40;&#91;\-\;\#\/\d00&#93;&#41;+&#40;?&#40;?=&#91;0-255&#91;:ascii:&#93;&#93;&#41;&#91;0-255&#91;:ascii:&#93;&#93;&#41;+$/</pre>
		</div>

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>/^&#40;?&#40;?=&#91;0-255&#91;:ascii:&#93;&#93;&#41;&#91;0-255&#91;:ascii:&#93;&#93;|&#91;\'\&#41;\"a-zA-Z0-9&#93;&#41;+benchmark+&#40;&#91;0-255&#91;:ascii:&#93;&#93;&#41;+&#40;&#91;\-\;\#\/\d00&#93;&#41;+&#40;?&#40;?=&#91;0-255&#91;:ascii:&#93;&#93;&#41;&#91;0-255&#91;:ascii:&#93;&#93;&#41;+$/</pre>
		</div>

Rất mong nhận được sự quan tâm.
]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/39497.html#242996</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/39497.html#242996</link>
				<pubDate><![CDATA[Thu, 7 Jul 2011 05:38:44]]> GMT</pubDate>
				<author><![CDATA[ chiro8x]]></author>
			</item>
			<item>
				<title>Luật chống lại Timing Attack (PHP)</title>
				<description><![CDATA[ Bạn định dùng regex để lọc câu query ngăn chặn sql injection phải ko? Mình ko rành regex lắm, nhưng cái link Time Attack của bạn hay đấy :D Lấy ghế ngồi nghe thôi ;))]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/39497.html#243961</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/39497.html#243961</link>
				<pubDate><![CDATA[Sat, 23 Jul 2011 01:22:14]]> GMT</pubDate>
				<author><![CDATA[ merlinhi]]></author>
			</item>
			<item>
				<title>Luật chống lại Timing Attack (PHP)</title>
				<description><![CDATA[ Nếu là SELECT, BENCHMARK, SeLect ... thì sao? 

Tốt nhất là bạn nên sanitize các param đưa vào câu SQL thay vì kiểm soát toàn bộ url. Ví dụ chỗ nào cần là number only thì dùng regex để kiểm tra hoặc cast về integer.]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/39497.html#244091</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/39497.html#244091</link>
				<pubDate><![CDATA[Mon, 25 Jul 2011 01:16:42]]> GMT</pubDate>
				<author><![CDATA[ vd_]]></author>
			</item>
			<item>
				<title>Luật chống lại Timing Attack (PHP)</title>
				<description><![CDATA[ Cái Timing Attack này nghe qua cũng thú vị nhưng nó chẳng qua là một kiểu bruteforce, chỉ cần mã hóa cẩn thận chút và thay đổi mã thường xuyên thì nó mò cả đời cũng không ra. Có nguy hiểm chăng là người ta có thể lợi dụng nó để DOS hệ thống của bạn.
Mà điều này thì đã thuộc vào chống SQL injections rồi nên mình thấy chỉ cần escape string là được, không cần mấy cái regexp rắc rối này, trừ khi bạn định để cho users trực tiếp nhập SQL queries vào ( :O )]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/39497.html#246108</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/39497.html#246108</link>
				<pubDate><![CDATA[Sun, 28 Aug 2011 13:04:41]]> GMT</pubDate>
				<author><![CDATA[ khuongduybui]]></author>
			</item>
			<item>
				<title>Luật chống lại Timing Attack (PHP)</title>
				<description><![CDATA[ <p></p>
		<cite class="blockquote">vd_ wrote:</cite><br>
		<blockquote>Nếu là SELECT, BENCHMARK, SeLect ... thì sao? 

Tốt nhất là bạn nên sanitize các param đưa vào câu SQL thay vì kiểm soát toàn bộ url. Ví dụ chỗ nào cần là number only thì dùng regex để kiểm tra hoặc cast về integer.&nbsp;
		</blockquote>

Mình chỉ block 2 cái đó thôi, bạn muốn viết hoa viết thường thế nào cũng được. Check bằng url mình đưa ấy thank :D.]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/39497.html#246156</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/39497.html#246156</link>
				<pubDate><![CDATA[Mon, 29 Aug 2011 07:06:38]]> GMT</pubDate>
				<author><![CDATA[ chiro8x]]></author>
			</item>
			<item>
				<title>Luật chống lại Timing Attack (PHP)</title>
				<description><![CDATA[ @chiro8x

my bad, bạn đã dùng strtolower() để xử lý được hoa thường, tuy nhiên tui vẫn giữ ý kiến là giải  pháp tốt nhất vẫn là kiểm tra các thông số đưa vào SQL thay vì nối chuỗi để thành sql.

Việc kiểm tra các keyword sql cũng như kiểm tra param đưa vào xem coi có trùng với pattern của sql không là một việc khá phức tạp, không thể chỉ dùng 1 hoặc 2 regex là có thể giải quyết được (bạn xem thêm ModSecurity Core Rule Set, phần rule SQL injection để thấy một số regex phát hiện sql injection).

Bạn cũng tham khảo thêm http://blog.spiderlabs.com/2011/07/modsecurity-sql-injection-challenge-lessons-learned.html để thấy một số kỹ thuật tránh detection.

]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/39497.html#246165</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/39497.html#246165</link>
				<pubDate><![CDATA[Mon, 29 Aug 2011 09:12:35]]> GMT</pubDate>
				<author><![CDATA[ vd_]]></author>
			</item>
			<item>
				<title>Luật chống lại Timing Attack (PHP)</title>
				<description><![CDATA[ <p></p>
		<cite class="blockquote">khuongduybui wrote:</cite><br>
		<blockquote>Cái Timing Attack này nghe qua cũng thú vị nhưng nó chẳng qua là một kiểu bruteforce, chỉ cần mã hóa cẩn thận chút và thay đổi mã thường xuyên thì nó mò cả đời cũng không ra. Có nguy hiểm chăng là người ta có thể lợi dụng nó để DOS hệ thống của bạn.
Mà điều này thì đã thuộc vào chống SQL injections rồi nên mình thấy chỉ cần escape string là được, không cần mấy cái regexp rắc rối này, trừ khi bạn định để cho users trực tiếp nhập SQL queries vào ( :O )&nbsp;
		</blockquote>
Ưhm ! có thể can thiệp từ cpanel để đặt quyền cho 1 user nhưng cấm SELECT thì cấm thế nào giờ. Ghi nhận ý kiến của bạn.]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/39497.html#246490</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/39497.html#246490</link>
				<pubDate><![CDATA[Sun, 4 Sep 2011 09:12:53]]> GMT</pubDate>
				<author><![CDATA[ chiro8x]]></author>
			</item>
			<item>
				<title>Luật chống lại Timing Attack (PHP)</title>
				<description><![CDATA[ <p></p>
		<cite class="blockquote">vd_ wrote:</cite><br>
		<blockquote>@chiro8x

my bad, bạn đã dùng strtolower() để xử lý được hoa thường, tuy nhiên tui vẫn giữ ý kiến là giải  pháp tốt nhất vẫn là kiểm tra các thông số đưa vào SQL thay vì nối chuỗi để thành sql.

Việc kiểm tra các keyword sql cũng như kiểm tra param đưa vào xem coi có trùng với pattern của sql không là một việc khá phức tạp, không thể chỉ dùng 1 hoặc 2 regex là có thể giải quyết được (bạn xem thêm ModSecurity Core Rule Set, phần rule SQL injection để thấy một số regex phát hiện sql injection).

Bạn cũng tham khảo thêm<span class="link"> http://blog.spiderlabs.com/2011/07/modsecurity-sql-injection-challenge-lessons-learned.html</span> để thấy một số kỹ thuật tránh detection.

&nbsp;
		</blockquote> Chủ đề mình đưa ra chỉ nói về timing attack thôi. Không giấu gì bạn đang làm web game sử dụng ajax và jquery nên chỉ cần chống cái timing attack là chủ yếu, nhưng mình sẽ tìm hiểu thứ bạn nói.]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/39497.html#246491</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/39497.html#246491</link>
				<pubDate><![CDATA[Sun, 4 Sep 2011 09:16:02]]> GMT</pubDate>
				<author><![CDATA[ chiro8x]]></author>
			</item>
	</channel>
</rss>
