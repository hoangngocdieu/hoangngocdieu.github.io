<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0">
	<channel>
		<title><![CDATA[Latest posts for the topic "Sever bị lỗi 502 bad gateway (nginx, php-fpm)"]]></title>
		<link>http://www.hvaonline.net/hvaonline/posts/list/24.html</link>
		<description><![CDATA[Latest messages posted in the topic "Sever bị lỗi 502 bad gateway (nginx, php-fpm)"]]></description>
		<generator>JForum - http://www.jforum.net</generator>
			<item>
				<title>Sever bị lỗi 502 bad gateway (nginx, php-fpm)</title>
				<description><![CDATA[ Hiện tại server đang bị thế này(502 bad gateway). Có bạn nào giúp mình cách khắc phục với . Mình dùng nginx và php-fpm

Khi xem error log thì mình thấy thế này
<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>2013/04/04 16:57:49 &#91;error&#93; 28414#0: *10337 connect&#40;&#41; to unix:/tmp/php-fpm.sock failed &#40;11: Resource temporarily unavailable&#41; while connecting to upstream, client:
2013/04/04 16:57:49 &#91;error&#93; 28414#0: *10166 connect&#40;&#41; to unix:/tmp/php-fpm.sock failed &#40;11: Resource temporarily unavailable&#41; while connecting to upstream, client:
2013/04/04 16:57:49 &#91;error&#93; 28414#0: *10335 connect&#40;&#41; to unix:/tmp/php-fpm.sock failed &#40;11: Resource temporarily unavailable&#41; while connecting to upstream, client:
2013/04/04 16:57:49 &#91;error&#93; 28414#0: *10341 connect&#40;&#41; to unix:/tmp/php-fpm.sock failed &#40;11: Resource temporarily unavailable&#41; while connecting to upstream, client:
2013/04/04 16:57:49 &#91;error&#93; 28414#0: *10005 connect&#40;&#41; to unix:/tmp/php-fpm.sock failed &#40;11: Resource temporarily unavailable&#41; while connecting to upstream, client:
2013/04/04 16:57:49 &#91;error&#93; 28414#0: *10345 connect&#40;&#41; to unix:/tmp/php-fpm.sock failed &#40;11: Resource temporarily unavailable&#41; while connecting to upstream, client:
2013/04/04 16:57:49 &#91;error&#93; 28414#0: *10344 connect&#40;&#41; to unix:/tmp/php-fpm.sock failed &#40;11: Resource temporarily unavailable&#41; while connecting to upstream, client:
2013/04/04 16:57:50 &#91;error&#93; 28414#0: *10350 connect&#40;&#41; to unix:/tmp/php-fpm.sock failed &#40;11: Resource temporarily unavailable&#41; while connecting to upstream, client:
2013/04/04 16:57:50 &#91;error&#93; 28414#0: *10353 connect&#40;&#41; to unix:/tmp/php-fpm.sock failed &#40;11: Resource temporarily unavailable&#41; while connecting to upstream, client:
2013/04/04 16:57:50 &#91;error&#93; 28414#0: *10362 connect&#40;&#41; to unix:/tmp/php-fpm.sock failed &#40;11: Resource temporarily unavailable&#41; while connecting to upstream, client:
2013/04/04 16:57:50 &#91;error&#93; 28414#0: *10360 connect&#40;&#41; to unix:/tmp/php-fpm.sock failed &#40;11: Resource temporarily unavailable&#41; while connecting to upstream, client:
2013/04/04 16:57:50 &#91;error&#93; 28414#0: *10366 connect&#40;&#41; to unix:/tmp/php-fpm.sock failed &#40;11: Resource temporarily unavailable&#41; while connecting to upstream, client:
2013/04/04 16:57:50 &#91;error&#93; 28414#0: *10367 connect&#40;&#41; to unix:/tmp/php-fpm.sock failed &#40;11: Resource temporarily unavailable&#41; while connecting to upstream, client:
2013/04/04 16:57:50 &#91;error&#93; 28414#0: *10370 connect&#40;&#41; to unix:/tmp/php-fpm.sock failed &#40;11: Resource temporarily unavailable&#41; while connecting to upstream, client:
2013/04/04 16:57:50 &#91;error&#93; 28414#0: *10371 connect&#40;&#41; to unix:/tmp/php-fpm.sock failed &#40;11: Resource temporarily unavailable&#41; while connecting to upstream, client:
2013/04/04 16:57:50 &#91;error&#93; 28414#0: *10374 connect&#40;&#41; to unix:/tmp/php-fpm.sock failed &#40;11: Resource temporarily unavailable&#41; while connecting to upstream, client:</pre>
		</div>]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/44530.html#274696</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/44530.html#274696</link>
				<pubDate><![CDATA[Thu, 4 Apr 2013 12:09:00]]> GMT</pubDate>
				<author><![CDATA[ phuongtnotv]]></author>
			</item>
			<item>
				<title>Sever bị lỗi 502 bad gateway (nginx, php-fpm)</title>
				<description><![CDATA[ Bạn mở cấu hình php-fpm (thường nằm /etc/php-fpm.d) lên tìm dòng 
listen = bla bla
thay bằng : 
listen = /tmp/php-fpm.sock

Nếu vẫn không được bạn gửi mình xem file config của nginx.conf và php-fpm.conf (hoặc www.conf ) .]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/44530.html#274712</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/44530.html#274712</link>
				<pubDate><![CDATA[Fri, 5 Apr 2013 04:01:43]]> GMT</pubDate>
				<author><![CDATA[ xwm]]></author>
			</item>
			<item>
				<title>Sever bị lỗi 502 bad gateway (nginx, php-fpm)</title>
				<description><![CDATA[ Vẫn bị thế bạn à 

Đây là 2 file cấu hình của mình

php-fpm.conf

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>&#91;abc&#93;

listen = /tmp/php-fpm.sock

listen.backlog = -1


listen.allowed_clients = 127.0.0.1


listen.owner = nobody
listen.group = nobody
listen.mode = 0666


user = nobody
group = nobody


pm = static

pm.max_children = 128

pm.start_servers = 128

pm.min_spare_servers = 30

pm.max_spare_servers = 80

pm.max_requests = 500


pm.status_path = /php-fpm-status/status.php

ping.path = /php-fpm-ping/ping.php

ping.response = pong</pre>
		</div>

nginx.conf

<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>worker_processes        16;

events {
        use                     epoll;
        worker_connections      1024;
}

http {
        # php-fpm backend
        upstream php {
                server          unix:/tmp/php-fpm.sock;
        }

        # general proxying rules
        proxy_set_header        X-Real-IP       $remote_addr;
        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header        Host            $host;
        proxy_buffer_size       32k;
        proxy_buffers           16      32k;
        proxy_wwwect          off;

        # fastcgi configuration
        fastcgi_connect_timeout 60;
        fastcgi_send_timeout    180;
        fastcgi_read_timeout    180;
        fastcgi_buffer_size     128k;
        fastcgi_buffers         32      32k;
        fastcgi_busy_buffers_size       256k;
        fastcgi_temp_file_write_size    256k;
        fastcgi_intercept_errors        on;

#       access_log              on;
#       error_log               off;
        include                 mime.types;
        default_type            application/octet-stream;

        keepalive_timeout       0;

        gzip                    on;
        gzip_types              text/css text/xml application/x-javascript application/atom+xml application/rss+xml text/plain text/javascript;

        server_tokens           off;

        sendfile                on;
        tcp_nopush              on;
        tcp_nodelay             on;

        client_max_body_size    32M;

server {
                listen          xxx.xxx.xxx.xxx:80;
                server_name     domain.comt;

                root            /home/admin/domains/domain.com/public_html;

                location / {
                        index           index.html      index.php;
#               access_log              on;

               }


                location /clear.gif {
                        empty_gif;
        access_log              off;
                }


                location ~ \.&#40;png|gif|jpg|jpeg|swf|css|js|ico&#41;$ {
                        expires         90d;
        access_log              off;
                }

                location ~ ^/php-fpm-&#40;status|ping&#41;$ {
                        include         fastcgi_params;
                        fastcgi_pass    php;
                        fastcgi_param   SCRIPT_FILENAME $fastcgi_script_name;
                }


                location /archive/index.php {
                        include         fastcgi_params;
                        fastcgi_pass    php;
                        fastcgi_param   SCRIPT_FILENAME $document_root/archive/index.php;
        access_log              off;
                }

                location ~ \.php$ {
#        access_log              on;
                        if &#40;$remote_addr = 0&#41; {
                                rewrite ^&#40;.*&#41;$ <span class="link"> http://lol.com/$1</span>       break;
                        }

                        include         fastcgi_params;
                        if &#40;$uri !~ "^/customavatars/"&#41;{
                                fastcgi_pass    php;
                        }
#                       fastcgi_param   SCRIPT_FILENAME $fastcgi_script_name;
                }

        error_page  502              /502.html;
        location = /502.html {
            root   /usr/local/nginx/html;
        }




        }
}</pre>
		</div>]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/44530.html#274715</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/44530.html#274715</link>
				<pubDate><![CDATA[Fri, 5 Apr 2013 06:28:32]]> GMT</pubDate>
				<author><![CDATA[ phuongtnotv]]></author>
			</item>
			<item>
				<title>Sever bị lỗi 502 bad gateway (nginx, php-fpm)</title>
				<description><![CDATA[ Mình thấy file cấu hình php-fpm bạn ok rồi. Bạn kiểm tra lại xem php-fpm coi có đang chạy không (service php-fpm status).
Nếu đang chạy mà vẫn báo lỗi bạn thử thay bằng đoạn này:
location ~ \.php$ {
	     
         root           /home/admin/domains/domain.com/public_html/;
		 index index.php  index.html index.htm;
         fastcgi_pass   php;
         fastcgi_index  index.php;
         fastcgi_param  SCRIPT_FILENAME   $document_root$fastcgi_script_name;
         include        fastcgi_params;
                      }
Có thắc mắc bạn liên hệ với mình qua email root@xgr0up.net cho tiện nhé.]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/44530.html#274723</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/44530.html#274723</link>
				<pubDate><![CDATA[Fri, 5 Apr 2013 20:59:11]]> GMT</pubDate>
				<author><![CDATA[ xwm]]></author>
			</item>
			<item>
				<title>Sever bị lỗi 502 bad gateway (nginx, php-fpm)</title>
				<description><![CDATA[ <p></p>
		<cite class="blockquote">xwm wrote:</cite><br>
		<blockquote>Mình thấy file cấu hình php-fpm bạn ok rồi. Bạn kiểm tra lại xem php-fpm coi có đang chạy không (service php-fpm status).
Nếu đang chạy mà vẫn báo lỗi bạn thử thay bằng đoạn này:
location ~ \.php$ {
	     
         root           /home/admin/domains/domain.com/public_html/;
		 index index.php  index.html index.htm;
         fastcgi_pass   php;
         fastcgi_index  index.php;
         fastcgi_param  SCRIPT_FILENAME   $document_root$fastcgi_script_name;
         include        fastcgi_params;
                      }
Có thắc mắc bạn liên hệ với mình qua email root@xgr0up.net cho tiện nhé.&nbsp;
		</blockquote>

Thỉnh thoảng vẫn lỗi cậu ơi 

Khi lỗi thì restart lại php-fpm là lại vào đc :( ]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/44530.html#274839</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/44530.html#274839</link>
				<pubDate><![CDATA[Wed, 10 Apr 2013 01:53:55]]> GMT</pubDate>
				<author><![CDATA[ phuongtnotv]]></author>
			</item>
			<item>
				<title>Sever bị lỗi 502 bad gateway (nginx, php-fpm)</title>
				<description><![CDATA[ ai giúp mình với :(]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/44530.html#274997</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/44530.html#274997</link>
				<pubDate><![CDATA[Wed, 17 Apr 2013 00:03:45]]> GMT</pubDate>
				<author><![CDATA[ phuongtnotv]]></author>
			</item>
			<item>
				<title>Sever bị lỗi 502 bad gateway (nginx, php-fpm)</title>
				<description><![CDATA[ Chậc....

Máy có bao nhiêu core mà set "worker_processes        16;"?


Sao không chỉnh <font color='red'>"pm = dynamic" </font>cho php-fpm mà chỉnh <font color='orange'>"pm = static"</font>?

Máy cấu hình mạnh hay nhẹ?

Nên chỉnh lại hết mấy cái này tùy theo cấu hình. Không nên nhét các con số vô trong đó mà không theo dõi và rút tỉa từ tình hình và khả năng của máy trên thực tế.:

<b>pm.max_children = 128

pm.start_servers = 128

pm.min_spare_servers = 30

pm.max_spare_servers = 80

pm.max_requests = 500</b>]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/44530.html#275132</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/44530.html#275132</link>
				<pubDate><![CDATA[Mon, 22 Apr 2013 00:08:42]]> GMT</pubDate>
				<author><![CDATA[ conmale]]></author>
			</item>
			<item>
				<title>Sever bị lỗi 502 bad gateway (nginx, php-fpm)</title>
				<description><![CDATA[ <p></p>
		<cite class="blockquote">conmale wrote:</cite><br>
		<blockquote>Chậc....

Máy có bao nhiêu core mà set "worker_processes        16;"?


Sao không chỉnh <font color='red'>"pm = dynamic" </font>cho php-fpm mà chỉnh <font color='orange'>"pm = static"</font>?

Máy cấu hình mạnh hay nhẹ?

Nên chỉnh lại hết mấy cái này tùy theo cấu hình. Không nên nhét các con số vô trong đó mà không theo dõi và rút tỉa từ tình hình và khả năng của máy trên thực tế.:

<b>pm.max_children = 128

pm.start_servers = 128

pm.min_spare_servers = 30

pm.max_spare_servers = 80

pm.max_requests = 500</b>&nbsp;
		</blockquote>

Sv em 16core nên em để worker_processes        16 

Trên sv có 1 site chạy thì em nghĩ để static sẽ tốt hơn
]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/44530.html#275186</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/44530.html#275186</link>
				<pubDate><![CDATA[Wed, 24 Apr 2013 01:17:47]]> GMT</pubDate>
				<author><![CDATA[ phuongtnotv]]></author>
			</item>
			<item>
				<title>Sever bị lỗi 502 bad gateway (nginx, php-fpm)</title>
				<description><![CDATA[ <p></p>
		<cite class="blockquote">phuongtnotv wrote:</cite><br>
		<blockquote><p></p>
		<cite class="blockquote">conmale wrote:</cite><br>
		<blockquote>Chậc....

Máy có bao nhiêu core mà set "worker_processes        16;"?


Sao không chỉnh <font color='red'>"pm = dynamic" </font>cho php-fpm mà chỉnh <font color='orange'>"pm = static"</font>?

Máy cấu hình mạnh hay nhẹ?

Nên chỉnh lại hết mấy cái này tùy theo cấu hình. Không nên nhét các con số vô trong đó mà không theo dõi và rút tỉa từ tình hình và khả năng của máy trên thực tế.:

<b>pm.max_children = 128

pm.start_servers = 128

pm.min_spare_servers = 30

pm.max_spare_servers = 80

pm.max_requests = 500</b>&nbsp;
		</blockquote>

Sv em 16core nên em để worker_processes        16 

Trên sv có 1 site chạy thì em nghĩ để static sẽ tốt hơn
&nbsp;
		</blockquote>

Bạn không nói rõ thông số cấu hình server của bạn như thế nào, chỉ có phần cấu hình PHP-FPM và Nginx như vậy thì không đủ để mọi người đưa ra ý kiến góp ý đâu :)]]></description>
				<guid isPermaLink="true">http://www.hvaonline.net/hvaonline/posts/list/44530.html#280084</guid>
				<link>http://www.hvaonline.net/hvaonline/posts/list/44530.html#280084</link>
				<pubDate><![CDATA[Fri, 21 Mar 2014 00:43:16]]> GMT</pubDate>
				<author><![CDATA[ rootix]]></author>
			</item>
	</channel>
</rss>
