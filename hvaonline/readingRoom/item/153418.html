<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"> 

<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta name="description" content="HVA Reading Room">
<meta name="keywords" content=", reading room, hva, hvaonline, hvazone, hvaforum">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="robots" content="index,follow">
<meta name="rating" content="general">
<style type="text/css">
<!-- 
@import url( "/hvaonline/templates/viet/styles/style.css");
-->
</style>
<style type="text/css">
<!--
@import url("/hvaonline/templates/viet/styles/en_US.css");
-->
</style>
<title> - .:: HVAOnline ::.</title>

</head>
<body class="en_US">


<!--
Original theme from phpBB (http://www.phpbb.com) subSilver
Created by subBlue design
http://www.subBlue.com
Modifications by JForum Team 
Extended and customised by HVA Team
Added more features and Black Silver theme designed by HVA
-->
<table width="100%" border="0" cols="2">
	<tr align="right">
		<td class="copyright">
			English
			| 
			<a href="/hvaonline/jforum.html?module=forums&amp;action=setLang&amp;lang=vi_VN" rel="nofollow">Vietnamese</a>
		</td>
	</tr>
</table>
<table width="100%" border="0" align="center">
	<tr>
        <td width="100%" align="center" valign="middle">
			<a href="" title="[Logo]"><img src="/hvaonline/templates/viet/images/hvabanner-final.gif" alt="banner" /></a>
		</td>
	</tr>

	<tr>
		<td>
<table cellspacing="0" cellpadding="0" width="80%" align="center" border="0">

		<tr height="15">
			<th colspan="2" class="thportal" align="left"><span class="readingheader">&nbsp;.::Defense::.</span></th>
		    <th class="thportal" align="center">
				<span class="readingheader">
					 Ký sự các vụ DDoS đến HVA - Phần 22 <a name="topPage" id="topPage"></a>
				</span>
			</th>
		    <th class="thportal" align="right">
				<a href="/hvaonline/posts/list/0/25343.html#153418" target="_blank">
				<img src="/hvaonline/templates/viet/images/goright.gif" align="absbottom" border="0" alt="Go to original post" title="Go to original post"/></a> 
				<img src="/hvaonline/templates/viet/images/what.gif" align="absbottom" border="0" alt="Author: Hoàng Ngọc Diêu (conmale) - Translator:  - Entry Date: 13/02/2009 14:52:32" title="Author: Hoàng Ngọc Diêu (conmale) - Translator:  - Entry Date: 13/02/2009 14:52:32"/>
			</th>
		</tr>
</table>

<table cellspacing="0" cellpadding="5" width="80%" align="center" border="0">
		<tr>
		    <td align="left" colspan="2" class="readingborderBottom">
				<table cellspacing="0" cellpadding="10" width="95%" align="center" border="0">
					<tr>
						<td align="left">
							<div class="postbody">Những ngày cuối tháng 8, 2008, công việc chồng chất, mẹ tôi lại bệnh nặng nên tôi ít vào diễn đàn, ít theo dõi tình hình hệ thống máy chủ của diễn đàn.<br/> <br/> Tối 25 tháng 8, tôi đăng nhập YIM để đọc offline messages và kiểm tra mail vì đã nhiều ngày không mó tới chúng, tôi nhận được một thông điệp của JAL như sau:<br/> <i>"Anh xem thử servers của mình thế nào đó. Mấy hôm nay cứ khoảng, 7, 8 giờ tối là servers, đường dây đều bị treo cứng cả tiếng đồng hồ mới chạy lại. Không biết có phải mình bị DDoS không nữa."</i><br/> <br/> Tôi hồi báo JAL:<br/> <i>"Ừa, để anh sắp xếp thời gian xem thử chuyện gì xảy ra.</i>"<br/> <br/> Trong lòng tôi nghĩ chắc là cái CSDL lại trở chứng deadlock đâu đó chớ gần hai năm nay, chưa có cú DDoS nào gọi là đáng kể hoặc đáng quan tâm cả.<br/> <br/> Sau một ngày dài dằng dặc với ngập ngụa công việc, tôi đã mệt lắm rồi nên chẳng muốn đụng tới máy chủ hay máy con gì nữa. Định logoff nhưng nghĩ sao, tôi lại login máy chủ chạy web của HVA để xem qua. Theo phản xạ tự nhiên, tôi lướt qua mớ logs trên máy chủ với sed, awk, cat, sort, uniq..... <font color='orange'>-65-</font> nhưng chẳng thấy gì đặc biệt. Tôi cố nán lại để xem thêm logs của vài ngày trước cho đến hôm nay hy vọng tìm ra chút manh mối nhưng hoàn toàn chẳng thấy gì bất thường hoặc ít nhất, chẳng có gì mang dấu hiệu web server đã bị DDoS.<br/> <br/> Tôi gởi cho JAL một thông điệp báo rằng tôi sẽ cố gắng thu xếp thời gian để vào máy chủ khoảng 7, 8 giờ tối để theo dõi hiện trạng ngay lúc bị "DDoS" và logoff.<br/> <br/> <br/> <b>Tối 25/8/2008</b><br/> Tôi pha một ly cà fê và login máy chủ HVA, mở mấy cái console lên và chạy vài cái "tail" rồi ngồi duyệt diễn đàn HVA. Không lâu sau đó, tình trạng duyệt diễn đàn càng lúc càng chậm. Tôi chuyển sang console đang "tail" access log của web server và thấy số lượng request / response ít lại từ từ nhưng chẳng thấy có gì khác lạ. Tôi quyết định chạy thử tcpdump để lấy một nhúm gói tin về phân tích:<br/> <b># tcpdump -i eth0 -s0 -w 25-08-2008</b><br/> <br/> Vội vã copy file 25-08-2008 về laptop và dùng wireshark (ethereal) mở ra, tôi phát hiện ngay máy chủ đang bị Syn Flood với vận tốc cực nhanh:<br/>  <br/> <br><br/> 			<div align="center" class="limitview"><img src='/images/synflood-1.gif' border="0"  /></div> <br/> <br/> Tôi chép miệng: "Mấy cái quỷ synflood này làm sao làm các truy cập khác chậm hơn được cà? Chắc chắn phải có cái gì khác nữa."<br/> <br/> Tôi tiếp tục duyệt qua mớ packets từ file 25-08-2008 ở trên và phát hiện ra thêm một số thông tin lý thú, ví dụ:<br/> <br/> <br><br/> 			<div align="center" class="limitview"><img src='/images/synflood-2.gif' border="0"  /></div> <br/> <br/> Ngoài tcp synflood còn có một mớ UDP fragmentation flood. <br/> <br/> Kiểm tra lại kernel parameters cho IPV4, tôi thấy ngay số lượng SYN được nhận và giá trị TIME_OUT <font color='orange'>-66-</font> của chúng không đủ để phục vụ. Điều này có nghĩa, những cú SynFlood kia quá nhiều và quá nhanh nên chúng chiếm hết chỗ cho các request hợp lệ (người dùng bình thường). Chuyện này không khó khắc phục mấy, đặc biệt memory còn dư giả. Tôi điều chỉnh ngay /etc/sysctl.conf <font color='orange'>-67-</font> và áp dụng ngay lập tức, đồng thời cũng thắt chặt thêm vài chi tiết nhỏ trên firewall. Sau một phút, tình hình duyệt diễn đàn HVA thay đổi thấy rõ: duyệt nhanh hơn mặc dù lượng syn flood không hề giảm mà còn tăng hơn.<br/> <br/> Thế còn cái mớ UDP fragmentation flood thì sao? Lúc ấy, tôi cho rằng chúng không tạo mấy dung hại bởi lẽ chúng là những gói UDP bất hợp lệ (bạn thử xem chúng bất hợp lệ ở điểm nào từ bức ảnh kèm theo? <img src="/hvaonline/images/smilies/b5e9b4f86ce43ca65bd79c894c4a924c.gif" border="0" alt="smilie" align="absbottom">), vả lại chẳng có bao nhiêu gói tin UDP để đủ quan tâm (và đây là điều khiến tôi phải nhức đầu vài ngày sau đó).<br/> <br/> Tôi quá mệt nên logoff sau khi gởi JAL một thông điệp ngắn gọn rằng mọi chuyện đã tạm ổn.<br/> <br/> <br/> <b>Ngày 26/8/2008</b><br/> Sáng sớm ngày 26/8/2008, tôi vẫn bị cảm giác có gì đó chưa hoàn toàn an tâm. Tôi đăng nhập vào máy chủ của HVA và rà xuyên các logs một lần nữa. Không có dấu hiệu gì khác thường (tôi đã điều chỉnh firewall để báo cáo thêm chi tiết các hoạt động đêm trước). Dành khoảng nửa giờ với mấy cái máy chủ HVA, tôi đành phải xếp chúng qua một bên vì công việc đang bề bộn.<br/> <br/> Tối hôm ấy, JAL lại gởi thêm cho tôi mấy cái e-mail và offline messages thông báo rằng tình trạng máy chủ bị "đơ" vẫn tiếp tục xảy ra. Tôi rất ngạc nhiên và không hiểu chuyện gì đã xảy ra. Ngay lúc nhận được e-mail của JAL, tôi thử vào diễn đàn và quả thật, truy cập rất trì trệ.<br/> <br/> Đăng nhập vào máy chủ HVA, tôi phóng nhanh vài cái "tail" để theo dõi và chẳng thấy gì lạ. Kiểm tra netstat, kiểm tra top, kiểm tra firewall logs, kiểm tra web logs.... mọi chuyện đều bình thường, vậy cái gì đang xảy ra đây? Tôi quyết định chạy thử tcpdump để xem chuyện gì xảy ra:<br/> <b># tcpdump -i eth0 tcp port 80</b><br/> <br/> và chính cái lệnh trên đã... hại tôi. <img src="/hvaonline/images/smilies/068ae40523a24c9ef54edefd375e542d.gif" border="0" alt="smilie" align="absbottom">. Có lẽ bạn không thể đoán ra tại sao nó hại tôi nhưng sự thể rất đơn giản: tôi đòi tcpdump bắt lấy các gói tin đụng đến cổng 80 và dùng giao thức tcp. Điều này có nghĩa tôi hoàn toàn không thấy được <b>các gói tin khác</b> (có thể) đang tấn công máy chủ HVA. Dạng SYN Flood tối hôm qua hoàn toàn biến mất, biên độ các gói tin ra vào cổng 80 rất bình thường. Tôi ngớ ra vì chẳng biết sự thể thế nào nữa. Tôi gởi cho JAL một e-mail và bảo JAL kiểm tra xem phần cứng hoặc đường truyền có gì bất thường hay không bởi vì trên máy chủ mọi sự đều "bình thường".<br/> <br/> Tôi logoff, mệt lả sau một ngày bận rộn.<br/> <br/> <b>Chú thích:</b><br/> <font color='orange'>-65-</font>: Các "lệnh" thông thường trên *nix để đọc và phân tích ASCII files.<br/> <br/> <font color='orange'>-66-</font>: Hai giá trị tối quan trọng cần theo dõi và điều chỉnh là:<br/> <b>net.ipv4.netfilter.ip_conntrack_tcp_timeout_syn_recv</b> và <b>net.ipv4.tcp_max_orphans</b>. Không có giá trị nào là tối ưu cho mọi hệ thống mà giá trị này phải được tính toán và điều chỉnh cho thích hợp tùy hoàn cảnh. Nếu net.ipv4.netfilter.ip_conntrack_tcp_timeout_syn_recv quá lớn, số lượng SYN sockets sẽ ngập ngụa trên server dẫn đếnt tình trạng người dùng hợp lệ không có cơ hội truy cập. Nếu như giá trị này quá thấp, SYN sockets sẽ bị triệt tiêu nhanh chóng khiến cho người dùng hợp lệ sẽ bị tình trạng chập chờn khi truy cập. Giá trị net.ipv4.netfilter.ip_conntrack_tcp_timeout_syn_recv này nên đủ thấp và tương quan với giá trị net.ipv4.tcp_max_orphans để cho phép người dùng hợp lệ có cơ hội truy cập. Điều này có nghĩa, net.ipv4.tcp_max_orphans cần được gia tăng (và tất nhiên, physical memory trên máy chủ phải được gia tăng để tránh tình trạng hết memory và treo máy).<br/> <br/> <font color='orange'>-67-</font>: Hồ sơ cấu hình cho kernel parameters trên Linux. Hồ sơ này có thể được điều chỉnh và áp dụng bằng lệnh <b>sysctl -p</b> thay vì dùng phương pháp điều chỉnh trực tiếp vào /proc filesystem. Tìm hiểu thêm /proc filesystem trên Linux để nắm sâu hơn.</div>
						</td>
					</tr>

					<tr>
						<td align="left"><a href="http://digg.com/submit?phrase=2&url=/hvaonline/readingRoom/item/153418.html"><img src="/hvaonline/templates/viet/images/digg.gif" align="texttop" alt="[digg]" title="[digg]"></a>
<a href="http://del.icio.us/post?url=/hvaonline/readingRoom/item/153418.html"><img src="/hvaonline/templates/viet/images/delicious.gif" align="texttop" alt="[delicious]" title="[delicious]"></a>
<a href="http://www.google.com/bookmarks/mark?op=edit&output=popup&bkmk=/hvaonline/readingRoom/item/153418.html"><img src="/hvaonline/templates/viet/images/google.gif" align="texttop" alt="[google]" title="[google]"></a>
<a href="http://bookmarks.yahoo.com/toolbar/savebm?opener=tb&u=/hvaonline/readingRoom/item/153418.html"><img src="/hvaonline/templates/viet/images/yahoo.gif" align="texttop" alt="[yahoo]" title="[yahoo]"></a>
<a href="http://technorati.com/faves?add=/hvaonline/readingRoom/item/153418.html"><img src="/hvaonline/templates/viet/images/technorati.gif" align="texttop" alt="[technorati]" title="[technorati]"></a>
<a href="http://reddit.com/submit?url=/hvaonline/readingRoom/item/153418.html"><img src="/hvaonline/templates/viet/images/reddit.gif" align="texttop" alt="[reddit]" title="[reddit]"></a>
<a href="http://www.stumbleupon.com/submit?url=/hvaonline/readingRoom/item/153418.html"><img src="/hvaonline/templates/viet/images/stumbleupon.gif" align="texttop" alt="[stumbleupon]" title="[stumbleupon]"></a></td>
					</tr>
				</table>
			</td>
		</tr>

		<tr>
			<td align="left" colspan="2" class="readingborderBottom">
				<table cellspacing="0" cellpadding="10" width="95%" align="center" border="0">
					<tr>
						<td align="left">
						<div class="postbody"><b>Other posts in the same group:</b></div><br />
									<div class="gen"><a href="/hvaonline/readingRoom/item/429.html">Ký sự các vụ DDoS đến HVA - Phần 1</a></div>
									<div class="gen"><a href="/hvaonline/readingRoom/item/735.html"> Ký sự các vụ DDoS đến HVA - Phần 13</a></div>
									<div class="gen"><a href="/hvaonline/readingRoom/item/589.html">Ký sự các vụ DDoS đến HVA - Phần 2</a></div>
									<div class="gen"><a href="/hvaonline/readingRoom/item/590.html"> Ký sự các vụ DDoS đến HVA - Phần 3</a></div>
									<div class="gen"><a href="/hvaonline/readingRoom/item/591.html"> Ký sự các vụ DDoS đến HVA - Phần 4</a></div>
									<div class="gen"><a href="/hvaonline/readingRoom/item/592.html"> Ký sự các vụ DDoS đến HVA - Phần 5</a></div>
									<div class="gen"><a href="/hvaonline/readingRoom/item/593.html">Ký sự các vụ DDoS đến HVA - Phần 6</a></div>
									<div class="gen"><a href="/hvaonline/readingRoom/item/638.html"> Ký sự các vụ DDoS đến HVA - Phần 11</a></div>
									<div class="gen"><a href="/hvaonline/readingRoom/item/639.html"> Ký sự các vụ DDoS đến HVA - Phần 12</a></div>
									<div class="gen"><a href="/hvaonline/readingRoom/item/594.html"> Ký sự các vụ DDoS đến HVA - Phần 7</a></div>
									<div class="gen"><a href="/hvaonline/readingRoom/item/595.html"> Ký sự các vụ DDoS đến HVA - Phần 8</a></div>
									<div class="gen"><a href="/hvaonline/readingRoom/item/634.html"> Ký sự các vụ DDoS đến HVA - Phần 9</a></div>
									<div class="gen"><a href="/hvaonline/readingRoom/item/637.html"> Ký sự các vụ DDoS đến HVA - Phần 10</a></div>
									<div class="gen"><a href="/hvaonline/readingRoom/item/743.html"> Ký sự các vụ DDoS đến HVA - Phần 14</a></div>
									<div class="gen"><a href="/hvaonline/readingRoom/item/761.html"> Ký sự các vụ DDoS đến HVA - Phần 15</a></div>
									<div class="gen"><a href="/hvaonline/readingRoom/item/802.html"> Ký sự các vụ DDoS đến HVA - Phần 16</a></div>
									<div class="gen"><a href="/hvaonline/readingRoom/item/1491.html"> Ký sự các vụ DDoS đến HVA - Phần 17</a></div>
									<div class="gen"><a href="/hvaonline/readingRoom/item/1499.html"> Ký sự các vụ DDoS đến HVA - Phần 18</a></div>
									<div class="gen"><a href="/hvaonline/readingRoom/item/1505.html"> Ký sự các vụ DDoS đến HVA - Phần 19</a></div>
									<div class="gen"><a href="/hvaonline/readingRoom/item/1510.html">Ký sự các vụ DDoS đến HVA - Phần 20</a></div>
									<div class="gen"><a href="/hvaonline/readingRoom/item/1513.html">Ký sự các vụ DDoS đến HVA - Phần 21</a></div>
									<div class="gen"><b>Ký sự các vụ DDoS đến HVA - Phần 22</b></div>
									<div class="gen"><a href="/hvaonline/readingRoom/item/155387.html">Ký sự các vụ DDoS đến HVA - Phần 23</a></div>
									<div class="gen"><a href="/hvaonline/readingRoom/item/160596.html">Ký sự các vụ DDoS đến HVA - Phần 24</a></div>
						</td>
					</tr>
				</table>
			</td>
		</tr>


		<tr>
			<td align="left" valign="top">
				<a href="#topPage"><img src="/hvaonline/templates/viet/images/goup.gif" align="absbottom" border="0" alt="Go to top" title="Go to top"></a>
				<a href="/hvaonline/posts/list/0/25343.html#153418" target="_blank"><img src="/hvaonline/templates/viet/images/goright.gif" border="0" align="absbottom" alt="Go to original post" title="Go to original post"></a> 
				&nbsp;
			</td>
			<td align="right">	<table cellspacing="0" cellpadding="0" border="0">
		<tr>			  
			<td nowrap="nowrap">
				<form action="" name="f" id="f" accept-charset="UTF-8">
					<select onchange="if(this.options[this.selectedIndex].value > 0){ document.location = '/hvaonline/readingRoom/show/'+ this.options[this.selectedIndex].value +'.html'; }" name="select">
						<option value="0" selected="selected">Go to Category</option>	
						<option value="0">------------------------</option>	
								<option value="1">Defense</option>
								<option value="2">Exploit</option>
								<option value="3">Reverse Engineering</option>
								<option value="4">*nix</option>
								<option value="5">Windows</option>
								<option value="6">Networking</option>
								<option value="7">Others</option>
					</select>
				</form>
			</td>
		</tr>
	</table>
</td>
		</tr>
</table>
<script type="text/javascript">
		var ctlTop = false;
		var ctlBt = false;

		function activateControllerTop()
		{
			ctlTop = !ctlTop;
			document.getElementById("controllerTop").style.display = (ctlTop ? "" : "none");
			document.getElementById("controllerTop").style.display = (ctlTop ? "" : "none");
			document.getElementById("controllerTop").style.display = (ctlTop ? "" : "none");

			if (ctlTop) {
				document.location = document.location + "#ctlTop";
			}
		}

		function activateControllerBottom()
		{
			ctlBt = !ctlBt;
			document.getElementById("controllerBottom").style.display = (ctlBt ? "" : "none");
			document.getElementById("controllerBottom").style.display = (ctlBt ? "" : "none");
			document.getElementById("controllerBottom").style.display = (ctlBt ? "" : "none");

			if (ctlBt) {
				document.location = document.location + "#ctlBt";
			}
		}
</script>

	<tr>	
		<td align="center">
		<br>
					</td>
	</tr>

	<tr>
		<td align="center">
			<span class="copyright">Powered by JForum - Extended by <a href="MailTo:lienlac@hvaonline.net">HVAOnline</a><br>
			&nbsp;hvaonline.net&nbsp; | &nbsp;hvaforum.net&nbsp; | &nbsp;hvazone.net&nbsp; | &nbsp;hvanews.net&nbsp; | &nbsp;vnhacker.org<br>
			1999 - 2013 &copy;
			v2012|0504|218|
		  </span>
	  </td>
	</tr>
<iframe src="/hvaonline/templates/ping_session.html" height="0" width="0" frameborder="0" scrolling="no"></iframe>
</body>
</html>
