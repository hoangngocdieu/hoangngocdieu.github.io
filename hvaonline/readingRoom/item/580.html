<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"> 

<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta name="description" content="HVA Reading Room">
<meta name="keywords" content=", reading room, hva, hvaonline, hvazone, hvaforum">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="robots" content="index,follow">
<meta name="rating" content="general">
<style type="text/css">
<!-- 
@import url( "http://www.hvaonline.net/hvaonline/templates/viet/styles/style.css");
-->
</style>
<style type="text/css">
<!--
@import url("http://www.hvaonline.net/hvaonline/templates/viet/styles/en_US.css");
-->
</style>
<title> - .:: HVAOnline ::.</title>

</head>
<body class="en_US">


<!--
Original theme from phpBB (http://www.phpbb.com) subSilver
Created by subBlue design
http://www.subBlue.com
Modifications by JForum Team 
Extended and customised by HVA Team
Added more features and Black Silver theme designed by HVA
-->
<table width="100%" border="0" cols="2">
	<tr align="right">
		<td class="copyright">
			English
			| 
			<a href="/hvaonline/jforum.html?module=forums&amp;action=setLang&amp;lang=vi_VN" rel="nofollow">Vietnamese</a>
		</td>
	</tr>
</table>
<table width="100%" border="0" align="center">
	<tr>
        <td width="100%" align="center" valign="middle">
			<a href="http://www.hvaonline.net" title="[Logo]"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/hvabanner-final.gif" alt="banner" /></a>
		</td>
	</tr>

	<tr>
		<td>
<table cellspacing="0" cellpadding="0" width="80%" align="center" border="0">

		<tr height="15">
			<th colspan="2" class="thportal" align="left"><span class="readingheader">&nbsp;.::*nix::.</span></th>
		    <th class="thportal" align="center">
				<span class="readingheader">
					 Thay thế BIND với djbdns - phần 4 <a name="topPage" id="topPage"></a>
				</span>
			</th>
		    <th class="thportal" align="right">
				<a href="/hvaonline/posts/list/0/174.html#580" target="_blank">
				<img src="/hvaonline/templates/viet/images/goright.gif" align="absbottom" border="0" alt="Go to original post" title="Go to original post"/></a> 
				<img src="/hvaonline/templates/viet/images/what.gif" align="absbottom" border="0" alt="Author: Hoàng Ngọc Diêu (conmale) - Translator:  - Entry Date: 20/02/2009 18:17:15" title="Author: Hoàng Ngọc Diêu (conmale) - Translator:  - Entry Date: 20/02/2009 18:17:15"/>
			</th>
		</tr>
</table>

<table cellspacing="0" cellpadding="5" width="80%" align="center" border="0">
		<tr>
		    <td align="left" colspan="2" class="readingborderBottom">
				<table cellspacing="0" cellpadding="10" width="95%" align="center" border="0">
					<tr>
						<td align="left">
							<div class="postbody"><b>Thay thế BIND với djbdns - phần 4</b><br/> <br/> <b>5. Kỹ thuật nâng cao cho tinydns</b><br/> 5.1 Tách rời khu vực trong tinydns data<br/> Trong trường hợp bạn có một loạt host thuộc nội mạng và cần thiết lập name service cho chúng để dùng trong phạm vi nội mạng mà không cho phép bất cứ máy nào bên ngoài khu vực ấn định có thể "query" được, tinydns cho phép thiết lập nhu cầu này rất dễ dàng. Giả định bạn dùng một tinydns server nằm ở DMZ cho cả nội mạng và Internet.<br/> <br/> Có vài hình thức dùng để hình thành các dạng tách rời khu vực trong hồ sơ "data" của tinydns:<br/> <br/> a. cách dùng đuôi .lan (hoặc bất cứ đuôi nào tùy thích nhưng không phải là .com, .org, .net và các . dùng công cộng)<br/> b. cách điều chỉnh "data" của tinydns để giới hạn query thông tin.<br/> <br/> Hãy thử khai triển hai dạng trên.<br/> <br/> <b>5.1.1 Dùng đuôi .lan cho nội mạng</b><br/> Giả sử các host trong nội mạng cần được resolve, bạn có thể dùng dạng host.123.lan chẳng hạn để tách rời giữa các host được phục vụ cho công cộng và các host chỉ dành cho nội mạng. Ngoài các thông tin dành cho công cộng, thử thêm vào hồ sơ data của tinydns ở trên như sau:<br/> <br/> # thông tin cho công cộng<br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre>.123.com::blue.123.com:259200<br/> .123.com::red.123.com:259200<br/> .10.100.203.in-addr.arpa::blue.123.com<br/> .20.200.204.in-addr.arpa::red.123.com<br/> =blue.123.com:203.100.10.10<br/> =red.123.com:204.200.20.20<br/> @123.com::mail.123.com<br/> =mail.123.com:203.100.10.11<br/> =web.123.com:203.100.10.12<br/> +www.123.com:203.100.10.12</pre><br/> 		</div><br/> <br/> # cụ thể cho .lan<br/> # khởi tạo SOA cho DNS server ở 123.lan dùng host blue<br/> .123.lan::blue.lan:259200<br/> <br/> # reversed lookup cho blue.123.lan<br/> .0.168.192.in-addr.arpa::blue.123.lan<br/> <br/> # tạo PTR record cho host blue<br/> =blue.123.lan:192.168.0.2<br/> <br/> # tạo A record cho host pink<br/> +pink.123.lan:172.16.1.10<br/> <br/> # tạo A record cho host green<br/> +green.123.lan:172.16.1.11<br/> <br/> Và cứ như vậy mà tạo thêm thông tin cho các host thuộc .lan tùy nhu cầu. Khi hoàn thành, bạn cần phải make để tạo hồ sơ "data.cdb" mới cho tinydns.<br/> <br/> Bước kế tiếp không thể thiếu được vì nó cần để "ra lệnh" dnscache server đi thẳng đến tinydns server (mà chúng ta vừa tạo thông tin cho các host ở trên) để lấy thông tin. Giả định vẫn dùng dnscacheext (của phần 4.3.3) làm "resolver" trong trường hợp này, chúng ta thực hiện các bước sau:<br/> <br/> <b># cd /service/dnscacheext/root/servers<br/> # echo 192.168.0.2 &gt; 123.lan<br/> # echo 192.168.0.2 &gt; .0.168.192.in-addr.arpa</b><br/> <br/> Hai lệnh "echo" ở trên đơn giản dùng để thêm giá trị 192.168.0.2 vào trong hai hồ sơ có tên là "123.lan" và ".0.168.192.in-addr.arpa" trong thư mục /service/dnscacheext/root/servers. Đơn giản mà nói, hồ sơ thứ nhất "123.lan" dùng để chỉ định cho dnscacheext đi đến máy có IP là 192.168.0.2 (đang chạy tinydns) để tìm lấy thông tin cho những gì thuộc về domain 123.lan nếu có client nào request. Tương tự, hồ sơ ".0.168.192.in-addr-arpa" dùng để trả lời cho reverse lookup.<br/> <br/> Vậy nếu các máy con trong nội mạng cần resolve một host nào đó thuộc domain 123.com thì sao? Có hai cách:<br/> - dnscache vẫn đi một vòng lớn để hỏi tìm thông tin thuộc domain 123.com -16-,<br/> - hoặc bạn ra lệnh cho dnscache liên hệ trực tiếp với tinydns để lấy thông tin thuộc về domain 123.com<br/> <br/> <b># cd /service/dnscacheext/root/servers<br/> # echo 192.168.0.2 &gt; 123.com<br/> # echo 192.168.0.2 &gt; .0.168.192.in-addr.arpa</b><br/> <br/> Tương tư như trên cho "123.lan", đoạn lệnh trên ứng dụng cho "123.com".<br/> <br/> Điều căn bản tất yếu là host mang IP 192.168.0.2 làm "authoritative server" được dnscache trong nội mạng thấy với private IP 192.168.0.2 đồng thời các máy trên Internet có thể "thấy" nó với public IP (xuyên qua phương thức mapping public IP thành private IP từ router hoặc phương thức NAT). Đối với các máy bên ngoài Internet, host blue.123.com (192.168.0.2) có thể được thấy với public IP như 203.100.10.10 chẳng hạn. Chi tiết vấn đề trên nằm ngoài giới hạn của tài liệu này.<br/> <br/> <b>5.1.2 Dùng tính năng "region" trong hồ sơ "data" của tinydns</b><br/> Trong bảng tóm tắt các dấu hiệu dùng trong hồ sơ data của tinydns có dấu phần trăm <img src="/hvaonline/images/smilies/e0f87a341be3edf5986da5169daff828.gif" border="0" alt="smilie" align="absbottom"> dùng để xác định khu vực cho thông tin. Đây chính là chìa khoá cho phương pháp ứng dụng "region". Đặc tính của khóa "region" trong hồ sơ "data" của tinydns ở chỗ nó quy định hẳn hòi các IP (và host nào) được tinydns trả lời cho Internet và cho nội mạng.<br/> <br/> Chỉ định "region" trong data của tinydns có cú pháp:<br/> <b>%<location>:<IP-prefix></b>, trong đó<br/> <location> được biểu thị bằng một (1) hoặc hai (2) chữ cái, ví dụ: AB, CD, IN, EX<br/> <IP-prefix> được biểu thị bằng chuỗi IP, ví dụ: 192.168.1 (ngầm hiểu là 192.168.1.0/24)<br/> <br/> Hãy cùng xét hồ sơ "data" sau:<br/> <br/> # khu vực nội mạng (gi�›i hạn cho nội mạng 172.16.1.0/24)<br/> %IN:172.16.1<br/> <br/> # khu vực công cộng (Internet, bất cứ nơi đâu bên ngoài nội mạng, không gi�›i hạn bất cứ IP nào)<br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre>%EX:<br/> <br/> .123.com::blue.123.com:259200::EX<br/> .123.com::red.123.com:259200::EX<br/> .10.100.203.in-addr.arpa::blue.123.com::EX<br/> .20.200.204.in-addr.arpa::red.123.com::EX<br/> =blue.123.com:203.100.10.10::EX<br/> =red.123.com:204.200.20.20::EX<br/> @123.com::mail.123.com::EX<br/> =mail.123.com:203.100.10.11::EX<br/> =web.123.com:203.100.10.12::EX<br/> +www.123.com:203.100.10.12::EX<br/> <br/> # dành riêng cho nội mạng<br/> +pink.123.com:172.16.1.10::IN<br/> +green.123.com:172.16.1.11::IN</pre><br/> 		</div><br/> <br/> - Tất cả các entry có đuôi % đi kèm ấn định thông tin này được giới hạn cho region đã ấn định<br/> <br/> - Nếu có nhiều regions thì bạn phải công bố nhiều giá trị % cho mỗi region.<br/> <br/> Sau khi "make" hồ sơ "data", các thông tin để tinydns dùng để trả lời các host / domain được phân chia theo region IN và EX. Bất cứ entry nào có đuôi là EX thì tinydns sẽ dùng để trả lời cho mọi địa chỉ (theo quy chế authoritative), bất cứ entry nào có đuôi là IN thì chỉ có nội mạng (172.16.1.0/24) mới được tinydns cung cấp thông tin. Nói một cách khác, một host nào đó từ Internet muốn resolve IP / name của host mail.123.com chẳng hạn thì tinydns sẽ cung cấp thông tin vì nó được ấn định đuôi "EX", nhưng nếu host này muốn resolve IP / name của host pink.123.com thì host này sẽ thuộc dạng "không tồn tại".<br/> <br/> Đối với trường hợp các máy con trong nội mạng cần resolve name xuyên qua dnscache, tất nhiên bạn vẫn cần "kết nối" dnscache và tinydns với nhau như ở phần 4.5.1 để dnscache đi thẳng đến tinydns mà lấy thông tin thay vì phải đi một vòng lớn (như ở phần chú thích 16).<br/> <br/> 5.2 Tách rời tinydns server cho nội mạng và tinydns server cho Internet<br/> Phương pháp dùng hai tinydns servers cho hai khu vực riêng biệt là phương pháp an toàn nhất nếu bạn muốn kiện toàn bảo mật cho dịch vụ DNS. Bạn có thể thiết lập hai tinydns servers ở hai khu vực:<br/> - tinydns thuộc DMZ chỉ chứa thông tin cho các host phục vụ cho công cộng<br/> - tinydns thuộc nội mạng chứa các thông tin chỉ dành riêng cho nội mạng<br/> Với phương pháp tách rời hai tinydns servers, không những bạn có thể ấn định thông tin các host nào được cung cấp mà bạn còn có thể loại trừ trường hợp tinydns server dùng cho công cộng bị nhân nhượng cũng không bị lộ các thông tin thuộc về nội mạng.<br/> <br/> Phương pháp tạo các tinydns server này như đã bàn ở phần 4.4, chúng ta không cần phải lặp lại chi tiết. Tuy nhiên, để tiện hình dung, hai hồ sơ "data" cho hai tinydns servers tạm có nội dung như sau:<br/> <br/> tinydns công cộng nằm ở DMZ<br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre># thông tin cho công cộng<br/> .123.com::blue.123.com:259200<br/> .123.com::red.123.com:259200<br/> .10.100.203.in-addr.arpa::blue.123.com<br/> .20.200.204.in-addr.arpa::red.123.com<br/> =blue.123.com:203.100.10.10<br/> =red.123.com:204.200.20.20<br/> @123.com::mail.123.com<br/> =mail.123.com:203.100.10.11<br/> =web.123.com:203.100.10.12<br/> +www.123.com:203.100.10.12</pre><br/> 		</div><br/> <br/> - tinydns cho công cộng vẫn dùng host blue và red làm các "authoritative" servers và các IP vẫn là các public IP.<br/> - tinydns cho công cộng chỉ cung cấp các thông tin đã ấn định ở đây.<br/> <br/> tinydns nội mạng nằm trong nội mạng<br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre># thông tin cho nội mạng<br/> .123.com::orange.123.com:259200<br/> .1.16.172.in-addr.arpa::orange.123.com<br/> =orange.123.lan:172.16.1.100<br/> =pink.123.com:172.16.1.10<br/> =green.123.com:172.16.1.11<br/> =yellow.123.com:172.16.1.12<br/> +intranet.123.com:172.16.1.12</pre><br/> 		</div><br/> <br/> - tinydns cho nội mạng dùng host orange làm "authoritative" server và các IP ở đây hoàn toàn là private IP.<br/> - tinydns cho nội mạng chỉ cung cấp các thông tin được ấn định ở đây.<br/> <br/> Điều cần phải hoàn tất ở đây là phải "ra lệnh" cho dnscache của nội mạng biết đi đâu để lấy thông tin cho các host thuộc domain 123.com (cả thông tin công cộng lẫn thông tin dành cho nội mạng). Chạy các lệnh sau:<br/> <br/> <b># cd /service/dnscacheext/root/servers<br/> # echo 172.16.1.100 &gt; 123.com<br/> # echo 172.16.1.100 &gt; .1.16.172.in-addr.arpa<br/> <br/> # cd /service/dnscacheext/root/servers<br/> # echo 192.168.0.2 &gt; 123.com<br/> # echo 192.168.0.2 &gt; .0.168.192.in-addr.arpa</b><br/> <br/> Như đã giải thích ở phần 5.1.1, các lệnh "echo" ở trên dùng để "ra lệnh" cho dnscacheext đi đến hai tinydns servers có IP là 172.16.1.100 và 192.168.0.2 lấy thông tin nếu có query nào thuộc về domain "123.com". Điểm cần chú ý ở đây là tinydns cho công cộng ở 192.168.0.2 đối với nội mạng vẫn là host nằm ở DMZ dùng private IP. dnscacheext sẽ đi ra ngoài các root DNS để tìm các thông tin thuộc về các domain khác mà bạn không làm chủ hoặc không quản lý đúng theo chức năng của nó.<br/> <br/> <b>6. Bảo trì</b><br/> dnscache và tinydns sau khi thiết lập một cách hoàn chỉnh, công tác bảo trì trở nên rất đơn giản. Đối với dnscache, vấn đề đáng quan tâm nhất là việc quản lý memory cho cache và thông tin trong cache. Vấn đề này cần được theo dõi và điều chỉnh tuỳ theo số lượng thông tin được cache. Đối với tinydns, ngoài việc thêm bớt các thông tin thuộc về các domain cho bạn làm chủ hoặc quản lý bằng cách điều chỉnh trực tiếp đến hồ sơ "data" (và make sau khi điều chỉnh), bạn cần quan tâm đến vấn đề phân bố thông tin cập nhật cho secondary tinydns server.<br/> <br/> 6.1 Điều chỉnh kích thước cache của dnscache<br/> Theo mặc định, giá trị memory ấn định cho dnscache là 1Mb. Tùy theo số lượng thông tin và biên độ thông tin được cached, bạn cần điều chỉnh giá trị memory cho thích hợp. Giá trị memory của dnscache được ấn định trong thư mục env thuộc thư mục chứa dnscache. Cú pháp tổng quát như sau:<br/> <b># echo <mem> /service/dnscache/env/CACHESIZE<br/> # echo <mem> /service/dnscache/env/DATALIMIT</b><br/> Trong đó,<br/> <mem> là giá trị memory ở đơn vị bytes được ấn định (Ví dụ, 8Mb ==&gt; 1024 * 1024 * 8 = 8388608)<br/> CACHESIZE là biến số giá trị cache được dnscache "đọc" và xử dụng khi khởi động (hay tái khởi động)<br/> DATALIMIT là biến số giới hạn ấn định không cho dnscache dùng memory vượt quá giới hạn này. Giới hạn này thật sự chỉ là giới hạn an toàn dùng để ngăn ngừa tình trạng memory "rò rỉ" (leak), giới hạn này thường có giá trị cao hơn CACHESIZE đôi chút.<br/> <br/> Nếu dnscache dùng memory đến giới hạn CACHESIZE đã ấn định, nó sẽ không chứa thông tin lấy được từ các authoritative DNS servers trong cache nữa. Sau giới hạn này, mỗi request được dnscache lấy từ authoritative DNS server và cung cấp thẳng đến máy con mà không hề lưu trữ (nếu thông tin này chưa hề có trong cache). Khi các thông tin được lưu trong cache của dnscache bị quá hạn (dựa trên thông tin TTL), chúng sẽ được xoá bỏ và thông tin mới sẽ được đưa vào các khoảng trống này. Vì các thông tin được lưu trên memory cache nên các máy con được cung cấp thông tin cần thiết rất nhanh và giảm thiểu lưu thông đến Internet và lưu thông đi về lại dnscache server. Nếu có thể được, bạn nên ấn định lượng memory tương đối rộng rãi cho dịch vụ dnscache. -17-<br/> <br/> Như đã đề cập ở trên, thông tin dnscache lấy được và cung cấp cho các máy con được lưu trữ trên memory. Bởi thế, mỗi khi tái khởi động dịch vụ dnscache, trọn bộ các thông tin được "cached" sẽ bị xoá. Nếu bạn muốn xoá trọn bộ cache của một dnscache server nào đó, bạn chỉ cần tái khởi động dịch vụ dnscache. Chức năng lưu trữ "cache" trên memory (thay vì trên đĩa) cũng là một tính năng bảo mật của dnscache nói riêng và djbdns nói chung: chỉ có chính dnscache thâu thập thông tin cần thiết và lưu trữ chúng ngay trên memory được ấn định trước và xoá chúng khi các thông tin này bị quá hạn. Các phương pháp thông thường dùng để "tiêm" những thông tin không thẩm quyền (và có thể hư hoại) vào phần "cache" của dịch vụ DNS không thể ứng dụng được với dnscache.<br/> <br/> <b>6.2 Quản lý tinydns (một và nhiều servers)</b><br/> Vấn đề quản lý dữ liệu giữa các authoritative DNS servers thường dùng cơ chế "zone transfer" (AXFR). Những phiên bản gần đây của BIND ứng dụng phương thức ACL để giới hạn "zone transfer" chỉ cho các servers được ấn định thực hiện chuyện này. Đây là một cải tiến rất lớn của BIND để kiện toàn bảo mật cho dịch vụ DNS trên BIND. Tuy nhiên, cơ chế zone transfer vẫn có những điểm hở trên phương diện bảo mật (spoofed IP vẫn có thể dùng để transfer zone của BIND chẳng hạn). Hơn nữa, cơ chế AXFR mang tính "thụ động" (passive) đối với primary DNS server, điều này có nghĩa BIND cho phép zone transfer, các secondary server được quyền chuyển dữ liệu (đã cập nhật) từ primary server khi nào cần và khi nào muốn.<br/> <br/> Đối với tinydns, việc phân bố và cập nhật thông tin "zone" (trong hồ sơ data.cdb) giữa các tinydns servers là một việc hết sức đơn giản. Bởi hồ sơ data.cdb có dạng "platform independent" -18- nên hồ sơ data.cdb sau khi được biên dịch trên một linux server có thể mang đến dùng cho một bsd server hoặc một solaris server nếu chúng cùng chạy tinydns. Bạn có thể dễ dàng cập nhật data.cdb đến các tinydns server khác (các secondary server) ngay sau khi data.cdb được tái tạo. Đây chính là tính "năng động" (active) của tinydns và zone transfer không còn cần thiết nữa. Tất nhiên, những hạn chế bảo mật của AXFR hoàn toàn được loại trừ khi thông tin giữa các authoritative servers không còn cập nhật bằng cơ chế zone transfer.<br/> <br/> Có nhiều cách để thực hiện công tác cập nhật hồ sơ data.cdb giữa các tinydns servers. Một cách tổng quát mà nói, nếu bạn có thể tải dữ liệu từ tinydns server này sang tinydns server kia (qua ftp, scp, sftp....) thì bạn có thể cập nhật hồ sơ data.cdb này tự động hoặc "bằng tay". Bạn chỉ đơn giản sao chép hồ sơ data.cdb của tinydns server chính và mang qua các tinydns server phụ (vào thư mục chứa data.cdb và viết chồng lên), sau đó tái khởi động dịch vụ tinydns là xong. Ở đây tôi muốn đưa ra một cách đơn giản nhất và hoàn toàn tự động, cơ chế này phụ thuộc vào dịch vụ SSH đã được thiết lập hoàn chỉnh trên các secondary tinydns server.<br/> <br/> Giả sử bạn có primary tinydns server với hostname là blue.123.com và secondary tinydns server với hostname là red.123.com (vẫn dùng ví dụ trong phần 4.4), server này đã có SSH -19- lắng nghe trên cổng 22 chẳng hạn và bạn có một tài khoản để truy cập vào host red.123.com.<br/> <br/> Cách chuyển data.cdb bằng tay<br/> Trên console của máy blue.123.com, bạn chạy lệnh sau:<br/> <b>$ rsync -e "ssh -p 22" -az <yourname>@red.123.com:/path/to/localdir/data.cdb /path/to/remotedir/data.cdb</b><br/> trong đó,<br/> - Tham số "ssh -p 22" dùng để đưa vào giá trị ssh server và cổng dịch vụ của nó để rsync truy cập đến. Nếu ssh server trên red.123.com không dùng cổng 22 mà dùng cổng khác thì bạn có thể thay thế giá trị này.<br/> - <yourname> ở đây là login name (tài khoản) bạn có, dùng để login host red.123.com<br/> - /path/to/localdir/data.cdb thường là /service/tinydns/root/data.cdb nơi chứa hồ sơ data.cdb trên blue.123.com<br/> - /path/to/remowww/data.cdb thường là /service/tinydns/root/data.cdb nơi chứa hồ sơ data.cdb trên red.123.com<br/> <br/> Điều quan trọng cần thiết lập trước trên host red.123.com là tài khoản <yourname> được dùng ở đây phải có quyền rw trong thư mục /path/to/remowww/ không thì hồ sơ data.cdb không thể cập nhật được. Đây chỉ là vấn đề thuộc diện "quyền truy cập" căn bản.<br/> <br/> Sau khi cập nhật hồ sơ data.cdb trên host red.123.com, bạn cần tái khởi động dịch vụ tinydns trên host này. Bạn có thể dùng ssh để login host red.123.com từ xa, chuyển sang chế độ "super user" và chạy lệnh:<br/> <b># svc -t /service/tinydns. </b>Bạn cũng có thể thi hành lệnh này ngay trên host blue.123.com sau khi đã cập nhật hồ sơ data.cdb bằng lệnh:<br/> <b># ssh -l <yourname> red.123.com /usr/local/bin/svc -t /service/tinydns </b>(nếu <yourname> được phép tái khởi động tinydns, nếu không bạn phải dùng "root" -20- để thay thế cho <yourname>).<br/> <br/> Cách chuyển data.cdb tự động<br/> Cách này tương tự như cách trên, chỉ khác ở một điểm duy nhất là thay vì phải thực thi các lệnh trên "bằng tay" trên một console, bạn chỉ cần đưa chúng vào hồ sơ Makefile nằm trong cùng thư mục chứa hồ sơ data.cdb (thông thường ở /service/tinydns/root/) và điều chỉnh hồ sơ Makefile từ:<br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre>data.cdb: data<br/>         /usr/local/bin/tinydns-data</pre><br/> 		</div><br/> <br/> <br/> trở thành:<br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre>remote: data.cdb<br/>     rsync -e "ssh -p 22" -az &lt;yourname&gt;@red.123.com:/path/to/localdir/data.cdb /path/to/remotedir/data.cdb<br/>     ssh -l &lt;yourname&gt; red.123.com /usr/local/bin/svc -t /service/tinydns<br/> <br/> data.cdb: data<br/>     /usr/local/bin/tinydns-data</pre><br/> 		</div><br/> <br/> <br/> "Target" remote ở trên thao tác hai lệnh như đã bàn. Bạn cần thay thế các thông tin cho phù hợp. Sở dĩ "target" remote nằm trên vì nó là dependency của "target" data.cdb -21-.<br/> <br/> Nếu không có sẵn rsync trên máy, bạn có thể dùng scp để thay thế cho dòng thứ nhất ở trên:<br/> scp data.cdb red.123.com:/path/to/remotedir/data.cdb<br/> <br/> Để tránh trường hợp thông tin của data.cdb không đồng bộ giữa primary và secondary server, bạn nên ngăn ngừa việc biên dịch hồ sơ "data" ngay trên secondary server nếu không, cơ hội bạn có hai hồ sơ data.cdb rất cao và đây là điều cần phải tránh cho dịch vụ DNS. Cách ngăn ngừa rất đơn giản: bạn chỉ cần điều chỉnh hồ sơ "data" trên secondary server như sau:<br/> <br/> # Do not edit and make this file directly<br/> # the compiled version is to be copied from primary server<br/> # The next line is to stop make<br/> 9<br/> <br/> <br/> <còn tiếp><br/> <hnd - vninformatics.com / diendantinhoc.net 11/2004)><br/> <br/> Chú thích:<br/> -16- Nhu cầu resolve có thể tạm tách biệt với hai trường hợp chính: resolve cho các host / domain nội bộ và resolve cho các host / domain công cộng. Ví dụ bạn làm chủ ba tên miền công cộng: 123.com, 456.com và 789.com, đồng thời bạn dùng dạng 123.lan cho các máy bên trong nội mạng, tinydns có thể được thiết lập để cho phép từng khu vực có quyền truy cập. Điều này dẫn tới một vấn đề: server A phục vụ dịch vụ "cache" dùng dnscache và server B dịch vụ "authoritative dns" dùng tinydns. Vậy nếu một client M thuộc nội mạng của server A này muốn resolve một host xyz thuộc domain 123.com (xyz.123.com) thì sao? Câu trả lời hết sức đơn giản: dnscache và tinydns vẫn giữ vững vai trò của chúng. vấn đề này có thể minh hoạ như sau:<br/> <br/> - client M gởi request đến server A cho thông tin về host xyz.123.com<br/> - dnscache của server A sẽ tiếp nhận request và gởi request đến một trong các root DNS servers trên Internet<br/> - root DNS servers sẽ delegate dnscache của server A xuống nhóm .com để tiếp tục tìm thông tin<br/> - authoritative DNS server của 123.com sẽ trả lời dnscache - trong trường hợp này authoritative DNS server của 123.com chính là tinydns trên server B<br/> - dnscache trả lời client M với thông tin tìm được và lưu trữ thông tin này trong cache<br/> <br/> Phân tích trên cho trường hợp bạn muốn dnscache và tinydns hoàn toàn độc lập và thực hiện đúng chức năng của chúng. Tuy nhiên, nếu muốn ấn định cho dnscache phải trực tiếp liên hệ với tinydns để lấy thông tin về host xyz.123.com thì bạn vẫn có thể thực hiện yêu cầu này bằng cách "ra lệnh" cho dnscache liên hệ trực tiếp với tinydns của bạn. Đường đi ở trên xảy ra y hệt cho trường hợp chỉ có một server chạy cả dnscache và tinydns vì hai dịch vụ này hoàn toàn độc lập.<br/> <br/> -17- Theo kinh nghiệm bản thân, một dnscache phục vụ cho gần 4000 máy được ấn định 128Mb RAM, hoạt động liên tục 18 tháng một cách ổn định. Với công ty nhỏ hơn, khoảng 200 máy được ấn định 16Mb RAM, hoạt động liên tục 24 tháng một cách ổn định. Lượng memory ấn định cho dnscache còn tùy vào mức độ truy dùng Internet và nhu cầu giải danh của từng môi trường làm việc. Bạn cần theo dõi log của dnscache để hình thành giá trị memory thích ứng cho môi trường của mình.<br/> <br/> -18- platform independent: không phụ thuộc vào môi trường hoạt động của hệ điều hành.<br/> <br/> -19- SSH là Secure SHell, dịch vụ này được cài theo mặc định trên hầu hết các linux distribution và *bsd cũng như trên Solaris và AIX. Cho chi tiết thiết lập, tham khảo tài liệu cụ thể của hệ điều hành bạn dùng.<br/> <br/> -20- Phần lớn các dịch vụ SSH đều không cho phép root login từ xa nếu như dịch vụ này được quản trị viên thắt chặt. Trong trường hợp này, bạn có thể tạo một shell script có tên là "restartdns" chẳng hạn trên host red.123.com chứa nội dung tương tự như:<br/> #!/bin/bash<br/> su - /usr/local/bin/svc -t /service/tinydns<br/> Sau đó mới chạy script này từ host red.123.com<br/> <br/> Thông tin ở đây chỉ là một giả định, cách thiết kế truy cập trên mỗi môi trường / máy chủ khác nhau. Tuỳ vào sở chọn và kỹ năng của từng người mà thiết kế.<br/> <br/> -21- để có thể thực hiện "target" remote, make phải hoàn thành data.cdb trước. Chuyện này rất hiển nhiên và logic vì nếu hồ sơ data.cdb trên primary server không cần cập nhật (từ make) thì việc copy hồ sơ này đến secondary server không cần thiết nữa.</div>
						</td>
					</tr>

					<tr>
						<td align="left"><a href="http://digg.com/submit?phrase=2&url=http://www.hvaonline.net/hvaonline/readingRoom/item/580.html"><img src="/hvaonline/templates/viet/images/digg.gif" align="texttop" alt="[digg]" title="[digg]"></a>
<a href="http://del.icio.us/post?url=http://www.hvaonline.net/hvaonline/readingRoom/item/580.html"><img src="/hvaonline/templates/viet/images/delicious.gif" align="texttop" alt="[delicious]" title="[delicious]"></a>
<a href="http://www.google.com/bookmarks/mark?op=edit&output=popup&bkmk=http://www.hvaonline.net/hvaonline/readingRoom/item/580.html"><img src="/hvaonline/templates/viet/images/google.gif" align="texttop" alt="[google]" title="[google]"></a>
<a href="http://bookmarks.yahoo.com/toolbar/savebm?opener=tb&u=http://www.hvaonline.net/hvaonline/readingRoom/item/580.html"><img src="/hvaonline/templates/viet/images/yahoo.gif" align="texttop" alt="[yahoo]" title="[yahoo]"></a>
<a href="http://technorati.com/faves?add=http://www.hvaonline.net/hvaonline/readingRoom/item/580.html"><img src="/hvaonline/templates/viet/images/technorati.gif" align="texttop" alt="[technorati]" title="[technorati]"></a>
<a href="http://reddit.com/submit?url=http://www.hvaonline.net/hvaonline/readingRoom/item/580.html"><img src="/hvaonline/templates/viet/images/reddit.gif" align="texttop" alt="[reddit]" title="[reddit]"></a>
<a href="http://www.stumbleupon.com/submit?url=http://www.hvaonline.net/hvaonline/readingRoom/item/580.html"><img src="/hvaonline/templates/viet/images/stumbleupon.gif" align="texttop" alt="[stumbleupon]" title="[stumbleupon]"></a></td>
					</tr>
				</table>
			</td>
		</tr>

		<tr>
			<td align="left" colspan="2" class="readingborderBottom">
				<table cellspacing="0" cellpadding="10" width="95%" align="center" border="0">
					<tr>
						<td align="left">
						<div class="postbody"><b>Other posts in the same group:</b></div><br />
									<div class="gen"><a href="/hvaonline/readingRoom/item/573.html">Thay thế BIND với djbdns - phần 1</a></div>
									<div class="gen"><a href="/hvaonline/readingRoom/item/576.html"> Thay thế BIND với djbdns - phần 2</a></div>
									<div class="gen"><a href="/hvaonline/readingRoom/item/578.html">Thay thế BIND với djbdns - phần 3</a></div>
									<div class="gen"><b>Thay thế BIND với djbdns - phần 4</b></div>
									<div class="gen"><a href="/hvaonline/readingRoom/item/581.html">Thay thế BIND với djbdns - phần 5 (phần cuối)</a></div>
						</td>
					</tr>
				</table>
			</td>
		</tr>


		<tr>
			<td align="left" valign="top">
				<a href="#topPage"><img src="/hvaonline/templates/viet/images/goup.gif" align="absbottom" border="0" alt="Go to top" title="Go to top"></a>
				<a href="/hvaonline/posts/list/0/174.html#580" target="_blank"><img src="/hvaonline/templates/viet/images/goright.gif" border="0" align="absbottom" alt="Go to original post" title="Go to original post"></a> 
				&nbsp;
			</td>
			<td align="right">	<table cellspacing="0" cellpadding="0" border="0">
		<tr>			  
			<td nowrap="nowrap">
				<form action="" name="f" id="f" accept-charset="UTF-8">
					<select onchange="if(this.options[this.selectedIndex].value > 0){ document.location = '/hvaonline/readingRoom/show/'+ this.options[this.selectedIndex].value +'.html'; }" name="select">
						<option value="0" selected="selected">Go to Category</option>	
						<option value="0">------------------------</option>	
								<option value="1">Defense</option>
								<option value="2">Exploit</option>
								<option value="3">Reverse Engineering</option>
								<option value="4">*nix</option>
								<option value="5">Windows</option>
								<option value="6">Networking</option>
								<option value="7">Others</option>
					</select>
				</form>
			</td>
		</tr>
	</table>
</td>
		</tr>
</table>
<script type="text/javascript">
		var ctlTop = false;
		var ctlBt = false;

		function activateControllerTop()
		{
			ctlTop = !ctlTop;
			document.getElementById("controllerTop").style.display = (ctlTop ? "" : "none");
			document.getElementById("controllerTop").style.display = (ctlTop ? "" : "none");
			document.getElementById("controllerTop").style.display = (ctlTop ? "" : "none");

			if (ctlTop) {
				document.location = document.location + "#ctlTop";
			}
		}

		function activateControllerBottom()
		{
			ctlBt = !ctlBt;
			document.getElementById("controllerBottom").style.display = (ctlBt ? "" : "none");
			document.getElementById("controllerBottom").style.display = (ctlBt ? "" : "none");
			document.getElementById("controllerBottom").style.display = (ctlBt ? "" : "none");

			if (ctlBt) {
				document.location = document.location + "#ctlBt";
			}
		}
</script>

	<tr>	
		<td align="center">
		<br>
					</td>
	</tr>

	<tr>
		<td align="center">
			<span class="copyright">Powered by JForum - Extended by <a href="MailTo:lienlac@hvaonline.net">HVAOnline</a><br>
			&nbsp;hvaonline.net&nbsp; | &nbsp;hvaforum.net&nbsp; | &nbsp;hvazone.net&nbsp; | &nbsp;hvanews.net&nbsp; | &nbsp;vnhacker.org<br>
			1999 - 2013 &copy;
			v2012|0504|218|
		  </span>
	  </td>
	</tr>
<iframe src="/hvaonline/templates/ping_session.jsp" height="0" width="0" frameborder="0" scrolling="no"></iframe>
</body>
</html>
