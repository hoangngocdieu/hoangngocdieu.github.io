<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"> 

<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta name="description" content="HVA Reading Room">
<meta name="keywords" content=", reading room, hva, hvaonline, hvazone, hvaforum">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="robots" content="index,follow">
<meta name="rating" content="general">
<style type="text/css">
<!-- 
@import url( "http://www.hvaonline.net/hvaonline/templates/viet/styles/style.css");
-->
</style>
<style type="text/css">
<!--
@import url("http://www.hvaonline.net/hvaonline/templates/viet/styles/en_US.css");
-->
</style>
<title> - .:: HVAOnline ::.</title>

</head>
<body class="en_US">


<!--
Original theme from phpBB (http://www.phpbb.com) subSilver
Created by subBlue design
http://www.subBlue.com
Modifications by JForum Team 
Extended and customised by HVA Team
Added more features and Black Silver theme designed by HVA
-->
<table width="100%" border="0" cols="2">
	<tr align="right">
		<td class="copyright">
			English
			| 
			<a href="/hvaonline/jforum.html?module=forums&amp;action=setLang&amp;lang=vi_VN" rel="nofollow">Vietnamese</a>
		</td>
	</tr>
</table>
<table width="100%" border="0" align="center">
	<tr>
        <td width="100%" align="center" valign="middle">
			<a href="http://www.hvaonline.net" title="[Logo]"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/hvabanner-final.gif" alt="banner" /></a>
		</td>
	</tr>

	<tr>
		<td>
<table cellspacing="0" cellpadding="0" width="80%" align="center" border="0">

		<tr height="15">
			<th colspan="2" class="thportal" align="left"><span class="readingheader">&nbsp;.::Reverse Engineering::.</span></th>
		    <th class="thportal" align="center">
				<span class="readingheader">
					 Kiến thức cơ bản về Reverse Engineering trên Windows Mobile - 3 <a name="topPage" id="topPage"></a>
				</span>
			</th>
		    <th class="thportal" align="right">
				<a href="/hvaonline/posts/list/0/18695.html#111866" target="_blank">
				<img src="/hvaonline/templates/viet/images/goright.gif" align="absbottom" border="0" alt="Go to original post" title="Go to original post"/></a> 
				<img src="/hvaonline/templates/viet/images/what.gif" align="absbottom" border="0" alt="Author: mfeng - Translator:  - Entry Date: 26/02/2009 11:31:00" title="Author: mfeng - Translator:  - Entry Date: 26/02/2009 11:31:00"/>
			</th>
		</tr>
</table>

<table cellspacing="0" cellpadding="5" width="80%" align="center" border="0">
		<tr>
		    <td align="left" colspan="2" class="readingborderBottom">
				<table cellspacing="0" cellpadding="10" width="95%" align="center" border="0">
					<tr>
						<td align="left">
							<div class="postbody"><b><font color='red'>3. Reverse Engineering trên Windows Mobile</font></b><br/> <b><font color='orange'>3.1 Hàm APIs</font></b><br/> <br/> Hàm APIs trên Windows Mobile nhìn chung tương tự như APIs trên Windows for x86. Các hàm quen thuộc với cr@cking như GetWindowTextW, GetDlgItemTextW, MessageBoxW... đều có trên WM. (Chú ý: API của WM hoàn toàn hỗ trợ Unicode). Chi tiết nội dung các hàm này có thể tìm trên MSDN.<br/> <br/> <b><font color='white'>Cách thức gọi hàm API cấp độ assembly (calling convention):</font></b><br/> <ul><li>Giá trị trả về được giữ trong thanh ghi <font color='orange'>R0 </font>(tương tự như <font color='orange'>EAX </font>trên x86).</li></ul><br/> <ul><li>Các tham số từ trái qua phải được tải vào các thanh ghi từ R0 tới R3. Nếu nhiều tham số hơn, các giá trị được đẩy vào stack theo thứ tự từ phải qua trái. VD</li></ul><br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre>.text:00107DB8    LDR     R1, =aClsid			; lpSubKey = "CLSID"<br/> .text:00107DBC    MOV     R6, R0			<br/> .text:00107DC0    STR     R3, &#91;SP,#0x34+var_34&#93;	;STR R3,&#91;SP&#93;; phkResult<br/> .text:00107DC4    MOV     R3, #0			; samDesired = 0<br/> .text:00107DC8    MOV     R2, #0			; ulOptions = 0<br/> .text:00107DCC    MOV     R0, #0x80000000		; hKey = HKEY_CLASS_ROOT<br/> .text:00107DD0    BL      RegOpenKeyExW<br/> .text:00107DD4    MOVS    R3, R0			; test operation result<br/> .text:00107DD8    BEQ     _OpenFailed</pre><br/> 		</div><br/> <b><font color='orange'>3.2 Công cụ</font></b><br/> <b><font color='white'>a) Editor</font></b><br/> <br/> Editor dành cho PE file trên Windows for x86 hoàn toàn có thể áp dụng cho Windows Mobile như LordPE, PE Explorer, Exe Scope, Stud PE…. Tuy nhiên, để thay đổi mã lệnh của PE file for WM thì hoàn toàn không thể sử dụng chương trình trên x86 như Hiew. Có hai cách để thay đổi mã lệnh (patch):<br/> <br/> <ul><li>Mã hóa lệnh bằng tay sang dạng binary, sau đó sử dụng một hex editor bất kỳ để sửa file binary.</li></ul><br/> Ví dụ, opcodes của một số lệnh rẽ nhánh như sau:<br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre>Command	Hex<br/> B		xxxxxxEA<br/> BEQ		xxxxxx0A<br/> BNE		xxxxxx1A<br/> BGE		xxxxxxAA<br/> BHI		xxxxxx8A<br/> BLT		xxxxxxBA<br/> BCC		xxxxxx3A<br/> BCS		xxxxxx2A<br/> BPL		xxxxxx5A<br/> BMI		xxxxxx4A<br/> BLS		xxxxxx9A<br/> BGT		xxxxxxCA<br/> BLE		xxxxxxDA</pre><br/> 		</div><br/> <ul><li>Sử dụng ChARMeD</li></ul><br/> Chương trình này mang chức năng gần tương tự Hiew for x86. Download ChARMeD ở<span class="link"> http://carolos.za.net/software.html</span> (nên dùng phiên bản cho x86 có chức năng sửa code assembly). Một số chức năng:<br/> -	Di chuyển tới offset của file exe: F5 -&gt; nhập địa chỉ offset của file theo dạng số hexa.<br/> -	Thực hiện thay đổi mã lệnh tại địa chỉ hiện tại: Spacebar -&gt; nhập mã lệnh mới.<br/> <br/> <br><br/> 			<div align="center" class="limitview"><img src='http://www.hvaonline.net/hvaonline/upload/2008/1/23/defd526ef81e71f9b697f09a8457ec33_92659.gif' border="0"  /></div><br/> <br/> <b><font color='white'>b) Disassembler:</font></b><br/> <br/> Công cụ disassembler cho Windows Mobile phổ biến và mạnh nhất là IDA Pro Disassembler. Vì các ứng dụng trên WM tuân theo định dạng PE file, cách thức disassemble tương tự như các chương trình trên Windows for x86. <br/> <br/> <br><br/> 			<div align="center" class="limitview"><img src='http://www.hvaonline.net/hvaonline/upload/2008/1/23/704e80db31f8cd7ee22b0e47d441b122_92659.gif' border="0"  /></div><br/> <br/> <b><font color='white'>c) Debuggers</font></b><br/> <br/>  Có hai debuggers được sử dụng chính trong WM. Debugger thứ nhất là EVC (Embedded Visual C++) của Microsoft. Đây là debugger cơ bản đầu tiên dành cho WM, có nhiều hạn chế so với debugger thứ hai là IDA Pro Disassembler phiên bản từ 4.9 trở lên. Do vậy, phần sau chỉ minh họa cách thức cấu hình và thực hiện debug bằng IDA Pro.<br/> <br/> <b><font color='orange'>3.3 Debug trên Windows Mobile</font></b><br/> <br/> Môi trường tiến hành debug bao gồm:<br/> •	Một PocketPC (hoặc sử dụng Windows Mobile Emulator của Microsoft).<br/> •	Microsoft ActiveSync: dùng để đồng bộ giữa thiết bị PPC (thiết bị thật hoặc Emulator ) và PC. <span class="link"> http://www.microsoft.com/windowsmobile/activesync/default.mspx</span><br/> •	Trình debugger: IDA Pro Disassembler 4.9 trở lên, có module debug cho WM: <font color='yellow'>wince_remote_arm.dll</font> & <font color='yellow'>wince_stub.plw</font><br/> <br/> <b><i><font color='white'>Phần sau đây sẽ hướng dẫn cách cài đặt Windows Mobile Emulator:</font></i></b><br/> <br/> Microsoft hỗ trợ nhiều phiên bản Device Emulator tương ứng với các Emulator Images của các phiên bản WM khác nhau. Các thế hệ emulator cũ chỉ mô phỏng cho CPU x86, các phiên bản mới gần đây giả lập hoàn chỉnh CPU ARM, cho phép chạy App như trên thiết bị thật. Có hai phiên bản Device Emulator:<br/>  - Version 1.0: dùng để sử dụng cho các Emulator Images của Windows Mobile 5.0 for Pocket PC và Windows Mobile 5.0 for Smartphone.<br/> - Version 2.0: dùng để sử dụng cho các images của WM6.<br/> Ở đây sẽ đề cập tới phiên bản WM5 và Emulator v1.0.<br/> <br/> <b><font color='red'>Download</font></b><br/> <ul><li><span class="link"> http://download.microsoft.com/download/c/b/b/cbb8bc58-07b9-46bb-86ba-d12bb0d9b1d9/V1Emulator.zip</span></li></ul><br/> <ul><li><span class="link"> http://download.microsoft.com/download/c/b/b/cbb8bc58-07b9-46bb-86ba-d12bb0d9b1d9/efp.msi</span></li></ul><br/> <ul><li>Virtual Machine Network Driver (VMNet)</li></ul>: driver này có trong Virtual PC 2004 hoặc Virtual PC 2007. Nếu không muốn cài đặt Virtual PC, có thể download riêng VMNet <span class="link"> http://www.memphistech.net/tools/netsvwrap.msi</span>.<br/> <br/> <b><font color='red'>Cấu hình</font></b><br/> <br/> -	Microsoft ActiveSync: menu File  Connection Setting<br/> <br/> <br><br/> 			<div align="center" class="limitview"><img src='http://www.hvaonline.net/hvaonline/upload/2008/1/23/a9321ad6fb6f3810133a5234ac08666c_92659.jpg' border="0"  /></div><br/> <br/> -	Khởi động “Device Emulator Manager”, sau đó khởi động “Pocket PC – Cold Boot”. (Sau khi đã lưu lại trạng thái của image, các lần sau sẽ chọn “Pocket PC – SaveState”). Đặt kết nối giữa Emulator và PC thông qua ActiveSync: right click như ở hình dưới, chọn Cradle:<br/> <br/> <br><br/> 			<div align="center" class="limitview"><img src='http://www.hvaonline.net/hvaonline/upload/2008/1/23/a34a13e2afd80374e2eb92e12ed9d72e_92659.jpg' border="0"  /></div><br/> <br/> Kết quả:<br/> <br/> <br><br/> 			<div align="center" class="limitview"><img src='http://www.hvaonline.net/hvaonline/upload/2008/1/23/4cd78e0d99d3d1de324a7a28a4729b7d_92659.gif' border="0"  /></div><br/> <br/> </div>
						</td>
					</tr>

					<tr>
						<td align="left"><a href="http://digg.com/submit?phrase=2&url=http://www.hvaonline.net/hvaonline/readingRoom/item/111866.html"><img src="/hvaonline/templates/viet/images/digg.gif" align="texttop" alt="[digg]" title="[digg]"></a>
<a href="http://del.icio.us/post?url=http://www.hvaonline.net/hvaonline/readingRoom/item/111866.html"><img src="/hvaonline/templates/viet/images/delicious.gif" align="texttop" alt="[delicious]" title="[delicious]"></a>
<a href="http://www.google.com/bookmarks/mark?op=edit&output=popup&bkmk=http://www.hvaonline.net/hvaonline/readingRoom/item/111866.html"><img src="/hvaonline/templates/viet/images/google.gif" align="texttop" alt="[google]" title="[google]"></a>
<a href="http://bookmarks.yahoo.com/toolbar/savebm?opener=tb&u=http://www.hvaonline.net/hvaonline/readingRoom/item/111866.html"><img src="/hvaonline/templates/viet/images/yahoo.gif" align="texttop" alt="[yahoo]" title="[yahoo]"></a>
<a href="http://technorati.com/faves?add=http://www.hvaonline.net/hvaonline/readingRoom/item/111866.html"><img src="/hvaonline/templates/viet/images/technorati.gif" align="texttop" alt="[technorati]" title="[technorati]"></a>
<a href="http://reddit.com/submit?url=http://www.hvaonline.net/hvaonline/readingRoom/item/111866.html"><img src="/hvaonline/templates/viet/images/reddit.gif" align="texttop" alt="[reddit]" title="[reddit]"></a>
<a href="http://www.stumbleupon.com/submit?url=http://www.hvaonline.net/hvaonline/readingRoom/item/111866.html"><img src="/hvaonline/templates/viet/images/stumbleupon.gif" align="texttop" alt="[stumbleupon]" title="[stumbleupon]"></a></td>
					</tr>
				</table>
			</td>
		</tr>

		<tr>
			<td align="left" colspan="2" class="readingborderBottom">
				<table cellspacing="0" cellpadding="10" width="95%" align="center" border="0">
					<tr>
						<td align="left">
						<div class="postbody"><b>Other posts in the same group:</b></div><br />
									<div class="gen"><a href="/hvaonline/readingRoom/item/111283.html">Kiến thức cơ bản về Reverse Engineering trên Windows Mobile</a></div>
									<div class="gen"><a href="/hvaonline/readingRoom/item/111825.html">Kiến thức cơ bản về Reverse Engineering trên Windows Mobile - 2</a></div>
									<div class="gen"><b>Kiến thức cơ bản về Reverse Engineering trên Windows Mobile - 3</b></div>
									<div class="gen"><a href="/hvaonline/readingRoom/item/111869.html">Kiến thức cơ bản về Reverse Engineering trên Windows Mobile - 4</a></div>
						</td>
					</tr>
				</table>
			</td>
		</tr>


		<tr>
			<td align="left" valign="top">
				<a href="#topPage"><img src="/hvaonline/templates/viet/images/goup.gif" align="absbottom" border="0" alt="Go to top" title="Go to top"></a>
				<a href="/hvaonline/posts/list/0/18695.html#111866" target="_blank"><img src="/hvaonline/templates/viet/images/goright.gif" border="0" align="absbottom" alt="Go to original post" title="Go to original post"></a> 
				&nbsp;
			</td>
			<td align="right">	<table cellspacing="0" cellpadding="0" border="0">
		<tr>			  
			<td nowrap="nowrap">
				<form action="" name="f" id="f" accept-charset="UTF-8">
					<select onchange="if(this.options[this.selectedIndex].value > 0){ document.location = '/hvaonline/readingRoom/show/'+ this.options[this.selectedIndex].value +'.html'; }" name="select">
						<option value="0" selected="selected">Go to Category</option>	
						<option value="0">------------------------</option>	
								<option value="1">Defense</option>
								<option value="2">Exploit</option>
								<option value="3">Reverse Engineering</option>
								<option value="4">*nix</option>
								<option value="5">Windows</option>
								<option value="6">Networking</option>
								<option value="7">Others</option>
					</select>
				</form>
			</td>
		</tr>
	</table>
</td>
		</tr>
</table>
<script type="text/javascript">
		var ctlTop = false;
		var ctlBt = false;

		function activateControllerTop()
		{
			ctlTop = !ctlTop;
			document.getElementById("controllerTop").style.display = (ctlTop ? "" : "none");
			document.getElementById("controllerTop").style.display = (ctlTop ? "" : "none");
			document.getElementById("controllerTop").style.display = (ctlTop ? "" : "none");

			if (ctlTop) {
				document.location = document.location + "#ctlTop";
			}
		}

		function activateControllerBottom()
		{
			ctlBt = !ctlBt;
			document.getElementById("controllerBottom").style.display = (ctlBt ? "" : "none");
			document.getElementById("controllerBottom").style.display = (ctlBt ? "" : "none");
			document.getElementById("controllerBottom").style.display = (ctlBt ? "" : "none");

			if (ctlBt) {
				document.location = document.location + "#ctlBt";
			}
		}
</script>

	<tr>	
		<td align="center">
		<br>
					</td>
	</tr>

	<tr>
		<td align="center">
			<span class="copyright">Powered by JForum - Extended by <a href="MailTo:lienlac@hvaonline.net">HVAOnline</a><br>
			&nbsp;hvaonline.net&nbsp; | &nbsp;hvaforum.net&nbsp; | &nbsp;hvazone.net&nbsp; | &nbsp;hvanews.net&nbsp; | &nbsp;vnhacker.org<br>
			1999 - 2013 &copy;
			v2012|0504|218|
		  </span>
	  </td>
	</tr>
<iframe src="/hvaonline/templates/ping_session.jsp" height="0" width="0" frameborder="0" scrolling="no"></iframe>
</body>
</html>
