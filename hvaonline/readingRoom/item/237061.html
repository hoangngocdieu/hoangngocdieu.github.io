<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"> 

<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta name="description" content="HVA Reading Room">
<meta name="keywords" content=", reading room, hva, hvaonline, hvazone, hvaforum">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="robots" content="index,follow">
<meta name="rating" content="general">
<style type="text/css">
<!-- 
@import url( "http://www.hvaonline.net/hvaonline/templates/viet/styles/style.css");
-->
</style>
<style type="text/css">
<!--
@import url("http://www.hvaonline.net/hvaonline/templates/viet/styles/en_US.css");
-->
</style>
<title> - .:: HVAOnline ::.</title>

</head>
<body class="en_US">


<!--
Original theme from phpBB (http://www.phpbb.com) subSilver
Created by subBlue design
http://www.subBlue.com
Modifications by JForum Team 
Extended and customised by HVA Team
Added more features and Black Silver theme designed by HVA
-->
<table width="100%" border="0" cols="2">
	<tr align="right">
		<td class="copyright">
			English
			| 
			<a href="/hvaonline/jforum.hva?module=forums&amp;action=setLang&amp;lang=vi_VN" rel="nofollow">Vietnamese</a>
		</td>
	</tr>
</table>
<table width="100%" border="0" align="center">
	<tr>
        <td width="100%" align="center" valign="middle">
			<a href="http://www.hvaonline.net" title="[Logo]"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/hvabanner-final.gif" alt="banner" /></a>
		</td>
	</tr>

	<tr>
		<td>
<table cellspacing="0" cellpadding="0" width="80%" align="center" border="0">

		<tr height="15">
			<th colspan="2" class="thportal" align="left"><span class="readingheader">&nbsp;.::Defense::.</span></th>
		    <th class="thportal" align="center">
				<span class="readingheader">
					 Bảo mật web server Apache với mod Security - Phần 3.1 <a name="topPage" id="topPage"></a>
				</span>
			</th>
		    <th class="thportal" align="right">
				<a href="/hvaonline/posts/list/0/38694.hva#237061" target="_blank">
				<img src="/hvaonline/templates/viet/images/goright.gif" align="absbottom" border="0" alt="Go to original post" title="Go to original post"/></a> 
				<img src="/hvaonline/templates/viet/images/what.gif" align="absbottom" border="0" alt="Author: tanviet12 - Translator:  - Entry Date: 16/05/2011 08:49:48" title="Author: tanviet12 - Translator:  - Entry Date: 16/05/2011 08:49:48"/>
			</th>
		</tr>
</table>

<table cellspacing="0" cellpadding="5" width="80%" align="center" border="0">
		<tr>
		    <td align="left" colspan="2" class="readingborderBottom">
				<table cellspacing="0" cellpadding="10" width="95%" align="center" border="0">
					<tr>
						<td align="left">
							<div class="postbody">----------------------------------------------------------------------------------<br/> Phần 1:<span class="link"> http://www.hvaonline.net/hvaonline/posts/list/38687.hva</span><br/> Phần 2:<span class="link"> http://www.hvaonline.net/hvaonline/posts/list/38690.hva</span><br/> ----------------------------------------------------------------------------------<br/> <br/> <font size='+2'><font color='orange'><b>PHẦN 3.  NGĂN CHẶN MỘT SỐ HÌNH THỨC TẤN CÔNG THƯỜNG GẶP VỚI MODSECURITY</b></font></font><br/> <br/> Chương này sẽ trình bày một số hình thức tấn công phổ biến nhất vào web application và web server. Tiếp theo là ngăn chặn các hình thức tấn công đó với ModSecurity. Để thực hiện ngăn chặn được, đầu tiên chúng ta phải hiểu rõ đặc điểm của các  hình thức tấn công này.<br/> <br/> Web application có thể bị tấn công từ nhiều góc độ khác nhau, vì vậy việc ngăn chặn các cuộc tấn công dưới phương diện web application không hề dễ dàng.<br/> <br/>  Đối với web server, việc phục vụ các request cũng rất dễ bị khai thác, ngay trong cả web server Apache – một trình web server được đánh giá là bảo mật. Ban đầu, web server chỉ phục vụ yêu cầu các trang HTML. Theo thời gian, các ngôn ngữ khác ra đời như JavaScript, PHP… đi kèm theo các nguy cơ bảo mật. Chẳng hạn như mod_php được sử dụng để chạy các script PHP, có thể bị lỗ hổng bảo mật ở chính ngôn ngữ PHP. <br/> <br/> <font size='+1'><b><font color='orange'>3.1.  HTTP FINGERPRINTING </font></b></font><br/> <br/> Chỉ có những hacker nghiệp dư mới thực hiện tấn công một server mà không biết server đó có hoạt động hay không. Phức tạp hơn, hacker sẽ thu thập càng nhiều thông tin càng tốt về kiến trúc mạng và phần mềm đang chạy trên server. Cụ thể với web server, phương thức tìm kiếm thông tin này gọi là <font color='yellow'>HTTP Fingerprinting</font> (dấu vân tay HTTP).<br/> <br/> HTTP Fingerprinting hoạt động bằng cách kiểm tra các đặc tính riêng của web server bằng các response khi được thăm dò và lấy “dấu vân tay” của server từ những thông tin thu thập được. Sau đó dấu vân tay này được so sánh với một cơ sở dữ liệu về “dấu vân tay” cho các web server được biết đến để xác định tên web server và phiên bản mà nó đang chạy. <br/> <br/> Trong bài viết này sử dụng công cụ HTTP Fingerprinting là httprecon. Phiên bản đầu tiên của phần mềm này được phát hành vào năm 2007. Chạy trên hệ điều hành Windows. <br/> <br/> Thực hiện thăm dò một server đang chạy Apache 2.2.3 với httprecon, ta thấy kết quả trả về chính xác.<br/>  <br/> <br><br/> 			<div align="center" class="limitview"><img src='http://i483.photobucket.com/albums/rr193/buitanviet/shareforum/phan3/1.jpg' border="0"  /></div><br/> Hình 3.1 Phần mềm httprecon<br/> <br/> <font color='orange'><b>3.1.1. Cách thức HTTP Fingerprinting hoạt động</b></font><br/> <br/> Có nhiều cách để các phần mềm HTTP Fingerprinting có thể phát hiện phiên bản của web server đang chạy trên hệ thống. Chúng ta sẽ xem xét một số phương pháp phổ biến sau:<br/> <br/> <font color='orange'><b>3.1.1.1. Server banner</b></font><br/> <br/> Server banner là một chuỗi được trả về bởi server trong response header (ví dụ: <font color='yellow'>Apache/1.3.3(Unix) (Red Hat/ Linux)</font>) mang thông tin của phần mềm chạy web server cũng như hệ điều hành của web server đó.<br/> <br/> Giả sử một hacker muốn tấn công  web server của chúng ta, bước đầu tiên của hacker sẽ là gì? Câu trả lời là tìm hiểu hệ điều hành và phần mềm web server đang chạy trên hệ điều hành đó. Vì vậy, ta có thể tạo ra các thông tin “giả” về web server để cho hacker tự do thăm dò.. <br/> <br/> Để thay đổi được server banner là điều rất khó. Apache không cung cấp lệnh để thay đổi thông tin về về server banner (trừ khi chúng ta thay đổi mã nguồn và biên dịch Apache ngay từ đầu).<br/> <br/> Đề thay đổi, chúng ta phải sử dụng ModSecurity. Khi sử dụng ModSecurity, chúng ta có thể thay đổi hoàn toàn thông tin về máy chủ. Ví dụ như Apache 2.2 thành <font color='yellow'>Microsoft-IIS/5.0</font>. Tuy nhiên, để thú vị hơn thì chúng ta nên thay đổi nó thành thông tin của một máy chủ phiên bản cũ có nhiều lỗi bảo mật.<br/> <br/> Đầu tiên, chúng ta cần phải “nói” cho Apache để Apache gởi thông tin đầy đủ phiên bản của máy chủ trong response header. Sau đó ModSecurity có thể nhận ra và thay đổi thiết lập. <br/> <br/> Đơn giản là trong httpd.conf, thêm vào dòng.<br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre># Goi full server signature de ModSecurity co the thay doi no <br/> ServerTokens Full</pre><br/> 		</div><br/> <br/> Sau đó, thêm dòng sau vào file cấu hình của ModSecurity (ở đây đặt là modsecurity.conf). Khởi động lại apache khi hoàn thành.<br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre># Thay doi web server signature goi boi Apache <br/> SecServerSignature "Apache 1.3.24"</pre><br/> 		</div><br/> <br/> Apache 1.3.24 là phiên bản củ của Apache với rất nhiều lỗ hổng bảo mật. Thấy vậy các hacker rất thích thú và bỏ rất nhiều thời gian và công sức để khai thác các lỗ hổng bảo mật của phiên bản này.. Hy vọng sẽ làm nản chí các đối tượng muốn khai thác hệ thống của chúng ta (nhưng đối với các hacker kinh nghiệm, sẽ có các biện pháp để phát hiện phiên bản thật của máy chủ web).<br/> Bây giờ, chúng ta kiểm tra kết quả của các bước trước đã cấu hình.<br/>  <br/> <br><br/> 			<div align="center" class="limitview"><img src='http://i483.photobucket.com/albums/rr193/buitanviet/shareforum/phan3/2.jpg' border="0"  /></div><br/> Hình  3.2 Kết quả thay đổi server banner với ModSecurity<br/> <br/> <b><font color='orange'>3.1.1.2. Các response của giao thức HTTP</font></b><br/> <br/> Để lấy được thông tin web server, có thể sử dụng các request phi tiêu chuẩn (non-standard) hoặc request bất thường để web server gởi về các response kèm theo thông tin về server cần thu thập.<br/> Các request có thể sử dụng để lấy thông tin từ web server:<br/> <br/> <font color='orange'><i><b>Request HTTP DELETE không hợp lệ</b></i></font><br/> <br/> Như phần 2.3.2 của chương 2 đã trình bày, <font color='yellow'>HTTP DELETE</font> dùng để xoá dữ liệu từ web server. Lệnh này chủ yếu được thực hiện với người dùng đã được chứng thực. Vì vậy đối với người dùng chưa được chứng thực, thông báo lỗi sẽ được trả về. Trong thông báo lỗi có thể có các thông tin về web server.<br/> <br/> Ví dụ ở đây sử dụng Netcat để gởi request DELETE đến web server Apache:<br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre>c:\nc&gt;nc ptnd.com 80<br/> DELETE /HTTP/1.0<br/> ............<br/> &lt;!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN"&gt;<br/> &lt;html&gt;&lt;head&gt;<br/> &lt;title&gt;405 Method Not Allowed&lt;/title&gt;<br/> &lt;/head&gt;&lt;body&gt;<br/> &lt;h1&gt;Method Not Allowed&lt;/h1&gt;<br/> &lt;p&gt;The requested method GET is not allowed for the URL /HTTP/1.0.&lt;/p&gt;<br/> &lt;p&gt;Additionally, a 404 Not Found<br/> error was encountered while trying to use an ErrorDocument to handle the reques.&lt;/p&gt;<br/> &lt;hr&gt;<br/> &lt;address&gt;Apache 1.3.24 PHP/5.1.6 mod_python/3.2.8 Python/2.4.3 mod_perl/2.0.4 Prl/v5.8.8 Server at ptnd.com Port 80&lt;/address&gt;<br/> &lt;/body&gt;&lt;/html&gt;</pre><br/> 		</div><br/> <br/> Kết quả trả về lỗi 405 Method Not Allowed. Lỗi trên cho thấy phương thức request DELETE không cho phép request các URL /index.html. Thông báo lỗi này kèm theo thông tin về máy chủ Apache 1.3.24 PHP/5.1.6 mod_python/3.2.8 Python/2.4.3 mod_perl/2.0.4 Prl/v5.8.8.<br/> <br/> <i><font color='orange'><b>Request sai phiên bản HTTP</b></font></i><br/> <br/> Thực hiện ví dụ tương tự như phần trên bằng cách gởi request GET đế web server với thông số phiên bản của giao thức HTTP không đúng. <br/>  <br/> Dưới đây là kết quả thực hiện GET với phiên bản HTTP là 5.0<br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre>c:\nc&gt;nc ptnd.com 80<br/> GET /HTTP/5.0<br/> ...........<br/> &lt;!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN"&gt;<br/> &lt;html&gt;&lt;head&gt;<br/> &lt;title&gt;404 Not Found&lt;/title&gt;<br/> &lt;/head&gt;&lt;body&gt;<br/> &lt;h1&gt;Not Found&lt;/h1&gt;<br/> &lt;p&gt;The requested URL /HTTP/5.0 was not found on this server.&lt;/p&gt;<br/> &lt;p&gt;Additionally, a 404 Not Found<br/> error was encountered while trying to use an ErrorDocument to handle the request<br/> .&lt;/p&gt;<br/> &lt;hr&gt;<br/> &lt;address&gt;Apache 1.3.24 PHP/5.1.6 mod_python/3.2.8 Python/2.4.3 mod_perl/2.0.4 Perl/v5.8.8 Server at ptnd.com Port 80&lt;/address&gt;<br/> &lt;/body&gt;&lt;/html&gt;</pre><br/> 		</div><br/> <br/> <font color='orange'><i><b>Request sai giao thức</b></i></font><br/> <br/> Ví dụ dưới đây thực hiện GET với tên giao thức không phải là HTTP mà là VIETHANIT. Kết quả báo lỗi tương tự.<br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre>c:\nc&gt;nc ptnd.com 80<br/> GET /VIETHANIT/1.0<br/> ..........<br/> &lt;!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN"&gt;<br/> &lt;html&gt;&lt;head&gt;<br/> &lt;title&gt;404 Not Found&lt;/title&gt;<br/> &lt;/head&gt;&lt;body&gt;<br/> &lt;h1&gt;Not Found&lt;/h1&gt;<br/> &lt;p&gt;The requested URL /VIETHANIT/1.0 was not found on this server.&lt;/p&gt;<br/> &lt;p&gt;Additionally, a 404 Not Found<br/> error was encountered while trying to use an ErrorDocument to handle the request<br/> .&lt;/p&gt;<br/> &lt;hr&gt;<br/> &lt;address&gt;Apache 1.3.24 PHP/5.1.6 mod_python/3.2.8 Python/2.4.3 mod_perl/2.0.4 Perl/v5.8.8 Server at ptnd.com Port 80&lt;/address&gt;<br/> &lt;/body&gt;&lt;/html&gt;</pre><br/> 		</div><br/> <br/> <b><i><font color='orange'>Giới thiệu về ETag HTTP header</font></i></b><br/> <br/> Chúng ta có thể quen thuộc với thông số<font color='yellow'> HTTP Last-Modified</font> trong response header. Thông số này cho phép trình duyệt xác định có tải về nội dung web hay sử dụng bộ nhớ cache để hiển thị cho người dùng (chẳng hạn như các file hình ảnh..) để tránh tải về các nội dung không thay đổi kể từ lần truy cập cuối. Các Etag  header (viết tắt của "Entity Tag") hoạt động theo cách tương tự, nhưng sử dụng thêm thông tin về tập tin là số inode (inode là số đại điện cho mỗi tập tin trong hệ thống tập tin Unix, số này chỉ thay đổi khi tập tin mà nó đại điện thay đổi thuộc tính như người sở hữu, kiểu tệp, quyền truy cập…).<br/> <br/> Etag header cũng được các phần mềm Fingerprinting dùng để xác định cấu hình web server. Ngoài ra, nếu sử dụng Etags có thể làm giảm hiệu suất hoạt động của web server. <br/> <br/> Ví dụ: Nếu chúng ta đang chạy nhiều web server để cân bằng tải và cấu hình Apache cho phép response Etag (mặc định Apache cho phép), các web server khác nhau sẽ trả về giá trị ETag khác nhau ngay cả khi thuộc tính của tập tin không thay đổi (do số inode trên các server khác nhau sẽ khác nhau). Điều này sẽ làm cho trình duyệt tải về các nội dung không cần thiết ngay cả khi thuộc tính của tập tin không thay đổi từ lần truy cập trước.<br/> <br/> Vô hiệu hoá ETag trong response của Apache sẽ có lợi cho hiệu năng của web server và làm cho HTTP Fingerprinting khó khăn hơn trong việc thăm dò. Để vô hiệu hoá ETag, trong file cấu hình httpd.conf thực hiện thêm vào dòng.<br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre>Header unset ETag</pre><br/> 		</div><br/> <br/> Lưu ý: Nếu web server đang chạy <font color='yellow'>WebDAV </font>với mod_dav_fs, chúng ta không nên vô hiệu hoá ETag vì mod_dav_fs sử dụng nó để xác định các tập tin đã thay đổi.<br/> <br/> <b><font color='orange'>3.1.2. Sử dụng ModSecurity để ngăn chặn HTTP Fingerprinting</font></b><br/> <br/> Chúng ta sẽ cung cấp đầy đủ các thông tin cho hacker tìm hiểu, nhưng không phải là thông tin chính xác. ModSecurity cho phép chúng ta tuỳ chỉnh và đánh lừa các công cụ HTTP Fingerprinting. Ví dụ cụ thể:<br/> <br/> -	Chỉ cho phép các phương thức GET, HEAD, và POST<br/> -	Chặn tất cả các request với các giao thức ngoại trừ giao thức HTTP 1.0 và 1.1<br/> -	Chặn các request không chứa Host header<br/> -	Chặn tất cả các request không chứa Accept header<br/> -	Đặt chữ ký là Microsoft-IIS/6.0<br/> -	Thêm X-Powered-By: ASP.NET 2.0 header<br/> -	Gỡ bỏ Etag header<br/> <br/> Dưới đây là các rule để thực hiện<br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre># Thay doi chu ky server<br/> SecServerSignature "Microsoft-IIS/6.0"<br/> # Tu choi cac request khong chua host header<br/> SecRule &REQUEST_HEADERS:Host "@eq 0" "phase:1,deny"<br/> # Tu choi cac request khong chua request header<br/> SecRule &REQUEST_HEADERS:Accept "@eq 0" "phase:1,deny"<br/> # Chi cho phep GET HEAD va POST<br/> SecRule REQUEST_METHOD !^&#40;get|head|post&#41;$ "phase:1,t:lowerCase,deny"<br/> # Chi cho phep HTTP phien ban 1.0 va 1.1<br/> SecRule REQUEST_PROTOCOL !^http/1\.&#40;0|1&#41;$ "phase:1,t:lowercase,deny"<br/> # Them X-Powered-By header<br/> Header set X-Powered-By "ASP.NET 2.0"<br/> # Go bo ETag header<br/> Header unset ETag</pre><br/> 		</div><br/> <br/> Và đây là kết quả của phần mèm Acunetix khi thực hiện scan:<br/>  <br/> <br><br/> 			<div align="center" class="limitview"><img src='http://i483.photobucket.com/albums/rr193/buitanviet/shareforum/phan3/3.jpg' border="0"  /></div><br/> Hình 3.3 Kết quả dùng Acunetix khi scan<br/> <br/> <font size='+1'><font color='orange'><b>3.2.  NGĂN CHẶN CÁC REQUEST TỪ PROXY SERVER</b></font></font><br/> <br/> Các request từ proxy server thường không tốt đối với một số website. Ví dụ nếu chúng ta đang chạy một diễn đàn thảo luận VBB hoặc PHPBB… Hacker thường sử dụng các proxy làm trung gian để ẩn dấu vết của mình và thực hiện các hành động như spam các bài viết lên diễn đàn, thực hiện các cuộc tấn công từ chối dịch vụ Ddos.. Do đó, chúng ta có thể chặn những người truy cập từ các proxy này.<br/> <br/> Đặc điểm nhận dạng của các proxy khi request vào web server là có sự hiện diện của chuỗi X-Forwarded-For trong request header, chúng ta có thể dựa vào đặc điểm này để viết rule ngăn chặn.<br/> Rule được viết như sau:<br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre>SecRule &REQUEST_HEADERS:X-Forwarded-For "@gt 0" deny</pre><br/> 		</div><br/> <br/> Lưu ý: Phải xem xét kỹ lưỡng trước khi quyết định chặn các proxy truy cập vào server. Bởi không phải tất cả website đều không nên cho proxy server truy cập vào.<br/> <br/> <font color='orange'><b><font size='+1'>3.3.  CROSS-SITE SCRIPTING</font></b></font><br/> <b><font color='orange'>3.3.1. Định nghĩa</font></b><br/> <br/> Cross-Site Scripting hay còn được gọi tắt là XSS (thay vì gọi tắt là CSS để tránh nhầm lẫn với CSS-Cascading Style Sheet của HTML) là một kĩ thuật tấn công bằng cách chèn vào các website động (ASP, PHP, CGI, JSP ...) những thẻ HTML hay những đoạn mã script nguy hiểm có thể gây nguy hại cho những người sử dụng khác. Trong đó, những đoạn mã nguy hiểm được chèn vào hầu hết được viết bằng các Client-Site Script như JavaScript, JScript, DHTML và cũng có thể là cả các thẻ HTML. <br/> Kĩ thuật tấn công XSS đã nhanh chóng trở thành một trong những lỗi phổ biến nhất của Web Applications và mối đe doạ của chúng đối với người sử dụng ngày càng lớn. <br/> <br/> <font color='orange'><b>4.3.2. Hoạt động của XSS</b></font><br/> <br/> Về cơ bản XSS cũng như SQL Injection hay Source Injection (sẽ được giới thiệu ở phần sau), nó cũng là các request được gửi từ các máy client tới server nhằm chèn vào đó các thông tin vượt quá tầm kiểm soát của server. Nó có thể là một request được gửi từ các form dữ liệu hoặc cũng có nằm trong request URI, ví dụ:<br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre>http://www.example.com/search.cgi?query=&lt;script&gt;alert&#40;'XSS was found !'&#41;;&lt;/script&gt;</pre><br/> 		</div><br/> <br/> Nếu truy cập vào địa chỉ trên, rất có thể trình duyệt sẽ hiện lên một thông báo <font color='yellow'>XSS was found !</font>. Các đoạn mã trong thẻ &lt;script&gt; không hề bị giới hạn bởi chúng hoàn toàn có thể thay thế bằng một file nguồn trên một server khác thông qua thuộc tính src của thẻ &lt;script&gt;. Cũng chính vì lẽ đó mà chúng ta chưa thể lường hết được độ nguy hiểm của các lỗi XSS. <br/> <br/> Nhưng nếu như các kĩ thuật tấn công khác có thể làm thay đổi được dữ liệu nguồn của web server (mã nguồn, cấu trúc, cơ sở dữ liệu) thì XSS chỉ gây tổn hại đối với website ở phía client mà nạn nhân trực tiếp là những người khách duyệt site đó. Tất nhiên đôi khi các hacker cũng sử dụng kĩ thuật này đề chiếm quyền điều khiển các website nhưng đó vẫn chỉ tấn công vào bề mặt của website. Thật vậy, XSS là những Client-Side Script, những đoạn mã này sẽ chỉ chạy bởi trình duyệt phía client do đó XSS không làm ảnh hưởng đến hệ thống website nằm trên server. <br/> <br/> Mục tiêu tấn công của XSS không ai khác chính là những người sử dụng khác của website, khi họ vô tình vào các trang có chứa các đoạn mã nguy hiểm do các hacker để lại, họ có thể bị chuyển tới các website khác, đặt lại homepage, hay nặng hơn là mất mật khẩu, mất cookie thậm chí máy tính người truy cập có thể sẽ bị cài các loại virus, backdoor, worm .. <br/> <br/> <font color='orange'><b>3.3.3. Ngăn chặn tấn công XSS</b></font><br/> <br/> Đề ngăn chặn tấn công XSS, chúng ta phải đảm bảo tất cả dữ liệu mà người dùng gởi lên đều được cản lọc. Cụ thể, chúng ta có thể thay thế hoặc loại bỏ các ký tự, các chuỗi thường được dùng trong tấn công XSS như đấu ngoặc góc (&lt; và &gt<img src="/hvaonline/images/smilies/068ae40523a24c9ef54edefd375e542d.gif" border="0" alt="smilie" align="absbottom">, script...<br/> Dưới đây là danh sách các ký tự nên mã hoá khi được client cung cấp để lưu vào cơ sở dữ liệu.<br/> <br/> <br><br/> 			<div align="center" class="limitview"><img src='http://i483.photobucket.com/albums/rr193/buitanviet/shareforum/phan3/8.jpg' border="0"  /></div><br/> Bảng  3.1 Các ký tự nên mã hoá  để ngăn chặn tấn công XSS<br/> <br/> Nếu chúng ta muốn ngăn chặn tấn công với ModSecurity, dưới đây là các đoạn script XSS phổ biến và các biểu thức chính quy để ngăn chặn người dùng request chứa các chuỗi này.<br/> <br/> <br><br/> 			<div align="center" class="limitview"><img src='http://i483.photobucket.com/albums/rr193/buitanviet/shareforum/phan3/9.jpg' border="0"  /></div><br/> Bảng  3.2 Các script XSS và biểu thức chính quy<br/> <br/> Dưới đây là ví dụ về một rule dùng để chặn XSS đã được trình bày ở phần 2.4.5<br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre>SecRule ARGS "&lt;script" "deny,t:lowercase"</pre><br/> 		</div><br/> <br/> <font color='orange'><b><font size='+1'>3.4.  TẤN CÔNG THỰC THI CÁC LỆNH SHELL</font></b></font><br/> <br/> Như chúng ta đã biết, chấp nhận dữ liệu đầu vào từ client mà không cản lọc có thể gây ra nguy hiểm cho ứng dụng web. Cụ thể của việc này là người dùng gởi các request trái phép đến server để hiển thị hoặc thực thi một tập tin nào đó mà người dùng không có quyền.<br/> <br/> Hacker thường kết hợp nhiều yếu tố để đạt được hiệu quả tối đa. Các ứng dụng web rất ít sử dụng các lệnh shell bởi nó thực hiện gọi <font color='yellow'>exec()</font> đến hệ thống. Tuy nhiên, chúng ta hãy xem xét quy trình sau đây:<br/>  <br/> <br><br/> 			<div align="center" class="limitview"><img src='http://i483.photobucket.com/albums/rr193/buitanviet/shareforum/phan3/4.jpg' border="0"  /></div><br/> <br/> Quy trình trên là sự kết hợp giữa khai thác lỗi SQL injection để tạo ra các file PHP với việc thực thi các lệnh shell. Nếu việc cản lọc dữ liệu đầu vào của web server không thành công, hacker sẽ thực thi scripts thucthi.php và toàn bộ dữ liệu trên thư mục gốc của web server sẽ bị xoá.<br/> <br/> Điều này cho thấy, cản lọc thực thi các lệnh shell là công việc hết sức cần thiết đối với người làm bảo mật web server.<br/> Dưới đây là một số lệnh, tên chương trình và đường dẫn thông thường của hệ thống Unix có thể chặn để tránh tấn công thực thi lệnh shell:<br/> <br/> -	rm<br/> -	ls<br/> -	kill<br/> -	mail<br/> -	sendmail<br/> -	cat<br/> -	echo<br/> -	/bin/<br/> -	/etc/<br/> -	/tmp/<br/> <br/> Để chặn các request với đối số là các chuỗi trên, ta có rule sau:<br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre>SecRule ARGS “rm|ls|kill&#40;send&#41;?mail|cat|echo|/bin/|/etc/|/tmp/&#41;” “deny”</pre><br/> 		</div><br/> <br/> <b><font size='+1'><font color='orange'>3.5.  TẤN CÔNG NULL BYTE</font></font></b><br/> <br/> Kiểu tấn công null byte (byte rỗng) thực sự bắt nguồn từ ngôn ngữ lập trình C (và các ngôn ngữ liên quan), sử dụng một byte rỗng (0x00) để biểu thị kết thúc một chuỗi. Ví dụ về cách lưu trữ chuỗi viethanit trong bộ nhớ của ngôn ngữ C:<br/> <br/> <br><br/> 			<div align="center" class="limitview"><img src='http://i483.photobucket.com/albums/rr193/buitanviet/shareforum/phan3/5.jpg' border="0"  /></div><br/> <br/> Với các ngôn ngữ lập trình khác như Java, các chuỗi được lưu trữ trong mảng, và giá trị tổng chiều dài của chuỗi (total length) được lưu trữ ở một vị trí  riêng  biệt. Vì vậy hoàn toàn có thể lưu trữ được các byte rỗng ở giữa chuỗi. <br/> Lợi dụng sự khác biệt trong việc lưu trữ và xử lý chuỗi giữa các ngôn ngữ lập trình, hacker có thể thực hiện tấn công khai thác lỗi null byte bằng cách đánh lừa các phần của hệ thống để phần này nghĩ rằng chuỗi đã kết thúc (vì gặp byte rỗng) và phần kia của hệ thống lại nghĩ rằng chuỗi được nhập đầy đủ.<br/> <br/> Xét trang JSP đơn giản được viết để hiển thị nội dung tập tin văn bản cho client truy cập bằng cách sử dụng tên tập tin làm tham số:<br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre>&gt;&lt;%<br/>   String filename = request.getParameter&#40;"file"&#41;;<br/>   if &#40;filename.endsWith&#40;".txt"&#41;&#41; {<br/>     // Include text file in output page<br/>   }<br/> %&gt;</pre><br/> 		</div><br/> <br/> Với ví dụ trên, website sẽ đảm bảo tên tập tin yêu cầu hiển thị cho người truy cập phải có phần mở rộng là .txt . Tuy nhiên, nếu hacker sử dụng hình thức tấn công là null byte, hacker sẽ nhập vào đối số tên tập tin là<font color='yellow'> /etc/passwd%00.txt</font> . <br/> <br/> Mặt khác, Java lại có khả năng chứa các byte rỗng trong chuỗi, vì vậy yêu cập hiển thị nội dung tập tin trên là hợp lệ và sẽ vượt qua được hàm kiểm tra <font color='yellow'>filename.endsWith(".txt").</font> Khi yêu cầu hiển thị tập tin được chuyển vào cho hệ thống, chức năng mở tập tin sẽ  hoạt động. Một vấn đề phát sinh nếu chức năng đọc tên tập tin của hệ thống dừng khi gặp byte rỗng, hệ điều hành sẽ không mở tập tin <font color='yellow'>/etc/passwd%00.txt</font> mà thay vào đó sẽ mở tập tin <font color='yellow'>/etc/passwd </font>(tập tin hệ thống chứa thông tin về người dùng của các hệ thống Unix). Và nội dung của tập tin này sẽ được hiển thị trên trình duyệt của hacker.<br/> <br/> ModSecurity có hai chức năng chuyển đổi đề đối phó với các byte rỗng được gởi lên từ người truy cập đó là <font color='yellow'>replaceNulls </font>và <font color='yellow'>removeNulls</font>. Với replaceNulls, khi thực thi sẽ thay thế byte rỗng bằng khoảng trắng, trong khi đó removeNulls lại thực hiện loại bỏ hoàn toàn byte rỗng. Byte rỗng rất hiếm khi cần thiết cho dữ liệu nhập vào của website, vì vậy có thể thiết lập chuyển đổi byte rỗng trong <font color='yellow'>SecDefaultAction</font>:<br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre>SecDefaultAction "phase:2,deny,log,status:403,t:removeNulls"</pre><br/> 		</div><br/> <br/> Rule trên từ chối các request boby có chứa byte rỗng. Nếu chúng ta muốn cho phép các request này, thực hiện dùng chức năng chuyển đổi để gỡ bỏ hoặc thay thế byte rỗng với rule:<br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre>SecRule ARGS:data "pass,t:-removeNulls"</pre><br/> 		</div><br/> </div>
						</td>
					</tr>

					<tr>
						<td align="left"><a href="http://digg.com/submit?phrase=2&url=http://www.hvaonline.net/hvaonline/readingRoom/item/237061.hva"><img src="/hvaonline/templates/viet/images/digg.gif" align="texttop" alt="[digg]" title="[digg]"></a>
<a href="http://del.icio.us/post?url=http://www.hvaonline.net/hvaonline/readingRoom/item/237061.hva"><img src="/hvaonline/templates/viet/images/delicious.gif" align="texttop" alt="[delicious]" title="[delicious]"></a>
<a href="http://www.google.com/bookmarks/mark?op=edit&output=popup&bkmk=http://www.hvaonline.net/hvaonline/readingRoom/item/237061.hva"><img src="/hvaonline/templates/viet/images/google.gif" align="texttop" alt="[google]" title="[google]"></a>
<a href="http://bookmarks.yahoo.com/toolbar/savebm?opener=tb&u=http://www.hvaonline.net/hvaonline/readingRoom/item/237061.hva"><img src="/hvaonline/templates/viet/images/yahoo.gif" align="texttop" alt="[yahoo]" title="[yahoo]"></a>
<a href="http://technorati.com/faves?add=http://www.hvaonline.net/hvaonline/readingRoom/item/237061.hva"><img src="/hvaonline/templates/viet/images/technorati.gif" align="texttop" alt="[technorati]" title="[technorati]"></a>
<a href="http://reddit.com/submit?url=http://www.hvaonline.net/hvaonline/readingRoom/item/237061.hva"><img src="/hvaonline/templates/viet/images/reddit.gif" align="texttop" alt="[reddit]" title="[reddit]"></a>
<a href="http://www.stumbleupon.com/submit?url=http://www.hvaonline.net/hvaonline/readingRoom/item/237061.hva"><img src="/hvaonline/templates/viet/images/stumbleupon.gif" align="texttop" alt="[stumbleupon]" title="[stumbleupon]"></a></td>
					</tr>
				</table>
			</td>
		</tr>

		<tr>
			<td align="left" colspan="2" class="readingborderBottom">
				<table cellspacing="0" cellpadding="10" width="95%" align="center" border="0">
					<tr>
						<td align="left">
						<div class="postbody"><b>Other posts in the same group:</b></div><br />
									<div class="gen"><a href="/hvaonline/readingRoom/item/237029.hva">Bảo mật web server Apache với mod Security - Phần 1</a></div>
									<div class="gen"><a href="/hvaonline/readingRoom/item/237042.hva">Bảo mật web server Apache với mod Security - Phần 2.1</a></div>
									<div class="gen"><b>Bảo mật web server Apache với mod Security - Phần 3.1</b></div>
									<div class="gen"><a href="/hvaonline/readingRoom/item/237044.hva">Bảo mật web server Apache với mod Security - Phần 2.2</a></div>
									<div class="gen"><a href="/hvaonline/readingRoom/item/237063.hva">Bảo mật web server Apache với mod Security - Phần 3.2</a></div>
						</td>
					</tr>
				</table>
			</td>
		</tr>


		<tr>
			<td align="left" valign="top">
				<a href="#topPage"><img src="/hvaonline/templates/viet/images/goup.gif" align="absbottom" border="0" alt="Go to top" title="Go to top"></a>
				<a href="/hvaonline/posts/list/0/38694.hva#237061" target="_blank"><img src="/hvaonline/templates/viet/images/goright.gif" border="0" align="absbottom" alt="Go to original post" title="Go to original post"></a> 
				&nbsp;
			</td>
			<td align="right">	<table cellspacing="0" cellpadding="0" border="0">
		<tr>			  
			<td nowrap="nowrap">
				<form action="" name="f" id="f" accept-charset="UTF-8">
					<select onchange="if(this.options[this.selectedIndex].value > 0){ document.location = '/hvaonline/readingRoom/show/'+ this.options[this.selectedIndex].value +'.hva'; }" name="select">
						<option value="0" selected="selected">Go to Category</option>	
						<option value="0">------------------------</option>	
								<option value="1">Defense</option>
								<option value="2">Exploit</option>
								<option value="3">Reverse Engineering</option>
								<option value="4">*nix</option>
								<option value="5">Windows</option>
								<option value="6">Networking</option>
								<option value="7">Others</option>
					</select>
				</form>
			</td>
		</tr>
	</table>
</td>
		</tr>
</table>
<script type="text/javascript">
		var ctlTop = false;
		var ctlBt = false;

		function activateControllerTop()
		{
			ctlTop = !ctlTop;
			document.getElementById("controllerTop").style.display = (ctlTop ? "" : "none");
			document.getElementById("controllerTop").style.display = (ctlTop ? "" : "none");
			document.getElementById("controllerTop").style.display = (ctlTop ? "" : "none");

			if (ctlTop) {
				document.location = document.location + "#ctlTop";
			}
		}

		function activateControllerBottom()
		{
			ctlBt = !ctlBt;
			document.getElementById("controllerBottom").style.display = (ctlBt ? "" : "none");
			document.getElementById("controllerBottom").style.display = (ctlBt ? "" : "none");
			document.getElementById("controllerBottom").style.display = (ctlBt ? "" : "none");

			if (ctlBt) {
				document.location = document.location + "#ctlBt";
			}
		}
</script>

	<tr>	
		<td align="center">
		<br>
					</td>
	</tr>

	<tr>
		<td align="center">
			<span class="copyright">Powered by JForum - Extended by <a href="MailTo:lienlac@hvaonline.net">HVAOnline</a><br>
			&nbsp;hvaonline.net&nbsp; | &nbsp;hvaforum.net&nbsp; | &nbsp;hvazone.net&nbsp; | &nbsp;hvanews.net&nbsp; | &nbsp;vnhacker.org<br>
			1999 - 2013 &copy;
			v2012|0504|218|
		  </span>
	  </td>
	</tr>
<iframe src="/hvaonline/templates/ping_session.jsp" height="0" width="0" frameborder="0" scrolling="no"></iframe>
</body>
</html>
