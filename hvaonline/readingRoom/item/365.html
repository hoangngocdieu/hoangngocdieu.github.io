<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"> 

<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta name="description" content="HVA Reading Room">
<meta name="keywords" content=", reading room, hva, hvaonline, hvazone, hvaforum">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="robots" content="index,follow">
<meta name="rating" content="general">
<style type="text/css">
<!-- 
@import url( "/hvaonline/templates/viet/styles/style.css");
-->
</style>
<style type="text/css">
<!--
@import url("/hvaonline/templates/viet/styles/en_US.css");
-->
</style>
<title> - .:: HVAOnline ::.</title>

</head>
<body class="en_US">


<!--
Original theme from phpBB (http://www.phpbb.com) subSilver
Created by subBlue design
http://www.subBlue.com
Modifications by JForum Team 
Extended and customised by HVA Team
Added more features and Black Silver theme designed by HVA
-->
<table width="100%" border="0" cols="2">
	<tr align="right">
		<td class="copyright">
			English
			| 
			<a href="/hvaonline/jforum.html?module=forums&amp;action=setLang&amp;lang=vi_VN" rel="nofollow">Vietnamese</a>
		</td>
	</tr>
</table>
<table width="100%" border="0" align="center">
	<tr>
        <td width="100%" align="center" valign="middle">
			<a href="" title="[Logo]"><img src="/hvaonline/templates/viet/images/hvabanner-final.gif" alt="banner" /></a>
		</td>
	</tr>

	<tr>
		<td>
<table cellspacing="0" cellpadding="0" width="80%" align="center" border="0">

		<tr height="15">
			<th colspan="2" class="thportal" align="left"><span class="readingheader">&nbsp;.::Others::.</span></th>
		    <th class="thportal" align="center">
				<span class="readingheader">
					 Mã bảo vệ tiến trình không bị End Task trong Windows <a name="topPage" id="topPage"></a>
				</span>
			</th>
		    <th class="thportal" align="right">
				<a href="/hvaonline/posts/list/0/82.html#365" target="_blank">
				<img src="/hvaonline/templates/viet/images/goright.gif" align="absbottom" border="0" alt="Go to original post" title="Go to original post"/></a> 
				<img src="/hvaonline/templates/viet/images/what.gif" align="absbottom" border="0" alt="Author: ngoalong - Translator:  - Entry Date: 13/02/2009 09:59:14" title="Author: ngoalong - Translator:  - Entry Date: 13/02/2009 09:59:14"/>
			</th>
		</tr>
</table>

<table cellspacing="0" cellpadding="5" width="80%" align="center" border="0">
		<tr>
		    <td align="left" colspan="2" class="readingborderBottom">
				<table cellspacing="0" cellpadding="10" width="95%" align="center" border="0">
					<tr>
						<td align="left">
							<div class="postbody">Đoạn code sau đây sử dụng các tính năng sercurity object trên<br/> Win2K/XP. Một process cần được bảo vệ sẽ được tạo ra với quyền<br/> truy cập được hạn chế bằng cách đặt thuộc tính SECURITY_ATTRIBUTES<br/> trong khi gọi hàn CreateProcess để tạo process được bảo vệ!<br/> <br/> <br/> <Tham khảo trong MSDN Platform SDK: Access Control  8)  ><br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre>// SecurityObj.cpp : Defines the entry point for the application.<br/> //<br/> <br/> #include "stdafx.h"<br/> <br/> #include &lt;windows.h&gt;<br/> #include &lt;stdio.h&gt;<br/> #include &lt;aclapi.h&gt;<br/> <br/> BOOL CreateProtectedProcess&#40;<br/> LPCTSTR lpApplicationName,                 // name of executable module<br/> LPTSTR lpCommandLine,                      // command line string   <br/> DWORD dwCreationFlags                      // creation flags<br/> &#41;;<br/> <br/> int APIENTRY WinMain&#40;HINSTANCE hInstance,<br/>                     HINSTANCE hPrevInstance,<br/>                     LPSTR     lpCmdLine,<br/>                     int       nCmdShow&#41;<br/> {<br/> CreateProtectedProcess&#40;"c:\winnt\system32\calc.exe",           NULL, 0 &#41;;<br/> return 0;<br/> }<br/> <br/> BOOL CreateProtectedProcess&#40;<br/> LPCTSTR lpApplicationName,                 // name of executable module<br/> LPTSTR lpCommandLine,                      // command line string   <br/> DWORD dwCreationFlags                      // creation flags<br/> &#41;<br/> {<br/> DWORD dwRes;<br/> PSID pEveryoneSID = NULL, pAdminSID = NULL;<br/> PACL pACL = NULL;<br/> PSECURITY_DESCRIPTOR pSD = NULL;<br/> EXPLICIT_ACCESS ea&#91;2&#93;;<br/> SID_IDENTIFIER_AUTHORITY SIDAuthWorld = SECURITY_WORLD_SID_AUTHORITY;<br/> SID_IDENTIFIER_AUTHORITY SIDAuthNT = SECURITY_NT_AUTHORITY;<br/> SECURITY_ATTRIBUTES sa;<br/> <br/> // Create a well-known SID for the Everyone group.<br/> <br/> if&#40;! AllocateAndInitializeSid&#40; &SIDAuthWorld, 1,<br/>                 SECURITY_WORLD_RID,<br/>                 0, 0, 0, 0, 0, 0, 0,<br/>                 &pEveryoneSID&#41; &#41; <br/> {    <br/>  return FALSE;<br/> }<br/> <br/> // Initialize an EXPLICIT_ACCESS structure for an ACE.<br/> // The ACE will allow Everyone read access to the object.<br/> <br/> ZeroMemory&#40;&ea, 2 * sizeof&#40;EXPLICIT_ACCESS&#41;&#41;;<br/> ea&#91;0&#93;.grfAccessPermissions = GENERIC_READ;<br/> ea&#91;0&#93;.grfAccessMode = DENY_ACCESS;<br/> ea&#91;0&#93;.grfInheritance= NO_INHERITANCE;<br/> ea&#91;0&#93;.Trustee.TrusteeForm = TRUSTEE_IS_SID;<br/> ea&#91;0&#93;.Trustee.TrusteeType = TRUSTEE_IS_WELL_KNOWN_GROUP;<br/> ea&#91;0&#93;.Trustee.ptstrName  = &#40;LPTSTR&#41; pEveryoneSID;<br/> <br/> // Create a SID for the BUILTIN\Administrators group.<br/> <br/> if&#40;! AllocateAndInitializeSid&#40; &SIDAuthNT, 2,<br/>                 SECURITY_BUILTIN_DOMAIN_RID,<br/>                 DOMAIN_ALIAS_RID_ADMINS,<br/>                 0, 0, 0, 0, 0, 0,<br/>                 &pAdminSID&#41; &#41; <br/> {    <br/>  goto Cleanup; <br/> }<br/> <br/> // Initialize an EXPLICIT_ACCESS structure for an ACE.<br/> // The ACE will allow the Administrators group full access to the key.<br/> <br/> ea&#91;1&#93;.grfAccessPermissions = GENERIC_READ;<br/> ea&#91;1&#93;.grfAccessMode = DENY_ACCESS;<br/> ea&#91;1&#93;.grfInheritance= NO_INHERITANCE;<br/> ea&#91;1&#93;.Trustee.TrusteeForm = TRUSTEE_IS_SID;<br/> ea&#91;1&#93;.Trustee.TrusteeType = TRUSTEE_IS_GROUP;<br/> ea&#91;1&#93;.Trustee.ptstrName  = &#40;LPTSTR&#41; pAdminSID;<br/> <br/> // Create a new ACL that contains the new ACEs.<br/> <br/> dwRes = SetEntriesInAcl&#40;2, ea, NULL, &pACL&#41;;<br/> if &#40;ERROR_SUCCESS != dwRes&#41; <br/> {    <br/>  goto Cleanup;<br/> }<br/> <br/> // Initialize a security descriptor.  <br/> <br/> pSD = &#40;PSECURITY_DESCRIPTOR&#41; LocalAlloc&#40;LPTR, <br/>                         SECURITY_DESCRIPTOR_MIN_LENGTH&#41;; <br/> if &#40;pSD == NULL&#41; <br/> {     <br/>  goto Cleanup; <br/> } <br/> <br/> if &#40;!InitializeSecurityDescriptor&#40;pSD, SECURITY_DESCRIPTOR_REVISION&#41;&#41; <br/> {      <br/>  goto Cleanup; <br/> } <br/> <br/> // Add the ACL to the security descriptor. <br/> <br/> if &#40;!SetSecurityDescriptorDacl&#40;pSD, TRUE,     // fDaclPresent flag   <br/>   pACL, FALSE&#41;&#41;   // not a default DACL <br/> {      <br/>  goto Cleanup; <br/> } <br/> <br/> // Initialize a security attributes structure.<br/> <br/> sa.nLength = sizeof &#40;SECURITY_ATTRIBUTES&#41;;<br/> sa.lpSecurityDescriptor = pSD;<br/> sa.bInheritHandle = FALSE;<br/> <br/> // Use the security attributes to set the security descriptor <br/> // when you create a key.<br/> <br/> PROCESS_INFORMATION pi; <br/> STARTUPINFO si;<br/> memset&#40;&pi,0,sizeof&#40;pi&#41;&#41;;<br/> memset&#40;&si,0,sizeof&#40;si&#41;&#41;;<br/> si.cb = sizeof&#40;si&#41;;<br/> si.wShowWindow = SW_SHOW;<br/> <br/> CreateProcess&#40;lpApplicationName,lpCommandLine, &sa,  &sa,dwCreationFlags,0,0,0,&si,&pi&#41;;<br/> <br/> // clean up data<br/> Cleanup:<br/> <br/>    if &#40;pEveryoneSID&#41;     FreeSid&#40;pEveryoneSID&#41;;<br/>    if &#40;pAdminSID&#41;         FreeSid&#40;pAdminSID&#41;;<br/>    if &#40;pACL&#41;         LocalFree&#40;pACL&#41;;<br/>    if &#40;pSD&#41;         LocalFree&#40;pSD&#41;;<br/>    <br/> return TRUE;<br/> <br/> }</pre><br/> 		</div></div>
						</td>
					</tr>

					<tr>
						<td align="left"><a href="http://digg.com/submit?phrase=2&url=/hvaonline/readingRoom/item/365.html"><img src="/hvaonline/templates/viet/images/digg.gif" align="texttop" alt="[digg]" title="[digg]"></a>
<a href="http://del.icio.us/post?url=/hvaonline/readingRoom/item/365.html"><img src="/hvaonline/templates/viet/images/delicious.gif" align="texttop" alt="[delicious]" title="[delicious]"></a>
<a href="http://www.google.com/bookmarks/mark?op=edit&output=popup&bkmk=/hvaonline/readingRoom/item/365.html"><img src="/hvaonline/templates/viet/images/google.gif" align="texttop" alt="[google]" title="[google]"></a>
<a href="http://bookmarks.yahoo.com/toolbar/savebm?opener=tb&u=/hvaonline/readingRoom/item/365.html"><img src="/hvaonline/templates/viet/images/yahoo.gif" align="texttop" alt="[yahoo]" title="[yahoo]"></a>
<a href="http://technorati.com/faves?add=/hvaonline/readingRoom/item/365.html"><img src="/hvaonline/templates/viet/images/technorati.gif" align="texttop" alt="[technorati]" title="[technorati]"></a>
<a href="http://reddit.com/submit?url=/hvaonline/readingRoom/item/365.html"><img src="/hvaonline/templates/viet/images/reddit.gif" align="texttop" alt="[reddit]" title="[reddit]"></a>
<a href="http://www.stumbleupon.com/submit?url=/hvaonline/readingRoom/item/365.html"><img src="/hvaonline/templates/viet/images/stumbleupon.gif" align="texttop" alt="[stumbleupon]" title="[stumbleupon]"></a></td>
					</tr>
				</table>
			</td>
		</tr>



		<tr>
			<td align="left" valign="top">
				<a href="#topPage"><img src="/hvaonline/templates/viet/images/goup.gif" align="absbottom" border="0" alt="Go to top" title="Go to top"></a>
				<a href="/hvaonline/posts/list/0/82.html#365" target="_blank"><img src="/hvaonline/templates/viet/images/goright.gif" border="0" align="absbottom" alt="Go to original post" title="Go to original post"></a> 
				&nbsp;
			</td>
			<td align="right">	<table cellspacing="0" cellpadding="0" border="0">
		<tr>			  
			<td nowrap="nowrap">
				<form action="" name="f" id="f" accept-charset="UTF-8">
					<select onchange="if(this.options[this.selectedIndex].value > 0){ document.location = '/hvaonline/readingRoom/show/'+ this.options[this.selectedIndex].value +'.html'; }" name="select">
						<option value="0" selected="selected">Go to Category</option>	
						<option value="0">------------------------</option>	
								<option value="1">Defense</option>
								<option value="2">Exploit</option>
								<option value="3">Reverse Engineering</option>
								<option value="4">*nix</option>
								<option value="5">Windows</option>
								<option value="6">Networking</option>
								<option value="7">Others</option>
					</select>
				</form>
			</td>
		</tr>
	</table>
</td>
		</tr>
</table>
<script type="text/javascript">
		var ctlTop = false;
		var ctlBt = false;

		function activateControllerTop()
		{
			ctlTop = !ctlTop;
			document.getElementById("controllerTop").style.display = (ctlTop ? "" : "none");
			document.getElementById("controllerTop").style.display = (ctlTop ? "" : "none");
			document.getElementById("controllerTop").style.display = (ctlTop ? "" : "none");

			if (ctlTop) {
				document.location = document.location + "#ctlTop";
			}
		}

		function activateControllerBottom()
		{
			ctlBt = !ctlBt;
			document.getElementById("controllerBottom").style.display = (ctlBt ? "" : "none");
			document.getElementById("controllerBottom").style.display = (ctlBt ? "" : "none");
			document.getElementById("controllerBottom").style.display = (ctlBt ? "" : "none");

			if (ctlBt) {
				document.location = document.location + "#ctlBt";
			}
		}
</script>

	<tr>	
		<td align="center">
		<br>
					</td>
	</tr>

	<tr>
		<td align="center">
			<span class="copyright">Powered by JForum - Extended by <a href="MailTo:lienlac@hvaonline.net">HVAOnline</a><br>
			&nbsp;hvaonline.net&nbsp; | &nbsp;hvaforum.net&nbsp; | &nbsp;hvazone.net&nbsp; | &nbsp;hvanews.net&nbsp; | &nbsp;vnhacker.org<br>
			1999 - 2013 &copy;
			v2012|0504|218|
		  </span>
	  </td>
	</tr>
<iframe src="/hvaonline/templates/ping_session.html" height="0" width="0" frameborder="0" scrolling="no"></iframe>
</body>
</html>
