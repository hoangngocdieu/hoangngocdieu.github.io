<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"> 

<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta name="description" content="HVA Reading Room">
<meta name="keywords" content=", reading room, hva, hvaonline, hvazone, hvaforum">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="robots" content="index,follow">
<meta name="rating" content="general">
<style type="text/css">
<!-- 
@import url( "/hvaonline/templates/viet/styles/style.css");
-->
</style>
<style type="text/css">
<!--
@import url("/hvaonline/templates/viet/styles/en_US.css");
-->
</style>
<title> - .:: HVAOnline ::.</title>

</head>
<body class="en_US">


<!--
Original theme from phpBB (http://www.phpbb.com) subSilver
Created by subBlue design
http://www.subBlue.com
Modifications by JForum Team 
Extended and customised by HVA Team
Added more features and Black Silver theme designed by HVA
-->
<table width="100%" border="0" cols="2">
	<tr align="right">
		<td class="copyright">
			English
			| 
			<a href="/hvaonline/jforum.html?module=forums&amp;action=setLang&amp;lang=vi_VN" rel="nofollow">Vietnamese</a>
		</td>
	</tr>
</table>
<table width="100%" border="0" align="center">
	<tr>
        <td width="100%" align="center" valign="middle">
			<a href="" title="[Logo]"><img src="/hvaonline/templates/viet/images/hvabanner-final.gif" alt="banner" /></a>
		</td>
	</tr>

	<tr>
		<td>
<table cellspacing="0" cellpadding="0" width="80%" align="center" border="0">

		<tr height="15">
			<th colspan="2" class="thportal" align="left"><span class="readingheader">&nbsp;.::*nix::.</span></th>
		    <th class="thportal" align="center">
				<span class="readingheader">
					 Mã hóa root file system với FreeBSD geli <a name="topPage" id="topPage"></a>
				</span>
			</th>
		    <th class="thportal" align="right">
				<a href="/hvaonline/posts/list/0/7525.html#43679" target="_blank">
				<img src="/hvaonline/templates/viet/images/goright.gif" align="absbottom" border="0" alt="Go to original post" title="Go to original post"/></a> 
				<img src="/hvaonline/templates/viet/images/what.gif" align="absbottom" border="0" alt="Author: pnco - Translator:  - Entry Date: 10/02/2009 09:47:20" title="Author: pnco - Translator:  - Entry Date: 10/02/2009 09:47:20"/>
			</th>
		</tr>
</table>

<table cellspacing="0" cellpadding="5" width="80%" align="center" border="0">
		<tr>
		    <td align="left" colspan="2" class="readingborderBottom">
				<table cellspacing="0" cellpadding="10" width="95%" align="center" border="0">
					<tr>
						<td align="left">
							<div class="postbody">Chào các bạn hâm mộ *nix.<br/> <br/> Kể từ lúc tôi đọc được bài viết của mrro "Nếu tôi là Huyremy" tại blog bảo mật thông tin, tôi thực sự ngỡ ngàng. Đó là kể từ lúc tôi biết sử dụng máy tính đến nay tôi chưa áp dụng bất kỳ 1 biện pháp nào để bảo vệ dữ liệu của mình. Điều này cũng giống như việc bạn cài đặt 1 phiên bản windows lên máy tính của mình mà không cài thêm cho nó 1 chương trình chống virus. Kết cục là điều dễ thấy. Tuy việc so sánh này có hơi khập khiễng nhưng nó có cùng 1 lý lẽ: Nếu bạn không biết tự bảo vệ mình thì ai khác sẽ làm điều đó đây? Nếu bạn không có biện pháp nào để bảo vệ dữ liệu thì bất kỳ ai cũng có thể đọc được nó. Thật chẳng có ý nghĩa gì khi bạn tạo ra 1 hệ thống được bảo mật chặt chẽ với mật khẩu root dài tới hàng trăm ký tự <img src="/hvaonline/images/smilies/8f173d0eaffc4b90c0c0361b8f37cc17.gif" border="0" alt="smilie" align="absbottom">) thế nhưng bất kỳ ai với 1 livecd đều có thể mount nó lên với quyền root mà không gặp phải 1 sự kháng cự nào. Hãy nghĩ đến viễn cảnh chiếc máy laptop yêu dấu hoặc ổ đĩa usb chứa toàn dữ liệu nhạy cảm mà bạn vô tình đánh rơi ở đâu đó.<br/> Tuy rằng trong bài viết đó mrro có mạnh mẽ khuyên rằng đừng có làm theo  <img src="/hvaonline/images/smilies/8f173d0eaffc4b90c0c0361b8f37cc17.gif" border="0" alt="smilie" align="absbottom">)  nhưng tôi nghĩ rằng bảo vệ dữ liệu của mình là 1 việc nên làm. Bài viết của mrro có giới thiệu công cụ <span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"> http://luks.endorphin.org/</span></span></span></span></span></span></span></span></span></span> dành cho linux. Tuy nhiên tôi đang dùng FreeBSD và tôi tự hỏi không biết hệ điều hành này có công cụ nào tương tự. Thật ngạc nhiên là nó có tới 2 công cụ <span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"> http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/disks-encrypting.html</span></span></span></span></span></span></span></span></span></span>. Tuy nhiên trong bài này tôi sử dụng geli vì khả năng mã hóa cả root file system. Ưu điểm của việc mã hóa cả root file system là bạn không thể đọc được bất kỳ 1 thông tin nào nếu bạn không cung cấp được 1 keyfile và 1 passphrase.<br/> <br/> <font color='red'>Cảnh báo quan trọng:</font> Nếu bạn thích thú với tính năng này và có ý định làm theo thì hãy backup tất cả dữ liệu.<br/> <br/> Mẹo: Trước khi thực hiện trên máy thật bạn có thể dùng máy ảo <img src="/hvaonline/images/smilies/8f173d0eaffc4b90c0c0361b8f37cc17.gif" border="0" alt="smilie" align="absbottom">)<br/> <br/> Ưu điểm thì đã thấy, tuy nhiên cũng nên nói thêm rằng bảo mật và tiện dụng là 2 khái niệm mâu thuẫn nhau. Nếu bạn sử dụng tính năng này thì phải hết sức cẩn thận, nếu bạn làm mất keyfile, hoặc đĩa cứng của bạn gặp vấn đề thì dữ liệu của bạn sẽ ra đi không phải xa mà là... rất xa <img src="/hvaonline/images/smilies/8f173d0eaffc4b90c0c0361b8f37cc17.gif" border="0" alt="smilie" align="absbottom">)<br/> <br/> Bây giờ chúng ta bắt đầu thực hiện. Yêu cầu cần có là 1 ổ CDRW, 1 cdrom <span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"> ftp://ftp.freebsd.org/pub/FreeBSD</span></span></span></span></span></span></span></span></span></span> phiên bản 6.1 hoặc 6.2 và 1 đĩa usb để lưu keyfile, <span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"> http://www.frenzy.org.ua</span></span></span></span></span></span></span></span></span></span> để tạo đĩa khởi động.<br/> <br/> 1. Boot máy với đĩa FreeBSD và chọn FixIt -&gt; CD/DVD -&gt; có shell<br/> 2. Gõ lệnh sau ở shell:<br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre>#ln -s /dist/boot/kernel /boot/kernel<br/> #ln -s /dist/lib /lib<br/> #geli load</pre><br/> 		</div><br/> 3. Gắn usb disk vào và tạo keyfile:<br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre>#mkdir /mnt/umass<br/> #mount_msdosfs /dev/da0s1 /mnt/umass<br/> #dd if=/dev/random of=/mnt/umass/ad0.key bs=128k count=1<br/> #geli init -b -l 256 -K /mnt/umass/ad0.key /dev/ad0<br/> Enter new passphrase: &lt;-- Nhập vào passphare<br/> Reenter new passphrase: &lt;-- Xác nhận passphare<br/> #geli attach -k /mnt/umass/ad0.key /dev/ad0<br/> Enter new passphrase: &lt;-- Nhập vào passphare</pre><br/> 		</div><br/> Sau bước này đĩa cứng của bạn đã ở chế độ mã hóa.<br/> 4. Phân vùng đĩa cứng và cài hệ điều hành:<br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre>#bsdlabel -w /dev/ad0.eli<br/> #EDITOR=/mnt2/usr/bin/ee; export EDITOR &lt;-- thay đổi text editor sang ee<br/> #bsdlabel -e /dev/ad0.eli</pre><br/> 		</div><br/> Bạn sẽ nhận được 1 màn hình có dạng như sau:<br/> <blockquote><br/> # /dev/ad0.eli<br/> 8 partitions:<br/> #      size   offset   fstype  [fsize bsize bps/cpg]<br/> a: 78200413        16   unused       0     0<br/> c: 78200431        0   unused       0     0 # "raw" part, don't edit<br/> &nbsp;<br/> 		</blockquote><br/> Tùy theo dung lượng ổ cứng mà bạn có mà điều chỉnh cho hợp lý, ở đây tôi có ổ cứng 40GB. Tôi sẽ điều chỉnh như sau:<br/> <blockquote><br/> # /dev/ad0.eli<br/> 8 partitions:<br/> #      size   offset   fstype  [fsize bsize bps/cpg]<br/> a: 256M        0   4.2BSD       0     0<br/> b: 934M        *     swap<br/> c: 78200431        0   unused       0     0 # "raw" part, don't edit<br/> d: 4096M        *   4.2BSD       0     0<br/> e: 8192M        *   4.2BSD       0     0<br/> f: 512M           *   4.2BSD       0      0<br/> g: *                *   4.2BSD       0     0<br/> &nbsp;<br/> 		</blockquote><br/> 5. Format file system:<br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre>#newfs /dev/ad0.elia<br/> #newfs /dev/ad0.elid<br/> #newfs /dev/ad0.elie<br/> #newfs /dev/ad0.elif<br/> #newfs /dev/ad0.elig</pre><br/> 		</div><br/> 6. Mount file system và cài đặt:<br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre>#mkdir /mnt/root; mount /dev/ad0.elia /mnt/root<br/> #cd /mnt/root; mkdir tmp home var usr<br/> #mount /dev/ad0.elid /mnt/root/var<br/> #mount /dev/ad0.elie /mnt/root/usr<br/> #mount /dev/ad0.elif /mnt/root/tmp<br/> #mount /dev/ad0.elig /mnt/root/home<br/> #DESTDIR=/mnt/root; export DESTDIR &lt;-- thay đổi biến môi trường cài đặt<br/> #cd /dist/6.1-RELEASE/base &#40;Nếu dùng phiên bản 6.2 thì đổi là 6.2-RELEASE<br/> #./install.sh<br/> #cd ../kernels<br/> #./install.sh generic &#40;đổi lại là ./install.sh smp nếu bạn may mắn có 1 hệ thống đa xử lý&#41;<br/> #cd ../manpages<br/> #./install.sh<br/> #cd ../ports<br/> #./install.sh<br/> #cd ../src<br/> #./install.sh all<br/> #rmdir /mnt/root/boot/kernel<br/> #mv /mnt/root/boot/GENERIC /mnt/root/boot/kernel &#40;nếu SMP thì đổi lại là mv /mnt/root/boot/SMP /mnt/root/boot/kernel&#41;</pre><br/> 		</div><br/> 7. Tạo fstab:<br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre>#ee /mnt/root/etc/fstab<br/> <br/> # Device       Mountpoint  FStype Options   Dump Pass#<br/> /dev/ad0.elib  none        swap   sw        0    0<br/> /dev/ad0.elia  /           ufs    rw        1    1<br/> /dev/ad0.elif  /tmp        ufs    rw        2    2<br/> /dev/ad0.elie  /usr        ufs    rw        2    2<br/> /dev/ad0.elid  /var        ufs    rw        2    2<br/> /dev/ad0.elig  /home     ufs    rw        2    2<br/> /dev/acd0      /cdrom      cd9660 ro,noauto 0    0</pre><br/> 		</div><br/> 8. Tạo đĩa khởi động. Đây là bước khó khăn và quan trọng. Bởi vì ổ đĩa cứng của bạn đã mã hóa hết nên máy tính không thể đọc được bất kỳ 1 thông tin nào, vì vậy bạn phải tạo 1 đĩa khởi động chưa mã hóa, trong đó có chứa keyfile để khởi động vào ổ cứng mã hóa.<br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre>#mkdir /mnt/umass/cdboot<br/> #cp -Rpv /mnt/root/boot /mnt/umass/cdboot<br/> #mkdir /mnt/umass/cdboot/boot/keys<br/> #cp /mnt/umass/ad0.key /mnt/umass/cdboot/boot/keys</pre><br/> 		</div><br/> Tạo fstab cho cdboot:<br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre>#mkdir /mnt/umass/cdboot/etc<br/> #ee /mnt/umass/cdboot/etc/fstab<br/> <br/> # Device       Mountpoint  FStype Options   Dump Pass#<br/> /dev/ad0.elia  /           ufs    rw        1    1</pre><br/> 		</div><br/> Tạo loader.conf để nạp module geli vào kernel lúc khởi động và cấu hình keyfile:<br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre>#ee /mnt/cdboot/boot/loader.conf<br/> <br/> geom_eli_load="YES"<br/> geli_ad0_keyfile0_load="YES"<br/> geli_ad0_keyfile0_type="ad0:geli_keyfile0"<br/> geli_ad0_keyfile0_name="/boot/keys/ad0.key"</pre><br/> 		</div><br/> Nếu bạn dùng phiên bản 6.1 thì có 1 bug với kdbmux. Bug này làm cho lúc khởi động bạn không thể nhập passpharse. Hãy điều chỉnh như sau:<br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre>#ee /mnt/umass/cdboot/device.hints<br/> ...<br/> hint.kdbmux.0.disabled="1"</pre><br/> 		</div><br/> Kế tiếp chúng ta boot Frenzy và tạo đĩa khởi động:<br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre>#mkdir /mnt/umass<br/> #mount_msdosfs /dev/da0s1 /mnt/umass<br/> #cd /mnt/umass<br/> #mkisofs -R -U -V "Boot Encrypted" -no-emul-boot -b boot/cdboot -o be.iso /mnt/umass/cdboot</pre><br/> 		</div><br/> Bạn đã tạo được iso boot rồi, hãy burn nó và khởi động. Chúc may mắn <img src="/hvaonline/images/smilies/8f173d0eaffc4b90c0c0361b8f37cc17.gif" border="0" alt="smilie" align="absbottom">)<br/> <br/> Tài liệu tham khảo:<br/> <span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"> http://www.proportion.ch/index.php?page=31</span></span></span></span></span></span></span></span></span></span><br/> <span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"> http://events.ccc.de/congress/2005/fahrplan/attachments/586-paper_Complete_Hard_Disk_Encryption.pdf</span></span></span></span></span></span></span></span></span></span><br/> <span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"> http://www.bsdforums.org/forums</span></span></span></span></span></span></span></span></span></span><br/> <br/> <br/> ---------------------------------------<br/> copyright by me, copyleft by you.</div>
						</td>
					</tr>

					<tr>
						<td align="left"><a href="http://digg.com/submit?phrase=2&url=/hvaonline/readingRoom/item/43679.html"><img src="/hvaonline/templates/viet/images/digg.gif" align="texttop" alt="[digg]" title="[digg]"></a>
<a href="http://del.icio.us/post?url=/hvaonline/readingRoom/item/43679.html"><img src="/hvaonline/templates/viet/images/delicious.gif" align="texttop" alt="[delicious]" title="[delicious]"></a>
<a href="http://www.google.com/bookmarks/mark?op=edit&output=popup&bkmk=/hvaonline/readingRoom/item/43679.html"><img src="/hvaonline/templates/viet/images/google.gif" align="texttop" alt="[google]" title="[google]"></a>
<a href="http://bookmarks.yahoo.com/toolbar/savebm?opener=tb&u=/hvaonline/readingRoom/item/43679.html"><img src="/hvaonline/templates/viet/images/yahoo.gif" align="texttop" alt="[yahoo]" title="[yahoo]"></a>
<a href="http://technorati.com/faves?add=/hvaonline/readingRoom/item/43679.html"><img src="/hvaonline/templates/viet/images/technorati.gif" align="texttop" alt="[technorati]" title="[technorati]"></a>
<a href="http://reddit.com/submit?url=/hvaonline/readingRoom/item/43679.html"><img src="/hvaonline/templates/viet/images/reddit.gif" align="texttop" alt="[reddit]" title="[reddit]"></a>
<a href="http://www.stumbleupon.com/submit?url=/hvaonline/readingRoom/item/43679.html"><img src="/hvaonline/templates/viet/images/stumbleupon.gif" align="texttop" alt="[stumbleupon]" title="[stumbleupon]"></a></td>
					</tr>
				</table>
			</td>
		</tr>



		<tr>
			<td align="left" valign="top">
				<a href="#topPage"><img src="/hvaonline/templates/viet/images/goup.gif" align="absbottom" border="0" alt="Go to top" title="Go to top"></a>
				<a href="/hvaonline/posts/list/0/7525.html#43679" target="_blank"><img src="/hvaonline/templates/viet/images/goright.gif" border="0" align="absbottom" alt="Go to original post" title="Go to original post"></a> 
				&nbsp;
			</td>
			<td align="right">	<table cellspacing="0" cellpadding="0" border="0">
		<tr>			  
			<td nowrap="nowrap">
				<form action="" name="f" id="f" accept-charset="UTF-8">
					<select onchange="if(this.options[this.selectedIndex].value > 0){ document.location = '/hvaonline/readingRoom/show/'+ this.options[this.selectedIndex].value +'.html'; }" name="select">
						<option value="0" selected="selected">Go to Category</option>	
						<option value="0">------------------------</option>	
								<option value="1">Defense</option>
								<option value="2">Exploit</option>
								<option value="3">Reverse Engineering</option>
								<option value="4">*nix</option>
								<option value="5">Windows</option>
								<option value="6">Networking</option>
								<option value="7">Others</option>
					</select>
				</form>
			</td>
		</tr>
	</table>
</td>
		</tr>
</table>
<script type="text/javascript">
		var ctlTop = false;
		var ctlBt = false;

		function activateControllerTop()
		{
			ctlTop = !ctlTop;
			document.getElementById("controllerTop").style.display = (ctlTop ? "" : "none");
			document.getElementById("controllerTop").style.display = (ctlTop ? "" : "none");
			document.getElementById("controllerTop").style.display = (ctlTop ? "" : "none");

			if (ctlTop) {
				document.location = document.location + "#ctlTop";
			}
		}

		function activateControllerBottom()
		{
			ctlBt = !ctlBt;
			document.getElementById("controllerBottom").style.display = (ctlBt ? "" : "none");
			document.getElementById("controllerBottom").style.display = (ctlBt ? "" : "none");
			document.getElementById("controllerBottom").style.display = (ctlBt ? "" : "none");

			if (ctlBt) {
				document.location = document.location + "#ctlBt";
			}
		}
</script>

	<tr>	
		<td align="center">
		<br>
					</td>
	</tr>

	<tr>
		<td align="center">
			<span class="copyright">Powered by JForum - Extended by <a href="MailTo:lienlac@hvaonline.net">HVAOnline</a><br>
			&nbsp;hvaonline.net&nbsp; | &nbsp;hvaforum.net&nbsp; | &nbsp;hvazone.net&nbsp; | &nbsp;hvanews.net&nbsp; | &nbsp;vnhacker.org<br>
			1999 - 2013 &copy;
			v2012|0504|218|
		  </span>
	  </td>
	</tr>
<iframe src="/hvaonline/templates/ping_session.html" height="0" width="0" frameborder="0" scrolling="no"></iframe>
</body>
</html>
