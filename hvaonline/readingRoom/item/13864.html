<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"> 

<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta name="description" content="HVA Reading Room">
<meta name="keywords" content=", reading room, hva, hvaonline, hvazone, hvaforum">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="robots" content="index,follow">
<meta name="rating" content="general">
<style type="text/css">
<!-- 
@import url( "/hvaonline/templates/viet/styles/style.css");
-->
</style>
<style type="text/css">
<!--
@import url("/hvaonline/templates/viet/styles/en_US.css");
-->
</style>
<title> - .:: HVAOnline ::.</title>

</head>
<body class="en_US">


<!--
Original theme from phpBB (http://www.phpbb.com) subSilver
Created by subBlue design
http://www.subBlue.com
Modifications by JForum Team 
Extended and customised by HVA Team
Added more features and Black Silver theme designed by HVA
-->
<table width="100%" border="0" cols="2">
	<tr align="right">
		<td class="copyright">
			English
			| 
			<a href="/hvaonline/jforum.html?module=forums&amp;action=setLang&amp;lang=vi_VN" rel="nofollow">Vietnamese</a>
		</td>
	</tr>
</table>
<table width="100%" border="0" align="center">
	<tr>
        <td width="100%" align="center" valign="middle">
			<a href="" title="[Logo]"><img src="/hvaonline/templates/viet/images/hvabanner-final.gif" alt="banner" /></a>
		</td>
	</tr>

	<tr>
		<td>
<table cellspacing="0" cellpadding="0" width="80%" align="center" border="0">

		<tr height="15">
			<th colspan="2" class="thportal" align="left"><span class="readingheader">&nbsp;.::*nix::.</span></th>
		    <th class="thportal" align="center">
				<span class="readingheader">
					 Làm mail server với Postfix - Phần 3 <a name="topPage" id="topPage"></a>
				</span>
			</th>
		    <th class="thportal" align="right">
				<a href="/hvaonline/posts/list/0/2551.html#13864" target="_blank">
				<img src="/hvaonline/templates/viet/images/goright.gif" align="absbottom" border="0" alt="Go to original post" title="Go to original post"/></a> 
				<img src="/hvaonline/templates/viet/images/what.gif" align="absbottom" border="0" alt="Author: James Nguyen  - Translator:  - Entry Date: 23/02/2009 12:30:50" title="Author: James Nguyen  - Translator:  - Entry Date: 23/02/2009 12:30:50"/>
			</th>
		</tr>
</table>

<table cellspacing="0" cellpadding="5" width="80%" align="center" border="0">
		<tr>
		    <td align="left" colspan="2" class="readingborderBottom">
				<table cellspacing="0" cellpadding="10" width="95%" align="center" border="0">
					<tr>
						<td align="left">
							<div class="postbody"><b>Chống spam bằng SpamAssassin</b><br/> <br/> <b>Nội dung</b><br/> <br/>    1. Giới thiệu<br/>    2. Cài đặt, cấu hình cơ bản<br/>    3. Mở rộng, nâng cao<br/>    4. Tham khảo<br/> <br/> <b>Giới thiệu</b><br/> <br/> SpamAssassin phát hiện và đánh dấu spam mail bằng cách phân tích thông tin trong header và nội dung mail. SpamAssassin tiêu tốn khá nhiều tài nguyên (cpu, memory, thời gian xử lý) của server, đặc biệt khi phải xử lý những mail có size lớn. Cấu hình để SpamAssassin hoạt động tốt, đồng thời giảm nhẹ sự tiêu tốn tài nguyên cho server là một vấn đề quan trọng.<br/> <br/> Bài viết này giới thiệu cách dùng SpamAssassin và procmail để đánh dấu spam mail cho Postfix server (postfix 2.x). Phương pháp này có những đặc điểm<br/> <br/>     * ít thay đổi cấu hình mặc định của Postfix (chỉ sửa một dòng trong file main.cf, không thay đổi file master.cf)<br/>     * giảm tải cho server bằng cách dùng spamc/spamd (không dùng trực tiếp chương trình spamassassin) và chọn cỡ mail thích hợp<br/>     * cho phép mỗi user tự xây dựng quy tắc kiểm tra spam riêng cho mình<br/>     * chú ý: ở đây chỉ dùng SpamAssassin để đánh dấu mail. Việc xử lý những mail bị đánh dấu spam (như xóa, phân loại vào hộp thư riêng) được thực hiện ở mail client. <br/> <br/> Bắt đầu viết: tháng 5 năm 2003.<br/> Thay đổi lần cuối vào lúc: Sun Feb 1 12:47:44 JST 2004.<br/> <br/> <b>Cài đặt và cấu hình</b><br/> <br/> Mail đến server sẽ được xử lý như sau: <b>postfix → procmail → spamassassin</b> → hộp thư của user.<br/> <br/> Bài viết này giả sử postfix, spamassassin, và procmail đã được cài đặt và hoạt động. Những file cấu hình cần thiết và vị trí của chúng giả sử như sau<br/> <br/>    1. postfix: <b>/etc/postfix/main.cf</b><br/>    2. procmail: <b>/etc/procmailrc</b><br/>    3. SpamAssassin: <b>/etc/mail/spamassassin/local.cf </b><br/> <br/> Trước hết, sửa file <b>main.cf</b> để procmail xử lý mail<br/> <br/> 	<blockquote>### chỉ cần uncomment (xóa #) dòng này<br/> 	mailbox_command = /usr/bin/procmail<br/> &nbsp;<br/> 		</blockquote><br/> Tiếp đến, tạo một file <b>/etc/procmailrc</b> như sau<br/> <br/> 	<blockquote>### tôi thích dùng Maildir<br/> 	MAILDIR=$HOME<br/> 	DEFAULT=$MAILDIR/Maildir/<br/> 	DROPPRIVS=yes<br/> <br/> 	# spam thường có size nhỏ hơn 10 KiB (10*1024=10240 bytes),<br/> 	# kiểm tra những file lớn chỉ làm tốn tài nguyên của server!<br/> 	:0fw<br/> 	* &lt; 10240<br/> 	        | /usr/bin/spamc<br/> &nbsp;<br/> 		</blockquote><br/> Sau đó lập những quy tắc kiểm tra mail cho SpamAssassin. File<b> local.cf </b>ghi những quy tắc chung cho mọi user.<br/> <br/> 	<blockquote># thường chỉ nhận mail tiếng Việt, tiếng Anh<br/> 	ok_locales	vi en<br/> 	# ngưỡng spam, nên sử dụng những giá trị từ 5-10<br/> 	required_hits	5<br/> 	# thay đổi tiêu đề mail nếu là spam<br/> 	rewrite_subject	1<br/> 	# đánh dấu spam<br/> 	subject_tag	[*** SPAM ***]<br/> <br/> 	# với SpamAssassin 3.x: thay thế "rewrite_subject" và "subject_tag" bằng<br/> 	# rewrite_header  Subject [*** SPAM ***]<br/> <br/> 	# đây là mail của những người quan trọng,<br/> 	# không bao giờ được đánh dấu spam!<br/> 	whitelist_from	gf@domain-1.name<br/> 	whitelist_from	*@domain-2.name&nbsp;<br/> 		</blockquote><br/> <br/> Khởi động SpamAssassin (xem script khởi động phía dưới) với option: <b>SPAMDOPTIONS="-d -c -a -m5</b>", trong đó<br/> <br/>    1. <b>-d</b>: (daemonize) chế độ daemon<br/>    2. <b>-c</b>: (create-prefs) tạo file cấu hình riêng cho các user<br/>    3. <b>-a</b>: (auto-whitelist) tự động điều chỉnh whitelist<br/>    4. <b>-m</b>: (max-children) số process tối đa<br/> <br/> Gõ "<b>man spamd</b>" để xem thêm về các option.<br/> <br/> Sau đây là một ví dụ về script khởi động /etc/init.d/spamassassin (tham khảo từ file của FC1).<br/> <br/> <blockquote>#!/bin/sh<br/> # spamassassin This script starts and stops the spamd daemon<br/> #<br/> # chkconfig: 3 80 30<br/> #<br/> # description: spamd is a daemon process which uses SpamAssassin to check<br/> #              email messages for SPAM.  It is normally called by spamc<br/> #              from a MDA.<br/>  <br/> # Source function library.<br/> . /etc/rc.d/init.d/functions<br/>  <br/> # Source networking configuration.<br/> . /etc/sysconfig/network<br/>  <br/> # Check that networking is up.<br/> [ ${NETWORKING} = "no" ] && exit 0<br/>  <br/> # Source spamd configuration.<br/> if [ -f /etc/sysconfig/spamassassin ] ; then<br/>         . /etc/sysconfig/spamassassin<br/> else<br/>         SPAMDOPTIONS="-d -c -a -m5 -H"<br/> fi<br/>  <br/> [ -f /usr/bin/spamd -o -f /usr/local/bin/spamd ] || exit 0<br/> PATH=$PATH:/usr/bin:/usr/local/bin<br/>  <br/> # See how we were called.<br/> case "$1" in<br/>   start)<br/>         # Start daemon.<br/>         echo -n "Starting spamd: "<br/>         daemon spamd $SPAMDOPTIONS<br/>         RETVAL=$?<br/>         echo<br/>         [ $RETVAL = 0 ] && touch /var/lock/subsys/spamassassin<br/>         ;;<br/>   stop)<br/>         # Stop daemons.<br/>         echo -n "Shutting down spamd: "<br/>         killproc spamd<br/>         RETVAL=$?<br/>         echo<br/>         [ $RETVAL = 0 ] && rm -f /var/lock/subsys/spamassassin<br/>         ;;<br/>   restart)<br/>         $0 stop<br/>         $0 start<br/>         ;;<br/>   status)<br/>         status spamd<br/>         ;;<br/>   *)<br/>         echo "Usage: $0 {start|stop|restart|status}"<br/>         exit 1<br/> esac<br/>  <br/> exit 0&nbsp;<br/> 		</blockquote><br/> <br/> Sau khi khởi động, spamd (spamassassin daemon) sẽ chờ ở cổng 783 của localhost (address 127.0.0.1).<br/> <br/> 	### khởi động spamassassin<br/> <b>	/etc/init.d/spamassassin start</b><br/> <br/> 	### kiểm tra bằng nmap<br/> <b>	$ nmap localhost</b><br/> <br/> 	### kết quả nmap<br/> 	...<br/> <b>	783/tcp  open  hp-alarm-mgr</b><br/> 	...<br/> <br/> Đến đây kết thúc phần cấu hình. Khởi động lại postfix (lệnh "postfix reload"), gửi thử 1 mail và kiểm tra phần header<br/> <br/> <blockquote>### đây là ví dụ về header một mail bình thường, không phải spam<br/> X-Spam-Checker-Version: SpamAssassin ver (YYYY-MM-DD) on ServerName<br/> X-Spam-Level: *<br/> X-Spam-Status: No, hits=1.2 required=5.0 tests=xxx autolearn=xxx version=x.yz<br/> <br/> ### đây là ví dụ về header của một spam mail<br/> X-Spam-Checker-Version: SpamAssassin ver (YYYY-MM-DD) on ServerName<br/> X-Spam-Level: ******************<br/> X-Spam-Status: Yes, hits=18.3 required=5.0 tests=FORGED_AOL_HTML,<br/> FORGED_MUA_AOL_FROM,HTML_90_100,HTML_IMAGE_ONLY_02,HTML_MESSAGE,<br/> MIME_HTML_NO_CHARSET,MIME_HTML_ONLY,MIME_HTML_ONLY_MULTI,<br/> MISSING_MIMEOLE,MISSING_OUTLOOK_NAME,NO_DNS_FOR_FROM,RCVD_IN_DSBL,<br/> RCVD_IN_NJABL,RCVD_IN_NJABL_PROXY,RCVD_IN_SORBS,RCVD_IN_SORBS_HTTP,<br/> RCVD_IN_SORBS_MISC autolearn=spam version=x.yz<br/> &nbsp;<br/> 		</blockquote><br/> <br/> <b>Tham khảo, thông tin thêm</b><br/> <br/>    1. mẫu thử spam<br/>    2. ví dụ về một spam mail sau khi qua bộ lọc SpamAssassin<br/>    3.<span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"> http://www.peregrinehw.com/downloads/SpamAssassin/INSTALL-RH9-NOTES</span></span></span></span></span></span></span></span></span></span></span></span></span></span><br/>    4. tại sao dùng spamc/spamd hiệu quả hơn dùng trực tiếp chương trình spamasassin?<br/> <br/>       <b>man spamc</b>: Spamc is the client half of the spamc/spamd pair. It should be used in place of "spamassassin" in scripts to process mail... Spamc has extremely low overhead in loading, so it should be much faster to load than the whole spamassassin program.<br/> <br/>       <b>man spamd</b>: The purpose of this program is to provide a daemonized version of the spamassassin executable. The goal is improving throughput performance for automated mail checking. This is intended to be used alongside "spamc", a fast, low-overhead C client program.<br/>    5. Theo cấu hình spamd như trong bài viết này, mỗi user có thể dùng bộ lọc mặc định (là file /etc/mail/spamassassin/local.cf do system admin quản lý), hoặc có thể tự điều chỉnh bộ lọc riêng cho mình nếu không thỏa mãn với cấu hình của bộ lọc mặc định. Cấu hình bộ lọc spam cho user nằm ở file <b>$HOME/.spamassassin/user_prefs</b><br/> <br/>       Mỗi khi kiểm tra mail, spamd sẽ sử dụng bộ lọc user_prefs trước (ưu tiên), nếu không tìm thấy user_prefs, spamd sẽ dùng bộ lọc mặc định local.cf. Những option để cấu hình user_prefs hoàn toàn giống như của local.cf<br/> <br/>    6. Xem list tất cả những option của bộ lọc spam ở đây<br/>      <span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"> http://spamassassin.apache.org/tests.html</span></span></span></span></span></span></span></span></span></span></span></span></span></span><br/> </div>
						</td>
					</tr>

					<tr>
						<td align="left"><a href="http://digg.com/submit?phrase=2&url=/hvaonline/readingRoom/item/13864.html"><img src="/hvaonline/templates/viet/images/digg.gif" align="texttop" alt="[digg]" title="[digg]"></a>
<a href="http://del.icio.us/post?url=/hvaonline/readingRoom/item/13864.html"><img src="/hvaonline/templates/viet/images/delicious.gif" align="texttop" alt="[delicious]" title="[delicious]"></a>
<a href="http://www.google.com/bookmarks/mark?op=edit&output=popup&bkmk=/hvaonline/readingRoom/item/13864.html"><img src="/hvaonline/templates/viet/images/google.gif" align="texttop" alt="[google]" title="[google]"></a>
<a href="http://bookmarks.yahoo.com/toolbar/savebm?opener=tb&u=/hvaonline/readingRoom/item/13864.html"><img src="/hvaonline/templates/viet/images/yahoo.gif" align="texttop" alt="[yahoo]" title="[yahoo]"></a>
<a href="http://technorati.com/faves?add=/hvaonline/readingRoom/item/13864.html"><img src="/hvaonline/templates/viet/images/technorati.gif" align="texttop" alt="[technorati]" title="[technorati]"></a>
<a href="http://reddit.com/submit?url=/hvaonline/readingRoom/item/13864.html"><img src="/hvaonline/templates/viet/images/reddit.gif" align="texttop" alt="[reddit]" title="[reddit]"></a>
<a href="http://www.stumbleupon.com/submit?url=/hvaonline/readingRoom/item/13864.html"><img src="/hvaonline/templates/viet/images/stumbleupon.gif" align="texttop" alt="[stumbleupon]" title="[stumbleupon]"></a></td>
					</tr>
				</table>
			</td>
		</tr>

		<tr>
			<td align="left" colspan="2" class="readingborderBottom">
				<table cellspacing="0" cellpadding="10" width="95%" align="center" border="0">
					<tr>
						<td align="left">
						<div class="postbody"><b>Other posts in the same group:</b></div><br />
									<div class="gen"><a href="/hvaonline/readingRoom/item/13868.html">Làm mail server với Postfix - Phần 6</a></div>
									<div class="gen"><a href="/hvaonline/readingRoom/item/13867.html">Làm mail server với Postfix - Phần 5</a></div>
									<div class="gen"><a href="/hvaonline/readingRoom/item/13866.html">Làm mail server với Postfix - Phần 4</a></div>
									<div class="gen"><b>Làm mail server với Postfix - Phần 3</b></div>
									<div class="gen"><a href="/hvaonline/readingRoom/item/13863.html">Làm mail server với Postfix - Phần 2</a></div>
									<div class="gen"><a href="/hvaonline/readingRoom/item/6091.html">Làm mail server với Postfix - Phần 1 </a></div>
						</td>
					</tr>
				</table>
			</td>
		</tr>


		<tr>
			<td align="left" valign="top">
				<a href="#topPage"><img src="/hvaonline/templates/viet/images/goup.gif" align="absbottom" border="0" alt="Go to top" title="Go to top"></a>
				<a href="/hvaonline/posts/list/0/2551.html#13864" target="_blank"><img src="/hvaonline/templates/viet/images/goright.gif" border="0" align="absbottom" alt="Go to original post" title="Go to original post"></a> 
				&nbsp;
			</td>
			<td align="right">	<table cellspacing="0" cellpadding="0" border="0">
		<tr>			  
			<td nowrap="nowrap">
				<form action="" name="f" id="f" accept-charset="UTF-8">
					<select onchange="if(this.options[this.selectedIndex].value > 0){ document.location = '/hvaonline/readingRoom/show/'+ this.options[this.selectedIndex].value +'.html'; }" name="select">
						<option value="0" selected="selected">Go to Category</option>	
						<option value="0">------------------------</option>	
								<option value="1">Defense</option>
								<option value="2">Exploit</option>
								<option value="3">Reverse Engineering</option>
								<option value="4">*nix</option>
								<option value="5">Windows</option>
								<option value="6">Networking</option>
								<option value="7">Others</option>
					</select>
				</form>
			</td>
		</tr>
	</table>
</td>
		</tr>
</table>
<script type="text/javascript">
		var ctlTop = false;
		var ctlBt = false;

		function activateControllerTop()
		{
			ctlTop = !ctlTop;
			document.getElementById("controllerTop").style.display = (ctlTop ? "" : "none");
			document.getElementById("controllerTop").style.display = (ctlTop ? "" : "none");
			document.getElementById("controllerTop").style.display = (ctlTop ? "" : "none");

			if (ctlTop) {
				document.location = document.location + "#ctlTop";
			}
		}

		function activateControllerBottom()
		{
			ctlBt = !ctlBt;
			document.getElementById("controllerBottom").style.display = (ctlBt ? "" : "none");
			document.getElementById("controllerBottom").style.display = (ctlBt ? "" : "none");
			document.getElementById("controllerBottom").style.display = (ctlBt ? "" : "none");

			if (ctlBt) {
				document.location = document.location + "#ctlBt";
			}
		}
</script>

	<tr>	
		<td align="center">
		<br>
					</td>
	</tr>

	<tr>
		<td align="center">
			<span class="copyright">Powered by JForum - Extended by <a href="MailTo:lienlac@hvaonline.net">HVAOnline</a><br>
			&nbsp;hvaonline.net&nbsp; | &nbsp;hvaforum.net&nbsp; | &nbsp;hvazone.net&nbsp; | &nbsp;hvanews.net&nbsp; | &nbsp;vnhacker.org<br>
			1999 - 2013 &copy;
			v2012|0504|218|
		  </span>
	  </td>
	</tr>
<iframe src="/hvaonline/templates/ping_session.html" height="0" width="0" frameborder="0" scrolling="no"></iframe>
</body>
</html>
