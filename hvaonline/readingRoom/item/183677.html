<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"> 

<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta name="description" content="HVA Reading Room">
<meta name="keywords" content=", reading room, hva, hvaonline, hvazone, hvaforum">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="robots" content="index,follow">
<meta name="rating" content="general">
<style type="text/css">
<!-- 
@import url( "http://www.hvaonline.net/hvaonline/templates/viet/styles/style.css");
-->
</style>
<style type="text/css">
<!--
@import url("http://www.hvaonline.net/hvaonline/templates/viet/styles/en_US.css");
-->
</style>
<title> - .:: HVAOnline ::.</title>

</head>
<body class="en_US">


<!--
Original theme from phpBB (http://www.phpbb.com) subSilver
Created by subBlue design
http://www.subBlue.com
Modifications by JForum Team 
Extended and customised by HVA Team
Added more features and Black Silver theme designed by HVA
-->
<table width="100%" border="0" cols="2">
	<tr align="right">
		<td class="copyright">
			English
			| 
			<a href="/hvaonline/jforum.hva?module=forums&amp;action=setLang&amp;lang=vi_VN" rel="nofollow">Vietnamese</a>
		</td>
	</tr>
</table>
<table width="100%" border="0" align="center">
	<tr>
        <td width="100%" align="center" valign="middle">
			<a href="http://www.hvaonline.net" title="[Logo]"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/hvabanner-final.gif" alt="banner" /></a>
		</td>
	</tr>

	<tr>
		<td>
<table cellspacing="0" cellpadding="0" width="80%" align="center" border="0">

		<tr height="15">
			<th colspan="2" class="thportal" align="left"><span class="readingheader">&nbsp;.::Defense::.</span></th>
		    <th class="thportal" align="center">
				<span class="readingheader">
					 Cơ chế hoạt động và cách cấu hình VPN IP Sec trên router Cisco <a name="topPage" id="topPage"></a>
				</span>
			</th>
		    <th class="thportal" align="right">
				<a href="/hvaonline/posts/list/0/5816.hva#183677" target="_blank">
				<img src="/hvaonline/templates/viet/images/goright.gif" align="absbottom" border="0" alt="Go to original post" title="Go to original post"/></a> 
				<img src="/hvaonline/templates/viet/images/what.gif" align="absbottom" border="0" alt="Author: Nguyễn Ngọc Thắng - thangdiablo - Translator:  - Entry Date: 24/07/2009 00:13:50" title="Author: Nguyễn Ngọc Thắng - thangdiablo - Translator:  - Entry Date: 24/07/2009 00:13:50"/>
			</th>
		</tr>
</table>

<table cellspacing="0" cellpadding="5" width="80%" align="center" border="0">
		<tr>
		    <td align="left" colspan="2" class="readingborderBottom">
				<table cellspacing="0" cellpadding="10" width="95%" align="center" border="0">
					<tr>
						<td align="left">
							<div class="postbody">Hôm nay có việc ngồi làm cái VPN Site to Site mới lại nhớ ra mình chưa hoàn thành cái TUT này ( Cũng hơn 2 năm rồi  ).<br/> Nhân tiện đang làm mình viết nốt phần còn lại về việc kiểm tra, debug quá trình VPN sau khi đã cấu hình xong.<br/> <br/> Trong phần cấu hình phía trên mình có chú thích thêm 1 phần quan trọng, mà ngày trước mình quên.<br/> Đó là appy cái crypto map vào Interface sử dụng để kết nối VPN.<br/> Nếu không có bước này. Trong quá trình debug các bạn sẽ thấy thiếu những dòng màu đỏ phía trong cái trích dẫn ngay bên dưới.<br/> <br/> Sử dụng lệnh show crypto map<br/> <blockquote><br/> R#sh crypto map <br/> Crypto Map "VPN-SG-HN" 10 ipsec-isakmp<br/>         Peer = 10.252.15.6<br/>         Extended IP access list 101<br/>             access-list 101 permit ip 10.128.16.0 0.0.15.255 172.16.128.0 0.0.3.255<br/>             access-list 101 permit ip 172.16.0.0 0.0.127.255 172.16.128.0 0.0.3.255<br/>         Current peer: 10.252.15.6<br/>         <font color='red'>Security association lifetime: 4608000 kilobytes/3600 seconds </font><br/>         PFS (Y/N): N<br/>         Transform sets={ <br/>                 SG-HN, <br/>         }<br/>         Interfaces using crypto map VPN-SG-HN:<br/> <font color='red'>                GigabitEthernet0/1 </font><br/> &nbsp;<br/> 		</blockquote><br/> <br/> Khi các bạn show crypto ipsec sa ( Kiểm tra việc trao đổi các Security Association ) của quá trình đóng gói packets giữa 2 phía, các bạn sẽ thấy chống trơn.<br/> <br/> Nhưng khi luồng VPN đã tạo thành công khi các bạn show crypto ipsec sa các bạn sẽ thấy như sau:<br/> <br/> <blockquote>R_MGW_SG.ACB.HN#sh crypto ipsec sa                   <br/> <br/> interface: GigabitEthernet0/1<br/>     Crypto map tag: VPN-SG-HN, local addr 172.31.1.218<br/> <br/>    protected vrf: (none)<br/>    local  ident (addr/mask/prot/port): (172.16.0.0/255.255.128.0/0/0)<br/>    remote ident (addr/mask/prot/port): (172.16.128.0/255.255.252.0/0/0)<br/>    current_peer 10.252.15.6 port 500<br/>      PERMIT, flags={origin_is_acl,}<br/>    <font color='red'> #pkts encaps: 12699, #pkts encrypt: 12699, #pkts digest: 12699 </font><br/>     #pkts decaps: 8707, #pkts decrypt: 8707, #pkts verify: 8707<br/>     #pkts compressed: 0, #pkts decompressed: 0<br/>     #pkts not compressed: 0, #pkts compr. failed: 0<br/>     #pkts not decompressed: 0, #pkts decompress failed: 0<br/>     #send errors 0, #recv errors 0<br/> <br/>      local crypto endpt.: 172.31.1.218, remote crypto endpt.: 10.252.15.6<br/>      path mtu 1500, ip mtu 1500, ip mtu idb GigabitEthernet0/1<br/>      current outbound spi: 0xF4B4F10(256593680)<br/> <br/>      inbound esp sas:<br/>       spi: 0x766F7231(1987015217)<br/>         transform: esp-aes esp-sha-hmac ,<br/>         in use settings ={Tunnel, }<br/>         conn id: 3005, flow_id: Onboard VPN:5, crypto map: VPN-SG-HN<br/>         sa timing: remaining key lifetime (k/sec): (4442319/3469)<br/>         IV size: 16 bytes<br/>         replay detection support: Y<br/> <font color='red'>        Status: ACTIVE </font><br/> <br/>      inbound ah sas:<br/> <br/>      inbound pcp sas:<br/> <br/>      outbound esp sas:<br/>       spi: 0xF4B4F10(256593680)<br/>         transform: esp-aes esp-sha-hmac ,<br/>         in use settings ={Tunnel, }<br/>         conn id: 3006, flow_id: Onboard VPN:6, crypto map: VPN-SG-HN<br/>         sa timing: remaining key lifetime (k/sec): (4441189/3469)<br/>         IV size: 16 bytes<br/>         replay detection support: Y<br/>         Status: ACTIVE<br/> <br/>      outbound ah sas:<br/> <br/>      outbound pcp sas:<br/> <br/>    protected vrf: (none)<br/>    local  ident (addr/mask/prot/port): (10.128.16.0/255.255.240.0/0/0)<br/>    remote ident (addr/mask/prot/port): (172.16.128.0/255.255.252.0/0/0)<br/>    current_peer 10.252.15.6 port 500<br/>      PERMIT, flags={origin_is_acl,}<br/>     #pkts encaps: 0, #pkts encrypt: 0, #pkts digest: 0<br/> <font color='red'>    #pkts decaps: 6, #pkts decrypt: 6, #pkts verify: 6 </font><br/>     #pkts compressed: 0, #pkts decompressed: 0<br/>     #pkts not compressed: 0, #pkts compr. failed: 0<br/>     #pkts not decompressed: 0, #pkts decompress failed: 0<br/>     #send errors 0, #recv errors 0<br/> <br/>      local crypto endpt.: 172.31.1.218, remote crypto endpt.: 10.252.15.6<br/>      path mtu 1500, ip mtu 1500, ip mtu idb GigabitEthernet0/1<br/>      current outbound spi: 0x7675CCC0(1987431616)<br/> <br/>      inbound esp sas:<br/>       spi: 0x2C2DE7CF(741205967)<br/>         transform: esp-aes esp-sha-hmac ,<br/>         in use settings ={Tunnel, }<br/>         conn id: 3003, flow_id: Onboard VPN:3, crypto map: VPN-SG-HN<br/>         sa timing: remaining key lifetime (k/sec): (4581032/62)<br/>         IV size: 16 bytes<br/>         replay detection support: Y<br/>         Status: ACTIVE<br/>       spi: 0x9875DB42(2557860674)<br/>         transform: esp-aes esp-sha-hmac ,<br/>         in use settings ={Tunnel, }<br/>         conn id: 3002, flow_id: Onboard VPN:2, crypto map: VPN-SG-HN<br/>         sa timing: remaining key lifetime (k/sec): (4427799/3596)<br/>         IV size: 16 bytes<br/>         replay detection support: Y<br/>         Status: ACTIVE<br/> <br/>      inbound ah sas:<br/> <br/>      inbound pcp sas:<br/> <br/>      outbound esp sas:<br/>       spi: 0x1084C9E4(277137892)<br/>         transform: esp-aes esp-sha-hmac ,<br/>         in use settings ={Tunnel, }<br/>         conn id: 3004, flow_id: Onboard VPN:4, crypto map: VPN-SG-HN<br/>         sa timing: remaining key lifetime (k/sec): (4581033/62)<br/>         IV size: 16 bytes<br/>         replay detection support: Y<br/>         Status: ACTIVE<br/>       spi: 0x7675CCC0(1987431616)<br/>         transform: esp-aes esp-sha-hmac ,<br/>         in use settings ={Tunnel, }<br/>         conn id: 3001, flow_id: Onboard VPN:1, crypto map: VPN-SG-HN<br/>         sa timing: remaining key lifetime (k/sec): (4427799/3596)<br/>         IV size: 16 bytes<br/>         replay detection support: Y<br/>         Status: ACTIVE<br/> <br/>      outbound ah sas:<br/> <br/>      outbound pcp sas:<br/> <br/> &nbsp;<br/> 		</blockquote><br/> <br/> Thêm 1 lệnh để kiểm tra quá trình thiết lập IKE<br/> <blockquote>sh crypto isakmp sa<br/> dst             src             state          conn-id slot status<br/> 172.31.1.218    10.252.15.6     QM_IDLE              3    0 ACTIVE<br/> &nbsp;<br/> 		</blockquote><br/> Trong quá trình làm và debug. Nhớ enable debug crypto isakmp và ipsec lên để theo dõi nhé.<br/> Các bạn sẽ thấy được quá trình làm việc, thiết lập thông số giữa 2 peers.<br/> <br/> Thôi đi ngủ. Good night. <img src="/hvaonline/images/smilies/274a01ad7ad7ad7d73d5f0b399ae5db2.gif" border="0" alt="smilie" align="absbottom">  <img src="/hvaonline/images/smilies/068ae40523a24c9ef54edefd375e542d.gif" border="0" alt="smilie" align="absbottom"> </div>
						</td>
					</tr>

					<tr>
						<td align="left"><a href="http://digg.com/submit?phrase=2&url=http://www.hvaonline.net/hvaonline/readingRoom/item/183677.hva"><img src="/hvaonline/templates/viet/images/digg.gif" align="texttop" alt="[digg]" title="[digg]"></a>
<a href="http://del.icio.us/post?url=http://www.hvaonline.net/hvaonline/readingRoom/item/183677.hva"><img src="/hvaonline/templates/viet/images/delicious.gif" align="texttop" alt="[delicious]" title="[delicious]"></a>
<a href="http://www.google.com/bookmarks/mark?op=edit&output=popup&bkmk=http://www.hvaonline.net/hvaonline/readingRoom/item/183677.hva"><img src="/hvaonline/templates/viet/images/google.gif" align="texttop" alt="[google]" title="[google]"></a>
<a href="http://bookmarks.yahoo.com/toolbar/savebm?opener=tb&u=http://www.hvaonline.net/hvaonline/readingRoom/item/183677.hva"><img src="/hvaonline/templates/viet/images/yahoo.gif" align="texttop" alt="[yahoo]" title="[yahoo]"></a>
<a href="http://technorati.com/faves?add=http://www.hvaonline.net/hvaonline/readingRoom/item/183677.hva"><img src="/hvaonline/templates/viet/images/technorati.gif" align="texttop" alt="[technorati]" title="[technorati]"></a>
<a href="http://reddit.com/submit?url=http://www.hvaonline.net/hvaonline/readingRoom/item/183677.hva"><img src="/hvaonline/templates/viet/images/reddit.gif" align="texttop" alt="[reddit]" title="[reddit]"></a>
<a href="http://www.stumbleupon.com/submit?url=http://www.hvaonline.net/hvaonline/readingRoom/item/183677.hva"><img src="/hvaonline/templates/viet/images/stumbleupon.gif" align="texttop" alt="[stumbleupon]" title="[stumbleupon]"></a></td>
					</tr>
				</table>
			</td>
		</tr>

		<tr>
			<td align="left" colspan="2" class="readingborderBottom">
				<table cellspacing="0" cellpadding="10" width="95%" align="center" border="0">
					<tr>
						<td align="left">
						<div class="postbody"><b>Other posts in the same group:</b></div><br />
									<div class="gen"><b>Cơ chế hoạt động và cách cấu hình VPN IP Sec trên router Cisco</b></div>
						</td>
					</tr>
				</table>
			</td>
		</tr>


		<tr>
			<td align="left" valign="top">
				<a href="#topPage"><img src="/hvaonline/templates/viet/images/goup.gif" align="absbottom" border="0" alt="Go to top" title="Go to top"></a>
				<a href="/hvaonline/posts/list/0/5816.hva#183677" target="_blank"><img src="/hvaonline/templates/viet/images/goright.gif" border="0" align="absbottom" alt="Go to original post" title="Go to original post"></a> 
				&nbsp;
			</td>
			<td align="right">	<table cellspacing="0" cellpadding="0" border="0">
		<tr>			  
			<td nowrap="nowrap">
				<form action="" name="f" id="f" accept-charset="UTF-8">
					<select onchange="if(this.options[this.selectedIndex].value > 0){ document.location = '/hvaonline/readingRoom/show/'+ this.options[this.selectedIndex].value +'.hva'; }" name="select">
						<option value="0" selected="selected">Go to Category</option>	
						<option value="0">------------------------</option>	
								<option value="1">Defense</option>
								<option value="2">Exploit</option>
								<option value="3">Reverse Engineering</option>
								<option value="4">*nix</option>
								<option value="5">Windows</option>
								<option value="6">Networking</option>
								<option value="7">Others</option>
					</select>
				</form>
			</td>
		</tr>
	</table>
</td>
		</tr>
</table>
<script type="text/javascript">
		var ctlTop = false;
		var ctlBt = false;

		function activateControllerTop()
		{
			ctlTop = !ctlTop;
			document.getElementById("controllerTop").style.display = (ctlTop ? "" : "none");
			document.getElementById("controllerTop").style.display = (ctlTop ? "" : "none");
			document.getElementById("controllerTop").style.display = (ctlTop ? "" : "none");

			if (ctlTop) {
				document.location = document.location + "#ctlTop";
			}
		}

		function activateControllerBottom()
		{
			ctlBt = !ctlBt;
			document.getElementById("controllerBottom").style.display = (ctlBt ? "" : "none");
			document.getElementById("controllerBottom").style.display = (ctlBt ? "" : "none");
			document.getElementById("controllerBottom").style.display = (ctlBt ? "" : "none");

			if (ctlBt) {
				document.location = document.location + "#ctlBt";
			}
		}
</script>

	<tr>	
		<td align="center">
		<br>
					</td>
	</tr>

	<tr>
		<td align="center">
			<span class="copyright">Powered by JForum - Extended by <a href="MailTo:lienlac@hvaonline.net">HVAOnline</a><br>
			&nbsp;hvaonline.net&nbsp; | &nbsp;hvaforum.net&nbsp; | &nbsp;hvazone.net&nbsp; | &nbsp;hvanews.net&nbsp; | &nbsp;vnhacker.org<br>
			1999 - 2013 &copy;
			v2012|0504|218|
		  </span>
	  </td>
	</tr>
<iframe src="/hvaonline/templates/ping_session.jsp" height="0" width="0" frameborder="0" scrolling="no"></iframe>
</body>
</html>
