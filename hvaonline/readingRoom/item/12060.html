<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"> 

<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta name="description" content="HVA Reading Room">
<meta name="keywords" content=", reading room, hva, hvaonline, hvazone, hvaforum">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="robots" content="index,follow">
<meta name="rating" content="general">
<style type="text/css">
<!-- 
@import url( "/hvaonline/templates/viet/styles/style.css");
-->
</style>
<style type="text/css">
<!--
@import url("/hvaonline/templates/viet/styles/en_US.css");
-->
</style>
<title> - .:: HVAOnline ::.</title>

</head>
<body class="en_US">


<!--
Original theme from phpBB (http://www.phpbb.com) subSilver
Created by subBlue design
http://www.subBlue.com
Modifications by JForum Team 
Extended and customised by HVA Team
Added more features and Black Silver theme designed by HVA
-->
<table width="100%" border="0" cols="2">
	<tr align="right">
		<td class="copyright">
			English
			| 
			<a href="/hvaonline/jforum.html?module=forums&amp;action=setLang&amp;lang=vi_VN" rel="nofollow">Vietnamese</a>
		</td>
	</tr>
</table>
<table width="100%" border="0" align="center">
	<tr>
        <td width="100%" align="center" valign="middle">
			<a href="" title="[Logo]"><img src="/hvaonline/templates/viet/images/hvabanner-final.gif" alt="banner" /></a>
		</td>
	</tr>

	<tr>
		<td>
<table cellspacing="0" cellpadding="0" width="80%" align="center" border="0">

		<tr height="15">
			<th colspan="2" class="thportal" align="left"><span class="readingheader">&nbsp;.::*nix::.</span></th>
		    <th class="thportal" align="center">
				<span class="readingheader">
					 Cài đặt nhanh Qmail+POP3+APOP <a name="topPage" id="topPage"></a>
				</span>
			</th>
		    <th class="thportal" align="right">
				<a href="/hvaonline/posts/list/0/2331.html#12060" target="_blank">
				<img src="/hvaonline/templates/viet/images/goright.gif" align="absbottom" border="0" alt="Go to original post" title="Go to original post"/></a> 
				<img src="/hvaonline/templates/viet/images/what.gif" align="absbottom" border="0" alt="Author: tranvanminh - Translator:  - Entry Date: 23/02/2009 12:16:55" title="Author: tranvanminh - Translator:  - Entry Date: 23/02/2009 12:16:55"/>
			</th>
		</tr>
</table>

<table cellspacing="0" cellpadding="5" width="80%" align="center" border="0">
		<tr>
		    <td align="left" colspan="2" class="readingborderBottom">
				<table cellspacing="0" cellpadding="10" width="95%" align="center" border="0">
					<tr>
						<td align="left">
							<div class="postbody">bmuht_gpj.76252_a9753dd0257efecf683ccbc63f641a2a/6/8/6002/daolpu/enilnoavh/052.831.141.302//:ptth<br/> <b>Cài đặt nhanh và cấu hình Qmail + APOP   </b><br/> Bài viết này dành cho những bạn reinstall qmail và các thiết bị quản lý qmail .<br/> thực hiện theo quá trình trong bài viết bạn có thể sử dụng được  Qmail + APOP  nhanh chóng mà không cần phải đi kiếm link hoặc các patch và đọc documents . tuy nhiên ý nghĩa của từng chương trình và lệnh sẽ không có dính kèm giải thích nào . nếu bạn chưa cài đặt qmail lần nào xin đọc bài  viết "Qmail as a Mail Gateway" để biết thêm chi tiếc và cơ cấu cu. thể của qmail tại các link sau . <br/> <br/> ------------------------------<br/> <br/> Phần 1 :<span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"> http://www.vnhacker.org/hvaonline/posts/list/119.html</span></span></span></span></span></span></span></span></span></span><br/> Phần 2 :<span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"> http://www.vnhacker.org/hvaonline/posts/list/120.html</span></span></span></span></span></span></span></span></span></span><br/> Phần 3 :<span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"> http://www.vnhacker.org/hvaonline/posts/list/121.html</span></span></span></span></span></span></span></span></span></span><br/> Phần 4 :<span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"> http://www.vnhacker.org/hvaonline/posts/list/122.html</span></span></span></span></span></span></span></span></span></span><br/> <br/> <br/> <b>1. Qmail </b><br/><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"> ftp://ftp.jp.qmail.org/qmail/qmail-1.03.tar.gz</span></span></span></span></span></span></span></span></span></span><br/> <b>2. Tcpserver </b><br/><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"> ftp://ftp.jp.qmail.org/qmail/ucspi-tcp-0.88.tar.gz</span></span></span></span></span></span></span></span></span></span><br/> <b>3. Patch files </b><br/><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"> http://www.qmail.org/rpms/</span></span></span></span></span></span></span></span></span></span><br/> <b>4.  daemontools</b><br/><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"> http://cr.yp.to/daemontools/daemontools-0.76.tar.gz</span></span></span></span></span></span></span></span></span></span><br/> <b>5. checkpw</b><br/><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"> http://checkpw.sourceforge.net/checkpw/</span></span></span></span></span></span></span></span></span></span><br/> <b>6. checkpassword-0.90.tar.gz</b><br/><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"> http://cr.yp.to/checkpwd/install.html</span></span></span></span></span></span></span></span></span></span><br/> <br/> <b>Tạo các user cần thiết cho qmail </b><br/> <br/> [root　]# mkdir /var/qmail<br/> [root ]# groupadd -g 710 nofiles<br/> [root ]# useradd -M -u 710 -g nofiles -s /bin/false -d /var/qmail/alias alias<br/> [root ]# useradd -M -u 711 -g nofiles -s /bin/false -d /var/qmail qmaild<br/> [root ]# useradd -M -u 712 -g nofiles -s /bin/false -d /var/qmail qmaill<br/> [root]# useradd -M -u 713 -g nofiles -s /bin/false -d /var/qmail qmailp<br/> [root ]# groupadd -g 711 qmail<br/> [root ]# useradd -M -u 714 -g qmail -s /bin/false -d /var/qmail qmailq<br/> [root ]# useradd -M -u 715 -g qmail -s /bin/false -d /var/qmail qmailr<br/> [root ]# useradd -M -u 716 -g qmail -s /bin/false -d /var/qmail qmails<br/> <br/> <b>Compile and patch qmail</b><br/> [root src]# tar zxvf qmail-1.03.tar.gz<br/> [root src]# cd qmail-1.03<br/> [root src]# wget<span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"> http://www.qmail.org/rpms/patches/qmail-1.03.errno.patch</span></span></span></span></span></span></span></span></span></span><br/> [root src]# wget<span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"> http://www.qmail.org/qmail-smtpd-relay-reject</span></span></span></span></span></span></span></span></span></span><br/> [root qmail-1.03]# patch -p1 &lt; ../checkpw-1.00/qmail-popup-auth.patch<br/> [root qmail-1.03]# patch -p1 &lt; ../qmail-smtpd-relay-reject<br/> [root qmail-1.03]# patch -p1 &lt; ../qmail-1.03.errno.patch <br/> [root qmail-1.03]# make setup check<br/> [root qmail-1.03]# <font color='red'>./config-fast mail.example.jp</font><br/> <br/> <br/> <b>Qmail configuration</b><br/> <br/> File : /var/qmail/control/locals<br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre>localhost　　　　　　　　　　&#40;add&#41;<br/>  mail.example.jp<br/>  example.jp　　　　　　　　　&#40;add&#41;</pre><br/> 		</div><br/> <br/> File : /var/qmail/control/rcpthosts<br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre>localhost　　　　　　　　　　&#40;add&#41;<br/>  mail.example.jp<br/>  example.jp　　　　　　　　　&#40;add&#41;</pre><br/> 		</div><br/> <br/> <b>Tạo alias cho  root</b><br/> [root]# cd /var/qmail/alias<br/> [root]# touch .qmail-postmaster .qmail-mailer-daemon .qmail-root<br/> [root]# chmod 644 .qmail*<br/> <br/> <b>Chỉnh sửa Mailbox thành Maildir </b><br/> [root]#cp /var/qmail/boot/home /var/qmail/rc<br/> [root]#cat /var/qmail/rc<br/> <blockquote>qmail-start <font color='red'>./Maildir/ </font>splogger qmail&nbsp;<br/> 		</blockquote><br/> <br/> <b>Tạo Maildir cho user </b><br/> <br/> [root]# /var/qmail/bin/maildirmake Maildir<br/> [root]# chown -R alias:nofiles Maildir<br/> <br/> <b>Tạo Maildir cho user đã tồn tại (ex: thanbai777)</b><br/> [root alias]# su - thanbai777<br/> [thanbai777]$ /var/qmail/bin/maildirmake ~/Maildir<br/> [thanbai777]$ echo ./Maildir/ &gt; ~/.qmail<br/> <br/> <b>Đưa Maildir vào /etc/skel </b><br/> [root]# /var/qmail/bin/maildirmake Maildir<br/> [root]# /var/qmail/bin/maildirmake /etc/skel/Maildir<br/> <br/> <b>Xoá sendmail và tạo symlink cho qmail</b><br/> [root root]# rm /usr/lib/sendmail<br/> [root root]# rm /usr/sbin/sendmail<br/> [root root]# ln -s /var/qmail/bin/sendmail /usr/sbin/sendmail<br/> [root root]# ln -s /var/qmail/bin/sendmail /usr/lib/sendmail<br/> <br/> <br/> <b>Cài đặt Daemontools </b><br/> <br/> # mkdir -p /package<br/> # chmod 755 /package<br/> # chmod +t /package<br/> <br/> # cd /package<br/> # wget<span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"> http://cr.yp.to/daemontools/daemontools-0.76.tar.gz</span></span></span></span></span></span></span></span></span></span><br/> # tar xvpfz  daemontools-0.76.tar.gz<br/> # cd daemontools-0.76/src<br/> # wget<span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"> http://www.qmail.org/rpms/patches/daemontools-0.76.errno.patch</span></span></span></span></span></span></span></span></span></span><br/> # patch -p1 &lt; daemontools-0.76.errno.patch<br/>   (error.h)<br/> <br/> <br/> <br/> <br/> # cd admin/daemontools-0.76<br/> # ./package/install<br/> <br/> <blockquote>Creating /service...<br/> Adding svscanboot to inittab...<br/> init should start svscan now.&nbsp;<br/> 		</blockquote><br/> <br/> chương trình sẽ tự động thêm dòng sau vào /etc/initab đe^? khi khởi động linux , svscan có thể tự động chạy .<br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre>SV:123456:respawn:/usr/local/bin/svscanboot</pre><br/> 		</div><br/> <br/> <br/> <b>Cài đặt tcpserver</b><br/> # tar xvfz ../ucspi-tcp-0.88.tar.gz<br/> # cd ucspi-tcp-0.88/<br/> #wget<span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"><span class="link"> http://www.qmail.org/rpms/patches/ucspi-tcp-0.88.errno.patch</span></span></span></span></span></span></span></span></span></span><br/> #patch -p1 &lt; ucspi-tcp-0.88.errno.patch<br/> patching file error.h<br/> # make setup check <br/> <br/> <b><br/> Cấu hình cho tcpserver </b><br/> <br/> [root ucspi-tcp-0.88]# cat /etc/tcp.smtp<br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre>192.168.11.:allow,RELAYCLIENT=""<br/> 127.:allow,RELAYCLIENT=""</pre><br/> 		</div> <br/> [root ucspi-tcp-0.88]#<font color='orange'> /usr/local/bin/tcprules /etc/tcp.smtp.cdb /etc/tcp.smtp.tmp &lt; /etc/tcp.smtp</font><br/> <br/> <br/> <b>Cài đặt chương trình quản lý password : checkpassword-0.90 </b><br/> [root ]# cd /usr/local/src<br/> [root src]# tar zxvf checkpassword-0.90.tar.gz<br/> [root src]# cd checkpassword-0.90<br/> [root checkpassword-0.90]# make setup check<br/> [root checkpassword-0.90]# cd /var/qmail<br/> <br/> <b>Cài đặt chương trình quản lý password : checkpw-1.01 </b><br/> [root ]# tar zxvf checkpw-1.01.tar.gz<br/> [root src]# cd checkpw-1.01<br/> [root checkpw-1.01]# make setup check<br/> <br/> <b>POP before SMTP : Cài đặt relay-ctrl  </b><br/> <br/> [root src]# tar -zxvf relay-ctrl-3.1.1.tar.gz<br/> [root src]# cd relay-ctrl-3.1.1<br/> [root relay-ctrl-3.1.1]# make<br/> [root relay-ctrl-3.1.1]# ./installer<br/> <br/> * Nếu bị error sau <br/> <font color='red'>installer error: Could not change directory to '/usr/local/man':</font><br/> Giải quyết bằng lệnh <b><i>mkdir /usr/local/man<br/> </i></b> và chạy lạy <b> ./installer</b><br/> <br/> <b>Cấu hình relay-ctrl</b><br/> [root relay-ctrl-3.1.1]# cd /var/qmail/<br/> [root]# mkdir -p /var/qmail/relay-ctrl/allow<br/> [root]# chmod 700 /var/qmail/relay-ctrl<br/> [root]# chmod 777 /var/qmail/relay-ctrl/allow<br/> [root]# mkdir /etc/relay-ctrl<br/> [root]# echo "/var/qmail/relay-ctrl/allow " &gt; /etc/relay-ctrl/RELAY_CTRL_DIR<br/> [root qmail]# echo "60" &gt; /etc/relay-ctrl/RELAY_CTRL_EXPIRY<br/> [root]# touch /etc/relay-ctrl/RELAY_CTRL_RELAYCLIENT<br/> <br/> <b>Tạo crontab cho relay-ctrl</b><br/> [root]# crontab -e<br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre>* * * * * /usr/local/bin/envdir /etc/relay-ctrl /usr/local/bin/relay-ctrl-age</pre><br/> 		</div><br/> <br/> Bước cuối cùng là khởi động ( lại ) chương trình svscan trước khi hoặc sau khi chạy service qmail  . <br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre>kill -HUP 1</pre><br/> 		</div><br/> <br/> Sau cùng copy code sau vào file qmail và set permission với lệnh<br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/><br/> 		<div class="coded""><br/> 		<pre># touch qmail<br/> # chmod +x qmail</pre><br/> 		</div><br/> <br/> <b>Script cho qmail </b><br/> <br/> <blockquote>#!/bin/sh<br/> <br/> <br/> # Source function library.<br/> . /etc/rc.d/init.d/functions<br/> <br/> [ -f /var/qmail/rc ] || exit 0<br/> PATH=$PATH:/var/qmail/bin:/usr/local/bin<br/> <br/> case "$1" in<br/>     start)<br/>         echo -n "Starting... qmail"<br/> <br/>         csh -cf '/var/qmail/rc &'<br/> <br/>        #For SMTP<br/>         envdir /etc/relay-ctrl relay-ctrl-chdir \<br/>         tcpserver -v -H -R -P -u 711 -g 710 0 smtp \<br/>         relay-ctrl-check /var/qmail/bin/qmail-smtpd 2&gt;&1 | /var/qmail/bin/splogger smtpd 3 &<br/> <br/>           #For POP3<br/>         envdir /etc/relay-ctrl relay-ctrl-chdir \<br/>         tcpserver -H -R -P -v 0 pop3 /var/qmail/bin/qmail-popup <font color='red'>hvaonline.net </font>selectcheckpw \<br/>         relay-ctrl-allow /var/qmail/bin/qmail-pop3d Maildir 2&gt;&1 | /var/qmail/bin/splogger pop3d 3 &<br/>         ;;<br/>     stop)<br/>         echo "Shutting down qmail."<br/>         PID=`/bin/ps -aefw | grep qmail | awk '{print $2}'`<br/>         if [ ! -z "$PID" ] ; then<br/>             /bin/kill ${PID} 1&gt; /dev/null 2&gt;&1<br/>         fi<br/>         rm -f /var/lock/qmail<br/>         ;;<br/> <br/>     *)<br/>         echo "Usage: "$0" {start|stop}"<br/>         exit 1<br/> esac<br/> exit 0&nbsp;<br/> 		</blockquote><br/> <br/> <br/> <br/> =====================<br/> <br/> <font color='green'>Update : 27/11/2008</font><br/> Tác giả : 777<br/> Nguồn : vnhacker.org<br/> <br/> <br/> <br/> <br/> </div>
						</td>
					</tr>

					<tr>
						<td align="left"><a href="http://digg.com/submit?phrase=2&url=/hvaonline/readingRoom/item/12060.html"><img src="/hvaonline/templates/viet/images/digg.gif" align="texttop" alt="[digg]" title="[digg]"></a>
<a href="http://del.icio.us/post?url=/hvaonline/readingRoom/item/12060.html"><img src="/hvaonline/templates/viet/images/delicious.gif" align="texttop" alt="[delicious]" title="[delicious]"></a>
<a href="http://www.google.com/bookmarks/mark?op=edit&output=popup&bkmk=/hvaonline/readingRoom/item/12060.html"><img src="/hvaonline/templates/viet/images/google.gif" align="texttop" alt="[google]" title="[google]"></a>
<a href="http://bookmarks.yahoo.com/toolbar/savebm?opener=tb&u=/hvaonline/readingRoom/item/12060.html"><img src="/hvaonline/templates/viet/images/yahoo.gif" align="texttop" alt="[yahoo]" title="[yahoo]"></a>
<a href="http://technorati.com/faves?add=/hvaonline/readingRoom/item/12060.html"><img src="/hvaonline/templates/viet/images/technorati.gif" align="texttop" alt="[technorati]" title="[technorati]"></a>
<a href="http://reddit.com/submit?url=/hvaonline/readingRoom/item/12060.html"><img src="/hvaonline/templates/viet/images/reddit.gif" align="texttop" alt="[reddit]" title="[reddit]"></a>
<a href="http://www.stumbleupon.com/submit?url=/hvaonline/readingRoom/item/12060.html"><img src="/hvaonline/templates/viet/images/stumbleupon.gif" align="texttop" alt="[stumbleupon]" title="[stumbleupon]"></a></td>
					</tr>
				</table>
			</td>
		</tr>



		<tr>
			<td align="left" valign="top">
				<a href="#topPage"><img src="/hvaonline/templates/viet/images/goup.gif" align="absbottom" border="0" alt="Go to top" title="Go to top"></a>
				<a href="/hvaonline/posts/list/0/2331.html#12060" target="_blank"><img src="/hvaonline/templates/viet/images/goright.gif" border="0" align="absbottom" alt="Go to original post" title="Go to original post"></a> 
				&nbsp;
			</td>
			<td align="right">	<table cellspacing="0" cellpadding="0" border="0">
		<tr>			  
			<td nowrap="nowrap">
				<form action="" name="f" id="f" accept-charset="UTF-8">
					<select onchange="if(this.options[this.selectedIndex].value > 0){ document.location = '/hvaonline/readingRoom/show/'+ this.options[this.selectedIndex].value +'.html'; }" name="select">
						<option value="0" selected="selected">Go to Category</option>	
						<option value="0">------------------------</option>	
								<option value="1">Defense</option>
								<option value="2">Exploit</option>
								<option value="3">Reverse Engineering</option>
								<option value="4">*nix</option>
								<option value="5">Windows</option>
								<option value="6">Networking</option>
								<option value="7">Others</option>
					</select>
				</form>
			</td>
		</tr>
	</table>
</td>
		</tr>
</table>
<script type="text/javascript">
		var ctlTop = false;
		var ctlBt = false;

		function activateControllerTop()
		{
			ctlTop = !ctlTop;
			document.getElementById("controllerTop").style.display = (ctlTop ? "" : "none");
			document.getElementById("controllerTop").style.display = (ctlTop ? "" : "none");
			document.getElementById("controllerTop").style.display = (ctlTop ? "" : "none");

			if (ctlTop) {
				document.location = document.location + "#ctlTop";
			}
		}

		function activateControllerBottom()
		{
			ctlBt = !ctlBt;
			document.getElementById("controllerBottom").style.display = (ctlBt ? "" : "none");
			document.getElementById("controllerBottom").style.display = (ctlBt ? "" : "none");
			document.getElementById("controllerBottom").style.display = (ctlBt ? "" : "none");

			if (ctlBt) {
				document.location = document.location + "#ctlBt";
			}
		}
</script>

	<tr>	
		<td align="center">
		<br>
					</td>
	</tr>

	<tr>
		<td align="center">
			<span class="copyright">Powered by JForum - Extended by <a href="MailTo:lienlac@hvaonline.net">HVAOnline</a><br>
			&nbsp;hvaonline.net&nbsp; | &nbsp;hvaforum.net&nbsp; | &nbsp;hvazone.net&nbsp; | &nbsp;hvanews.net&nbsp; | &nbsp;vnhacker.org<br>
			1999 - 2013 &copy;
			v2012|0504|218|
		  </span>
	  </td>
	</tr>
<iframe src="/hvaonline/templates/ping_session.html" height="0" width="0" frameborder="0" scrolling="no"></iframe>
</body>
</html>
