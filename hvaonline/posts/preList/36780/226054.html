<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"> 

<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="-1">
<meta name="description" content="HVA discussion board">
<meta name="keywords" content="Backup database của zimbra mail chạy trên RedHat 5?, jforum, jforum java, jforum forum, forum java, java jforum, java forum, forum, rafael steil, bulletin board, java bb, javabb, hva, hvaonline, hvazone, hvaforum">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="robots" content="index,follow">
<meta name="rating" content="general">
<style type="text/css">
<!-- 
@import url( "/hvaonline/templates/viet/styles/style.css");
-->
</style>
<style type="text/css">
<!--
@import url("/hvaonline/templates/viet/styles/en_US.css");
-->
</style>
<title>Backup database của zimbra mail chạy trên RedHat 5? - .:: HVAOnline ::.</title>

</head>
<body class="en_US">


<!--
Original theme from phpBB (http://www.phpbb.com) subSilver
Created by subBlue design
http://www.subBlue.com
Modifications by JForum Team 
Extended and customised by HVA Team
Added more features and Black Silver theme designed by HVA
-->
<table width="100%" border="0" cols="2">
	<tr align="right">
		<td class="copyright">
			English
			| 
			<a href="/hvaonline/jforum.html?module=forums&amp;action=setLang&amp;lang=vi_VN" rel="nofollow">Vietnamese</a>
		</td>
	</tr>
</table>
<table width="100%" border="0">
	<tr>
		<td>
			<table cellspacing="0" cellpadding="0" width="100%" border="0">
				<tr>			
        <td>&nbsp;
			</td>
		
        <td width="100%" align="center" valign="middle">
						<p><a href="" title="[Logo]">
								<img src="/hvaonline/templates/viet/images/hvabanner-final.gif" alt="banner" />
							<br>
            				</a><span class="maintitle"></span>
						</p>
          <table cellspacing="0" cellpadding="2" border="0">
							<tr>
								
              <td valign="top" nowrap="nowrap" align="center">
			  						<a href="/hvaonline/forums/rule.html"><img src="/hvaonline/templates/viet/images/icon_mini_rule.gif" alt="[Rule]" title="[Rule]"></a>
									<a id="rule" class="topmenu" href="/hvaonline/forums/rule.html">Rules</a>&nbsp;
									
									<a class="topmenu" href="/hvaonline/forums/list.html"><img src="/hvaonline/templates/viet/images/icon_mini_groups.gif" alt="[Home]" title="[Home]"></a>
										<a id="backtosite" class="topmenu" href="/hvaonline/forums/list.html">Main Forum</a>&nbsp;

										<a class="topmenu" href="/hvaonline/portal/list.html"><img src="/hvaonline/templates/viet/images/icon_mini_portal.gif" alt="[Portal]" title="[Portal]"></a>
										<a id="portalsite" class="topmenu" href="/hvaonline/portal/list.html">Portal</a>&nbsp;&nbsp;
									<br>
									
										<a href="/hvaonline/user/list.html"><img src="/hvaonline/templates/viet/images/icon_mini_members.gif" alt="[Members]" title="[Members]"></a>
										<a id="users" class="topmenu" href="/hvaonline/user/list.html">Member Listing</a>&nbsp;
										
										<a href="/hvaonline/forums/stats.html"><img src="/hvaonline/templates/viet/images/icon_mini_stats.gif" alt="[Statistics]" title="[Statistics]"></a>
										<a id="stats" class="topmenu" href="/hvaonline/forums/stats.html">Statistics</a>&nbsp;
										
										<a href="/hvaonline/search/filters.html"><img src="/hvaonline/templates/viet/images/icon_mini_search.gif" alt="[Search]" title="[Search]"></a>
										<span class="mainmenu"><a id="search" class="topmenu" href="/hvaonline/search/filters.html"><b>Search</b></a>&nbsp;
									
										<a href="/book/"><img src="/hvaonline/templates/viet/images/icon_mini_book.gif" alt="[Reading Room]" title="[Reading Room]"></a> 
										<a class="topmenu" href="/hvaonline/readingRoom/list.html">Reading Room</a>&nbsp;

									
									<span class="topmenu"> 
										

	
										<br>
											<a id="register" class="topmenu" href="/hvaonline/user/insert.html"><img src="/hvaonline/templates/viet/images/icon_mini_register.gif" border="0" alt="[Register]" title="[Register]"> 
												Register</a>&nbsp;&nbsp;</span>
											<img src="/hvaonline/templates/viet/images/icon_mini_login.gif" border="0" alt="[Login]" title="[Login]"> 
											<strong>Login</strong> [&nbsp;
											<a id="login" class="topmenu" href="/hvaonline/user/login.html">http</a>&nbsp;
											|
											<a id="logins" class="topmenu" href="https://www.hvaonline.net/hvaonline/user/logins.html">https </a>&nbsp;]</span>
								</td>
							</tr>
							<tr>
								<td>&nbsp;</td>
							</tr>
						</table>
					</td>
				</tr>
			</table>
		</td>
	</tr>
	<tr>
		<td>

<!-- navigator -->
<table cellspacing="2" cellpadding="2" width="100%" border="0" align="center">
	<tr>
		<td valign="baseline" align="left" colspan="0">
			<span class="nav">
			<a class="nav" href="/hvaonline/forums/list.html">Forum Index </a> 
			<img src="/hvaonline/templates/viet/images/en_US/arrow.gif"> <a class="nav" href="/hvaonline/forums/show/24.html">Thảo luận hệ điều hành *nix </a>
			<img src="/hvaonline/templates/viet/images/en_US/arrow.gif"> <a class="nav" href="/hvaonline/posts/list/36780.html" name="top" id="top">Backup database của zimbra mail chạy trên RedHat 5?</a>
				&nbsp;<a href="/hvaonline/rss/topicPosts/36780.html"><img src="/hvaonline/templates/viet/images/xml_button.gif" border="0" alt="XML"></a>
			</span>
		
		</td>

		<td valign="middle" align="right" class="nav"></td>
	</tr>
</table>

<!-- poll show -->

  <!-- POST LISTING -->


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Backup database của zimbra mail chạy trên RedHat 5?<a name="225915" id="225915"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">30/11/2010 16:50:24 (+0700) | <a href="/hvaonline/posts/list/36780.html#225915">#1</a> | 225915 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/129247.html"><b>neverwon</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 08/08/2006 13:38:43<br>
		Messages: 89<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/129247.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/129247.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row1">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row1"><span class="postbody">Cho tớ hỏi chút:<br/> <br/> Tớ muốn backup database của zimbra mail chạy trên RedHat 5<br/> Script như sau:<br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>#!/bin/sh

mySqlPassword=&quot;password&quot;
mySqlUser=&quot;root&quot;

#Start service mySQL if it is not running
mySQLStatus=`su - zimbra -c &quot;mysql.server status&quot; |gawk '{print $3}'`
if &#91; &quot;$mySQLStatus&quot; != &quot;running&quot; &#93;; then
su - zimbra -c 'mysql.server start --socket=/opt/zimbra/db/mysql.sock'
fi

#Backup zimbra mail's database
su - zimbra -c '/opt/zimbra/mysql/bin/mysqldump --user=$mySqlUser --password=$mySqlPassword --socket=/opt/zimbra/db/mysql.sock --all-databases &gt; /opt/backup/zimbraBackup$&#40;date +&quot;%d%m%Y_%H%M%S&quot;&#41;.sql'</pre>
		</div><br/> Với script này, việc backup không thành công do mysqldump không hiểu tham số $mySqlUser và $mySqlPassword.<br/> <br/> Nếu tớ hardcode: <br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>su - zimbra -c '/opt/zimbra/mysql/bin/mysqldump --user=root --password=password --socket=/opt/zimbra/db/mysql.sock --all-databases &gt; /opt/backup/zimbraBackup$&#40;date +&quot;%d%m%Y_%H%M%S&quot;&#41;.sql'</pre>
		</div><br/> Thi việc backup diễn ra thành công.<br/> Cậu có thể gọi ý cho tớ chỉnh sửa lại script để thực thi việc backup mà không cần hardcode được không?<br/> </span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>


			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Backup database của zimbra mail chạy trên RedHat 5?<a name="225922" id="225922"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">30/11/2010 18:23:17 (+0700) | <a href="/hvaonline/posts/list/36780.html#225922">#2</a> | 225922 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>
<td width="20">
		<img src="/hvaonline/images/avatar/3f44f3018ff71ff4a7d22a98f3babb55.png" border="0" alt="[Avatar]" title="[Avatar]"><br>
	</td>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/128502.html"><b>quanta</b></a><br>
	<font color="#FF9900">Moderator</font></span>
<br>

<span class="uprofile">
		
</span>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 28/07/2006 14:44:21<br>
		Messages: 7265<br>
	
		Location: $ locate `whoami`<br>
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/128502.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/128502.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row2">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row2"><span class="postbody"><p></p>
		<cite class="blockquote">neverwon wrote:</cite><br>
		<blockquote><br/> Với script này, việc backup không thành công do mysqldump không hiểu tham số $mySqlUser và $mySqlPassword.<br/> &nbsp;
		</blockquote><br/> Nguyên văn câu thông báo thế nào? User, password của bạn có ký tự gì đặc biệt không? Debug thử với <b>sh -x</b> sẽ thấy rõ hơn đấy.</span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>

		  <tr>
			<td height="20" colspan="2" valign="bottom" class="rowButton"><span class="gensmall"><font color='orange'>Let's build on a great foundation!</font></span></td>
		  </tr>

			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Backup database của zimbra mail chạy trên RedHat 5?<a name="225994" id="225994"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">01/12/2010 08:23:01 (+0700) | <a href="/hvaonline/posts/list/36780.html#225994">#3</a> | 225994 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/129247.html"><b>neverwon</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 08/08/2006 13:38:43<br>
		Messages: 89<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/129247.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/129247.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row1">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row1"><span class="postbody"><p></p>
		<cite class="blockquote">quanta wrote:</cite><br>
		<blockquote><p></p>
		<cite class="blockquote">neverwon wrote:</cite><br>
		<blockquote><br/> Với script này, việc backup không thành công do mysqldump không hiểu tham số $mySqlUser và $mySqlPassword.<br/> &nbsp;
		</blockquote><br/> Nguyên văn câu thông báo thế nào? User, password của bạn có ký tự gì đặc biệt không? Debug thử với <b>sh -x</b> sẽ thấy rõ hơn đấy.&nbsp;
		</blockquote><br/> <br/> Khi truyền tham số theo cách này:<br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>#Backup zimbra mail's database
 su - zimbra -c '/opt/zimbra/mysql/bin/mysqldump --user=$mySqlUser --password=$mySqlPassword --socket=/opt/zimbra/db/mysql.sock --all-databases &gt; /opt/backup/zimbraBackup$&#40;date +&quot;%d%m%Y_%H%M%S&quot;&#41;.sql'</pre>
		</div><br/> thực thi script thì nhận được báo lỗi:<br/> <blockquote><br/> [root@mail backup]# ./exportDB.sh<br/> mysqldump: Got error: 1045: Access denied for user 'root'@'localhost' (using password: NO) when trying to connect<br/> &nbsp;
		</blockquote><br/>  Lỗi này tương đuơng với việc thực thi <br/> <blockquote><br/> [root@mail backup]# su - zimbra -c '/opt/zimbra/mysql/bin/mysqldump --socket=/opt/zimbra/db/mysql.sock --all-databases &gt; /opt/backup/zimbraBackup$(date +&quot;%d%m%Y_%H%M%S&quot<img src="/hvaonline/images/smilies/068ae40523a24c9ef54edefd375e542d.gif" border="0" alt="smilie" align="absbottom">.sql'<br/> mysqldump: Got error: 1045: Access denied for user 'root'@'localhost' (using password: NO) when trying to connect<br/> &nbsp;
		</blockquote><br/> Theo tớ hiểu, khi thực thi script exportDB.sh, tham số &quot;--user=$mySqlUser&quot; và &quot;--password=$mySqlPassword&quot; đã bị bỏ qua.<br/> <br/> Tớ modify:<br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>su - zimbra -c '/opt/zimbra/mysql/bin/mysqldump --user=root --password=$mySqlPassword --socket=/opt/zimbra/db/mysql.sock --all-databases &gt; /opt/backup/zimbraBackup$&#40;date +&quot;%d%m%Y_%H%M%S&quot;&#41;.sql'</pre>
		</div><br/> <br/> <blockquote><br/> [root@mail backup]# ./exportDB.sh<br/> mysqldump: Got error: 1045: Access denied for user 'root'@'localhost' (using password: NO) when trying to connect<br/> &nbsp;
		</blockquote><br/> <br/> Tham số &quot;--password=$mySqlPassword&quot; đã bị bỏ qua khi thực thi script!!!<br/> <br/> Khi hardcode:<br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>su - zimbra -c '/opt/zimbra/mysql/bin/mysqldump --user=root --password=password --socket=/opt/zimbra/db/mysql.sock --all-databases &gt; /opt/backup/zimbraBackup$&#40;date +&quot;%d%m%Y_%H%M%S&quot;&#41;.sql'</pre>
		</div><br/> Script thực thi thành công, dữ liệu được backup đầy đủ:<br/> <blockquote><br/> [root@mail backup]# ./exportDB.sh<br/> [root@mail backup]# ll<br/> total 1212<br/> -rwxr-x--- 1 zimbra zimbra   1422 Nov 30 16:06 autoBackupZimbra.sh<br/> -rw-r--r-- 1 root   root       34 Nov 30 10:46 domain_list.txt<br/> -rwxr-x--- 1 zimbra zimbra   4314 Nov 30 14:20 export-acc-zcs.sh<br/> -rwxr-x--- 1 root   root      500 Dec  1 09:15 exportDB.sh<br/> -rwxr-x--- 1 zimbra zimbra   2017 Nov 30 09:53 import-acc-zcs.sh<br/> -rwxr-x--- 1 root   root       72 Nov 30 14:47 ldapStatus.sh<br/> -rwxr-x--- 1 root   root       98 Nov 30 15:27 mySQLStatus.sh<br/> -rw-r----- 1 zimbra zimbra  15270 Nov 30 16:32 mysqldump.help.txt<br/> -rwxr-x--- 1 root   root      223 Nov 30 11:07 test.sh<br/> -rwxr-x--- 1 zimbra zimbra    404 Nov 30 09:53 uninstall.sh<br/> -rw-r----- 1 zimbra zimbra 584606 Dec  1 09:16 zimbraBackup01122010_091648.sql<br/> -rw-r----- 1 zimbra zimbra 584606 Nov 30 16:58 zimbraBackup30112010_165829.sql<br/> -rwxr-x--- 1 zimbra zimbra     63 Nov 30 09:53 zimbraStatus.sh<br/> <br/> &nbsp;
		</blockquote><br/> <br/> <blockquote><br/> [root@mail backup]# more zimbraBackup01122010_091648.sql<br/> -- MySQL dump 10.11<br/> --<br/> -- Host: localhost    Database:<br/> -- ------------------------------------------------------<br/> -- Server version       5.0.90-log<br/> <br/> /*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;<br/> /*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;<br/> /*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;<br/> /*!40101 SET NAMES utf8 */;<br/> /*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;<br/> /*!40103 SET TIME_ZONE='+00:00' */;<br/> /*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;<br/> /*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;<br/> /*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;<br/> /*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;<br/> <br/> --<br/> -- Current Database: `mboxgroup1`<br/> --<br/> <br/> CREATE DATABASE /*!32312 IF NOT EXISTS*/ `mboxgroup1` /*!40100 DEFAULT CHARACTER SET utf8 */;<br/> <br/> USE `mboxgroup1`;<br/> <br/> --<br/> -- Table structure for table `appointment`<br/> --<br/> <br/> DROP TABLE IF EXISTS `appointment`;<br/> /*!40101 SET @saved_cs_client     = @@character_set_client */;<br/> /*!40101 SET character_set_client = utf8 */;<br/> CREATE TABLE `appointment` (<br/>   `mailbox_id` int(10) unsigned NOT NULL,<br/>   `uid` varchar(255) NOT NULL,<br/>   `item_id` int(10) unsigned NOT NULL,<br/>   `start_time` datetime NOT NULL,<br/>   `end_time` datetime default NULL,<br/>   PRIMARY KEY  (`mailbox_id`,`uid`),<br/>   UNIQUE KEY `i_item_id` (`mailbox_id`,`item_id`),<br/>   CONSTRAINT `fk_appointment_item_id` FOREIGN KEY (`mailbox_id`, `item_id`) REFERENCES `mail_item` (`mailbox_id`, `id`) ON DELETE CASCADE,<br/>   CONSTRAINT `fk_appointment_mailbox_id` FOREIGN KEY (`mailbox_id`) REFERENCES `zimbra`.`mailbox` (`id`)<br/> ) ENGINE=InnoDB DEFAULT CHARSET=utf8;<br/> &nbsp;
		</blockquote><br/> <br/> <br/> <br/> <br/> <br/> </span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>


			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Backup database của zimbra mail chạy trên RedHat 5?<a name="225999" id="225999"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">01/12/2010 08:45:34 (+0700) | <a href="/hvaonline/posts/list/36780.html#225999">#4</a> | 225999 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>
<td width="20">
		<img src="/hvaonline/images/avatar/3f44f3018ff71ff4a7d22a98f3babb55.png" border="0" alt="[Avatar]" title="[Avatar]"><br>
	</td>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/128502.html"><b>quanta</b></a><br>
	<font color="#FF9900">Moderator</font></span>
<br>

<span class="uprofile">
		
</span>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 28/07/2006 14:44:21<br>
		Messages: 7265<br>
	
		Location: $ locate `whoami`<br>
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/128502.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/128502.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row2">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row2"><span class="postbody">Bạn vẫn chưa trả lời câu hỏi:<br/> <blockquote>password của bạn có ký tự gì đặc biệt không?&nbsp;
		</blockquote><br/> Chèn thêm một dòng `echo $mySqlPassword` trước mysqldump rồi chạy `sh -x ./exportDB.sh` sẽ rõ hơn đấy.</span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>

		  <tr>
			<td height="20" colspan="2" valign="bottom" class="rowButton"><span class="gensmall"><font color='orange'>Let's build on a great foundation!</font></span></td>
		  </tr>

			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Backup database của zimbra mail chạy trên RedHat 5?<a name="226008" id="226008"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">01/12/2010 09:09:22 (+0700) | <a href="/hvaonline/posts/list/36780.html#226008">#5</a> | 226008 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/129247.html"><b>neverwon</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 08/08/2006 13:38:43<br>
		Messages: 89<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/129247.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/129247.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row1">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row1"><span class="postbody"><p></p>
		<cite class="blockquote">quanta wrote:</cite><br>
		<blockquote>Bạn vẫn chưa trả lời câu hỏi:<br/> <blockquote>password của bạn có ký tự gì đặc biệt không?&nbsp;
		</blockquote><br/> Chèn thêm một dòng `echo $mySqlPassword` trước mysqldump rồi chạy `sh -x ./exportDB.sh` sẽ rõ hơn đấy.&nbsp;
		</blockquote><br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>&#91;root@mail backup&#93;# sh -x ./exportDB.sh
+ mySqlPassword=password
+ mySqlUser=root
++ su - zimbra -c 'mysql.server status'
++ gawk '{print $3}'
+ mySQLStatus=running
+ '&#91;' running '!=' running '&#93;'
+ echo 'mySQL password: ' password
mySQL password:  password
+ su - zimbra -c '/opt/zimbra/mysql/bin/mysqldump --user=$mySqlUser --password=$mySqlPassword --socket=/opt/zimbra/db/mysql.sock --all-databases &gt; /opt/backup/zimbraBackup$&#40;date +&quot;%d%m%Y_%H%M%S&quot;&#41;.sql'
mysqldump: Got error: 1045: Access denied for user 'root'@'localhost' &#40;using password: NO&#41; when trying to connect</pre>
		</div><br/> <br/> password của user root chỉ bao gồm các ký tự thông thường (chữ cái và chữ số), không có ký tự đặc biệt nào (kiểu như #, % hay &...)<br/> <br/> Tuy nhiên, tình huống này, theo như tớ hiểu, câu truy vấn đã được thực thi ở chế độ mặc định (user mặc định là root, không sử dụng password).<br/> <br/> Phân biệt với tình huống có nhập password nhưng password không đúng:<br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>&#91;root@mail backup&#93;# su - zimbra -c '/opt/zimbra/mysql/bin/mysqldump --user=root --password=aaa --socket=/opt/zimbra/db/mysql.sock --all-databases &gt; /opt/backup/zimbraBackup$&#40;date +&quot;%d%m%Y_%H%M%S&quot;&#41;.sql'
mysqldump: Got error: 1045: Access denied for user 'root'@'localhost' &#40;using password: YES&#41; when trying to connect</pre>
		</div></span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>


			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Backup database của zimbra mail chạy trên RedHat 5?<a name="226021" id="226021"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">01/12/2010 10:00:31 (+0700) | <a href="/hvaonline/posts/list/36780.html#226021">#6</a> | 226021 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>
<td width="20">
		<img src="/hvaonline/images/avatar/3f44f3018ff71ff4a7d22a98f3babb55.png" border="0" alt="[Avatar]" title="[Avatar]"><br>
	</td>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/128502.html"><b>quanta</b></a><br>
	<font color="#FF9900">Moderator</font></span>
<br>

<span class="uprofile">
		
</span>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 28/07/2006 14:44:21<br>
		Messages: 7265<br>
	
		Location: $ locate `whoami`<br>
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/128502.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/128502.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row2">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row2"><span class="postbody">Bạn thêm tiếp -v (verbose) vào mysqldump rồi chạy lại sh -x xem nó bắn ra những gì.</span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>

		  <tr>
			<td height="20" colspan="2" valign="bottom" class="rowButton"><span class="gensmall"><font color='orange'>Let's build on a great foundation!</font></span></td>
		  </tr>

			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Backup database của zimbra mail chạy trên RedHat 5?<a name="226025" id="226025"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">01/12/2010 10:33:20 (+0700) | <a href="/hvaonline/posts/list/36780.html#226025">#7</a> | 226025 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/129247.html"><b>neverwon</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 08/08/2006 13:38:43<br>
		Messages: 89<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/129247.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/129247.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row1">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row1"><span class="postbody"><p></p>
		<cite class="blockquote">quanta wrote:</cite><br>
		<blockquote>Bạn thêm tiếp -v (verbose) vào mysqldump rồi chạy lại sh -x xem nó bắn ra những gì.&nbsp;
		</blockquote><br/> <br/> Để kiểu tham biến:<br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>&#91;root@mail backup&#93;# sh -x ./exportDB.sh
+ mySqlPassword=password
+ mySqlUser=root
++ su - zimbra -c 'mysql.server status'
++ gawk '{print $3}'
+ mySQLStatus=running
+ '&#91;' running '!=' running '&#93;'
+ echo 'mySQL password: ' password
mySQL password:  password
+ su - zimbra -c '/opt/zimbra/mysql/bin/mysqldump -v --user=$mySqlUser --password=$mySqlPassword --socket=/opt/zimbra/db/mysql.sock --all-databases &gt; /opt/backup/zimbraBackup$&#40;date +&quot;%d%m%Y_%H%M%S&quot;&#41;.sql'
-- Connecting to localhost...
mysqldump: Got error: 1045: Access denied for user 'root'@'localhost' &#40;using password: NO&#41; when trying to connect</pre>
		</div><br/> Không tạo được kết nối tới DB<br/> <br/> Hardcode:<br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>&#91;root@mail backup&#93;# sh -x ./exportDB.sh
+ mySqlPassword=password
+ mySqlUser=root
++ su - zimbra -c 'mysql.server status'
++ gawk '{print $3}'
+ mySQLStatus=running
+ '&#91;' running '!=' running '&#93;'
+ echo 'mySQL password: ' password
mySQL password:  password
+ su - zimbra -c '/opt/zimbra/mysql/bin/mysqldump -v --user=root --password=password --socket=/opt/zimbra/db/mysql.sock --all-databases &gt; /opt/backup/zimbraBackup$&#40;date +&quot;%d%m%Y_%H%M%S&quot;&#41;.sql'

-- Retrieving table structure for table jiveExtComponentConf...
-- Sending SELECT query...
-- Retrieving rows...
-- Retrieving table structure for table jiveGroupProp...
-- Sending SELECT query...
-- Retrieving rows...</pre>
		</div><br/> <br/> Kết nối, truy xuất dữ liệu thành công.</span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>


			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Backup database của zimbra mail chạy trên RedHat 5?<a name="226030" id="226030"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">01/12/2010 10:57:37 (+0700) | <a href="/hvaonline/posts/list/36780.html#226030">#8</a> | 226030 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>
<td width="20">
		<img src="/hvaonline/images/avatar/3f44f3018ff71ff4a7d22a98f3babb55.png" border="0" alt="[Avatar]" title="[Avatar]"><br>
	</td>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/128502.html"><b>quanta</b></a><br>
	<font color="#FF9900">Moderator</font></span>
<br>

<span class="uprofile">
		
</span>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 28/07/2006 14:44:21<br>
		Messages: 7265<br>
	
		Location: $ locate `whoami`<br>
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/128502.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/128502.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row2">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row2"><span class="postbody">vim có tính năng syntax highlighting, viết script nên chú ý là khi gọi biến sẽ có màu riêng thay vì màu của string bình thường.<br/> <br/> Sửa: <br/> <font color='red'>--user=$mySqlUser --password=$mySqlPassword</font><br/> <br/> thành:<br/> <font color='red'>--user=</font><font color='orange'>'</font><font color='violet'>$mySqlUser</font><font color='orange'>'</font> <font color='red'>--password=</font><font color='orange'>'</font><font color='violet'>$mySqlPassword</font><font color='orange'>'</font><br/> </span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>

		  <tr>
			<td height="20" colspan="2" valign="bottom" class="rowButton"><span class="gensmall"><font color='orange'>Let's build on a great foundation!</font></span></td>
		  </tr>

			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Backup database của zimbra mail chạy trên RedHat 5?<a name="226051" id="226051"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">01/12/2010 14:51:01 (+0700) | <a href="/hvaonline/posts/list/36780.html#226051">#9</a> | 226051 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/129247.html"><b>neverwon</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 08/08/2006 13:38:43<br>
		Messages: 89<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/129247.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/129247.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row1">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row1"><span class="postbody"><p></p>
		<cite class="blockquote">quanta wrote:</cite><br>
		<blockquote>vim có tính năng syntax highlighting, viết script nên chú ý là khi gọi biến sẽ có màu riêng thay vì màu của string bình thường.<br/> <br/> Sửa: <br/> <font color='red'>--user=$mySqlUser --password=$mySqlPassword</font><br/> <br/> thành:<br/> <font color='red'>--user=</font><font color='orange'>'</font><font color='violet'>$mySqlUser</font><font color='orange'>'</font> <font color='red'>--password=</font><font color='orange'>'</font><font color='violet'>$mySqlPassword</font><font color='orange'>'</font><br/> &nbsp;
		</blockquote><br/> <br/> Tớ switch sang user zimbra và thực thi script:<br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>#!/bin/sh
mySQLUser=&quot;root&quot;
mySQLPassword=&quot;password&quot;

/opt/zimbra/mysql/bin/mysqldump --user=$mySQLUser --password=$mySQLPassword --socket=/opt/zimbra/db/mysql.sock --all-databases &gt; /opt/backup/zimbraBackup.sql</pre>
		</div><br/> <br/> Quá trình backup diễn ra thành công!!!<br/> <br/> Trong khi đứng ở user root để thực thi script:<br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>#!/bin/sh
mySQLUser=&quot;root&quot;
mySQLPassword=&quot;password&quot;

su - zimbra -c '/opt/zimbra/mysql/bin/mysqldump --user=$mySQLUser --password=$mySQLPassword --socket=/opt/zimbra/db/mysql.sock --all-databases &gt; /opt/backup/zimbraBackup.sql'</pre>
		</div><br/> <br/> <font color='red'>--user=$mySQLUser</font> và <font color='red'>--password=$mySQLPassword</font> bị bỏ qua!!!<br/> <br/> Tớ nghĩ, vấn đề nằm ở trong cặp 'single quote'.<br/> Khi đứng từ root, thực thi câu truy vấn gián tiếp thông qua <font color='yellow'>su - zimbra -c 'command'</font>, tham biến kiểu <font color='red'>--user=$mySQLUser</font> bị bỏ qua.<br/> </span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>


			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Backup database của zimbra mail chạy trên RedHat 5?<a name="226052" id="226052"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">01/12/2010 15:11:49 (+0700) | <a href="/hvaonline/posts/list/36780.html#226052">#10</a> | 226052 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>
<td width="20">
		<img src="/hvaonline/images/avatar/3f44f3018ff71ff4a7d22a98f3babb55.png" border="0" alt="[Avatar]" title="[Avatar]"><br>
	</td>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/128502.html"><b>quanta</b></a><br>
	<font color="#FF9900">Moderator</font></span>
<br>

<span class="uprofile">
		
</span>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 28/07/2006 14:44:21<br>
		Messages: 7265<br>
	
		Location: $ locate `whoami`<br>
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/128502.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/128502.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row2">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row2"><span class="postbody"><p></p>
		<cite class="blockquote">neverwon wrote:</cite><br>
		<blockquote><br/> Tớ nghĩ, vấn đề nằm ở trong cặp 'single quote'.<br/> &nbsp;
		</blockquote><br/> Đúng rồi. Có 2 cách: 1 là enclose tên biến với single quotes, 2 là dùng double quotes cho -c (--command) trong lệnh su.</span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>

		  <tr>
			<td height="20" colspan="2" valign="bottom" class="rowButton"><span class="gensmall"><font color='orange'>Let's build on a great foundation!</font></span></td>
		  </tr>

			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Backup database của zimbra mail chạy trên RedHat 5?<a name="226054" id="226054"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">01/12/2010 16:04:57 (+0700) | <a href="/hvaonline/posts/list/36780.html#226054">#11</a> | 226054 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/129247.html"><b>neverwon</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 08/08/2006 13:38:43<br>
		Messages: 89<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/129247.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/129247.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row1">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row1"><span class="postbody">Đây là toàn bộ script <font color='cyan'>autoBackupZimbra.sh</font> của tớ:<br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>#!/bin/sh
#Stop zimbra service before backup &#40;if it is running&#41;
STATUS=`su - zimbra -c 'zmcontrol status |grep -i &quot;mailbox&quot;' | gawk '{print $2}'`
if &#91; &quot;$STATUS&quot; == &quot;Running&quot; &#93;; then
echo &quot;Stopping Zimbra service....&quot;
su - zimbra -c 'zmcontrol stop'
fi
echo &quot;.... Service Zimbra has been stopped&quot;

SCRIPT_FOLDER=&quot;/opt/backup&quot;
BACKUP_FOLDER=&quot;/opt/backup&quot;

mySqlPassword=`su - zimbra -c 'zmlocalconfig -s | grep &quot;mysql_root_password&quot;' | gawk '{print $3}'`
mySqlUser=&quot;root&quot;

#Start service LDAP if it is not running
ldapStatus=`su - zimbra -c &quot;ldap status | grep slapd&quot; |gawk '{print $2}'`
if &#91; &quot;$ldapStatus&quot; != &quot;running&quot; &#93;; then
echo &quot;Starting LDAP service...........&quot;
su - zimbra -c 'ldap start'
fi
echo &quot;..... Service LDAP has been started&quot;

#Export LDAP users
$SCRIPT_FOLDER/export-acc-zcs.sh

#Stop service LDAP
su - zimbra -c 'ldap stop'

#Start service mySQL if it is not running
mySQLStatus=`su - zimbra -c &quot;mysql.server status&quot; |gawk '{print $3}'`
if &#91; &quot;$mySQLStatus&quot; != &quot;running&quot; &#93;; then
echo &quot;Starting mysql service......&quot;
su - zimbra -c 'mysql.server start --socket=/opt/zimbra/db/mysql.sock'
fi
echo &quot;Service mysql has been started&quot;

#Backup zimbra mail's database
echo &quot;Starting backup database of Zimbra mail....&quot;
/opt/zimbra/mysql/bin/mysqldump --user=$mySqlUser --password=$mySqlPassword --socket=/opt/zimbra/db/mysql.sock --all-databases &gt; $BACKUP_FOLDER/zimbraBackup$&#40;date +&quot;%d%m%Y_%H%M%S&quot;&#41;.sql
echo &quot;backup completed&quot;

#Stop mysql service
su - zimbra -c 'mysql.server stop --socket=/opt/zimbra/db/mysql.sock'

#Backup index and store
echo &quot;Starting backup index and store....&quot;
tar -cvf $BACKUP_FOLDER/backupZimbraStore$&#40;date +&quot;%d%m%Y_%H%M%S&quot;&#41;.tar /opt/zimbra/store /opt/zimbra/index
echo &quot;... Backup completed&quot;

#Start zimbra service
START=`su - zimbra -c 'zmcontrol status |grep -i &quot;mailbox&quot;' |  gawk '{print $2}'`
if &#91; &quot;$START&quot; != &quot;Running&quot; &#93;; then
su - zimbra -c 'zmcontrol start'
fi
echo &quot;Completed tasks&quot;</pre>
		</div><br/> <br/> Còn đây là script <font color='orange'>export-acc-zcs.sh</font> tớ lấy từ<span class="link"> http://www.vavai.com,</span> có sửa đổi một chút để lấy toàn bộ accounts:<br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>#!/bin/sh

#Hapus Layar
clear

echo -e &quot;###################################################################################&quot;
echo -e &quot;# Zimbra export-acc-zcs.sh ver 0.0.2                                              #&quot;
echo -e &quot;# Skrip untuk export account Zimbra berikut profile dan password                  #&quot;
echo -e &quot;# Masim 'Vavai' Sugianto - &lt;a href="mailto:vavai@vavai.com"&gt;vavai@vavai.com&lt;/a&gt; -<span class="link"> http://www.vavai.com</span>                 #&quot;
echo -e &quot;# Untuk saran dan pertanyaan silakan menggunakan Milis Komunitas Zimbra Indonesia #&quot;
echo -e &quot;# Link Komunitas :<span class="link"> http://www.zimbra.web.id</span> -<span class="link"> http://www.opensuse.or.id</span>           #&quot;
echo -e &quot;###################################################################################&quot;

# /* Variable untuk bold */
ibold=&quot;\033&#91;1m&quot;&quot;\n===&gt; &quot;
ebold=&quot;\033&#91;0m&quot;

FOLDER=&quot;/opt/backup&quot;

# /* Parameter */
#echo &quot;&quot;
#echo -n &quot;Enter Domain Name &#40;ex : vavai.com&#41; : &quot;
#read NAME_DOMAIN
#echo -n &quot;Enter path folder for exported account &#40;ex : /home/vavai/&#41; : &quot;
#read FOLDER

# /*export ldap user */
NAME_FILE=&quot;$FOLDER/zcs-acc-add$&#40;date +&quot;%d%m%Y_%H%M%S&quot;&#41;.zmp&quot;
LDIF_FILE=&quot;$FOLDER/zcs-acc-mod$&#40;date +&quot;%d%m%Y_%H%M%S&quot;&#41;.ldif&quot;

rm -f $NAME_FILE
rm -f $LDIF_FILE

touch $NAME_FILE
touch $LDIF_FILE

#echo &quot;createDomain $NAME_DOMAIN&quot; &gt;&gt; $NAME_FILE

# /* Check Zimbra version */
VERSION=`su - zimbra -c 'zmcontrol -v'`;
ZCS_VER=&quot;/tmp/zcsver.txt&quot;
# get Zimbra LDAP password
ZIMBRA_LDAP_PASSWORD=`su - zimbra -c &quot;zmlocalconfig -s zimbra_ldap_password | cut -d ' ' -f3&quot;`

touch $ZCS_VER
echo $VERSION &gt; $ZCS_VER

echo -e $ibold&quot;Retrieve Zimbra User..............................&quot;$ebold

grep &quot;Release 5.&quot; $ZCS_VER
if &#91; $? = 0 &#93;; then
USERS=`su - zimbra -c 'zmprov gaa'`;
LDAP_MASTER_URL=`su - zimbra -c &quot;zmlocalconfig -s ldap_master_url | cut -d ' ' -f3&quot;`
fi

grep &quot;Release 6.&quot; $ZCS_VER
if &#91; $? = 0 &#93;; then
USERS=`su - zimbra -c 'zmprov -l gaa'`;
LDAP_MASTER_URL=&quot;ldapi:///&quot;
fi

echo -e $ibold&quot;Processing account, please wait..............................&quot;$ebold
# /* Proses insert account kedalam file hasil export */
for ACCOUNT in $USERS; do
NAME=`echo $ACCOUNT`;
DOMAIN=`echo $ACCOUNT | awk -F@ '{print $2}'`;
ACCOUNT=`echo $ACCOUNT | awk -F@ '{print $1}'`;
ACC=`echo $ACCOUNT | cut -d '.' -f1`

#if &#91; $NAME_DOMAIN == $DOMAIN &#93; ;
#Export all LDAP's users
if &#91; $DOMAIN == $DOMAIN &#93; ;
then
OBJECT=&quot;&#40;&&#40;objectClass=zimbraAccount&#41;&#40;mail=$NAME&#41;&#41;&quot;
dn=`/opt/zimbra/bin/ldapsearch -H $LDAP_MASTER_URL -w $ZIMBRA_LDAP_PASSWORD -D uid=zimbra,cn=admins,cn=zimbra -x $OBJECT | grep dn:`


displayName=`/opt/zimbra/bin/ldapsearch -H $LDAP_MASTER_URL -w $ZIMBRA_LDAP_PASSWORD -D uid=zimbra,cn=admins,cn=zimbra -x $OBJECT | grep displayName: | cut -d ':' -f2 | sed 's/^ *//g' | sed 's/ *$//g'`


givenName=`/opt/zimbra/bin/ldapsearch -H $LDAP_MASTER_URL -w $ZIMBRA_LDAP_PASSWORD -D uid=zimbra,cn=admins,cn=zimbra -x $OBJECT | grep givenName: | cut -d ':' -f2 | sed 's/^ *//g' | sed 's/ *$//g'`

userPassword=`/opt/zimbra/bin/ldapsearch -H $LDAP_MASTER_URL -w $ZIMBRA_LDAP_PASSWORD -D uid=zimbra,cn=admins,cn=zimbra -x $OBJECT | grep userPassword: | cut -d ':' -f3 | sed 's/^ *//g' | sed 's/ *$//g'`

cn=`/opt/zimbra/bin/ldapsearch -H $LDAP_MASTER_URL -w $ZIMBRA_LDAP_PASSWORD -D uid=zimbra,cn=admins,cn=zimbra -x $OBJECT | grep cn: | cut -d ':' -f2 | sed 's/^ *//g' | sed 's/ *$//g'`

initials=`/opt/zimbra/bin/ldapsearch -H $LDAP_MASTER_URL -w $ZIMBRA_LDAP_PASSWORD -D uid=zimbra,cn=admins,cn=zimbra -x $OBJECT | grep initials: | cut -d ':' -f2 | sed 's/^ *//g' | sed 's/ *$//g'`

sn=`/opt/zimbra/bin/ldapsearch -H $LDAP_MASTER_URL -w $ZIMBRA_LDAP_PASSWORD -D uid=zimbra,cn=admins,cn=zimbra -x $OBJECT | grep sn: | cut -d ':' -f2 | sed 's/^ *//g' | sed 's/ *$//g'`

	if &#91; $ACC == &quot;admin&quot; &#93; || &#91; $ACC == &quot;wiki&quot; &#93; || &#91; $ACC == &quot;galsync&quot; &#93; || &#91; $ACC == &quot;ham&quot; &#93; || &#91; $ACC == &quot;spam&quot; &#93;; then
    		echo &quot;Skipping system account, $NAME...&quot;
	else
		echo &quot;createAccount $NAME passwordtemp displayName '$displayName' givenName '$givenName' sn '$sn' initials '$initials' zimbraPasswordMustChange FALSE&quot; &gt;&gt; $NAME_FILE

    		echo &quot;$dn
changetype: modify
replace: userPassword
userPassword:: $userPassword
&quot; &gt;&gt; $LDIF_FILE
    		echo &quot;Adding account $NAME&quot;
	fi
else
	echo &quot;Skipping account $NAME&quot;
fi

done
echo -e $ibold&quot;All account has been exported sucessfully into $NAME_FILE and $LDIF_FILE...&quot;$ebold</pre>
		</div><br/> <br/> Tớ đã backup thành công.</span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>


			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td valign="middle" align="right" class="nav"></td>
	</tr>
</table>

<!-- quick reply -->
<table class="forumline" cellspacing="1" cellpadding="3" width="100%" border="0" align="center">
</table>

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="10"></td>
	</tr>
</table>

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td align="left">
			<!-- watch - unwatch -->
			<!-- add bookmark -->

		</td>
		<td align="right" valign="bottom">			
		</td>
	</tr>
</table>

<!-- mod -->

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td colspan="3"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="10"></td>
	</tr>
</table>

<!-- combo navigator -->
<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td align="left"><a href="http://digg.com/submit?phrase=2&url=/hvaonline/posts/list/36780.html"><img src="/hvaonline/templates/viet/images/digg.gif" align="texttop" alt="[digg]" title="[digg]"></a>
<a href="http://del.icio.us/post?url=/hvaonline/posts/list/36780.html"><img src="/hvaonline/templates/viet/images/delicious.gif" align="texttop" alt="[delicious]" title="[delicious]"></a>
<a href="http://www.google.com/bookmarks/mark?op=edit&output=popup&bkmk=/hvaonline/posts/list/36780.html"><img src="/hvaonline/templates/viet/images/google.gif" align="texttop" alt="[google]" title="[google]"></a>
<a href="http://bookmarks.yahoo.com/toolbar/savebm?opener=tb&u=/hvaonline/posts/list/36780.html"><img src="/hvaonline/templates/viet/images/yahoo.gif" align="texttop" alt="[yahoo]" title="[yahoo]"></a>
<a href="http://technorati.com/faves?add=/hvaonline/posts/list/36780.html"><img src="/hvaonline/templates/viet/images/technorati.gif" align="texttop" alt="[technorati]" title="[technorati]"></a>
<a href="http://reddit.com/submit?url=/hvaonline/posts/list/36780.html"><img src="/hvaonline/templates/viet/images/reddit.gif" align="texttop" alt="[reddit]" title="[reddit]"></a>
<a href="http://www.stumbleupon.com/submit?url=/hvaonline/posts/list/36780.html"><img src="/hvaonline/templates/viet/images/stumbleupon.gif" align="texttop" alt="[stumbleupon]" title="[stumbleupon]"></a></td>
		<td align="right">	<table cellspacing="0" cellpadding="0" border="0">
		<tr>			  
			<td nowrap="nowrap">
				<form action="" name="f" id="f" accept-charset="UTF-8">
					<span class="gensmall">Go to:&nbsp;</span>
					<select onchange="if(this.options[this.selectedIndex].value > 0){ document.location = '/hvaonline/forums/show/'+ this.options[this.selectedIndex].value +'.html'; }" name="select">
						<option value="0" selected="selected">Select a forum</option>				
							<option value="0">-------------</option>
									<option value="2" >Thông báo từ HVA</option>
									<option value="41" >FAQ - Các câu hỏi thường gặp</option>
									<option value="5" >Góp ý và Hỏi đáp thắc mắc chung</option>
									<option value="6" >Kiểm tra bảo mật</option>
							<option value="0">-------------</option>
									<option value="8" >Thảo luận bảo mật</option>
									<option value="12" >Thảo luận thâm nhập</option>
									<option value="28" >Thảo luận virus, trojan, spyware, worm...</option>
									<option value="36" >Thủ thuật reverse engineering</option>
									<option value="13" >Thông tin new bugs và exploits</option>
									<option value="51" >Case Studies</option>
							<option value="0">-------------</option>
									<option value="23" >Thảo luận hệ điều hành Windows</option>
									<option value="24" selected="selected">Thảo luận hệ điều hành *nix</option>
									<option value="26" >Thảo luận các loại thiết bị máy tính</option>
									<option value="31" >Thảo luận mạng và thiết bị mạng</option>
									<option value="27" >Thông tin về các địa chỉ và tài liệu hữu ích</option>
							<option value="0">-------------</option>
									<option value="44" >Người tìm việc - Việc tìm người</option>
									<option value="21" >Thảo luận việc định hướng</option>
									<option value="19" >Những thảo luận khác</option>
									<option value="50" >Hình minh họa</option>
									<option value="33" >Trash</option>
							<option value="0">-------------</option>
					</select>
				</form>
			</td>
		</tr>
	</table>
</td>
	</tr>
</table>

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td colspan="3"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="10"></td>
	</tr>
</table>

<!-- list users in -->
<table class="forumline" cellspacing="3" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<th class="thright"  nowrap="nowrap" height="26" valign="middle">&nbsp;Users currently in here&nbsp;</th>
	</tr>
		<tr>
			<td class="gensmall" valign="middle" align="left">
				1 Anonymous 
				
			</td>	
		</tr>
</table>
<a name="quick"></a>

<table cellspacing="0" cellpadding="0" width="100%" border="0"  align="center">

	<tr>	
		<td align="center">
		<br>
					</td>
	</tr>

	<tr>
		<td align="center">
			<span class="copyright">Powered by JForum - Extended by <a href="MailTo:lienlac@hvaonline.net">HVAOnline</a><br>
			&nbsp;hvaonline.net&nbsp; | &nbsp;hvaforum.net&nbsp; | &nbsp;hvazone.net&nbsp; | &nbsp;hvanews.net&nbsp; | &nbsp;vnhacker.org<br>
			1999 - 2013 &copy;
			v2012|0504|218|
		  </span>
	  </td>
	</tr>
<iframe src="/hvaonline/templates/ping_session.html" height="0" width="0" frameborder="0" scrolling="no"></iframe>
</body>
</html>
</table>

<script type="text/javascript" src="/hvaonline/templates/viet/js/post_show.js"></script>
<script type="text/javascript" src="/hvaonline/templates/viet/js/post.js"></script>
<script type="text/javascript" src="/hvaonline/templates/viet/js/avim.js"></script>
<script type="text/javascript">
<!--
function showEmail(beforeAt, afterAt)
{
	return beforeAt + "@" + afterAt;
}

var starOn=new Image();
starOn.src="/hvaonline/templates/viet/images/star_on.gif";

var starOff=new Image();
starOff.src="/hvaonline/templates/viet/images/star_off.gif";

function writeStars(q, postId)
{
	for (var i = 0; i < 5; i++) {
		var name = "star" + postId + "_" + i;
		document.write("<img name='" + name + "' alt='*' />");
		document.images[name].src = q > i ? starOn.src : starOff.src;
	}
}

function addBookmark(relationType, relationId)
{
	var w = window.open('/hvaonline/bookmarks/insert/' + relationType + '/' + relationId + '.html', 'bookmark_add', 'width="700", height="100", scrollbars="no"');
	w.focus();
}

function supportAjax()
{
	if (typeof(AjaxUtils) != 'undefined') {
		if (window.ActiveXObject) {
			var r = new ActiveXObject("Microsoft.XMLHTTP");
			return r != undefined;
		}
		else if (window.XMLHttpRequest) {
			return true;
		}
	}

	return false;
}




function maxImg(foto, maxSize){
w = foto.width;
if (w > maxSize){
	foto.width = maxSize;
	}
} 

-->
</script>
