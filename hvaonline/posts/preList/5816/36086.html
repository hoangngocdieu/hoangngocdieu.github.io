<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"> 

<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="-1">
<meta name="description" content="HVA discussion board">
<meta name="keywords" content="Cơ chế hoạt động và cách cấu hình VPN IP Sec trên router Cisco, jforum, jforum java, jforum forum, forum java, java jforum, java forum, forum, rafael steil, bulletin board, java bb, javabb, hva, hvaonline, hvazone, hvaforum">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="robots" content="index,follow">
<meta name="rating" content="general">
<style type="text/css">
<!-- 
@import url( "/hvaonline/templates/viet/styles/style.css");
-->
</style>
<style type="text/css">
<!--
@import url("/hvaonline/templates/viet/styles/en_US.css");
-->
</style>
<title>Cơ chế hoạt động và cách cấu hình VPN IP Sec trên router Cisco - .:: HVAOnline ::.</title>

</head>
<body class="en_US">


<!--
Original theme from phpBB (http://www.phpbb.com) subSilver
Created by subBlue design
http://www.subBlue.com
Modifications by JForum Team 
Extended and customised by HVA Team
Added more features and Black Silver theme designed by HVA
-->
<table width="100%" border="0" cols="2">
	<tr align="right">
		<td class="copyright">
			English
			| 
			<a href="/hvaonline/jforum.html?module=forums&amp;action=setLang&amp;lang=vi_VN" rel="nofollow">Vietnamese</a>
		</td>
	</tr>
</table>
<table width="100%" border="0">
	<tr>
		<td>
			<table cellspacing="0" cellpadding="0" width="100%" border="0">
				<tr>			
        <td>&nbsp;
			</td>
		
        <td width="100%" align="center" valign="middle">
						<p><a href="" title="[Logo]">
								<img src="/hvaonline/templates/viet/images/hvabanner-final.gif" alt="banner" />
							<br>
            				</a><span class="maintitle"></span>
						</p>
          <table cellspacing="0" cellpadding="2" border="0">
							<tr>
								
              <td valign="top" nowrap="nowrap" align="center">
			  						<a href="/hvaonline/forums/rule.html"><img src="/hvaonline/templates/viet/images/icon_mini_rule.gif" alt="[Rule]" title="[Rule]"></a>
									<a id="rule" class="topmenu" href="/hvaonline/forums/rule.html">Rules</a>&nbsp;
									
									<a class="topmenu" href="/hvaonline/forums/list.html"><img src="/hvaonline/templates/viet/images/icon_mini_groups.gif" alt="[Home]" title="[Home]"></a>
										<a id="backtosite" class="topmenu" href="/hvaonline/forums/list.html">Main Forum</a>&nbsp;

										<a class="topmenu" href="/hvaonline/portal/list.html"><img src="/hvaonline/templates/viet/images/icon_mini_portal.gif" alt="[Portal]" title="[Portal]"></a>
										<a id="portalsite" class="topmenu" href="/hvaonline/portal/list.html">Portal</a>&nbsp;&nbsp;
									<br>
									
										<a href="/hvaonline/user/list.html"><img src="/hvaonline/templates/viet/images/icon_mini_members.gif" alt="[Members]" title="[Members]"></a>
										<a id="users" class="topmenu" href="/hvaonline/user/list.html">Member Listing</a>&nbsp;
										
										<a href="/hvaonline/forums/stats.html"><img src="/hvaonline/templates/viet/images/icon_mini_stats.gif" alt="[Statistics]" title="[Statistics]"></a>
										<a id="stats" class="topmenu" href="/hvaonline/forums/stats.html">Statistics</a>&nbsp;
										
										<a href="/hvaonline/search/filters.html"><img src="/hvaonline/templates/viet/images/icon_mini_search.gif" alt="[Search]" title="[Search]"></a>
										<span class="mainmenu"><a id="search" class="topmenu" href="/hvaonline/search/filters.html"><b>Search</b></a>&nbsp;
									
										<a href="/book/"><img src="/hvaonline/templates/viet/images/icon_mini_book.gif" alt="[Reading Room]" title="[Reading Room]"></a> 
										<a class="topmenu" href="/hvaonline/readingRoom/list.html">Reading Room</a>&nbsp;

									
									<span class="topmenu"> 
										

	
										<br>
											<a id="register" class="topmenu" href="/hvaonline/user/insert.html"><img src="/hvaonline/templates/viet/images/icon_mini_register.gif" border="0" alt="[Register]" title="[Register]"> 
												Register</a>&nbsp;&nbsp;</span>
											<img src="/hvaonline/templates/viet/images/icon_mini_login.gif" border="0" alt="[Login]" title="[Login]"> 
											<strong>Login</strong> [&nbsp;
											<a id="login" class="topmenu" href="/hvaonline/user/login.html">http</a>&nbsp;
											|
											<a id="logins" class="topmenu" href="https://www.hvaonline.net/hvaonline/user/logins.html">https </a>&nbsp;]</span>
								</td>
							</tr>
							<tr>
								<td>&nbsp;</td>
							</tr>
						</table>
					</td>
				</tr>
			</table>
		</td>
	</tr>
	<tr>
		<td>

<!-- navigator -->
<table cellspacing="2" cellpadding="2" width="100%" border="0" align="center">
	<tr>
		<td valign="baseline" align="left" colspan="0">
			<span class="nav">
			<a class="nav" href="/hvaonline/forums/list.html">Forum Index </a> 
			<img src="/hvaonline/templates/viet/images/en_US/arrow.gif"> <a class="nav" href="/hvaonline/forums/show/8.html">Thảo luận bảo mật </a>
			<img src="/hvaonline/templates/viet/images/en_US/arrow.gif"> <a class="nav" href="/hvaonline/posts/list/5816.html" name="top" id="top">Cơ chế hoạt động và cách cấu hình VPN IP Sec trên router Cisco</a>
				&nbsp;<a href="/hvaonline/rss/topicPosts/5816.html"><img src="/hvaonline/templates/viet/images/xml_button.gif" border="0" alt="XML"></a>
			</span>
		
		</td>

		<td valign="middle" align="right" class="nav"></td>
	</tr>
</table>

<!-- poll show -->

  <!-- POST LISTING -->


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#FFFF00">[Document]</font></span>&nbsp;&nbsp; Cơ chế hoạt động và cách cấu hình VPN IP Sec trên router Cisco<a name="34240" id="34240"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">04/01/2007 14:02:59 (+0700) | <a href="/hvaonline/posts/list/5816.html#34240">#1</a> | 34240 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/21000.html"><b>thangdiablo</b></a><br>
	<font color="#3366CC">HVA Friend</font></span>
<br>

<span class="uprofile">
		
</span>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 11/05/2003 17:31:58<br>
		Messages: 734<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/21000.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/21000.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
			<a href="http://vntaekwondo.com" target="_new"><img src="/hvaonline/templates/viet/images/icon_www.gif" alt="[WWW]" title="[www]"></a>
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row1">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row1"><span class="postbody">Đầu xuân năm mới tôi viết 1 TUT để tặng anh em cũng như để có điều kiện trao đổi trau dồi thêm kiến thức với mọi người .<br/> <font color='red'>Bài viết này tôi viết riêng cho HVA do đó mọi việc sao chép vui lòng ghi rõ nguồn từ HVAonline.net</font><br/> <br/> <br/> Bài viết phía dưới là những kiến thức nhỏ bé của tôi muốn chia sẻ và trao đổi cùng các bạn . Trong bài viết tôi đã có gắng hết sức để dùng các từ tiếng Việt thay vì dùng tiếng Anh và nhất thiết sẽ có những sai sót mong các bạn bỏ qua .<br/> Tài liệu tham khảo : Implementing Secure Converged Wide Area Networks của Cisco<br/> <br/> Cơ chế hoạt động và cách cấu hình VPN IP Sec trên router Cisco<br/> <br/> <b><font color='red'><font size='+1'>Phần I Giới thiệu về cơ chế hoạt động của bộ giao thức IPSec<br/> <br/> </font></font></b><br/> <b>1. Giao thức  Ipsec</b> <br/> Ipsec có 3 tầng giao thức chính<br/> -	Internet Key Exchange ( IKE ) : Giúp cho các thiết bị tham gia VPN trao đổi với nhau về thông tin an ninh như mã hóa thế nào ? Mã hóa bằng thuật toán gì ? Bao lâu mã hóa 1 lần . IKE có tác dụng tự động thỏa thuận các chính sách an ninh giữa các thiết bị tham gia VPN . Do đó IKE giúp cho Ipsec có thể áp dụng cho các hệ thống mạng mô hình lớn .<br/>      Trong quá trình trao đổi key IKE dùng thuật toán mã hóa bất đối xứng gồm bộ Public key và Private Key để bảo vệ việc trao đổi key giữa các thiết bị tham gia VPN .<br/> -	Encapsulation Security Payload (ESP) : Có tác dụng xác thực ( authentication ) , mã hóa ( encrytion ) và đảm bảo tính trọn vẹn dữ liệu ( securing of data ) . Đây là giao thức được dùng phổ biến trong việc thiết lập IPSec .<br/> -	Authentication Header ( AH ) :  Có tác dụng xác thực , AH thì thường ít được sử dụng vì nó đã có trong giao thức ESP<br/> <b>2. Ipsec có 2 dạng là</b> : <br/> - Transports mode : Dữ liệu (Layer4 Payload) được mã hóa sẽ nằm trong ESP header và ESP sẽ chèn vào giữa Layer 2 header và layer 3 header<br/> - Tunnel mode : Dữ liệu sẽ được mã hóa và đóng gói thành 1 IP Header mới với source và des IP mới . <br/> <br/> IPSec có những phương pháp mã hóa như DES (Data Encrution Standard) , 3DES , AES (Advance Encrytion Standar)<br/> IPSec có những phương pháp xác thực như HMAC , MD5 , SHA-1<br/> <b><br/> 3. Trước khi trao đổi key để thiết lập 1 kênh truyền ảo (VPN-Ipsec) IPSEC sẽ làm nhiệm vụ là xác thực xem mình đang trao đổi với ai ?</b><br/> Các phương pháp Peer Authentication  :<br/> -	Username password<br/> -	OTP (One time password)<br/> -	Biometric (Xác thực bằng sinh học)<br/> -	Preshared keys<br/> -	Digital certificate (chữ ký số) phương pháp này thường được dùng trong chính phủ điện tử .<br/> <br/> <b>4. Cơ chế hoật động của Internet Key Exchange ( IKE )</b><br/> <br/> Như đã nói ở trên giao thức IKE sẽ có chức năng trao đổi key giữa các thiết bị tham gia VPN và trao đổi chính sách an ninh giữa các thiết bị  . Và nếu không có giao thức này thì người quản trị phải cấu hình thủ công .<br/> Và những chính sách an ninh trên những thiết bị này được gọi là SA (Security Associate)<br/> Do đó các thiết bị trong quá trình IKE sẽ trao đổi với nhau tất cả những SA mà nó có . Và giữa các thiết bị này sẽ tự tìm ra cho mình những SA phù hợp với đối tác nhất<br/> Những key được trao đổi trong quá trình IKE cũng được mã hóa và những key này sẽ thay đổi theo thơi gian (generate key) để tránh tình trạng bruteforce của Attacker .<br/> Và dứoi đây là các giao thức xác thực cũng như mã hóa key trong quá trình IKE<br/> Oakley (Tham khao thêm trên RFC 2412) , ISAKMP (RFC 2408) , Skeme .<br/> Giao thức IKE sử dụng UDP port 500<br/> <br/> <b>5. Các giai đoạn hoạt động của IKE (IKE Phases)</b><br/> - IKE Phases 1 (Bắt buộc xảy ra trong quá trình IKE)<br/> Bước 1 : Xác thực giữa các thiết bị tham gia VPN (Authentication the peers)<br/> Bước 2 : Trao đổi các SA<br/> Và Phases 1 này có 2 chế độ hoạt động là Main mode (Cần 6 mess để hoàn thành các bước 1&2) và Aggressive mode (Cần 3 mess đển hoàn thành  các bước 1&2)<br/> -	IKE Phases 1.5 (Không bắt buộc)<br/> Giao đoạn này có tác dụng cấp phát địa chỉ IP LAN , DNS thông qua DHCP và xác thực User (Authentication User ) . Giao thức được gọi trong quá trình này là Xauth (Extended Authentication)<br/> -	IKE Phases 2 (Bắt buộc phải xảy ra )<br/> Sau khi trải qua Phase 1& 1.5 lúc này giữa các thiết bị đã có đầy đủ các thông tin về nhau như chính sách mã hóa , xác thực ( SA ) và key .<br/> Và nhờ IKE thì giữa các thiết bị đã xây dựng được 1 kênh truyền ảo an ninh .<br/> Đến đây giữa các thiết bị lại tiếp tục trao đổi cho nhau 1 SA khác ( mọi người chú ý khúc này ) . <br/> Cái SA được trao đổi lúc này là chính sách của giao thức Ipsec (chính sách an ninh đóng gói dự liệu ) nó khác với SA của giao thức IKE ( làm thế nào để xây dựng 1 kênh an toàn ) .<br/> Cái SA của Ipsec này nó sẽ trao đổi với nhau việc mã hóa đóng gói dự liệu theo ESP hay AH , nó hoạt động theo dạng tunel mode hay transports mode , thời gian mã hóa là bao lâu ? . <br/> Đây là mã hóa dự liệu chứ không còn là mã hóa trao đổi khóa (key) như diễn ra trong quá trình IKE . <br/> Đến lúc này nếu muốn trao đổi với ai thì nó sẽ trao đổi SA IPSec với người đó và dữ liệu được gửi trên đường truyền được mã hóa dựa vào SA Ipsec này<br/>      <br/>        Vậy là trong phần 5 tôi đã trình bày 3 bước chính để tạo ra 1 kênh truyền ảo an ninh      (VPN Ipsec)<br/>       <br/> <b><br/> 6 .Các chức năng khác của IKE giúp cho IKE hoạt động tối ưu hơn bao gồm</b> :<br/> -	Dead peer detection ( DPD ) and Cisco IOS keepalives là những chức năng bộ đếm thời gian . Nghĩa là sau khi 2 thiết bị đã tạo được VPN IPsec với nhau rồi thì nó sẽ thường xuyên gửi cho nhau gói keepalives để kiểm tra tình trạng của đối tác . Mục đích chính để phát hiện hỏng hóc của các thiết bị . Thông thường các gói keepalives sẽ gửi mỗi 10s<br/> -	Hỗ trợ chức năng NAT-Traversal : Chức năng này có ý nghĩa là nếu trên đường truyền từ A tới B nếu có những thiết bị NAT or PAT đứng giữa thì lúc này IPSec  nếu hoạt động ở chế độ tunel mode và enable chức năng NAT- Trasersal sẽ vẫn chuyển gói tin đi được bình thường .<br/>        Tại sao IPSec chỉ hoạt động ở tunel mode mà không hoạt động ở tranports mode thì tôi sẽ giải thích kỹ trong những đoạn sau .<br/> <b><font color='red'>Lưu ý</font></b> : Chức năng NAT-T bắt đầu được Cisco hỗ trợ tự phiên bản IOS Release 122.2(13)T       <br/> <br/> Tại sao phải hỗ trợ chức năng NAT-T thì các packet mới tiếp tục đi được ?<br/> Các bạn chú ý phần trên tôi đã trình bày . Khi thực hiện quá trình mã hóa bằng ESP thì lúc này các source IP , port và destination IP, port đều đã được mã hóa và nằm gọn tron ESP Header . Như vậy khi tất cả các thông tin IP và Port bị mã hóa thì kênh truyền IPSec không thể diễn ra quá trình NAT . <br/> Do đó NAT Traversal ra đời trong quá trình hoạt động của IKE nhằm phát hiện và hỗ trợ NAT cho Ipsec .<br/> Các dự liệu sẽ không bị đóng gói trực tiếp bỏi giao thức IP mà nó sẽ đóng gói thông qua giao thức UDP . Và lúc này các thông tin về IP và Port sẽ nằm trong gói UDP này .<br/> -	Chức năng Mode Configuration :<br/>  Chức năng này có tác dụng pushing các chính sách bảo mật cũng như thông tin về IP , DNS , Gateway cho người dùng di động khi họ quay VPN vào  hệ thống .<br/> Ngoài ra Cisco có cung cấp giải pháp cho việc này đó là Easy VPN . Nhưng trong phạm vi bài này tôi sẽ không đi sâu về vấn đề này .<br/> -	Chức năng cuối cùng IKE hỗ trợ mà tôi muốn giới thiệu với các bạn đó là Xauth ( Tôi đã giới thiệu sơ trong phares 1.5 ) <br/> Xauth sẽ cho phép phương thức AAA (Authentication , Authorization , Accounting) hoạt động đối với việc xác thực user . Các bạn cũng nên lưu ý phần này . Xauth không đè lên IKE mà việc xác thực của giao thức Xauth này là xác thực người dùng chứ không phải quá trình xác thực diễn ra trong Phares 1<br/> <br/> Như vậy trong phần I tôi đã giới thiệu cơ chế hoạt động của VPN Ipsec và đi sâu vào bộ giao thức đầu tiên là IKE . Trong các phần kế tiếp tôi sẽ trình bày kỹ hơn về cơ chế hoạt động của ESP và AH . Sau đó là cấu hình Router trong 1 sơ đồ cụ thể .<br/> Hy vọng bài viết này sẽ giúp các bạn hiểu hơn phần nào về giao thức IP Sec và cách thiết lập VPN Ipsec sẽ được trình bày ở các phần kế tiếp ......<br/> <br/> <b>Thangdiablo</b>  <img src="/hvaonline/images/smilies/6c6e754a49e0a0e3966b3ee6fcf8714d.gif" border="0" alt="smilie" align="absbottom"> </span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>

		  <tr>
			<td height="20" colspan="2" valign="bottom" class="rowButton"><span class="gensmall">Hãy sống có Tuệ Giác.</span></td>
		  </tr>

			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Cơ chế hoạt động và cách cấu hình VPN IP Sec trên router Cisco<a name="34247" id="34247"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">04/01/2007 14:39:26 (+0700) | <a href="/hvaonline/posts/list/5816.html#34247">#2</a> | 34247 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/124987.html"><b>Mr.Khoai</b></a><br>
	<font color="#FF9900">Moderator</font></span>
<br>

<span class="uprofile">
		
</span>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 27/06/2006 01:55:07<br>
		Messages: 954<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/124987.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/124987.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row2">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row2"><span class="postbody">khoai xin phép có vài ý kiến về bài viết của anh thangdiablo:<br/> <br/> 1. Mã hóa đối xứng là <b>symmetric </b> encryption, không phả symmetrical :~)<br/> 2. Bước IKE theo khoai nghĩ là một bước <b>phải làm</b> để trao đổi khóa. Và bước này sẽ diễn ra trước khi chọn một trong 2 protocols ESP hoặc AH, và một trong 2 mode transport hay tunnel. Cá nhân khoai anh thangdiablo không nên liệt chung IKE và ESP, AH để tránh gây cảm nhận là 3 protocols này ở cùng một "level".<br/> <br/> Cám ơn anh thangdiablo, bài viết rất chi tiết.<br/> <br/> khoai</span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>


			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Cơ chế hoạt động và cách cấu hình VPN IP Sec trên router Cisco<a name="34292" id="34292"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">04/01/2007 23:36:23 (+0700) | <a href="/hvaonline/posts/list/5816.html#34292">#3</a> | 34292 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>
<td width="20">
		<img src="/hvaonline/images/avatar/b53a60644f901c10f27c27e8f8937f97.jpg" border="0" alt="[Avatar]" title="[Avatar]"><br>
	</td>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/130388.html"><b>hoalacanh</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 03/09/2006 16:01:23<br>
		Messages: 51<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/130388.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/130388.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row1">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row1"><span class="postbody">chào Anh thangdiablo Pro!!! bài viết mới chỉ bắt đầu nhưng rất hay. mình hy vọng được học hỏi nhiều ở topic này. xin cảm ơn</span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>


			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Cơ chế hoạt động và cách cấu hình VPN IP Sec trên router Cisco<a name="34357" id="34357"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">05/01/2007 04:54:15 (+0700) | <a href="/hvaonline/posts/list/5816.html#34357">#4</a> | 34357 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>
<td width="20">
		<img src="/hvaonline/images/avatar/6f4b7fd3eea0af87f9990faa8e3287f1.png" border="0" alt="[Avatar]" title="[Avatar]"><br>
	</td>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/9480.html"><b>dabu</b></a><br>
	<font color="#33CC33">Elite Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 03/03/2003 03:31:20<br>
		Messages: 226<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/9480.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/9480.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row2">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row2"><span class="postbody">Dù chưa hiểu hết nhưng thấy rất hay và có ích !!! Tiếp đi lão <img src="/hvaonline/images/smilies/068ae40523a24c9ef54edefd375e542d.gif" border="0" alt="smilie" align="absbottom">)</span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>

		  <tr>
			<td height="20" colspan="2" valign="bottom" class="rowButton"><span class="gensmall">It's time to build a new network.</span></td>
		  </tr>

			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Cơ chế hoạt động và cách cấu hình VPN IP Sec trên router Cisco<a name="34475" id="34475"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">05/01/2007 14:14:40 (+0700) | <a href="/hvaonline/posts/list/5816.html#34475">#5</a> | 34475 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/21000.html"><b>thangdiablo</b></a><br>
	<font color="#3366CC">HVA Friend</font></span>
<br>

<span class="uprofile">
		
</span>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 11/05/2003 17:31:58<br>
		Messages: 734<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/21000.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/21000.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
			<a href="http://vntaekwondo.com" target="_new"><img src="/hvaonline/templates/viet/images/icon_www.gif" alt="[WWW]" title="[www]"></a>
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row1">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row1"><span class="postbody"><p></p>
		<cite class="blockquote">Mr.Khoai wrote:</cite><br>
		<blockquote>khoai xin phép có vài ý kiến về bài viết của anh thangdiablo:<br/> <br/> 1. Mã hóa đối xứng là <b>symmetric </b> encryption, không phả symmetrical :~)<br/> 2. Bước IKE theo khoai nghĩ là một bước <b>phải làm</b> để trao đổi khóa. Và bước này sẽ diễn ra trước khi chọn một trong 2 protocols ESP hoặc AH, và một trong 2 mode transport hay tunnel. Cá nhân khoai anh thangdiablo không nên liệt chung IKE và ESP, AH để tránh gây cảm nhận là 3 protocols này ở cùng một "level".<br/> <br/> Cám ơn anh thangdiablo, bài viết rất chi tiết.<br/> <br/> khoai&nbsp;
		</blockquote><br/> <br/> Hello Mr.Khoai phần 1 và 2 tớ viết là giới thiệu các chồng giao thức tồn tại trong IPSec . Tớ đã sắp xếp thứ tự các giao thức ESP và AH nằm dưới IKE .<br/> <br/> Và tớ cũng có ghi rõ quá trình IKE là <b>quá trình bắt buộc</b> phải xảy ra trước khi diễn ra quá trình mã hóa gói dữ liệu .<br/> Có điều trong quá trình diễn ra của IKE cụ thể là giữa Phases 1 và 2 thì có Phases 1.5 xen vào giữa .<br/> Quá trình Phases 1.5 này là quá trình Xauth (AAA) và đẩy pusing các thông tin cấu hình cho user .<br/> Do đó nó có thể xảy ra hay không xảy ra là tuy thuộc vào tình hình cụ thể và quyết định của admin.<br/> <br/> Thanks Mr Khoai đã góp ý .<br/> <br/> Các phần kế tiếp sẽ có những cấu hình cụ thể và các debug cụ thể . Hy vọng sẽ có nhiều cái để bàn .<br/> Thân mên </span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>

		  <tr>
			<td height="20" colspan="2" valign="bottom" class="rowButton"><span class="gensmall">Hãy sống có Tuệ Giác.</span></td>
		  </tr>

			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Re: Cơ chế hoạt động và cách cấu hình VPN IP Sec trên router Cisco<a name="34986" id="34986"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">08/01/2007 15:35:25 (+0700) | <a href="/hvaonline/posts/list/5816.html#34986">#6</a> | 34986 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/21000.html"><b>thangdiablo</b></a><br>
	<font color="#3366CC">HVA Friend</font></span>
<br>

<span class="uprofile">
		
</span>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 11/05/2003 17:31:58<br>
		Messages: 734<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/21000.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/21000.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
			<a href="http://vntaekwondo.com" target="_new"><img src="/hvaonline/templates/viet/images/icon_www.gif" alt="[WWW]" title="[www]"></a>
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row2">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row2"><span class="postbody"><font color='red'><b>Bài viết này tôi viết riêng cho HVA do đó mọi việc sao chép vui lòng ghi rõ nguồn từ HVAonline.net </b></font><br/> <br/> <font color='red'><font size='+1'>Phần 2 Cơ chế hoạt động của 2 protocol ESP và AH</font></font><br/> <br/> Bộ giao thức Ipsec thì ngoài IKE còn có ESP và AH là 2 giao thức chính trong việc mã hóa&xác thực dữ liệu .<br/> <br/> <b>1.	Khái  quát </b><br/> <br/> ESP sử dụng IP protocol number là 50 (ESP được đóng gói bởi giao thức IP và trường protocol trong IP là 50 )<br/> AH sử dụng IP protocol number là 51 (AH được đóng gói bởi giao thức IP và trường protocol trong IP là 51 )<br/> <br/> Bộ giao thức Ipsec hoạt động trên 2 mode chính là Tunel Mode và Transport Mode<br/> - Tunel Mode<br/> Khi bộ giao thức Ipsec hoạt động ở mode này thì sau khi đóng gói dữ liệu và giao thức ESP mã hóa toàn bộ payload , frame header , ip header thì nó sẽ thêm 1 IP header mới và gói packet trước khi forward đi .<br/> - Transports Mode<br/>  Khi bộ giao thức Ipsec hoạt động ở mode này thì IP header vẫn được giữ nguyên và lúc này giao thức ESP sẽ chèn vào giữa payload và IP header của gói tin .<br/> Giao thức này rất hay được sử dụng khi những người quản trị mạng có tạo thêm 1 tunnel GRE (Generic Routing Encapsulation) . Còn tunnel GRE là gì tôi sẽ giải thích trong một TUT khác .<br/> Tất cả gói tin được mã hóa bởi Ipsec đều là khóa đối xứng (symetric key) <br/> <br/> <b>2. Tổng quan ESP và AH Header<br/> </b><br/> <br/> bmuht_gpj.00012_cc25e0917bf944b611f306de4a8b002a/8/1/7002/daolpu/enilnoavh/ten.enilnoavh//:ptth<br/> <br/> <br/> Đây là hình minh họa việc đóng gói dự liệu bằng 2 protocol Esp và AH .<br/> Trên cùng là gói dữ liệu nguyên thủy bao gồm Data và Ip Header . <br/> <br/> -	Nếu sử dụng giao thức ESP :<br/> Thì giao thức ESP sẽ làm công việc là mã hóa ( encryption ) , xác thực ( authentication ) , bảo đảm tính trọn vẹn của dữ liệu ( Securing of data ) . Sau khi đóng gói xong bằng ESP mọi thông tin về mã hóa và giải mã sẽ nằm trong ESP Header .<br/> Các thuật toán  mã hóa bao gồm DES , 3DES , AES <br/> Các thuật toán để xác thực bao gồm MD5 hoặc SHA-1<br/> ESP còn cung cấp tính năng anti-relay để bảo vệ các gói tin bị ghi đè lên nó.<br/> <br/> -	Nếu sử dụng giao thức AH<br/> Thì giao thức AH chỉ làm công việc xác thực ( authentication ) và bảo đảm tính trọn vẹn dự liệu . Giao thức AH không có chức năng mã hóa dự liệu . Do đó AH ít được dùng trong IPSec vì nó không đãm bảo tính an ninh .<br/> <br/> <b>3 . AH xác thực và đảm bảo tính trọn vẹn dự liệu </b><br/> <br/> Dưới đây là hình minh họa về cơ chế xác thực của giao thứ AH <br/> <br/> [img]http:/bmuht_gpj.00012_f307be307198a0fd9501671f45089a92/8/1/7002/daolpu/enilnoavh/ten.enilnoavh//:ptthr/&gt; Bước thứ 1 : Giao thức AH sẽ đem gói dữ liệu ( packet ) bao gồm payload + Ip header + Key <br/> Cho chạy qua 1 giải thuật gọi là giải thuật Hash và cho ra 1 chuỗi số . Các bạn nhớ đây là giải thuật 1 chiều , nghĩa là từ gói dữ liệu + key = chuỗi số . Nhưng từ chuỗi số không thể hash ra = dữ liệu + key <br/> Và chuỗi số này sẽ đuợc gán vào AH header .<br/> <br/> Bước thứ 2 : AH Header này sẽ được chèn vào giữa Payload và Ip Header và chuyển sang phía bên kia .<br/> Đương nhiên các bạn cũng nhớ cho rằng việc truyền tải gói dự liệu này đang chạy trên 1 tunel mà trước đó quá trình IKE sau khi trao đổi khóa đã tạo ra .<br/> <br/> Bước thứ 3 : Router đích sau khi nhận được gói tin này bao gồm IP header + AH header + Payload sẽ được chạy qua giải thuật Hash 1 lần nữa để cho ra 1 chuỗi số .<br/> <br/> Bước thứ 4 : So sánh chuỗi số nó vừa tạo ra và chuỗi số của nó nếu giống nhau thì nó sẽ chấp nhận gói tin .<br/> Nếu trong quá trình truyền gói dữ liệu 1 attacker sniff nói tin và chỉnh sửa nó dẫn đến việc gói tin bị thay đổi về kích cỡ , nội dung thì khi đi qua quá trình hash sẽ cho ra 1 chuỗi số khác chuỗi số ban đầu mà router đích đang có . Do đó gói tin sẽ bị drop<br/> <br/> Thuật toán hash bao gồm MD5 và SHA-1<br/> Và trong trừong hợp này IPSec đang chạy ở chế độ trasports mode .<br/> <br/> <b>4 . Giao thức ESP</b><br/>  Phía dưới đây là cơ chế mã hóa gói dữ liệu bằng giao thức ESP<br/> <br/> [img]http://hvaonline.bmuht_gpj.00012_9ff8ac38d93b61a8a394d6a1042bc958/8/1/7002/daolpu/enilnoavh/ten.enilnoavh//:ptthEsp là giao thức hỗ trợ cả xác thực và mã hóa .<br/> <br/> Phía trên là gói dự liệu ban đầu và ESP sẽ dùng 1 cái key để mã hóa toàn bộ dữ liệu ban đầu . Và trường hợp trên là Ipsec đang chạy ở chế độ Tunel mode nên ngoài ESP header ra nó sẽ sinh ra 1 Ip Header mới không bị mã hóa để có thể truyền  đi trong mạng Internet .<br/> <br/> Như vậy trong phần này tôi đã giới thiệu với các bạn về cơ chế hoạt động của 2 protocol ESP và AH .<br/> Các bạn lưu ý quá trình xác thực và mã hóa của ESP và AH chỉ diễn ra sau khi quá trình IKE hòan thành. <br/> Ở chương này tôi không muốn đi sâu vào phân tích các thuật toán mã hóa vì mục đích của tôi trong TUT này là trình bày cho các bạn hiểu cơ chế hoạt động của IPSEC và cách cấu hình IPSEC VPN trên Router Cisco .<br/> <br/> Phần cấu hình sẽ được trình bày ở phần 3<br/> Còn tiếp ….<br/>  <img src="/hvaonline/images/smilies/6c6e754a49e0a0e3966b3ee6fcf8714d.gif" border="0" alt="smilie" align="absbottom"> </span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>

		  <tr>
			<td height="20" colspan="2" valign="bottom" class="rowButton"><span class="gensmall">Hãy sống có Tuệ Giác.</span></td>
		  </tr>

			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Re: Cơ chế hoạt động và cách cấu hình VPN IP Sec trên router Cisco<a name="35471" id="35471"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">11/01/2007 04:02:36 (+0700) | <a href="/hvaonline/posts/list/5816.html#35471">#7</a> | 35471 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/94689.html"><b>prof</b></a><br>
	<font color="#FF9900">Moderator</font></span>
<br>

<span class="uprofile">
		
</span>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 23/11/2004 01:08:55<br>
		Messages: 205<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/94689.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/94689.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row1">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row1"><span class="postbody">Hello thangdiablo,<br/> <br/> Bài viết của bạn rất hay. Tuy nhiên, có một số điểm, <i>prof</i> nghĩ, nếu được đào sâu thêm một chút, sẽ hoàn thiện hơn. <br/> <br/> <blockquote><br/>  - Nếu sử dụng giao thức ESP :<br/> Thì giao thức ESP sẽ làm công việc là mã hóa ( encryption ) , xác thực ( authentication ) , bảo đảm tính trọn vẹn của dữ liệu ( Securing of data ) . Sau khi đóng gói xong bằng ESP mọi thông tin về mã hóa và giải mã sẽ nằm trong ESP Header .<br/> Các thuật toán mã hóa bao gồm DES , 3DES , AES<br/> Các thuật toán để xác thực bao gồm MD5 hoặc SHA-1<br/> ESP còn cung cấp tính năng anti-relay để bảo vệ các gói tin bị ghi đè lên nó. <br/> <br/> - Nếu sử dụng giao thức AH<br/> Thì giao thức AH chỉ làm công việc xác thực ( authentication ) và bảo đảm tính trọn vẹn dự liệu . Giao thức AH không có chức năng mã hóa dự liệu . Do đó AH ít được dùng trong IPSec vì nó không đãm bảo tính an ninh .<br/> &nbsp;
		</blockquote><br/> Lý do AH có khả năng cung cấp cơ chế xác thực và bảo đảm tính toàn vẹn (integrity) của dữ liệu là vì AH Header chứa một "chữ ký số" <font color='orange'>-1-</font> được gọi là giá trị kiểm tra tính toàn vẹn <b>(Integrity Check Value-ICV)</b>. Thực chất nó là một giá trị băm được dùng để kiểm tra xem liệu gói tin có bị thay đổi trên đường truyền hay không. Vì AH sử dụng IP header để tính toán ICV nên chúng ta có thể chắc chắn rằng địa chỉ nguồn của gói tin là xác thực và gói tin này xuất phát từ đúng nơi gửi. <br/> <br/> Hơn nữa, AH cũng sử dụng các giá trị <b>sequence number</b> hỗ trợ việc chống lại kiểu tấn công phát lại <b>(replay attack)</b>. Vì các thiết bị truyền thông sử dụng giá trị này để theo dõi dòng dữ liệu trao đổi, một kẻ tấn công với ý định chiếm quyền truy cập vào VPN không thể gửi lại gói tin mà hắn "bắt" được.<br/> <br/> Ngoài ra, một vấn đề cần lưu tâm ở đây, đó là AH xác thực gói tin dựa vào thông tin IP header. Do vậy, nó sẽ không tương thích với các thay đổi do cơ chế NAT mang lại. Vì giá trị ICV của AH đã được tính toán trước NAT nên khi gói tin được gửi tới đích, việc kiểm tra tính toàn vẹn sẽ thất bại(!)<br/> <br/> Mặt khác, vì AH không hỗ trợ bảo vệ tính mật <b>(confidentiality)</b> của dữ liệu trong các gói tin, nên nó sẽ không phải thực hiện tính toán nhiều để mã hoá các gói tin, do đó công việc xử lý và đóng gói các gói tin sẽ dễ dàng và nhanh chóng hơn. Đây là những đặc điểm góp phần làm cho AH trở thành một giải pháp hợp lý cho những nơi chỉ cần bảo toàn và xác thực thông tin địa chỉ IP và cần hiệu năng cao. <img src="/hvaonline/images/smilies/b5e9b4f86ce43ca65bd79c894c4a924c.gif" border="0" alt="smilie" align="absbottom"><br/> <br/> Để có thể xem thông tin chi tiết về một AH packet, bạn có thể dùng <b>tcpdump</b> để thu bắt thông tin về AH traffic. Khi đó, bạn sẽ thấy phần payload của gói tin sẽ không được mã hoá vì AH không hỗ trợ cơ chế này. <img src="/hvaonline/images/smilies/b5e9b4f86ce43ca65bd79c894c4a924c.gif" border="0" alt="smilie" align="absbottom"><br/> <br/> <blockquote><br/> ....<br/> <b>4 . Giao thức ESP</b><br/>  Phía dưới đây là cơ chế mã hóa gói dữ liệu bằng giao thức ESP<br/> <br/> Esp là giao thức hỗ trợ cả xác thực và mã hóa .<br/> <br/> Phía trên là gói dự liệu ban đầu và ESP sẽ dùng 1 cái key để mã hóa toàn bộ dữ liệu ban đầu . Và trường hợp trên là Ipsec đang chạy ở chế độ Tunel mode nên ngoài ESP header ra nó sẽ sinh ra 1 Ip Header mới không bị mã hóa để có thể truyền  đi trong mạng Internet .<br/> <br/> ....<br/> &nbsp;
		</blockquote><br/> Cách thức hoạt động của ESP có khác biệt đôi chút phụ thuộc vào chế độ làm việc của IPSec. Trong chế độ Transport, ESP chỉ đơn thuần thêm phần header của bản thân nó vào sau phần IP header và mã hoá toàn bộ phần còn lại của gói tin từ tầng 4 trở lên. Nếu trong quá trình thương lượng khởi tạo một IPSec connection có chỉ định sử dụng dịch vụ xác thực của ESP, khi đó ESP sẽ thêm một phần (trailer) chứa thông tin <b>ICV</b> để đảm bảo tính toàn vẹn và tính xác thực. <b><i>Không giống với AH, ESP ICV không tính toán dựa trên các thông tin về IP header.</i></b><br/> <br/> ESP là giải pháp cho phép IPSec chạy trên hệ thống có xảy ra quá trình NAT với điều kiện IPSEC được thiết lập ở chế độ tunnel <font color='orange'>-2-</font>. Tuy nhiên trong chế độ <i>transport</i>, ESP và NAT không tương thích với nhau vì các thông tin của phần header của gói tin đã bị NAT thay đổi. Khi NAT thực hiện thay đổi phần thông tin về IP, nó cũng sẽ tính lại giá trị <b>checksum</b> trong TCP header. Và bởi vì TCP checksum được tính toán không chỉ dựa vào TCP header, mà nó còn dựa vào các thông tin từ IP header, như địa chỉ nguồn/đích của gói tin nên NAT đã phá vỡ tính toàn vẹn của gói tin. Trong chế độ Transport ESP, toàn bộ TCP header đã được mã hoá, NAT box sẽ không thể tính toán lại TCP checksum. (Vấn đề tương tự đối với UDP packets khi UDP checksum được tính đến). Kết quả là trước khi giải mã, gói tin sẽ bị hủy vì không bảo đảm tính toàn vẹn. Vấn đề này có thể được giải quyết nếu như không đụng đến TCP checksum trong mọi trường hợp. <img src="/hvaonline/images/smilies/b5e9b4f86ce43ca65bd79c894c4a924c.gif" border="0" alt="smilie" align="absbottom"><br/> <br/> Trong chế độ <i>Tunnel ESP</i>, NAT hoàn toàn được tương thích vì toàn bộ gói tin nguồn bao gồm các thông tin về IP và thông tin ở tầng 4 được đóng gói và do đó không bị xử lý bởi NAT. Vì thông tin về IP, TCP header, TCP checksum không bị thay đổi trong chế độ Tunnel ESP nên gói tin sẽ được giải mã và thoả mãn tính toàn vẹn. Tuy nhiên, mặc dù ESP traffic trong chế độ Tunnel có thể tương thích với NAT, bạn sẽ gặp phải các vấn đề liên quan đến NAT khi thương lượng các tham số cho IPSec connection. Chẳng hạn, <b><i>one-to-many NAT</i></b> (thường được hiểu là <b>PAT</b>) sẽ sửa đổi tham số cổng nguồn của một <b>outbound IKE packet</b>, dẫn đến giá trị cổng UDP 500 dành cho IKE bị thay đổi, từ đó dẫn đến việc thất bại khi phân phối khoá cho các tham số của IPSec session.<br/> <br/> Một vấn đề còn đang tranh cãi nữa là khả năng xác thực của ESP. Như ta đã biết, ESP có khả năng cung cấp cơ chế xác thực, nhưng giá trị băm mà nó sử dụng được sinh ra dựa trên toàn bộ gói tin ngoại trừ phần IP header và phần authentication trailer. Điều này giúp cho ESP authentication tương thích với NAT, nhưng việc thiếu xác thực của IP header sẽ không đảm bảo được nguồn gốc của gói tin. May thay, trong hầu hết các cài đặt, việc kiểm tra tính xác thực cho phần IP payload <font color='orange'>-3-</font> cũng đủ để nói lên nguồn gốc của gói tin này! <img src="/hvaonline/images/smilies/b5e9b4f86ce43ca65bd79c894c4a924c.gif" border="0" alt="smilie" align="absbottom"><br/> <br/> Chúc vui.<br/> <br/> -------------<br/> <font color='orange'>-1-</font> và <font color='orange'>-3-</font>: chỉnh sửa theo góp ý của <i>alice.</i><br/> <font color='orange'>-2-</font>: chỉnh sửa theo góp ý của <i>father_nghia_den.</i></span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>


			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Re: Cơ chế hoạt động và cách cấu hình VPN IP Sec trên router Cisco<a name="35569" id="35569"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">11/01/2007 12:53:48 (+0700) | <a href="/hvaonline/posts/list/5816.html#35569">#8</a> | 35569 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>
<td width="20">
		<img src="/hvaonline/images/avatar/13485a8da3233f114113e29f6bf6b7db.png" border="0" alt="[Avatar]" title="[Avatar]"><br>
	</td>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/100666.html"><b>alice</b></a><br>
	<font color="#33CC33">Elite Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 20/01/2005 22:23:24<br>
		Messages: 87<br>
	
		Location: Wonderland<br>
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/100666.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/100666.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row2">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row2"><span class="postbody">Bài bổ sung của <b>prof</b> rất tốt, alice chỉ nghĩ có thể bài viết sẽ dễ hiểu hơn nếu thay đổi vài điểm về thuật ngữ. <img src="/hvaonline/images/smilies/575eda61e93c7ad9d05928580213fd9b.gif" border="0" alt="smilie" align="absbottom">)<br/> <br/>  <p></p>
		<cite class="blockquote">prof wrote:</cite><br>
		<blockquote>Lý do AH có khả năng cung cấp cơ chế xác thực và bảo đảm tính toàn vẹn (integrity) của dữ liệu là vì AH Header chứa một chữ ký số <b>(Digital Signature - DS)</b> được gọi là giá trị kiểm tra tính toàn vẹn <b>(Integrity Check Value-ICV)</b>. Thực chất nó là một giá trị băm được dùng để kiểm tra xem liệu gói tin có bị thay đổi trên đường truyền hay không. Vì AH sử dụng IP header để tính toán DS nên chúng ta có thể chắc chắn rằng địa chỉ nguồn của gói tin là xác thực và gói tin này xuất phát từ đúng nơi gửi. &nbsp;
		</blockquote>Dùng từ ICV là đủ, tránh dùng từ DS. ICV nói chung không phải là DS và thực tế không phải là DS.<br/> <br/> <br/> <p></p>
		<cite class="blockquote">prof wrote:</cite><br>
		<blockquote>Cách thức hoạt động của ESP có khác biệt đôi chút phụ thuộc vào chế độ làm việc của IPSec. Trong chế độ Transport, ESP chỉ đơn thuần thêm phần header của bản thân nó vào sau phần IP header và mã hoá toàn bộ phần còn lại của gói tin từ tầng 4 trở lên. Nếu trong quá trình thương lượng khởi tạo một IPSec connection có chỉ định sử dụng dịch vụ xác thực của ESP, khi đó ESP sẽ thêm một phần (trailer) chứa thông tin <b>ICV</b> để đảm bảo tính toàn vẹn và tính xác thực. <b><i>Không giống với AH, ESP ICV không tính toán dựa trên các thông tin về IP header.</i></b><br/> <br/> ESP thường được xem như là sự kết hợp của <font color='yellow'>IPSec</font> với NAT. ESP thường được sử dụng trong chế độ <i>tunnel</i>. Tuy nhiên trong chế độ <i>transport</i>, ESP và NAT không tương thích với nhau vì các thông tin của phần header của gói tin đã bị NAT thay đổi. Khi NAT thực hiện thay đổi phần thông tin về IP, nó cũng sẽ tính lại giá trị <b>checksum</b> trong TCP header. Và bởi vì TCP checksum được tính toán không chỉ dựa vào TCP header, mà nó còn dựa vào các thông tin từ IP header, như địa chỉ nguồn/đích của gói tin nên NAT đã phá vỡ tính toàn vẹn của gói tin. Trong chế độ Transport ESP, toàn bộ TCP header đã được mã hoá, NAT box sẽ không thể tính toán lại TCP checksum. (Vấn đề tương tự đối với UDP packets khi UDP checksum được tính đến). Kết quả là trước khi giải mã, gói tin sẽ bị hủy vì không bảo đảm tính toàn vẹn. Vấn đề này có thể được giải quyết nếu như không đụng đến TCP checksum trong mọi trường hợp. <img src="/hvaonline/images/smilies/b5e9b4f86ce43ca65bd79c894c4a924c.gif" border="0" alt="smilie" align="absbottom">&nbsp;
		</blockquote>Chỗ <font color='yellow'>IPSec màu vàng</font> có vẻ khó hiểu. Đối tượng đang được giải thích là IPSEC. ESP là một phần của IPSEC. Sẽ không hợp lý lắm khi đem IPSEC để giải thích ESP.<br/> <br/> Khi đưa TCP/UDP vào cuộc, cũng nên nói rõ hoàn cảnh sử dụng là <font color='yellow'>ESP bao bọc TCP/UDP</font>. Để phân biệt với hoàn cảnh <font color='yellow'>UDP bao bọc ESP</font> (NAT-T) mà loạt bài sẽ nói đến về sau.<br/> <br/> <br/> <p></p>
		<cite class="blockquote">prof wrote:</cite><br>
		<blockquote>Trong chế độ <i>Tunnel ESP</i>, <b><font color='yellow'>NAT</font></b> hoàn toàn được tương thích vì toàn bộ gói tin nguồn bao gồm các thông tin về IP và thông tin ở tầng 4 được đóng gói và do đó không bị xử lý bởi NAT. Vì thông tin về IP, TCP header, TCP checksum không bị thay đổi trong chế độ Tunnel ESP nên gói tin sẽ được giải mã và thoả mãn tính toàn vẹn. Tuy nhiên, mặc dù ESP traffic trong chế độ Tunnel có thể tương thích với NAT, bạn sẽ gặp phải các vấn đề liên quan đến <font color='yellow'>NAT</font> khi thương lượng các tham số cho IPSec connection. Chẳng hạn, <b><i>one-to-many NAT</i></b> (thường được hiểu là <b>PAT</b>) sẽ sửa đổi tham số cổng nguồn của một <b>outbound IKE packet</b>, dẫn đến giá trị cổng UDP 500 dành cho IKE bị thay đổi, từ đó dẫn đến việc thất bại khi phân phối khoá cho các tham số của IPSec session.&nbsp;
		</blockquote><br/> Đoạn này có thể xem như có 2 phần:<br/> <br/> Phần <font color='yellow'>NAT màu vàng thứ nhất</font> nói về tính tương thích của NAT với ESP. Ở đây nên làm rõ thêm từ NAT bởi một từ khác (thí dụ, <font color='yellow'>basic NAT</font> theo tự điển wikipedia), ngụ ý rằng ở đây chỉ có dịch địa chỉ mà thôi. Cũng nên nói rõ thêm NAT trong trường hợp chung (bao hàm PAT) với ESP trong chế độ tunnel là <font color='yellow'>không tương thích</font> bởi vì khác với TCP/UDP, ESP không có khái niệm "cổng". Như thế người đọc sẽ không phải thắc mắc đại loại như <font color='yellow'>nếu ESP tunnel và NAT đã tương thích với nhau, tại sao phải dùng UDP bao bọc ESP để có NAT-T?</font><br/> <br/> Phần <font color='yellow'>NAT màu vàng thứ hai</font> nói về tính tương thích của NAT với IKE, cũng nên nói rõ hơn một chút (nhưng chính alice cũng chưa biết nói thế nào cho rõ <img src="/hvaonline/images/smilies/575eda61e93c7ad9d05928580213fd9b.gif" border="0" alt="smilie" align="absbottom"> ), tránh cho người đọc những thắc mắc kiểu như <font color='yellow'>tại sao khác với nhiều giao thức trên nền TCP/UDP, IKE phải cố định cổng nguồn?</font>.<br/> <br/> <br/> <br/> <p></p>
		<cite class="blockquote">prof wrote:</cite><br>
		<blockquote>Một vấn đề còn đang tranh cãi nữa là khả năng xác thực của ESP. Như ta đã biết, ESP có khả năng cung cấp cơ chế xác thực, nhưng giá trị băm mà nó sử dụng được sinh ra dựa trên <font color='yellow'>toàn bộ gói tin ngoại trừ phần IP header và phần authentication trailer</font>. Điều này giúp cho ESP authentication tương thích với NAT, nhưng việc thiếu xác thực của IP header sẽ không đảm bảo được nguồn gốc của gói tin. May thay, trong hầu hết các cài đặt, việc kiểm tra tính xác thực cho phần <font color='yellow'>payload của ESP</font>  cũng đủ để nói lên nguồn gốc của gói tin này! <img src="/hvaonline/images/smilies/b5e9b4f86ce43ca65bd79c894c4a924c.gif" border="0" alt="smilie" align="absbottom">&nbsp;
		</blockquote><br/> Theo alice, cụm từ <font color='yellow'>payload của ESP</font> có lẽ sửa thành <font color='yellow'>IP payload</font> hoặc cụ thể hơn 1 chút thì <font color='yellow'>ESP header</font> mới đúng. Như chính <b>prof</b> đã nói, authentication trailer xác thực không những ESP payload mà còn cả ESP header, trong đó có SPI (security parameter index), từ đó dựa theo SAD (security association database) tra được địa chỉ IP của người gửi. Nói cách khác, với một chi phí tính toán thích đáng, cài đặt không cần phải xác thực IP header vẫn xác thực được địa chỉ IP nguồn của gói tin.<br/> <br/> <br/> Cám ơn <b>thangdiablo</b>, <b>prof</b>, <b>Mr. Khoai</b> và các bạn khác vì một loạt bài lý thú.  <img src="/hvaonline/images/smilies/575eda61e93c7ad9d05928580213fd9b.gif" border="0" alt="smilie" align="absbottom">) </span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>

		  <tr>
			<td height="20" colspan="2" valign="bottom" class="rowButton"><span class="gensmall">Như hà nghịch lỗ lai xâm phạm<br>如 何 逆 虜 來 侵 犯</span></td>
		  </tr>

			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Cơ chế hoạt động và cách cấu hình VPN IP Sec trên router Cisco<a name="35684" id="35684"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">12/01/2007 01:13:26 (+0700) | <a href="/hvaonline/posts/list/5816.html#35684">#9</a> | 35684 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/50830.html"><b>father_nghia_den</b></a><br>
	<font color="#33CC33">Elite Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 06/10/2003 16:48:21<br>
		Messages: 95<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/50830.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/50830.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row1">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row1"><span class="postbody"><p></p>
		<cite class="blockquote">prof wrote:</cite><br>
		<blockquote> ESP thường được xem như là sự kết hợp của IPSec với NAT. &nbsp;
		</blockquote><br/> <br/> Đúng như Alice nói . Có thể đoạn này sẽ gây hiểu lầm . Tất nhiên prof hiểu được bản chất vấn đề nhưng cú pháp trong câu này hơi bị khó hiểu 1 chút .<br/> <br/> Theo tớ nghĩ câu trên sẽ là ESP  là giải pháp cho phép IPSec chạy trên hệ thống có xảy ra quá trình NAT với điều kiện IPSEC chạy ở  mode Tunel .</span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>


			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Cơ chế hoạt động và cách cấu hình VPN IP Sec trên router Cisco<a name="35739" id="35739"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">12/01/2007 04:57:35 (+0700) | <a href="/hvaonline/posts/list/5816.html#35739">#10</a> | 35739 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>
<td width="20">
		<img src="/hvaonline/images/avatar/682fd484282af0db905c31ab6da21cb4.png" border="0" alt="[Avatar]" title="[Avatar]"><br>
	</td>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/125805.html"><b>anhdong2k5</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 01/07/2006 05:02:14<br>
		Messages: 92<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/125805.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/125805.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
			<a href="http://s0ftarchi3.blogspot.com" target="_new"><img src="/hvaonline/templates/viet/images/icon_www.gif" alt="[WWW]" title="[www]"></a>
		
			<a href="http://edit.yahoo.com/config/send_webmesg?.target=lllll_o0o_lllll&amp;.src=pg"><img src="/hvaonline/templates/viet/images/icon_yim.gif" alt="[Yahoo!]" title="[YIM]"></a>
		
			<a href="/hvaonline/user/profile/125805.html"><img src="/hvaonline/templates/viet/images/icon_msnm.gif" alt="[MSN]" title="[MSN]"></a>
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row2">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row2"><span class="postbody">Đọc đi đọc lại mấy lần loạt bài này cũng chưa hiểu hết mặc dù bài viết rất chi tiết, bro nào có tài liệu thì cho mình xin để đọc thêm đi.<br/> <br/> Cám ơn mọi người!</span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>


			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Cơ chế hoạt động và cách cấu hình VPN IP Sec trên router Cisco<a name="35940" id="35940"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">13/01/2007 08:54:00 (+0700) | <a href="/hvaonline/posts/list/5816.html#35940">#11</a> | 35940 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/21000.html"><b>thangdiablo</b></a><br>
	<font color="#3366CC">HVA Friend</font></span>
<br>

<span class="uprofile">
		
</span>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 11/05/2003 17:31:58<br>
		Messages: 734<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/21000.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/21000.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
			<a href="http://vntaekwondo.com" target="_new"><img src="/hvaonline/templates/viet/images/icon_www.gif" alt="[WWW]" title="[www]"></a>
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row1">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row1"><span class="postbody">Bravo prof , alice và các bạn đã tham gia . Chính những kiến thức rất sâu và đóng góp của các bạn sẽ tạo cho loạt bài này thêm phần lý thú .<br/> Trong phần kế tiếp chúng ta sẽ bàn đến cách cấu hình cụ thể và monitor các trạng thái hoạt động của kênh IPSEC .<br/> Đến lúc đó hy vọng các bạn tiếp tục pham gia để phân tích các thông tin thu thập được từ debug.<br/> <br/> Thân mến</span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>

		  <tr>
			<td height="20" colspan="2" valign="bottom" class="rowButton"><span class="gensmall">Hãy sống có Tuệ Giác.</span></td>
		  </tr>

			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Re: Cơ chế hoạt động và cách cấu hình VPN IP Sec trên router Cisco<a name="36086" id="36086"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">14/01/2007 06:38:32 (+0700) | <a href="/hvaonline/posts/list/5816.html#36086">#12</a> | 36086 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/94689.html"><b>prof</b></a><br>
	<font color="#FF9900">Moderator</font></span>
<br>

<span class="uprofile">
		
</span>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 23/11/2004 01:08:55<br>
		Messages: 205<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/94689.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/94689.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row2">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row2"><span class="postbody">Chào cả nhà,<br/> Chào <i>alice</i>,<br/> <br/> <i>Prof</i> rất vui khi nhận được comments từ <i>alice, father_nghia_den,</i> và <i>thangdiablo</i>. Mấy ngày qua mình khá bận nên việc reply có phần chậm trễ. Mong các bạn thông cảm. Bây giờ ta tiếp tục thảo luận nhé. <img src="/hvaonline/images/smilies/b5e9b4f86ce43ca65bd79c894c4a924c.gif" border="0" alt="smilie" align="absbottom">)<br/> <br/> <p></p>
		<cite class="blockquote">alice wrote:</cite><br>
		<blockquote>Bài bổ sung của <b>prof</b> rất tốt, alice chỉ nghĩ có thể bài viết sẽ dễ hiểu hơn nếu thay đổi vài điểm về thuật ngữ. <img src="/hvaonline/images/smilies/575eda61e93c7ad9d05928580213fd9b.gif" border="0" alt="smilie" align="absbottom">)<br/> &nbsp;
		</blockquote><br/> Uhm, mục đích của bài viết bổ sung cho loạt bài của bạn <i>thangdiablo</i>  là nhằm đào sâu hơn một chút về những thứ mà <i>thangdiablo</i> chưa có dịp đề cập đến. Rõ ràng, bài viết sẽ không thành công nếu như tạo thêm sự khó hiểu cho người đọc. Vì vậy, trong quá trình thảo luận, mình sẵn sàng "thay đổi vài điểm về thuật ngữ" nhằm giúp độc giả *tiêu hóa* tốt hơn. Cũng cần nói thêm là bài bổ sung trên được viết khá gấp rút, nên không thể tránh khỏi thiếu sót. Góp ý của các bạn sẽ giúp bài viết thêm phần hoàn thiện.  <img src="/hvaonline/images/smilies/b5e9b4f86ce43ca65bd79c894c4a924c.gif" border="0" alt="smilie" align="absbottom">)<br/> <blockquote><br/>  <p></p>
		<cite class="blockquote">prof wrote:</cite><br>
		<blockquote>Lý do AH có khả năng cung cấp cơ chế xác thực và bảo đảm tính toàn vẹn (integrity) của dữ liệu là vì AH Header chứa một chữ ký số <b>(Digital Signature - DS)</b> được gọi là giá trị kiểm tra tính toàn vẹn <b>(Integrity Check Value-ICV)</b>. Thực chất nó là một giá trị băm được dùng để kiểm tra xem liệu gói tin có bị thay đổi trên đường truyền hay không. Vì AH sử dụng IP header để tính toán DS nên chúng ta có thể chắc chắn rằng địa chỉ nguồn của gói tin là xác thực và gói tin này xuất phát từ đúng nơi gửi. &nbsp;
		</blockquote>Dùng từ ICV là đủ, tránh dùng từ DS. ICV nói chung không phải là DS và thực tế không phải là DS.<br/> &nbsp;
		</blockquote><br/> Trước tiên, hoàn toàn đồng ý với <i>alice</i> ở điểm ICV không phải là DS. <img src="/hvaonline/images/smilies/b5e9b4f86ce43ca65bd79c894c4a924c.gif" border="0" alt="smilie" align="absbottom">) Tuy nhiên, khi viết đoạn này, ý đồ của mình không nhằm <b>so sánh</b> DS và ICV. Mình tuy là kẻ *ngâm cứu* không chuyên về <i>applied crypto. & its related stuffs</i> nhưng cũng may mắn hiểu được sự khác biệt về phạm vi ứng dụng, và về bản chất của DS. Trong phạm vi bài này, mình sử dụng DS với mục đích giúp người đọc hiểu được những lợi điểm do ICV đem lại, kiểu như dùng một thuật ngữ đã quen thuộc để giải thích cho một thuật ngữ mới hơn. Có lẽ chúng ta đều biết DS có khả năng cung cấp tính xác thực (Authentication), tính toàn vẹn (Integrity), và tính chống phủ nhận (Non-repudiation). ICV trong AH Header cũng hội đủ các điều kiện để cung cấp 2 trong 3 khả năng này. Vì vậy, ở một khía cạnh hẹp & trực quan nào đó, ICV mang đặc điểm của DS. <br/> <br/> Mình cũng đã từng gặp ở một số tài liệu khác, khi đề cập đến một intemediate device/application/middleware/..., người viết thường mượn thuật ngữ <b>proxy server</b> nhằm mục đích nói lên tính trung gian của đối tượng đang xét, mặc dù nếu khắt khe hơn, thì proxy server không thể là đối tượng mà họ đang bàn. Đó chỉ là một ví dụ khá *thô* về cách dùng thuật ngữ mà thôi. <img src="/hvaonline/images/smilies/b5e9b4f86ce43ca65bd79c894c4a924c.gif" border="0" alt="smilie" align="absbottom">) <br/> <br/> Anyway, có lẽ mình đã lạm dụng thuật ngữ DS này nên dẫn đến hiểu lầm. Prof sẽ chỉnh sửa lại đoạn này bằng việc bỏ đi thuật ngữ DS. <img src="/hvaonline/images/smilies/b5e9b4f86ce43ca65bd79c894c4a924c.gif" border="0" alt="smilie" align="absbottom"><br/> <blockquote><br/> <p></p>
		<cite class="blockquote">prof wrote:</cite><br>
		<blockquote>Cách thức hoạt động của ESP có khác biệt đôi chút phụ thuộc vào chế độ làm việc của IPSec. Trong chế độ Transport, ESP chỉ đơn thuần thêm phần header của bản thân nó vào sau phần IP header và mã hoá toàn bộ phần còn lại của gói tin từ tầng 4 trở lên. Nếu trong quá trình thương lượng khởi tạo một IPSec connection có chỉ định sử dụng dịch vụ xác thực của ESP, khi đó ESP sẽ thêm một phần (trailer) chứa thông tin <b>ICV</b> để đảm bảo tính toàn vẹn và tính xác thực. <b><i>Không giống với AH, ESP ICV không tính toán dựa trên các thông tin về IP header.</i></b><br/> <br/> ESP thường được xem như là sự kết hợp của <font color='yellow'>IPSec</font> với NAT. ESP thường được sử dụng trong chế độ <i>tunnel</i>. Tuy nhiên trong chế độ <i>transport</i>, ESP và NAT không tương thích với nhau vì các thông tin của phần header của gói tin đã bị NAT thay đổi. Khi NAT thực hiện thay đổi phần thông tin về IP, nó cũng sẽ tính lại giá trị <b>checksum</b> trong TCP header. Và bởi vì TCP checksum được tính toán không chỉ dựa vào TCP header, mà nó còn dựa vào các thông tin từ IP header, như địa chỉ nguồn/đích của gói tin nên NAT đã phá vỡ tính toàn vẹn của gói tin. Trong chế độ Transport ESP, toàn bộ TCP header đã được mã hoá, NAT box sẽ không thể tính toán lại TCP checksum. (Vấn đề tương tự đối với UDP packets khi UDP checksum được tính đến). Kết quả là trước khi giải mã, gói tin sẽ bị hủy vì không bảo đảm tính toàn vẹn. Vấn đề này có thể được giải quyết nếu như không đụng đến TCP checksum trong mọi trường hợp. <img src="/hvaonline/images/smilies/b5e9b4f86ce43ca65bd79c894c4a924c.gif" border="0" alt="smilie" align="absbottom">&nbsp;
		</blockquote>Chỗ <font color='yellow'>IPSec màu vàng</font> có vẻ khó hiểu. Đối tượng đang được giải thích là IPSEC. ESP là một phần của IPSEC. Sẽ không hợp lý lắm khi đem IPSEC để giải thích ESP.<br/> <br/> Khi đưa TCP/UDP vào cuộc, cũng nên nói rõ hoàn cảnh sử dụng là <font color='yellow'>ESP bao bọc TCP/UDP</font>. Để phân biệt với hoàn cảnh <font color='yellow'>UDP bao bọc ESP</font> (NAT-T) mà loạt bài sẽ nói đến về sau.&nbsp;
		</blockquote><br/> Yep! Câu trên đúng là gây khó hiểu. Rất may mắn, bạn <i>father_nghia_den</i> đã giải thích lại giúp một cách hợp lý. Thanks <i>father_nghia_den</i>. <img src="/hvaonline/images/smilies/b5e9b4f86ce43ca65bd79c894c4a924c.gif" border="0" alt="smilie" align="absbottom">)<br/> <br/> <blockquote><br/> Đoạn này có thể xem như có 2 phần:<br/> <br/> Phần <font color='yellow'>NAT màu vàng thứ nhất</font> nói về tính tương thích của NAT với ESP. Ở đây nên làm rõ thêm từ NAT bởi một từ khác (thí dụ, <font color='yellow'>basic NAT</font> theo tự điển wikipedia), ngụ ý rằng ở đây chỉ có dịch địa chỉ mà thôi. Cũng nên nói rõ thêm NAT trong trường hợp chung (bao hàm PAT) với ESP trong chế độ tunnel là <font color='yellow'>không tương thích</font> bởi vì khác với TCP/UDP, ESP không có khái niệm "cổng". Như thế người đọc sẽ không phải thắc mắc đại loại như <font color='yellow'>nếu ESP tunnel và NAT đã tương thích với nhau, tại sao phải dùng UDP bao bọc ESP để có NAT-T?</font><br/> &nbsp;
		</blockquote><br/> Thanks <i>alice.</i> Mình quả thật đã thiếu xót khi không đề cập đến khía cạnh <b>NAT-T</b> trong IKE.<br/> <blockquote><br/> Phần <font color='yellow'>NAT màu vàng thứ hai</font> nói về tính tương thích của NAT với IKE, cũng nên nói rõ hơn một chút (nhưng chính alice cũng chưa biết nói thế nào cho rõ <img src="/hvaonline/images/smilies/575eda61e93c7ad9d05928580213fd9b.gif" border="0" alt="smilie" align="absbottom"> ), tránh cho người đọc những thắc mắc kiểu như <font color='yellow'>tại sao khác với nhiều giao thức trên nền TCP/UDP, IKE phải cố định cổng nguồn?</font>.&nbsp;
		</blockquote><br/> Chà, xem ra "người đọc" muốn mở rộng thêm vấn đề về tính tương thích giữa NAT và việc cố định cổng nguồn của IKE đây. <img src="/hvaonline/images/smilies/575eda61e93c7ad9d05928580213fd9b.gif" border="0" alt="smilie" align="absbottom"> Trường hợp này, có lẽ phải mời người tham khảo thêm <b>RFC 3715</b> để biết chi tiết. <img src="/hvaonline/images/smilies/b5e9b4f86ce43ca65bd79c894c4a924c.gif" border="0" alt="smilie" align="absbottom">) Phải thừa nhận một điều là còn khá nhiều vấn đề giữa NAT và IPSec mà <i>prof</i> chưa thể nói hết. Bởi vậy, ngay từ đầu, mình chỉ dám đi sâu <b>một chút</b>, vì biết sẽ không đủ sức. Nếu <i>alice</i> hay bạn nào đó có thời gian, các bạn có thể bổ sung thêm những vấn đề mà mình chưa đề cập đến. <img src="/hvaonline/images/smilies/b5e9b4f86ce43ca65bd79c894c4a924c.gif" border="0" alt="smilie" align="absbottom"><br/> <br/> <blockquote><br/> Theo alice, cụm từ <font color='yellow'>payload của ESP</font> có lẽ sửa thành <font color='yellow'>IP payload</font> hoặc cụ thể hơn 1 chút thì <font color='yellow'>ESP header</font> mới đúng. Như chính <b>prof</b> đã nói, authentication trailer xác thực không những ESP payload mà còn cả ESP header, trong đó có SPI (security parameter index), từ đó dựa theo SAD (security association database) tra được địa chỉ IP của người gửi. Nói cách khác, với một chi phí tính toán thích đáng, cài đặt không cần phải xác thực IP header vẫn xác thực được địa chỉ IP nguồn của gói tin.<br/> &nbsp;
		</blockquote><br/> Đồng ý! <img src="/hvaonline/images/smilies/b5e9b4f86ce43ca65bd79c894c4a924c.gif" border="0" alt="smilie" align="absbottom">)</span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>


			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Re: Cơ chế hoạt động và cách cấu hình VPN IP Sec trên router Cisco<a name="36186" id="36186"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">14/01/2007 18:33:38 (+0700) | <a href="/hvaonline/posts/list/5816.html#36186">#13</a> | 36186 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>
<td width="20">
		<img src="/hvaonline/images/avatar/13485a8da3233f114113e29f6bf6b7db.png" border="0" alt="[Avatar]" title="[Avatar]"><br>
	</td>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/100666.html"><b>alice</b></a><br>
	<font color="#33CC33">Elite Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 20/01/2005 22:23:24<br>
		Messages: 87<br>
	
		Location: Wonderland<br>
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/100666.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/100666.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row1">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row1"><span class="postbody"><p></p>
		<cite class="blockquote">prof wrote:</cite><br>
		<blockquote>Trước tiên, hoàn toàn đồng ý với <i>alice</i> ở điểm ICV không phải là DS. <img src="/hvaonline/images/smilies/b5e9b4f86ce43ca65bd79c894c4a924c.gif" border="0" alt="smilie" align="absbottom">) Tuy nhiên, khi viết đoạn này, ý đồ của mình không nhằm <b>so sánh</b> DS và ICV. Mình tuy là kẻ *ngâm cứu* không chuyên về <i>applied crypto. & its related stuffs</i> nhưng cũng may mắn hiểu được sự khác biệt về phạm vi ứng dụng, và về bản chất của DS. Trong phạm vi bài này, mình sử dụng DS với mục đích giúp người đọc hiểu được những lợi điểm do ICV đem lại, kiểu như dùng một thuật ngữ đã quen thuộc để giải thích cho một thuật ngữ mới hơn. Có lẽ chúng ta đều biết DS có khả năng cung cấp tính xác thực (Authentication), tính toàn vẹn (Integrity), và tính chống phủ nhận (Non-repudiation). ICV trong AH Header cũng hội đủ các điều kiện để cung cấp 2 trong 3 khả năng này. Vì vậy, ở một khía cạnh hẹp & trực quan nào đó, ICV mang đặc điểm của DS. <br/> <br/> Mình cũng đã từng gặp ở một số tài liệu khác, khi đề cập đến một intemediate device/application/middleware/..., người viết thường mượn thuật ngữ <b>proxy server</b> nhằm mục đích nói lên tính trung gian của đối tượng đang xét, mặc dù nếu khắt khe hơn, thì proxy server không thể là đối tượng mà họ đang bàn. Đó chỉ là một ví dụ khá *thô* về cách dùng thuật ngữ mà thôi. <img src="/hvaonline/images/smilies/b5e9b4f86ce43ca65bd79c894c4a924c.gif" border="0" alt="smilie" align="absbottom">) <br/> <br/> Anyway, có lẽ mình đã lạm dụng thuật ngữ DS này nên dẫn đến hiểu lầm. Prof sẽ chỉnh sửa lại đoạn này bằng việc bỏ đi thuật ngữ DS. <img src="/hvaonline/images/smilies/b5e9b4f86ce43ca65bd79c894c4a924c.gif" border="0" alt="smilie" align="absbottom">&nbsp;
		</blockquote><br/> <br/> <br/> Ồ, alice thật có lỗi khi đã viết ở đó 1 câu bình cộc lốc. Thực sự, các bài viết của <b>prof</b> ở HVA vài năm nay đã chứng tỏ một kiến thức sâu rộng về cryptography và các ứng dụng của nó, còn lối diễn đạt dễ hiểu và phong cách tranh luận khiêm tốn đã thể hiện tính chuyên nghiệp rất cao. Một khi prof. <b>prof</b> tự đánh giá mình là người nghiên cứu "không chuyên" thì <b>alice</b> phải hoảng hốt tự nhận mình là kẻ "tà ma ngoại đạo" thui  <img src="/hvaonline/images/smilies/575eda61e93c7ad9d05928580213fd9b.gif" border="0" alt="smilie" align="absbottom">) . Nếu được viết lại, <b>alice</b> sẽ viết thế này: <br/> <br/> "Sự ví von rất hay, đã làm cho giải thích thêm phần dễ hiểu. Tuy nhiên, nếu viết từ  <font color='yellow'>chữ ký</font>  trong "nháy nháy" và không mở ngoặc viết thêm phụ đề Anh ngữ <font color='yellow'>digital signature (DS)</font> thì thuật ngữ sẽ không bị "đụng hàng" và tính chất ví von sẽ được thể hiện rõ nét hơn nữa.  :!<img src="/hvaonline/images/smilies/b5e9b4f86ce43ca65bd79c894c4a924c.gif" border="0" alt="smilie" align="absbottom">  <img src="/hvaonline/images/smilies/575eda61e93c7ad9d05928580213fd9b.gif" border="0" alt="smilie" align="absbottom">) "<br/> <br/> Khi tính chống phủ nhận (non-repudiability) đã được đề cập, luôn tiện nói thêm, nhóm giao thức IPSEC không có tính chất này. Đó không phải là một thiếu sót. Ngược lại, <font color='yellow'>plausible deniability</font> (tính phủ nhận được?) là cần thiết. Nhờ thế An và Bình có thể liên lạc với nhau mà sau này có thể "cãi bay chối biến" vì không để lại chứng cứ nào về sự liên lạc. Giám định viên tư pháp muốn tìm chứng cứ chống lại An cũng đành phải bó tay ngay cả khi Bình bội bạc với An.  <img src="/hvaonline/images/smilies/575eda61e93c7ad9d05928580213fd9b.gif" border="0" alt="smilie" align="absbottom">) <br/> <br/> Plausible deniability là một trong những mối quan tâm khi thiết kế IPSEC và ở một chừng mực nào đó, đã được đảm bảo.<br/> <br/> <br/> <br/> <p></p>
		<cite class="blockquote">prof wrote:</cite><br>
		<blockquote><p></p>
		<cite class="blockquote">alice wrote:</cite><br>
		<blockquote><br/> Phần <font color='yellow'>NAT màu vàng thứ hai</font> nói về tính tương thích của NAT với IKE, cũng nên nói rõ hơn một chút (nhưng chính alice cũng chưa biết nói thế nào cho rõ <img src="/hvaonline/images/smilies/575eda61e93c7ad9d05928580213fd9b.gif" border="0" alt="smilie" align="absbottom"> ), tránh cho người đọc những thắc mắc kiểu như <font color='yellow'>tại sao khác với nhiều giao thức trên nền TCP/UDP, IKE phải cố định cổng nguồn?</font>.&nbsp;
		</blockquote><br/> Chà, xem ra "người đọc" muốn mở rộng thêm vấn đề về tính tương thích giữa NAT và việc cố định cổng nguồn của IKE đây. <img src="/hvaonline/images/smilies/575eda61e93c7ad9d05928580213fd9b.gif" border="0" alt="smilie" align="absbottom"> Trường hợp này, có lẽ phải mời người tham khảo thêm <b>RFC 3715</b> để biết chi tiết. <img src="/hvaonline/images/smilies/b5e9b4f86ce43ca65bd79c894c4a924c.gif" border="0" alt="smilie" align="absbottom">) Phải thừa nhận một điều là còn khá nhiều vấn đề giữa NAT và IPSec mà <i>prof</i> chưa thể nói hết. Bởi vậy, ngay từ đầu, mình chỉ dám đi sâu <b>một chút</b>, vì biết sẽ không đủ sức. Nếu <i>alice</i> hay bạn nào đó có thời gian, các bạn có thể bổ sung thêm những vấn đề mà mình chưa đề cập đến. <img src="/hvaonline/images/smilies/b5e9b4f86ce43ca65bd79c894c4a924c.gif" border="0" alt="smilie" align="absbottom">&nbsp;
		</blockquote><br/> <br/> Ớ, RFC 3715 đâu có giải thích tại sao IKE cố định cổng nguồn đâu, chỉ nói ra điều đó thui muh <img src="/hvaonline/images/smilies/575eda61e93c7ad9d05928580213fd9b.gif" border="0" alt="smilie" align="absbottom">). Một cách nghiêm túc, RFC này tổng kết 16 điểm không tương thích NAT -- nguyên văn: NA(P)T -- của nhóm giao thức IPSEC, đánh số từ a) đến p), trong đó có 9 điểm đầu tiên thuộc loại thâm căn cố đế (intrinsic). Việc cổng nguồn IKE cố định được <b>prof</b> lấy làm thí dụ, nếu <b>alice</b> hiểu không lầm, là điểm d), chỉ được RFC nêu ra như là một thực tế "ngời ngời như chân lý" thôi. Cho dù đó là thực tế, <b>alice</b> không nghĩ rằng nó hiển nhiên như một yêu cầu chuẩn định (normative).<br/> <br/> Đó là điều mà trong bài trước <b>alice</b> đã muốn "nói rõ thêm một chút mà không biết nói thế nào".  <img src="/hvaonline/images/smilies/575eda61e93c7ad9d05928580213fd9b.gif" border="0" alt="smilie" align="absbottom">)  <br/> <br/> Còn việc mở rộng vấn đề ra một cách rõ ràng và đầy đủ, <b>alice</b> cũng không có nguyện vọng đó. <b>alice</b> biết mình không đủ qualified và mặt khác, nhất trí hoàn toàn với <b>prof</b>, RFC 3175 đã gọn ràng đến mức khó có thể trình bày lại vấn đề cho gọn gàng hơn. Không tương thích IPSEC với NAT là một "tổ kiến lửa" mà việc "chọc" vào nó là không thích đáng trong phạm vi của một bài tut. <img src="/hvaonline/images/smilies/575eda61e93c7ad9d05928580213fd9b.gif" border="0" alt="smilie" align="absbottom">)</span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>

		  <tr>
			<td height="20" colspan="2" valign="bottom" class="rowButton"><span class="gensmall">Như hà nghịch lỗ lai xâm phạm<br>如 何 逆 虜 來 侵 犯</span></td>
		  </tr>

			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Re: Cơ chế hoạt động và cách cấu hình VPN IP Sec trên router Cisco<a name="51859" id="51859"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">06/04/2007 00:43:23 (+0700) | <a href="/hvaonline/posts/list/5816.html#51859">#14</a> | 51859 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/21000.html"><b>thangdiablo</b></a><br>
	<font color="#3366CC">HVA Friend</font></span>
<br>

<span class="uprofile">
		
</span>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 11/05/2003 17:31:58<br>
		Messages: 734<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/21000.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/21000.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
			<a href="http://vntaekwondo.com" target="_new"><img src="/hvaonline/templates/viet/images/icon_www.gif" alt="[WWW]" title="[www]"></a>
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row2">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row2"><span class="postbody"><font color='red'><font size='+2'><b>Phần III .Hướng dẫn cấu hình VPN/IPSEC trên Router Cisco</b></font></font><br/> <br/> Chào anh em. Có 1 điều đáng tiếc là do trong thời gian vừa qua tôi có sự thay đổi công việc nên hơi bận rộn và thời gian không có phép tôi viết tiếp tục TUT này 1 cách liên tục. Hôm nay thời gian đã rảnh rỗi hơn tôi xin tiếp tục để các bạn theo dõi.<br/> <p></p>
		<cite class="blockquote">Mô hình wrote:</cite><br>
		<blockquote><br/> [[ROUTER R1]]<br/>         s1/0 = R2 s1/0   # Cổng Serial s1/0 của Router R1 nối với s1/0 của R2<br/> 		<br/> [[router R2]]<br/>         model = 7200<br/> 	s1/1 = R3 s1/1  # Cổng Serial S1/1 của Router R2 nối với S1/1 của R3<br/> 	<br/> [[router R3]]<br/>         model = 7200<br/> <br/> &nbsp;
		</blockquote>		<br/> <br/> Trước khi đi vào chi tiết cấu hình của 3 Router tôi đưa ra 1 ví dụ cụ thể để các bạn dễ hình dung.<br/> Chúng ta có 3 chi nhánh gồm HN (R1) , ĐN (R2) và HCM (R3) . Việc trao đổi dự liệu giữa các TP này diễn ra thường xuyên và liên tục.<br/> Tất cả dữ liệu được truyền từ ĐN vào HCM là những dữ liệu quan trọng và yêu cầu đặt ra là khi dữ liệu chạy trên đường truyền từ ĐN và HCM phải được mã hóa và bảo vệ.<br/> Trong mô hình lab này. Tôi sẽ cấu hình VPN IPSEC chạy trên đoạn từ serial 1/1 của Router 2 tới Serial 1/1 của Router 3.<br/> Nghĩa là khi có luồng dữ liệu chạy trên link này nếu đúng peer<font color='orange'> -1- </font>thì cơ chế VPN sẽ bắt đầu hoạt động.<br/> <br/> Trước tiên là cấu hình Router 1 ( HN ). Trong con Router này thì không có gì đáng chú ý trong vấn đề VPN/IPSEC . Nhưng tôi cũng sẽ giải thích thêm 1 số vấn đề để các bạn dễ nắm bắt. Phần giải thích sẽ là chữ màu đỏ được in đậm<br/> <br/> <br/> <b><font color='orange'><p></p>
		<cite class="blockquote">Config Router R1 Hà Nội wrote:</cite><br>
		<blockquote></font></b><br/> R1#sh run<br/> Building configuration...<br/> <br/> Current configuration : 3499 bytes<br/>  <br/> version 12.4<br/> service timestamps debug datetime msec<br/> service timestamps log datetime msec<br/> no service password-encryption<br/>  <br/> hostname R1<br/>  <br/> boot-start-marker<br/> boot-end-marker<br/> <br/> enable secret 5 $1$NOsH$dzAiUg0rigA/wHkPJZB/b0<br/> <br/> no aaa new-model<br/> ip cef<br/> multilink bundle-name authenticated<br/> <br/> <br/> crypto pki trustpoint TP-self-signed-4294967295<br/>  enrollment selfsigned<br/>  subject-name cn=IOS-Self-Signed-Certificate-4294967295<br/>  revocation-check none<br/>  rsakeypair TP-self-signed-4294967295<br/> <br/> crypto pki certificate chain TP-self-signed-4294967295<br/>  certificate self-signed 01<br/>   3082023A 308201A3 A0030201 02020101 300D0609 2A864886 F70D0101 04050030<br/>   31312F30 2D060355 04031326 494F532D 53656C66 2D536967 6E65642D 43657274<br/>   69666963 6174652D 34323934 39363732 3935301E 170D3037 30343034 32323332<br/>   30325A17 0D323030 31303130 30303030 305A3031 312F302D 06035504 03132649<br/>   4F532D53 656C662D 5369676E 65642D43 65727469 66696361 74652D34 32393439<br/>   36373239 3530819F 300D0609 2A864886 F70D0101 01050003 818D0030 81890281<br/>   8100B306 EE726C90 E705F165 B464DDA4 314014FA 38DA1020 120AB79E CB3B9AD8<br/>   B76B2262 2FAE5208 21C20A01 4304984C 34C0ED37 DD02AF87 99FC8B86 DBCD42FF<br/>   B08CF30C B3C19056 50DC2B37 5E7769F2 AB8F8CE4 464DF6BE BB725A97 29A9E629<br/>   A323D36D E01FC307 4C61F961 C0AC5C83 3134CFE4 3FD2347A 289F21DC E0F7ED40<br/>   D9B30203 010001A3 62306030 0F060355 1D130101 FF040530 030101FF 300D0603<br/>   551D1104 06300482 02523130 1F060355 1D230418 30168014 DE1009DC 2F7D3708<br/>   04170326 E5336218 6052B3D3 301D0603 551D0E04 160414DE 1009DC2F 7D370804<br/>   170326E5 33621860 52B3D330 0D06092A 864886F7 0D010104 05000381 81009463<br/>   996F4CA7 6DC06475 AF297485 5A715D4B AE4DB018 13F79AD0 33227310 8DACCC44<br/>   1EB897F9 82F41311 7E178D1B 903197F6 5082C822 9BE373DA 5743BE8E 6E68A90E<br/>   081C6CF4 BD3ED8D3 C7E4DAF8 10325062 8B1A8A43 80886D42 EFD18E26 3B854D05<br/>   969B748B 4F084A4A 1031AA22 7684BBE0 846DA565 AC257813 0AD2B5F9 42A0<br/>   quit<br/> <br/> interface Loopback0<br/>  ip address 192.168.1.1 255.255.255.0<br/>  <br/> interface Loopback1<br/>  ip address 192.168.2.1 255.255.255.0<br/>  <br/> interface Loopback2<br/>  ip address 192.168.3.1 255.255.255.0<br/>  <br/> interface FastEthernet0/0<br/>  ip address 10.10.1.146 255.255.255.0 <br/>  duplex full<br/>  <br/> interface Serial1/0 <br/>  ip address 10.0.0.1 255.255.255.0<br/>  ip ospf authentication message-digest<font color='orange'> \\ Trong khi routing bằng OSPF tôi có authentication giữa các neighbor bằng key là “ thang “ </font><br/>  ip ospf message-digest-key 1 md5 thang<br/>  no fair-queue<br/>  serial restart-delay 0<br/>  clock rate 64000<br/>  <br/> <br/> router eigrp 1<br/>  network 192.168.1.0<br/>  network 192.168.2.0<br/>  network 192.168.3.0<br/>  auto-summary<br/>  <br/> router ospf 1  <font color='orange'>\\ Giữa 3 Router của 3 miền tôi dung cơ chế OSPF để routing. Và tất cả để được nối vào Area0</font><br/>  log-adjacency-changes<br/>  summary-address 192.168.0.0 255.255.0.0 <br/>  redistribute eigrp 1 subnets<br/>  network 10.0.0.0 0.0.0.255 area 0<br/>  <br/> ip http server<br/> ip http secure-server<br/> <br/> logging alarm informational<br/> <br/> control-plane<br/> <br/> gatekeeper<br/>  shutdown<br/>  <br/> banner motd ^C<br/> Retrict Area . This is ASBR . Routing OSPF1 + EIGRP1<br/> ^C<br/>  <br/> line con 0<br/>  exec-timeout 0 0<br/>  password cisco<br/>  login<br/>  stopbits 1<br/> &nbsp;
		</blockquote><br/> <br/> <br/> <font color='orange'><p></p>
		<cite class="blockquote"> Config Router 2 Đà Nẵng wrote:</cite><br>
		<blockquote></font><br/> R2<br/> version 12.4<br/> service timestamps debug datetime msec<br/> service timestamps log datetime msec<br/> no service password-encryption<br/>  <br/> hostname R2<br/>  <br/> boot-start-marker<br/> boot-end-marker<br/>  <br/> enable secret 5 $1$zFeK$NJjHyf.rQkLWZf88tT21R.<br/>  <br/> no aaa new-model<br/> ip cef<br/> <br/>  <br/> multilink bundle-name authenticated<br/> <br/> crypto isakmp policy 1 <font color='orange'>\\ Chúng ta đang bắt đầu tạo policy cho quá trình IKE mà tôi đã giải thích trong 2 chương trước đó</font><br/>  encr aes <font color='orange'>\\ Chúng ta sẽ mã hóa bằng AES</font><br/>  authentication pre-share <font color='orange'>\\ Xác thực bằng pre-share key</font><br/>  group 2<br/> crypto isakmp key 6 cisco address 11.0.0.2 \<font color='orange'>\ Và key để trao đổi giữa 2 đầu Đà Nẵng và HCM là “ cisco “ . IP 11.0.0.2 chính là IP của Serial 1/1 HCM hay còn gọi là peer của Router Đà Nẵng.<br/> Việc xác định peer này là vô cùng quan trọng vì người quản trị phải biết được mục đích chúng ta đang định giao tiếp với ai và quá trình VPN sẽ xảy ra khi dữ liệu đi từ đâu tới đâu.</font><br/> <br/>  <br/>  <br/> crypto ipsec transform-set R2 esp-aes esp-sha-hmac  <font color='orange'>\\ Đến thời điểm này chúng ta đã xong phần thiết lập các chính sách trong quá trình IKE. Trong command này chúng ta đang tiến hành khởi tạo policy cho quá trình đóng gói dữ liệu. Đây là những chính sách mà chúng ta quy định cho việc gói dữ liệu sẽ được bao bọc bởi cơ chế mã hóa gì. </font><br/>  <br/> crypto map VPN_TO_R3 10 ipsec-isakmp <font color='orange'>\\  Command này là thao tác chúng ta chính thức thông báo cho Router ĐN apply các chính sách đã khởi tạo quá trình IKE</font><br/>  set peer 11.0.0.2<font color='orange'> \\ Và đối tượng để thiết lập quá trình VPN/IPSEC này là IP 11.0.0.2 của Router HCM </font><br/>  set transform-set R2 <font color='orange'>\\ Chính thức apply policy của cơ chế IPSEC</font> <br/>  match address 101 <font color='orange'>\\  Apply luồng traffic được mã hóa. Và luồng traffic được mã hóa này chúng ta sẽ tạo ra nó bằng 1 Access list</font><br/> <br/> interface Loopback0<br/>  ip address 172.0.0.1 255.255.255.0<br/>  <br/> interface Loopback1<br/>  ip address 172.0.2.1 255.255.255.0<br/>  <br/> interface Loopback2<br/>  ip address 172.0.3.1 255.255.255.0<br/>  <br/> interface FastEthernet0/0<br/>  no ip address<br/>  shutdown<br/>  duplex half<br/>  <br/> interface Serial1/0<br/>  ip address 10.0.0.2 255.255.255.0<br/>  ip ospf authentication message-digest<br/>  ip ospf message-digest-key 1 md5 thang<br/>  serial restart-delay 0<br/>  <br/> interface Serial1/1<br/>  ip address 11.0.0.1 255.255.255.0<br/>  ip ospf authentication message-digest<br/>  ip ospf message-digest-key 2 md5 thang<br/>  serial restart-delay 0<br/>  clock rate 64000<br/>  crypto map VPN_TO_R3 <font color='#orange'>\\Apply crypto map vào Interface kết nối VPN</font><br/> <br/> router eigrp 1<br/>  network 172.0.0.0 0.0.0.255<br/>  network 172.0.2.0 0.0.0.255<br/>  network 172.0.3.0 0.0.0.255<br/>  auto-summary<br/>  <br/> router ospf 1<br/>  log-adjacency-changes<br/>  summary-address 192.168.0.0 255.255.0.0 not-advertise<br/>  summary-address 172.0.0.0 255.255.0.0<br/>  redistribute eigrp 1 subnets<br/>  network 10.0.0.0 0.0.0.255 area 0<br/>  network 11.0.0.0 0.0.0.255 area 0<br/>  <br/> no ip http server<br/> no ip http secure-server<br/>  <br/>  <br/>  <br/> logging alarm informational<br/> access-list 101 permit ip 10.0.0.0 0.0.255.255 210.245.0.0 0.0.255.255 <font color='orange'>\\ Khi thực hiện command này chúng ta đang tạo ra bộ luật bao gồm những range IP sẽ được VPN và mã hóa bởi IP SEC.<br/> Và Access list 101 này chúng ta đã apply vào Router bằng lệnh match address 101 phía trên. Thao tác tạo ra Access list này các bạn nên làm trước khi Apply các chính sách VPN IPSEC và Router.<br/> Ý nghĩa của command này là tôi muốn Router hiểu rằng tất cả những traffic nào có địa chỉ IP là 10.0.x.x subnet mask 255.255.0.0 khi muốn đi tới range 210.245.x.x subnetmask là 255.255.0.0 đều phải chui qua VPN và được IPSEC bao bọc.</font><br/>  <br/>  <br/> control-plane<br/>  <br/>  <br/> gatekeeper<br/>  shutdown<br/>  <br/> banner motd ^C<br/> Retrict Area . This's ASBRs Router . EIGRP1 + OSPF1<br/> ^C<br/>  <br/> line con 0<br/>  password cisco<br/>  login<br/>  stopbits 1<br/> line aux 0<br/>  stopbits 1<br/> line vty 0 4<br/>  login<br/>  <br/>  <br/> end<br/> <br/> R2#<br/> &nbsp;
		</blockquote><br/> <br/> Còn với Router 3 thì các bạn nhìn và suy luận tương tự như Router 2<br/> <font color='orange'><br/> <p></p>
		<cite class="blockquote"> Config Router 3 HCM wrote:</cite><br>
		<blockquote></font><br/> Building configuration...<br/> <br/> Current configuration : 1829 bytes<br/>   <br/> version 12.4<br/> service timestamps debug datetime msec<br/> service timestamps log datetime msec<br/> no service password-encryption<br/>   <br/> hostname R3<br/>   <br/> boot-start-marker<br/> boot-end-marker<br/>   <br/>   <br/> no aaa new-model<br/> ip cef<br/>   <br/> <br/> multilink bundle-name authenticated<br/> <br/> crypto isakmp policy 1<br/>  encr aes<br/>  authentication pre-share<br/>  group 2<br/> crypto isakmp key 6 cisco address 11.0.0.1<br/>   <br/>   <br/> crypto ipsec transform-set R3 esp-aes esp-sha-hmac<br/>   <br/> crypto map VPN_TO_R2 10 ipsec-isakmp<br/>  set peer 11.0.0.1<br/>  set transform-set R3<br/>  match address 101<br/>   <br/>   <br/>   <br/>   <br/>   <br/> interface Loopback0<br/>  ip address 210.245.31.130 255.255.255.255<br/>   <br/> interface FastEthernet0/0<br/>  no ip address<br/>  shutdown<br/>  duplex half<br/>   <br/> interface Serial1/0<br/>  no ip address<br/>  shutdown<br/>  no fair-queue<br/>  serial restart-delay 0<br/>   <br/> interface Serial1/1<br/>  ip address 11.0.0.2 255.255.255.0<br/>  ip ospf authentication message-digest<br/>  ip ospf message-digest-key 2 md5 thang<br/>  serial restart-delay 0<br/>  crypto map VPN_TO_R2<br/>   <br/>   <br/> router ospf 1<br/>  log-adjacency-changes<br/>  network 11.0.0.0 0.0.0.255 area 0<br/>  network 210.245.0.0 0.0.255.255 area 0<br/>   <br/> no ip http server<br/> no ip http secure-server<br/>   <br/>   <br/>   <br/> logging alarm informational<br/> access-list 101 permit ip 210.245.0.0 0.0.255.255 10.0.0.0 0.0.0.255<br/> <br/> control-plane<br/> <br/> gatekeeper<br/>  shutdown<br/>   <br/> banner motd ^C<br/> Retric Area .^C<br/>   <br/> line con 0<br/>  exec-timeout 0 0<br/>  stopbits 1<br/> line aux 0<br/>  stopbits 1<br/> line vty 0 4<br/>  login<br/>   <br/>   <br/> End<br/> &nbsp;
		</blockquote><br/> <br/> <font color='yellow'>Trong phần này tôi đã trình bày cách cấu hình VPN IPSEC theo dạng Site to Site.<br/> Và những gì sẽ diễn ra sau khi chúng ta thiết lập những thông số trên?<br/> Làm sao chúng ta có thể biết VPN đã chạy hay chưa?<br/> Nó đang ở mode nào? Xin vui lòng chờ chương kế tiếp.<br/> Tôi không giải thích qua chi tiết tất cả những command trong quá trình viết TUT này. Do đó xin mời tất cả các bạn tham gia thảo luận.<br/> Cám ơn các bạn</font><br/> <br/> Thangdiablo<br/> <br/> <font color='orange'>-1-  peer</font> Chỉ những đầu , đối tượng liên hệ trực tiếp với Router</span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>

		  <tr>
			<td height="20" colspan="2" valign="bottom" class="rowButton"><span class="gensmall">Hãy sống có Tuệ Giác.</span></td>
		  </tr>

			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Re: Cơ chế hoạt động và cách cấu hình VPN IP Sec trên router Cisco<a name="72616" id="72616"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">21/07/2007 01:56:26 (+0700) | <a href="/hvaonline/posts/list/5816.html#72616">#15</a> | 72616 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>
<td width="20">
		<img src="/hvaonline/images/avatar/db24d12db193b13c183004bdd2b91660.jpg" border="0" alt="[Avatar]" title="[Avatar]"><br>
	</td>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/106492.html"><b>PhuongDT</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 19/04/2005 02:36:42<br>
		Messages: 41<br>
	
		Location: HVA<br>
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/106492.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/106492.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row1">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row1"><span class="postbody">Bài viết và các thảo luận rất hay, mong bro thangdiablo tiếp tục post nhiều bài tương tự nữa nhé.</span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>


			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Re: Cơ chế hoạt động và cách cấu hình VPN IP Sec trên router Cisco<a name="73704" id="73704"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">25/07/2007 06:55:24 (+0700) | <a href="/hvaonline/posts/list/5816.html#73704">#16</a> | 73704 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/21000.html"><b>thangdiablo</b></a><br>
	<font color="#3366CC">HVA Friend</font></span>
<br>

<span class="uprofile">
		
</span>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 11/05/2003 17:31:58<br>
		Messages: 734<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/21000.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/21000.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
			<a href="http://vntaekwondo.com" target="_new"><img src="/hvaonline/templates/viet/images/icon_www.gif" alt="[WWW]" title="[www]"></a>
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row2">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row2"><span class="postbody"><p></p>
		<cite class="blockquote">PhuongDT wrote:</cite><br>
		<blockquote>Bài viết và các thảo luận rất hay, mong bro thangdiablo tiếp tục post nhiều bài tương tự nữa nhé.&nbsp;
		</blockquote><br/> Tớ sẽ cố gắng viết trong vài ngày tới. Thời gian vừa rồi bạn quá. Sorry mọi người.<br/> <br/> Thân mến</span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>

		  <tr>
			<td height="20" colspan="2" valign="bottom" class="rowButton"><span class="gensmall">Hãy sống có Tuệ Giác.</span></td>
		  </tr>

			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Cơ chế hoạt động và cách cấu hình VPN IP Sec trên router Cisco<a name="183677" id="183677"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">16/06/2009 13:59:27 (+0700) | <a href="/hvaonline/posts/list/5816.html#183677">#17</a> | 183677 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/21000.html"><b>thangdiablo</b></a><br>
	<font color="#3366CC">HVA Friend</font></span>
<br>

<span class="uprofile">
		
</span>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 11/05/2003 17:31:58<br>
		Messages: 734<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/21000.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/21000.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
			<a href="http://vntaekwondo.com" target="_new"><img src="/hvaonline/templates/viet/images/icon_www.gif" alt="[WWW]" title="[www]"></a>
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row1">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row1"><span class="postbody">Hôm nay có việc ngồi làm cái VPN Site to Site mới lại nhớ ra mình chưa hoàn thành cái TUT này ( Cũng hơn 2 năm rồi  ).<br/> Nhân tiện đang làm mình viết nốt phần còn lại về việc kiểm tra, debug quá trình VPN sau khi đã cấu hình xong.<br/> <br/> Trong phần cấu hình phía trên mình có chú thích thêm 1 phần quan trọng, mà ngày trước mình quên.<br/> Đó là appy cái crypto map vào Interface sử dụng để kết nối VPN.<br/> Nếu không có bước này. Trong quá trình debug các bạn sẽ thấy thiếu những dòng màu đỏ phía trong cái trích dẫn ngay bên dưới.<br/> <br/> Sử dụng lệnh show crypto map<br/> <blockquote><br/> R#sh crypto map <br/> Crypto Map "VPN-SG-HN" 10 ipsec-isakmp<br/>         Peer = 10.252.15.6<br/>         Extended IP access list 101<br/>             access-list 101 permit ip 10.128.16.0 0.0.15.255 172.16.128.0 0.0.3.255<br/>             access-list 101 permit ip 172.16.0.0 0.0.127.255 172.16.128.0 0.0.3.255<br/>         Current peer: 10.252.15.6<br/>         <font color='red'>Security association lifetime: 4608000 kilobytes/3600 seconds </font><br/>         PFS (Y/N): N<br/>         Transform sets={ <br/>                 SG-HN, <br/>         }<br/>         Interfaces using crypto map VPN-SG-HN:<br/> <font color='red'>                GigabitEthernet0/1 </font><br/> &nbsp;
		</blockquote><br/> <br/> Khi các bạn show crypto ipsec sa ( Kiểm tra việc trao đổi các Security Association ) của quá trình đóng gói packets giữa 2 phía, các bạn sẽ thấy chống trơn.<br/> <br/> Nhưng khi luồng VPN đã tạo thành công khi các bạn show crypto ipsec sa các bạn sẽ thấy như sau:<br/> <br/> <blockquote>R_MGW_SG.ACB.HN#sh crypto ipsec sa                   <br/> <br/> interface: GigabitEthernet0/1<br/>     Crypto map tag: VPN-SG-HN, local addr 172.31.1.218<br/> <br/>    protected vrf: (none)<br/>    local  ident (addr/mask/prot/port): (172.16.0.0/255.255.128.0/0/0)<br/>    remote ident (addr/mask/prot/port): (172.16.128.0/255.255.252.0/0/0)<br/>    current_peer 10.252.15.6 port 500<br/>      PERMIT, flags={origin_is_acl,}<br/>    <font color='red'> #pkts encaps: 12699, #pkts encrypt: 12699, #pkts digest: 12699 </font><br/>     #pkts decaps: 8707, #pkts decrypt: 8707, #pkts verify: 8707<br/>     #pkts compressed: 0, #pkts decompressed: 0<br/>     #pkts not compressed: 0, #pkts compr. failed: 0<br/>     #pkts not decompressed: 0, #pkts decompress failed: 0<br/>     #send errors 0, #recv errors 0<br/> <br/>      local crypto endpt.: 172.31.1.218, remote crypto endpt.: 10.252.15.6<br/>      path mtu 1500, ip mtu 1500, ip mtu idb GigabitEthernet0/1<br/>      current outbound spi: 0xF4B4F10(256593680)<br/> <br/>      inbound esp sas:<br/>       spi: 0x766F7231(1987015217)<br/>         transform: esp-aes esp-sha-hmac ,<br/>         in use settings ={Tunnel, }<br/>         conn id: 3005, flow_id: Onboard VPN:5, crypto map: VPN-SG-HN<br/>         sa timing: remaining key lifetime (k/sec): (4442319/3469)<br/>         IV size: 16 bytes<br/>         replay detection support: Y<br/> <font color='red'>        Status: ACTIVE </font><br/> <br/>      inbound ah sas:<br/> <br/>      inbound pcp sas:<br/> <br/>      outbound esp sas:<br/>       spi: 0xF4B4F10(256593680)<br/>         transform: esp-aes esp-sha-hmac ,<br/>         in use settings ={Tunnel, }<br/>         conn id: 3006, flow_id: Onboard VPN:6, crypto map: VPN-SG-HN<br/>         sa timing: remaining key lifetime (k/sec): (4441189/3469)<br/>         IV size: 16 bytes<br/>         replay detection support: Y<br/>         Status: ACTIVE<br/> <br/>      outbound ah sas:<br/> <br/>      outbound pcp sas:<br/> <br/>    protected vrf: (none)<br/>    local  ident (addr/mask/prot/port): (10.128.16.0/255.255.240.0/0/0)<br/>    remote ident (addr/mask/prot/port): (172.16.128.0/255.255.252.0/0/0)<br/>    current_peer 10.252.15.6 port 500<br/>      PERMIT, flags={origin_is_acl,}<br/>     #pkts encaps: 0, #pkts encrypt: 0, #pkts digest: 0<br/> <font color='red'>    #pkts decaps: 6, #pkts decrypt: 6, #pkts verify: 6 </font><br/>     #pkts compressed: 0, #pkts decompressed: 0<br/>     #pkts not compressed: 0, #pkts compr. failed: 0<br/>     #pkts not decompressed: 0, #pkts decompress failed: 0<br/>     #send errors 0, #recv errors 0<br/> <br/>      local crypto endpt.: 172.31.1.218, remote crypto endpt.: 10.252.15.6<br/>      path mtu 1500, ip mtu 1500, ip mtu idb GigabitEthernet0/1<br/>      current outbound spi: 0x7675CCC0(1987431616)<br/> <br/>      inbound esp sas:<br/>       spi: 0x2C2DE7CF(741205967)<br/>         transform: esp-aes esp-sha-hmac ,<br/>         in use settings ={Tunnel, }<br/>         conn id: 3003, flow_id: Onboard VPN:3, crypto map: VPN-SG-HN<br/>         sa timing: remaining key lifetime (k/sec): (4581032/62)<br/>         IV size: 16 bytes<br/>         replay detection support: Y<br/>         Status: ACTIVE<br/>       spi: 0x9875DB42(2557860674)<br/>         transform: esp-aes esp-sha-hmac ,<br/>         in use settings ={Tunnel, }<br/>         conn id: 3002, flow_id: Onboard VPN:2, crypto map: VPN-SG-HN<br/>         sa timing: remaining key lifetime (k/sec): (4427799/3596)<br/>         IV size: 16 bytes<br/>         replay detection support: Y<br/>         Status: ACTIVE<br/> <br/>      inbound ah sas:<br/> <br/>      inbound pcp sas:<br/> <br/>      outbound esp sas:<br/>       spi: 0x1084C9E4(277137892)<br/>         transform: esp-aes esp-sha-hmac ,<br/>         in use settings ={Tunnel, }<br/>         conn id: 3004, flow_id: Onboard VPN:4, crypto map: VPN-SG-HN<br/>         sa timing: remaining key lifetime (k/sec): (4581033/62)<br/>         IV size: 16 bytes<br/>         replay detection support: Y<br/>         Status: ACTIVE<br/>       spi: 0x7675CCC0(1987431616)<br/>         transform: esp-aes esp-sha-hmac ,<br/>         in use settings ={Tunnel, }<br/>         conn id: 3001, flow_id: Onboard VPN:1, crypto map: VPN-SG-HN<br/>         sa timing: remaining key lifetime (k/sec): (4427799/3596)<br/>         IV size: 16 bytes<br/>         replay detection support: Y<br/>         Status: ACTIVE<br/> <br/>      outbound ah sas:<br/> <br/>      outbound pcp sas:<br/> <br/> &nbsp;
		</blockquote><br/> <br/> Thêm 1 lệnh để kiểm tra quá trình thiết lập IKE<br/> <blockquote>sh crypto isakmp sa<br/> dst             src             state          conn-id slot status<br/> 172.31.1.218    10.252.15.6     QM_IDLE              3    0 ACTIVE<br/> &nbsp;
		</blockquote><br/> Trong quá trình làm và debug. Nhớ enable debug crypto isakmp và ipsec lên để theo dõi nhé.<br/> Các bạn sẽ thấy được quá trình làm việc, thiết lập thông số giữa 2 peers.<br/> <br/> Thôi đi ngủ. Good night. <img src="/hvaonline/images/smilies/274a01ad7ad7ad7d73d5f0b399ae5db2.gif" border="0" alt="smilie" align="absbottom">  <img src="/hvaonline/images/smilies/068ae40523a24c9ef54edefd375e542d.gif" border="0" alt="smilie" align="absbottom"> </span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>

		  <tr>
			<td height="20" colspan="2" valign="bottom" class="rowButton"><span class="gensmall">Hãy sống có Tuệ Giác.</span></td>
		  </tr>

			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Cơ chế hoạt động và cách cấu hình VPN IP Sec trên router Cisco<a name="184277" id="184277"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">22/06/2009 21:22:57 (+0700) | <a href="/hvaonline/posts/list/5816.html#184277">#18</a> | 184277 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/199565.html"><b>lamnk</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 22/06/2009 08:54:22<br>
		Messages: 1<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/199565.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/199565.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row2">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row2"><span class="postbody">Cảm ơn bác thangdiablo đã viết bài rất chi tiết.<br/> <br/> Em thấy trong nhiều cấu hình VPN, định nghĩa cho DH group khá là quan trọng mà trong bài này không thấy bác nhắc đến ? </span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>


			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Cơ chế hoạt động và cách cấu hình VPN IP Sec trên router Cisco<a name="184286" id="184286"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">22/06/2009 22:44:51 (+0700) | <a href="/hvaonline/posts/list/5816.html#184286">#19</a> | 184286 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/21000.html"><b>thangdiablo</b></a><br>
	<font color="#3366CC">HVA Friend</font></span>
<br>

<span class="uprofile">
		
</span>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 11/05/2003 17:31:58<br>
		Messages: 734<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/21000.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/21000.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
			<a href="http://vntaekwondo.com" target="_new"><img src="/hvaonline/templates/viet/images/icon_www.gif" alt="[WWW]" title="[www]"></a>
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row1">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row1"><span class="postbody"><p></p>
		<cite class="blockquote">lamnk wrote:</cite><br>
		<blockquote>Cảm ơn bác thangdiablo đã viết bài rất chi tiết.<br/> <br/> Em thấy trong nhiều cấu hình VPN, định nghĩa cho DH group khá là quan trọng mà trong bài này không thấy bác nhắc đến ? &nbsp;
		</blockquote><br/> <br/> DH? Ý bạn là thuật toán ( giao thức ) Diffie-Hellman? Nếu bạn thấy nó quan trọng thì mình nói  <img src="/hvaonline/images/smilies/3019f422209a6593f02fad5560f36b79.gif" border="0" alt="smilie" align="absbottom"> <br/> Nhưng chi tiết thuật toán Diffie-Hellman chắc phải nhường cho alice ( nghiên cứu về cryptography )<br/> <br/> Đa số trong các Router Cisco thường hỗ trợ group DH là group 1, 2 và 5. Ngoài ra còn có cả DH group  7<br/> Thuật toán Diffie-Hellman dùng để generate ra key đối xứng ở Phrase 2 ( trong quá trình thiết lập  Security Associate cho IP Sec)<br/> Với các DH có group càng lớn thì khả năng mã hóa  key càng cao. <br/> Tuy nhiên, đi cùng với khả năng bảo mật cao dẫn tới thời gian xử lý càng lâu. Cái gì cũng có 2 mặt lợi/hại nên thường thì khi cấu hình DH mình hay chọn group 2 với modulus 1024 bits.<br/> <br/> Lưu ý: 2 peer luôn luôn phải thống nhất cùng 1 DH group.</span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>

		  <tr>
			<td height="20" colspan="2" valign="bottom" class="rowButton"><span class="gensmall">Hãy sống có Tuệ Giác.</span></td>
		  </tr>

			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td valign="middle" align="right" class="nav"></td>
	</tr>
</table>

<!-- quick reply -->
<table class="forumline" cellspacing="1" cellpadding="3" width="100%" border="0" align="center">
</table>

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="10"></td>
	</tr>
</table>

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td align="left">
			<!-- watch - unwatch -->
			<!-- add bookmark -->

		</td>
		<td align="right" valign="bottom">			
		</td>
	</tr>
</table>

<!-- mod -->

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td colspan="3"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="10"></td>
	</tr>
</table>

<!-- combo navigator -->
<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td align="left"><a href="http://digg.com/submit?phrase=2&url=/hvaonline/posts/list/5816.html"><img src="/hvaonline/templates/viet/images/digg.gif" align="texttop" alt="[digg]" title="[digg]"></a>
<a href="http://del.icio.us/post?url=/hvaonline/posts/list/5816.html"><img src="/hvaonline/templates/viet/images/delicious.gif" align="texttop" alt="[delicious]" title="[delicious]"></a>
<a href="http://www.google.com/bookmarks/mark?op=edit&output=popup&bkmk=/hvaonline/posts/list/5816.html"><img src="/hvaonline/templates/viet/images/google.gif" align="texttop" alt="[google]" title="[google]"></a>
<a href="http://bookmarks.yahoo.com/toolbar/savebm?opener=tb&u=/hvaonline/posts/list/5816.html"><img src="/hvaonline/templates/viet/images/yahoo.gif" align="texttop" alt="[yahoo]" title="[yahoo]"></a>
<a href="http://technorati.com/faves?add=/hvaonline/posts/list/5816.html"><img src="/hvaonline/templates/viet/images/technorati.gif" align="texttop" alt="[technorati]" title="[technorati]"></a>
<a href="http://reddit.com/submit?url=/hvaonline/posts/list/5816.html"><img src="/hvaonline/templates/viet/images/reddit.gif" align="texttop" alt="[reddit]" title="[reddit]"></a>
<a href="http://www.stumbleupon.com/submit?url=/hvaonline/posts/list/5816.html"><img src="/hvaonline/templates/viet/images/stumbleupon.gif" align="texttop" alt="[stumbleupon]" title="[stumbleupon]"></a></td>
		<td align="right">	<table cellspacing="0" cellpadding="0" border="0">
		<tr>			  
			<td nowrap="nowrap">
				<form action="" name="f" id="f" accept-charset="UTF-8">
					<span class="gensmall">Go to:&nbsp;</span>
					<select onchange="if(this.options[this.selectedIndex].value > 0){ document.location = '/hvaonline/forums/show/'+ this.options[this.selectedIndex].value +'.html'; }" name="select">
						<option value="0" selected="selected">Select a forum</option>				
							<option value="0">-------------</option>
									<option value="2" >Thông báo từ HVA</option>
									<option value="41" >FAQ - Các câu hỏi thường gặp</option>
									<option value="5" >Góp ý và Hỏi đáp thắc mắc chung</option>
									<option value="6" >Kiểm tra bảo mật</option>
							<option value="0">-------------</option>
									<option value="8" selected="selected">Thảo luận bảo mật</option>
									<option value="12" >Thảo luận thâm nhập</option>
									<option value="28" >Thảo luận virus, trojan, spyware, worm...</option>
									<option value="36" >Thủ thuật reverse engineering</option>
									<option value="13" >Thông tin new bugs và exploits</option>
									<option value="51" >Case Studies</option>
							<option value="0">-------------</option>
									<option value="23" >Thảo luận hệ điều hành Windows</option>
									<option value="24" >Thảo luận hệ điều hành *nix</option>
									<option value="26" >Thảo luận các loại thiết bị máy tính</option>
									<option value="31" >Thảo luận mạng và thiết bị mạng</option>
									<option value="27" >Thông tin về các địa chỉ và tài liệu hữu ích</option>
							<option value="0">-------------</option>
									<option value="44" >Người tìm việc - Việc tìm người</option>
									<option value="21" >Thảo luận việc định hướng</option>
									<option value="19" >Những thảo luận khác</option>
									<option value="50" >Hình minh họa</option>
									<option value="33" >Trash</option>
							<option value="0">-------------</option>
					</select>
				</form>
			</td>
		</tr>
	</table>
</td>
	</tr>
</table>

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td colspan="3"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="10"></td>
	</tr>
</table>

<!-- list users in -->
<table class="forumline" cellspacing="3" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<th class="thright"  nowrap="nowrap" height="26" valign="middle">&nbsp;Users currently in here&nbsp;</th>
	</tr>
		<tr>
			<td class="gensmall" valign="middle" align="left">
				1 Anonymous 
				
			</td>	
		</tr>
</table>
<a name="quick"></a>

<table cellspacing="0" cellpadding="0" width="100%" border="0"  align="center">

	<tr>	
		<td align="center">
		<br>
					</td>
	</tr>

	<tr>
		<td align="center">
			<span class="copyright">Powered by JForum - Extended by <a href="MailTo:lienlac@hvaonline.net">HVAOnline</a><br>
			&nbsp;hvaonline.net&nbsp; | &nbsp;hvaforum.net&nbsp; | &nbsp;hvazone.net&nbsp; | &nbsp;hvanews.net&nbsp; | &nbsp;vnhacker.org<br>
			1999 - 2013 &copy;
			v2012|0504|218|
		  </span>
	  </td>
	</tr>
<iframe src="/hvaonline/templates/ping_session.html" height="0" width="0" frameborder="0" scrolling="no"></iframe>
</body>
</html>
</table>

<script type="text/javascript" src="/hvaonline/templates/viet/js/post_show.js"></script>
<script type="text/javascript" src="/hvaonline/templates/viet/js/post.js"></script>
<script type="text/javascript" src="/hvaonline/templates/viet/js/avim.js"></script>
<script type="text/javascript">
<!--
function showEmail(beforeAt, afterAt)
{
	return beforeAt + "@" + afterAt;
}

var starOn=new Image();
starOn.src="/hvaonline/templates/viet/images/star_on.gif";

var starOff=new Image();
starOff.src="/hvaonline/templates/viet/images/star_off.gif";

function writeStars(q, postId)
{
	for (var i = 0; i < 5; i++) {
		var name = "star" + postId + "_" + i;
		document.write("<img name='" + name + "' alt='*' />");
		document.images[name].src = q > i ? starOn.src : starOff.src;
	}
}

function addBookmark(relationType, relationId)
{
	var w = window.open('/hvaonline/bookmarks/insert/' + relationType + '/' + relationId + '.html', 'bookmark_add', 'width="700", height="100", scrollbars="no"');
	w.focus();
}

function supportAjax()
{
	if (typeof(AjaxUtils) != 'undefined') {
		if (window.ActiveXObject) {
			var r = new ActiveXObject("Microsoft.XMLHTTP");
			return r != undefined;
		}
		else if (window.XMLHttpRequest) {
			return true;
		}
	}

	return false;
}




function maxImg(foto, maxSize){
w = foto.width;
if (w > maxSize){
	foto.width = maxSize;
	}
} 

-->
</script>
