<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"> 

<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="-1">
<meta name="description" content="HVA discussion board">
<meta name="keywords" content="Cần ai hiểu sâu về SQL Server giúp đỡ tìm nguyên nhân SQL chậm, jforum, jforum java, jforum forum, forum java, java jforum, java forum, forum, rafael steil, bulletin board, java bb, javabb, hva, hvaonline, hvazone, hvaforum">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="robots" content="index,follow">
<meta name="rating" content="general">
<style type="text/css">
<!-- 
@import url( "/hvaonline/templates/viet/styles/style.css");
-->
</style>
<style type="text/css">
<!--
@import url("/hvaonline/templates/viet/styles/en_US.css");
-->
</style>
<title>Cần ai hiểu sâu về SQL Server giúp đỡ tìm nguyên nhân SQL chậm - .:: HVAOnline ::.</title>

</head>
<body class="en_US">


<!--
Original theme from phpBB (http://www.phpbb.com) subSilver
Created by subBlue design
http://www.subBlue.com
Modifications by JForum Team 
Extended and customised by HVA Team
Added more features and Black Silver theme designed by HVA
-->
<table width="100%" border="0" cols="2">
	<tr align="right">
		<td class="copyright">
			English
			| 
			<a href="/hvaonline/jforum.html?module=forums&amp;action=setLang&amp;lang=vi_VN" rel="nofollow">Vietnamese</a>
		</td>
	</tr>
</table>
<table width="100%" border="0">
	<tr>
		<td>
			<table cellspacing="0" cellpadding="0" width="100%" border="0">
				<tr>			
        <td>&nbsp;
			</td>
		
        <td width="100%" align="center" valign="middle">
						<p><a href="" title="[Logo]">
								<img src="/hvaonline/templates/viet/images/hvabanner-final.gif" alt="banner" />
							<br>
            				</a><span class="maintitle"></span>
						</p>
          <table cellspacing="0" cellpadding="2" border="0">
							<tr>
								
              <td valign="top" nowrap="nowrap" align="center">
			  						<a href="/hvaonline/forums/rule.html"><img src="/hvaonline/templates/viet/images/icon_mini_rule.gif" alt="[Rule]" title="[Rule]"></a>
									<a id="rule" class="topmenu" href="/hvaonline/forums/rule.html">Rules</a>&nbsp;
									
									<a class="topmenu" href="/hvaonline/forums/list.html"><img src="/hvaonline/templates/viet/images/icon_mini_groups.gif" alt="[Home]" title="[Home]"></a>
										<a id="backtosite" class="topmenu" href="/hvaonline/forums/list.html">Main Forum</a>&nbsp;

										<a class="topmenu" href="/hvaonline/portal/list.html"><img src="/hvaonline/templates/viet/images/icon_mini_portal.gif" alt="[Portal]" title="[Portal]"></a>
										<a id="portalsite" class="topmenu" href="/hvaonline/portal/list.html">Portal</a>&nbsp;&nbsp;
									<br>
									
										<a href="/hvaonline/user/list.html"><img src="/hvaonline/templates/viet/images/icon_mini_members.gif" alt="[Members]" title="[Members]"></a>
										<a id="users" class="topmenu" href="/hvaonline/user/list.html">Member Listing</a>&nbsp;
										
										<a href="/hvaonline/forums/stats.html"><img src="/hvaonline/templates/viet/images/icon_mini_stats.gif" alt="[Statistics]" title="[Statistics]"></a>
										<a id="stats" class="topmenu" href="/hvaonline/forums/stats.html">Statistics</a>&nbsp;
										
										<a href="/hvaonline/search/filters.html"><img src="/hvaonline/templates/viet/images/icon_mini_search.gif" alt="[Search]" title="[Search]"></a>
										<span class="mainmenu"><a id="search" class="topmenu" href="/hvaonline/search/filters.html"><b>Search</b></a>&nbsp;
									
										<a href="/book/"><img src="/hvaonline/templates/viet/images/icon_mini_book.gif" alt="[Reading Room]" title="[Reading Room]"></a> 
										<a class="topmenu" href="/hvaonline/readingRoom/list.html">Reading Room</a>&nbsp;

									
									<span class="topmenu"> 
										

	
										<br>
											<a id="register" class="topmenu" href="/hvaonline/user/insert.html"><img src="/hvaonline/templates/viet/images/icon_mini_register.gif" border="0" alt="[Register]" title="[Register]"> 
												Register</a>&nbsp;&nbsp;</span>
											<img src="/hvaonline/templates/viet/images/icon_mini_login.gif" border="0" alt="[Login]" title="[Login]"> 
											<strong>Login</strong> [&nbsp;
											<a id="login" class="topmenu" href="/hvaonline/user/login.html">http</a>&nbsp;
											|
											<a id="logins" class="topmenu" href="https://www.hvaonline.net/hvaonline/user/logins.html">https </a>&nbsp;]</span>
								</td>
							</tr>
							<tr>
								<td>&nbsp;</td>
							</tr>
						</table>
					</td>
				</tr>
			</table>
		</td>
	</tr>
	<tr>
		<td>

<!-- navigator -->
<table cellspacing="2" cellpadding="2" width="100%" border="0" align="center">
	<tr>
		<td valign="baseline" align="left" colspan="0">
			<span class="nav">
			<a class="nav" href="/hvaonline/forums/list.html">Forum Index </a> 
			<img src="/hvaonline/templates/viet/images/en_US/arrow.gif"> <a class="nav" href="/hvaonline/forums/show/23.html">Thảo luận hệ điều hành Windows </a>
			<img src="/hvaonline/templates/viet/images/en_US/arrow.gif"> <a class="nav" href="/hvaonline/posts/list/35132.html" name="top" id="top">Cần ai hiểu sâu về SQL Server giúp đỡ tìm nguyên nhân SQL chậm</a>
				&nbsp;<a href="/hvaonline/rss/topicPosts/35132.html"><img src="/hvaonline/templates/viet/images/xml_button.gif" border="0" alt="XML"></a>
			</span>
		
		</td>

		<td valign="middle" align="right" class="nav"></td>
	</tr>
</table>

<!-- poll show -->

  <!-- POST LISTING -->


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#33CC33">[Discussion]</font></span>&nbsp;&nbsp; Cần ai hiểu sâu về SQL Server giúp đỡ tìm nguyên nhân SQL chậm<a name="215867" id="215867"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">21/07/2010 10:14:35 (+0700) | <a href="/hvaonline/posts/list/35132.html#215867">#1</a> | 215867 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/71831.html"><b>lama</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 14/06/2004 20:27:02<br>
		Messages: 40<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/71831.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/71831.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row1">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row1"><span class="postbody">Chào mọi người,<br/> <br/> Mình đang gặp khó khăn với ứng dụng ERP có dữ liệu lớn (hiện tại khỏang 20GB/company, tổng file .mdf bao gồm nhiều company là 50GB)<br/> Khi in các báo cáo Tồn kho và Doanh số thì truy xuất hệ thống chậm và thậm chí treo 1 số máy ở bộ phận nhập liệu Đơn hàng/hóa đơn.<br/> Mình không chuyên sâu về SQL và không tìm được nguyên nhân gây ra vấn đề ở đây. Vậy có bạn nào hiểu sâu về SQL cũng như cách thức tìm nguyên nhân, tối ưu hóa SQL thì giúp mình với.<br/> <br/> Nếu vấn đề này không thể chia sẻ trên diễn đàn, bạn có thể liên hệ trực tiếp mình cũng được. Xem như là mình đang tìm dịch vụ vậy mà.<br/> <br/> Mọi người ai biết ai rành thì cũng chỉ giúp mình nhé.<br/> <br/> Cám ơn nhiều.<br/> <br/> Thông tin thêm :<br/> <br/> Server IBM x3650 2x3.0Ghz Quad Core, 6GB RAM, 5x146GB SAS RAID5, Windows 2003 Ent SP1, SQL Server 2005 Ent.<br/> Lúc bị treo đó thì thấy RAM, CPU trên Server cũng ở mức thấp (chừng 20%=30%), không bị overload.<br/> <br/> Nguyễn Phúc Nguyên<br/> 0909.899.235<br/> </span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>


			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#33CC33">[Discussion]</font></span>&nbsp;&nbsp; Cần ai hiểu sâu về SQL Server giúp đỡ tìm nguyên nhân SQL chậm<a name="215869" id="215869"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">21/07/2010 10:27:05 (+0700) | <a href="/hvaonline/posts/list/35132.html#215869">#2</a> | 215869 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>
<td width="20">
		<img src="/hvaonline/images/avatar/089f41810321eefc3f4eef5d4a388e42.png" border="0" alt="[Avatar]" title="[Avatar]"><br>
	</td>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/67588.html"><b>conmale</b></a><br>
	<font color="#FF3333">Administrator</font></span>
<br>

<span class="uprofile">
		
</span>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 07/05/2004 23:43:15<br>
		Messages: 9353<br>
	
		Location: down under<br>
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/67588.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/67588.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row2">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row2"><span class="postbody"><p></p>
		<cite class="blockquote">lama wrote:</cite><br>
		<blockquote>Chào mọi người,<br/> <br/> Mình đang gặp khó khăn với ứng dụng ERP có dữ liệu lớn (hiện tại khỏang 20GB/company, tổng file .mdf bao gồm nhiều company là 50GB)<br/> Khi in các báo cáo Tồn kho và Doanh số thì truy xuất hệ thống chậm và thậm chí treo 1 số máy ở bộ phận nhập liệu Đơn hàng/hóa đơn.<br/> Mình không chuyên sâu về SQL và không tìm được nguyên nhân gây ra vấn đề ở đây. Vậy có bạn nào hiểu sâu về SQL cũng như cách thức tìm nguyên nhân, tối ưu hóa SQL thì giúp mình với.<br/> <br/> Nếu vấn đề này không thể chia sẻ trên diễn đàn, bạn có thể liên hệ trực tiếp mình cũng được. Xem như là mình đang tìm dịch vụ vậy mà.<br/> <br/> Mọi người ai biết ai rành thì cũng chỉ giúp mình nhé.<br/> <br/> Cám ơn nhiều.<br/> <br/> Thông tin thêm :<br/> <br/> Server IBM x3650 2x3.0Ghz Quad Core, 6GB RAM, 5x146GB SAS RAID5, Windows 2003 Ent SP1, SQL Server 2005 Ent.<br/> Lúc bị treo đó thì thấy RAM, CPU trên Server cũng ở mức thấp (chừng 20%=30%), không bị overload.<br/> <br/> Nguyễn Phúc Nguyên<br/> 0909.899.235<br/> &nbsp;
		</blockquote><br/> <br/> W2k3 và MSSQL này chạy phiên bản 32-bit hay 64-bit?<br/> <br/> Phương thức kết nối và "commit data" từ các applications đến CSDL cụ thể như thế nào?</span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>

		  <tr>
			<td height="20" colspan="2" valign="bottom" class="rowButton"><span class="gensmall">What bringing us together is stronger than what pulling us apart.</span></td>
		  </tr>

			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#33CC33">[Discussion]</font></span>&nbsp;&nbsp; Cần ai hiểu sâu về SQL Server giúp đỡ tìm nguyên nhân SQL chậm<a name="215874" id="215874"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">21/07/2010 11:05:15 (+0700) | <a href="/hvaonline/posts/list/35132.html#215874">#3</a> | 215874 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/64819.html"><b>qtra004</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 19/04/2004 22:36:57<br>
		Messages: 298<br>
	
		Location: Kiwiland<br>
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/64819.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/64819.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row1">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row1"><span class="postbody">Ngoài những thông tin anh conmale hỏi? Bạn có thể dùng Activity Monitor trên SQL Management Studio để xem lúc application chạy report, những query gì đang chạy và những process có bị lock không? Loại lock là gì? Nếu bạn biết được sql query của process để generate report thì bạn thảy lên đây để mình xem thử xem query đó có optimised cho performance chưa? <br/> <br/> Bạn cũng có thể dùng SQL Sever Profiler để trace performance của SQL lúc bạn chạy report từ application.</span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>

		  <tr>
			<td height="20" colspan="2" valign="bottom" class="rowButton"><span class="gensmall">Carpe diem quam minimum credula postero</span></td>
		  </tr>

			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#33CC33">[Discussion]</font></span>&nbsp;&nbsp; Cần ai hiểu sâu về SQL Server giúp đỡ tìm nguyên nhân SQL chậm<a name="215942" id="215942"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">21/07/2010 22:09:07 (+0700) | <a href="/hvaonline/posts/list/35132.html#215942">#4</a> | 215942 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/71831.html"><b>lama</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 14/06/2004 20:27:02<br>
		Messages: 40<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/71831.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/71831.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row2">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row2"><span class="postbody"><p></p>
		<cite class="blockquote">conmale wrote:</cite><br>
		<blockquote><br/> W2k3 và MSSQL này chạy phiên bản 32-bit hay 64-bit?<br/> <br/> Phương thức kết nối và "commit data" từ các applications đến CSDL cụ thể như thế nào?&nbsp;
		</blockquote><br/> <br/> Dạ, W2k3 và SQL thì đều đang chạy 32 bit. Em không rõ lắm cách "commit data" của Application. Nhưng biết là ứng dụng gọi các COM+ App và DCOM, trong database thì em không thấy lưu các Stored Proc phục vụ insert,update,delete dữ liệu gì cả, chỉ có 1 vài stored phục vụ đăng nhập, phân quyền, ... Đây là 1 ứng dụng ERP cũng ở tầm trung và brochure thì cũng có nói là dữ liệu được mã hoá gởi giữa Client đến Server (ứng dụng chạy Client/Server). Không đề cập đến cơ chế hoạt động bên dưới nên em không được biết.<br/> <br/> <p></p>
		<cite class="blockquote">qtra004 wrote:</cite><br>
		<blockquote><br/> Ngoài những thông tin anh conmale hỏi? Bạn có thể dùng Activity Monitor trên SQL Management Studio để xem lúc application chạy report, những query gì đang chạy và những process có bị lock không? Loại lock là gì? Nếu bạn biết được sql query của process để generate report thì bạn thảy lên đây để mình xem thử xem query đó có optimised cho performance chưa? <br/> &nbsp;
		</blockquote><br/> <br/> Mình sẽ thử xem sao, có gì sẽ post lên đây nhờ mọi người giúp đỡ.<br/> <br/> À, quên nói 1 vấn đề quan trọng là Các báo cáo mà mình đề cập bên trên là Báo cáo do công ty Customize, mình nghĩ chắc cách viết không tối ưu, gây lock table hay sao (trình độ coding của người customize báo cáo có hạn, mình cũng không rành nên đọc code cũng không tìm ra chổ nào để tối ưu được). Các báo cáo có sẵn của chương trình thì mặc dù in lâu nhưng không làm treo các máy con nhập liệu Hoá đơn.<br/> <br/> Cám ơn mọi người nhiều lắm.</span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>


			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#33CC33">[Discussion]</font></span>&nbsp;&nbsp; Cần ai hiểu sâu về SQL Server giúp đỡ tìm nguyên nhân SQL chậm<a name="215945" id="215945"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">21/07/2010 22:43:04 (+0700) | <a href="/hvaonline/posts/list/35132.html#215945">#5</a> | 215945 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/133880.html"><b>cvhainb</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 04/01/2007 14:32:38<br>
		Messages: 251<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/133880.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/133880.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row1">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row1"><span class="postbody"><b>Mình chỉ có thể góp ý thêm một chút về các vấn đề về truy vấn (query).<br/> <br/> Đối với package lớn như bạn mô tả thì việc các câu truy vấn dữ liệu như thế nào cũng rất quan trọng. Với dữ liệu lớn mà báo cáo khi in ra là trong khoảng thời gian là 1, 2 năm thì việc treo máy cũng là thường.<br/> <br/> Để dễ dàng bạn chỉ nên xem lại đoạn code chỗ nhập liệu, thử xem.<br/> <br/> Thân<br/> <img src="/hvaonline/images/smilies/b5e9b4f86ce43ca65bd79c894c4a924c.gif" border="0" alt="smilie" align="absbottom"></b></span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>


			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#33CC33">[Discussion]</font></span>&nbsp;&nbsp; Cần ai hiểu sâu về SQL Server giúp đỡ tìm nguyên nhân SQL chậm<a name="215947" id="215947"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">21/07/2010 23:12:44 (+0700) | <a href="/hvaonline/posts/list/35132.html#215947">#6</a> | 215947 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/71831.html"><b>lama</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 14/06/2004 20:27:02<br>
		Messages: 40<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/71831.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/71831.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row2">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row2"><span class="postbody"><p></p>
		<cite class="blockquote">cvhainb wrote:</cite><br>
		<blockquote><b>Mình chỉ có thể góp ý thêm một chút về các vấn đề về truy vấn (query).<br/> <br/> Đối với package lớn như bạn mô tả thì việc các câu truy vấn dữ liệu như thế nào cũng rất quan trọng. Với dữ liệu lớn mà báo cáo khi in ra là trong khoảng thời gian là 1, 2 năm thì việc treo máy cũng là thường.<br/> <br/> Để dễ dàng bạn chỉ nên xem lại đoạn code chỗ nhập liệu, thử xem.<br/> <br/> Thân<br/> <img src="/hvaonline/images/smilies/b5e9b4f86ce43ca65bd79c894c4a924c.gif" border="0" alt="smilie" align="absbottom"></b>&nbsp;
		</blockquote><br/> <br/> Cám ơn bạn đã chia sẻ. Ứng dụng ERP này của 1 tập đoàn nước ngoài nên mình không có xem code chổ nhập liệu được.</span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>


			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#33CC33">[Discussion]</font></span>&nbsp;&nbsp; Cần ai hiểu sâu về SQL Server giúp đỡ tìm nguyên nhân SQL chậm<a name="215951" id="215951"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">21/07/2010 23:53:00 (+0700) | <a href="/hvaonline/posts/list/35132.html#215951">#7</a> | 215951 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/71831.html"><b>lama</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 14/06/2004 20:27:02<br>
		Messages: 40<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/71831.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/71831.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row1">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row1"><span class="postbody">Mình post 1 stored proc dùng để Liệt kê các thành phẩm xuất kho. Mỗi ngày có khoảng 200-300 Hoá đơn, mỗi Hoá đơn có khoảng 10 dòng --&gt; khoảng 2000-3000 dòng trong bảng chứa nghiệp vụ xuất kho mỗi ngày (chưa tính nghiệp vụ khác như nhập, chuyển kho (2 nghiệp vụ này ít hơn) .... cũng nằm cúng 1 bảng nghiệp vụ kho này).<br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>set ANSI_NULLS ON
set QUOTED_IDENTIFIER ON
go


ALTER                                   PROCEDURE &#91;dbo&#93;.&#91;GL_BK_ThanhPhamXuat&#93;
		@Para1		NVARCHAR&#40;20&#41;	--@CompID
		,@Para2		NVARCHAR&#40;20&#41;	--@FYear
		
		,@Para3		NVARCHAR&#40;20&#41;	--CustCodeFrom
		,@Para4		NVARCHAR&#40;20&#41;	--CustCodeTo

		,@Para5		NVARCHAR&#40;20&#41;	--StockFrom
		,@Para6		NVARCHAR&#40;20&#41;	--StockTo

		,@Para7		NVARCHAR&#40;20&#41;	--@FromDate
		,@Para8		NVARCHAR&#40;20&#41;	--@ToDate

AS
--&#91;GL_BK_ThanhPhamXuat&#93; '01','10','','','M6009','M6009','100420','100426'
SET NOCOUNT ON
BEGIN
---==DECLARE AND INTINITIALIZE THE GLOBAL VARIANCE==-- 

	DECLARE @CompID as NVARCHAR&#40;20&#41;
	SET @CompID = @Para1
	 
	DECLARE @FYear as NVARCHAR&#40;20&#41;
	SET @FYear = @Para2

	DECLARE @CustCodeFrom as NVARCHAR&#40;20&#41;
	SET @CustCodeFrom = @Para3
	
DECLARE @CustCodeTo as NVARCHAR&#40;20&#41;
	SET @CustCodeTo = @Para4

DECLARE @StockFrom as NVARCHAR&#40;20&#41;
	SET @StockFrom = @Para5

DECLARE @StockTo as NVARCHAR&#40;20&#41;
	SET @StockTo = @Para6

	DECLARE @FromDate as NVARCHAR&#40;20&#41;
	SET @FromDate = @Para7
	 
	DECLARE @ToDate as NVARCHAR&#40;20&#41;
	SET @ToDate = @Para8

	DECLARE @SqlStr NVARCHAR&#40;4000&#41;

	IF EXISTS &#40;SELECT * FROM dbo.sysobjects WHERE id = object_id&#40;N'&#91;dbo&#93;.&#91;tbThanhPhamXuat&#93;'&#41;
						AND OBJECTPROPERTY&#40;id, N'IsUserTable'&#41; = 1&#41;
				DROP TABLE &#91;dbo&#93;.&#91;tbThanhPhamXuat&#93;

	IF EXISTS &#40;SELECT * FROM dbo.sysobjects WHERE id = object_id&#40;N'&#91;dbo&#93;.&#91;tbBangLuuHoaDonChoTPXuat&#93;'&#41;
						AND OBJECTPROPERTY&#40;id, N'IsUserTable'&#41; = 1&#41;
				DROP TABLE &#91;dbo&#93;.&#91;tbBangLuuHoaDonChoTPXuat&#93;
CREATE TABLE tbBangLuuHoaDonChoTPXuat
&#40;
SoHoaDon nvarchar&#40;50&#41;
&#41;
	SET @SqlStr = &quot; INSERT INTO tbBangLuuHoaDonChoTPXuat SELECT &quot;
+&quot; distinct SL03002 from SL03&quot; + @CompID + &quot;00 &quot;
+ &quot;  where 	SL03005 BETWEEN '&quot; + CONVERT&#40;NVARCHAR&#40;10&#41;,convert&#40;datetime,@FromDate&#41;,112&#41; + &quot;'&quot;
		+ &quot;  AND	'&quot; + CONVERT&#40;NVARCHAR&#40;10&#41;,convert&#40;datetime,@ToDate&#41;,112&#41; + &quot;'&quot;
	EXECUTE sp_executesql @SqlStr
update tbBangLuuHoaDonChoTPXuat
set SoHoaDon=Replace &#40;SoHoaDon,'R',''&#41;
--select * from tbBangLuuHoaDonChoTPXuat
	CREATE TABLE tbThanhPhamXuat
	&#40;
		MA_KH			NVARCHAR&#40;20&#41;
		,MA_HANG 		NVARCHAR&#40;20&#41;		
		,TEN_HANG		NVARCHAR&#40;50&#41;	
		,QUY_CACH		NVARCHAR&#40;100&#41;	
		,DON_VI_TINH		NVARCHAR&#40;50&#41;
		,TAI_KHOAN_DU		NVARCHAR&#40;50&#41;
		,SO_LUONG		FLOAT
		,DON_GIA_BAN		FLOAT	
--		,GIA_VON		FLOAT
		,THANH_TIEN		FLOAT
--		,THANH_TIEN_VON		FLOAT
		,MA_KHO			NVARCHAR&#40;50&#41;
--		,TEN_KHO		NVARCHAR&#40;50&#41;
--		,LOAI_NV		NVARCHAR&#40;50&#41;					bo 5/8/09              
--		,TEN_NV		NVARCHAR&#40;50&#41;                        bo 5/8/09 
		,SO_DON_HANG		NVARCHAR&#40;50&#41;
		,SO_HOA_DON		NVARCHAR&#40;50&#41;
		,GHI_CHU		NVARCHAR&#40;50&#41;
		,LOAI_NHAP_XUAT		NVARCHAR&#40;50&#41;
		,TI_LE_CK		NVARCHAR&#40;50&#41;
		,NGAY_HOA_DON		DATETIME	
--,SO_LO NVARCHAR&#40;50&#41;
	&#41;
	SET @SqlStr = &quot; INSERT INTO tbThanhPhamXuat SELECT &quot;
		+ &quot;  SC07006		AS	&#91;MA_KH&#93;&quot;
		+ &quot;, SC07003 		AS 	&#91;MA_HANG&#93;&quot;
		+ &quot;, SC01002		AS 	&#91;TÊN_HÀNG&#93;&quot;
		+ &quot;, SC01003		AS 	&#91;QUY_CACH&#93;&quot;
		+ &quot;, SC01135		AS 	&#91;DON_VI_TINH&#93;&quot;
		+ &quot;, ''			AS 	&#91;TAI_KHOAN_DU&#93;&quot;
		+ &quot;, SC07004		AS 	&#91;SO_LUONG&#93;&quot;
		+ &quot;, ROUND&#40;SC07010,2&#41;	AS 	&#91;DON_GIA_BAN&#93;&quot;
--		+ &quot;, SC07005		AS	&#91;GIA_VON&#93;&quot;
		+ &quot;, 0			AS 	&#91;THANH_TIEN&#93;&quot;
--		+ &quot;, 0			AS 	&#91;THANH_TIEN_VON&#93;&quot;
		+ &quot;, SC07009		AS 	&#91;MA_KHO&#93;&quot;
--		+ &quot;, SC23002		AS 	&#91;TEN_KHO&#93;&quot;	
--		+ &quot;, SUBSTRING&#40;SC07012,49,2&#41;			AS 	&#91;LOAI_NV&#93;&quot;            bo 5/8/09
--		+ &quot;, ''			AS	&#91;TEN_NV&#93;&quot;                                     bo 5/8/09
		+ &quot;, SC07007		AS	&#91;SO_DON_HANG&#93;&quot;
		+ &quot;, SC07056			AS	&#91;SO_HOA_DON&#93;&quot;
		+ &quot;, SC07055			AS	&#91;GHI_CHU&#93;&quot;
		+ &quot;, CONVERT&#40;INT, SC07013&#41;	AS	&#91;LOAI_NHAP_XUAT&#93;&quot;
		+ &quot;, ''				AS	&#91;TI_LE_CK&#93;&quot;
		+ &quot;, '1900/01/01'		AS 	&#91;NGAY_HOA_DON&#93;&quot;
		--+&quot;,SC07029 &quot;
		+ &quot;  FROM 	SC07&quot; + @CompID + &quot;00 INNER JOIN SC01&quot; + @CompID + &quot;00 ON  SC07003 = SC01001&quot;
	--	+ &quot;  INNER JOIN SC23&quot; + @CompID + &quot;00 ON SC07009 = SC23001&quot;
	--	+ &quot;  INNER JOIN SL03&quot; + @CompID + &quot;00 ON SC07056 = SL03002 OR RTRIM&#40;SC07007&#41; + 'R' = SL03002&quot;
		+ &quot;  WHERE 	SC07001 = '01'&quot;
		+ &quot;  AND 	LEFT&#40;SC07003,1&#41; in &#40; 'A','M'&#41;&quot;
--		+ &quot;  AND 	&#40;CONVERT&#40;INT, SC07013&#41; = 49&quot;				-- XUAT BAN
--		+ &quot;  OR		&#40;CONVERT&#40;INT, SC07013&#41; NOT IN &#40;66&#41; AND SC07004 &gt; 0&#41;&#41;&quot;	--TRA HANG TRONG STOCK ISSUED VOI SO LUONG AM
--		+ &quot;  AND	&#40;CONVERT&#40;INT, SC07013&#41; NOT IN &#40;66&#41; AND SC07004 &gt; 0&#41;&#41;&quot;	--TRA HANG TRONG STOCK ISSUED VOI SO LUONG AM
--		+ &quot;  AND 	SC07009 BETWEEN '&quot; + @WareCodeFrom + &quot;' AND '&quot; + @WareCodeTo + &quot;'&quot;
	--	+ &quot;  AND	SL03005 BETWEEN '&quot; + CONVERT&#40;NVARCHAR&#40;10&#41;,@FromDate,112&#41; + &quot;'&quot;
		--+ &quot;  AND	'&quot; + CONVERT&#40;NVARCHAR&#40;10&#41;,@ToDate,112&#41; + &quot;'&quot;
+&quot; and SC07056 in &#40;select SoHoaDon from tbBangLuuHoaDonChoTPXuat&#41;&quot;
		+ &quot;  AND 	SUBSTRING&#40;SC07012,49,2&#41; &lt;&gt; '92'&quot;             
--if @CustCodeFrom&lt;&gt;''
--SET @SqlStr =@SqlStr  + &quot; and SC07006 between '&quot; +@CustCodeFrom+&quot;' and '&quot;+@CustCodeTo+&quot;'&quot;
--
if @StockFrom &lt;&gt;''
SET @SqlStr =@SqlStr  + &quot; and  SC07003 between '&quot; +@StockFrom+&quot;' and '&quot;+@StockTo+&quot;'&quot;


		SET @SqlStr =@SqlStr  + &quot;  ORDER BY 	SC01002&quot;
print @SqlStr
		EXECUTE sp_executesql @SqlStr

--SELECT * FROM tbThanhPhamXuat ORDER BY SO_DON_HANG

 
/*
	UPDATE 	tbThanhPhamXuat
	SET 	THANH_TIEN_VON = SO_LUONG * GIA_VON
*/
	SET @SqlStr = &quot;	UPDATE tbThanhPhamXuat&quot;
		+ &quot; SET		SO_HOA_DON  =	OR20021&quot;
		+ &quot;		,TI_LE_CK   = 	OR20051&quot;
		+ &quot;		,NGAY_HOA_DON   = 	OR20022&quot;
		+ &quot; FROM 	tbThanhPhamXuat, OR20&quot; + @CompID + &quot;00&quot;
		+ &quot; WHERE 	SO_DON_HANG = OR20001&quot;


		EXECUTE sp_executesql @SqlStr
/*
SELECT * FROM tbThanhPhamXuat
WHERE SO_DON_HANG = '0309000040'
*/
	UPDATE tbThanhPhamXuat
	SET 	SO_HOA_DON 	= 	SO_DON_HANG
	WHERE 	SO_HOA_DON  = 	''


	-----------------------------------
	--GIA DUOI KHO KHAC TREN DON HANG--
	-----------------------------------

	UPDATE tbThanhPhamXuat
	SET DON_GIA_BAN = 0
	WHERE SO_HOA_DON = '08/0109319'

	UPDATE tbThanhPhamXuat
	SET DON_GIA_BAN = 368.6
	WHERE SO_HOA_DON = '08/083294'
	
	DELETE tbThanhPhamXuat
	WHERE SO_DON_HANG = '08/076853' --ĐIỀU CHỈNH HỦY HĐ CỦA THÁNG KHÁC
	-----------------------------------


	UPDATE 	tbThanhPhamXuat
	SET 	THANH_TIEN = SO_LUONG * ROUND&#40;DON_GIA_BAN, 2&#41;

	SET @SqlStr = &quot;	UPDATE tbThanhPhamXuat&quot;
		+ &quot; SET		GHI_CHU  =	OR22008&quot;
		+ &quot; FROM 	tbThanhPhamXuat, OR22&quot; + @CompID + &quot;00&quot;
		+ &quot; WHERE 	SO_DON_HANG = OR22001&quot;


		EXECUTE sp_executesql @SqlStr

--	SET @SqlStr = &quot; UPDATE tbThanhPhamXuat&quot;                                  -- bo 5/8/09
----		+ &quot; SET 	TEN_NV = GL03003&quot;--, MO_TA = GL03004&quot;                -- doan nay
--		+ &quot; FROM	tbThanhPhamXuat, GL03&quot; + @CompID + @FYear                --
----		+ &quot; WHERE	LOAI_NV = GL03002&quot;                                   --  
--		+ &quot; AND 	GL03001 = 'J'&quot;                                           --
--
--		EXECUTE sp_executesql @SqlStr                                        --

	---------------------------------------------------
	 /* Dinh nghia bang tam luu don vi tinh &#40;Unit&#41; */
	---------------------------------------------------
	IF EXISTS&#40;SELECT name FROM sysobjects WHERE name = 'tbUnitText_ThahPhamXuat'&#41;
		DROP TABLE tbUnitText_ThahPhamXuat

	DECLARE @dem AS INT
	SET @dem = 1

	CREATE TABLE tbUnitText_ThahPhamXuat
	&#40;
		idcol int primary key
		,UnitText nvarchar&#40;50&#41;
	&#41;
	
	SET @dem = 0
	WHILE @dem &lt;= 40
	  BEGIN
		IF @dem &lt;= 7
			SET @SqlStr = &quot; INSERT INTO tbUnitText_ThahPhamXuat &quot;
						+ &quot; SELECT '&quot; + CONVERT&#40;nvarchar, @dem&#41;  + &quot;', SC0900&quot; + CONVERT&#40;nvarchar,&#40;@dem + 2&#41;&#41; 
						+ &quot; FROM SC09&quot; + @CompID + &quot;00 WHERE SC09001 = 'AME'&quot;
		ELSE
			SET @SqlStr = &quot;INSERT INTO tbUnitText_ThahPhamXuat &quot;
						+ &quot; SELECT '&quot; + CONVERT&#40;nvarchar, @dem&#41;  + &quot;', SC090&quot; + CONVERT&#40;nvarchar,&#40;@dem + 2&#41;&#41; 
						+ &quot; FROM SC09&quot; + @CompID + &quot;00 WHERE SC09001 = 'AME'&quot;
	
		EXECUTE sp_executesql @SqlStr
		SET @dem = @dem + 1
	  END

	UPDATE tbThanhPhamXuat
	SET 	DON_VI_TINH = UnitText
	FROM	tbThanhPhamXuat, tbUnitText_ThahPhamXuat
	WHERE 	DON_VI_TINH = idcol



	SET @SqlStr = &quot; UPDATE tbThanhPhamXuat&quot;
		+ &quot; SET	TAI_KHOAN_DU = SUBSTRING&#40;SL04006, 1, 4&#41;&quot;
		+ &quot; FROM	tbThanhPhamXuat, SL04&quot; + @CompID + @FYear	--CO DINH MA CONG TY, NAM TAI CHINH	
		+ &quot; WHERE 	SO_HOA_DON = SL04013&quot;
		+ &quot; AND		LEFT&#40;SL04006,4&#41; IN &#40;'5112', '5122', '5312','5111'&#41;&quot;


		EXECUTE sp_executesql @SqlStr


	SET @SqlStr = &quot; UPDATE tbThanhPhamXuat&quot;
		+ &quot; SET	TAI_KHOAN_DU = SUBSTRING&#40;GL06001, 1, 4&#41;&quot;
		+ &quot; FROM	tbThanhPhamXuat, GL06&quot; + @CompID + @FYear	--CO DINH MA CONG TY, NAM TAI CHINH	
		+ &quot; WHERE 	SO_HOA_DON = GL06007&quot;
		+ &quot; AND		LEFT&#40;GL06001,4&#41; IN &#40;'5112', '5122', '5312','5111'&#41;&quot;
		+ &quot; AND		TAI_KHOAN_DU = ''&quot;


		EXECUTE sp_executesql @SqlStr


	-------------------------------------
	--DON GIA = 0 LA HOA DON KHUYEN MAI, UPDATE LAI TK--
	-------------------------------------
	UPDATE tbThanhPhamXuat 
	SET TAI_KHOAN_DU = '5122'
	WHERE DON_GIA_BAN = 0

	-----------------------------------------------
	--UPDATE TAI KHOAN DO MAT BUT TOAN TRONG SL04--
	-----------------------------------------------

	UPDATE tbThanhPhamXuat 
	SET TAI_KHOAN_DU = '5112'
	WHERE SO_HOA_DON = '08/112567'

	-------------------------------------
		--GET RESULT--
	-------------------------------------
	SELECT *--MA_HANG, TEN_HANG, QUY_CACH, DON_VI_TINH, TAI_KHOAN_DU, SUM&#40;SO_LUONG&#41; AS SO_LUONG, SUM&#40;THANH_TIEN&#41; AS THANH_TIEN
	FROM tbThanhPhamXuat
order by MA_HANG
--	WHERE SO_HOA_DON = '08/153030'
--	WHERE TAI_KHOAN_DU &lt;&gt; '' --AND THANH_TIEN &lt;&gt; 0
--	AND MA_HANG = 'A0245'
--	GROUP BY MA_HANG, TEN_HANG, QUY_CACH, DON_VI_TINH, TAI_KHOAN_DU
--	ORDER BY TAI_KHOAN_DU

	IF EXISTS &#40;SELECT * FROM dbo.sysobjects WHERE id = object_id&#40;N'&#91;dbo&#93;.&#91;tbThanhPhamXuat&#93;'&#41;
						AND OBJECTPROPERTY&#40;id, N'IsUserTable'&#41; = 1&#41;
				DROP TABLE &#91;dbo&#93;.&#91;tbThanhPhamXuat&#93;
	IF EXISTS &#40;SELECT * FROM dbo.sysobjects WHERE id = object_id&#40;N'&#91;dbo&#93;.&#91;tbSupplier&#93;'&#41;
						AND OBJECTPROPERTY&#40;id, N'IsUserTable'&#41; = 1&#41;
				DROP TABLE &#91;dbo&#93;.&#91;tbSupplier&#93;

END</pre>
		</div><br/> <br/> 1 báo cáo khác cũng làm treo máy : Báo cáo xuất nhập tồn kho (có thêm giá trị) dành cho Kế toán.<br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>set ANSI_NULLS ON
set QUOTED_IDENTIFIER ON
go

----*******************************************----
--Made Date:		01/01/2005
--Updating Date:	19/04/2007	&#40; Version:1000.0002 &#41; 
--For Purpose: 		Bao Cao Xuat Nhap Ton -&gt; For Design Template
--For Company:	 	Designed Template
--Description:		In this store procedure, we used three tables such as
					-- SC07 -&gt; Stock Transaction File I/O 
					-- SC09 -&gt; Get Unit of Measure
	--Note: 		
		-- @Para1	nvarchar&#40;50&#41;	-- @CompID
		--,@Para2	nvarchar&#40;50&#41;	-- @FYear 
		--,@Para3	nvarchar&#40;50&#41;	-- @Language
		--,@Para4	nvarchar&#40;50&#41;	-- @StockFrom
		--,@Para5	nvarchar&#40;50&#41;	-- @StockTo	
		--,@Para6	nvarchar&#40;50&#41;	--,@WHFrom	
		--,@Para7	nvarchar&#40;50&#41;	--,@WHTo  	
		--,@Para8	nvarchar&#40;50&#41;	--,@DateFrom
		--,@Para9	nvarchar&#40;50&#41;	--,@DateTo  
----*******************************************----
ALTER                     PROCEDURE &#91;dbo&#93;.&#91;SC_XuatNhapTon_KeToan&#93;
	 @Para1	nvarchar&#40;50&#41;	-- @CompID  	
	,@Para2	nvarchar&#40;50&#41;	-- @FYear  		
	,@Para3	nvarchar&#40;50&#41;	-- @Language 	
	,@Para4 nvarchar&#40;50&#41;	-- @StockFrom	
	,@Para5 nvarchar&#40;50&#41;	-- @StockTo		
	,@Para6 nvarchar&#40;50&#41;	--,@WHFrom		
	,@Para7	nvarchar&#40;50&#41;	--,@WHTo  		
	,@Para8	nvarchar&#40;50&#41;	--,@DateFrom  	
	,@Para9	nvarchar&#40;50&#41;	--,@DateTo  	
WITH RECOMPILE
-- &#91;XuatNhapTon_KeToan&#93; '01','10','AME','A0144','A0144','K1','KTGC12','100401','100430'
AS
BEGIN
/* ************************************************* */
DECLARE @CompID		AS NVARCHAR&#40;50&#41;	SET @CompID		=	@Para1
DECLARE @FYear		AS NVARCHAR&#40;50&#41;	SET @FYear		=	@Para2
DECLARE @Language	AS NVARCHAR&#40;50&#41;	SET @Language	=	@Para3
DECLARE @StockFrom	AS NVARCHAR&#40;50&#41; SET @StockFrom	= 	@Para4
DECLARE @StockTo	AS NVARCHAR&#40;50&#41; SET @StockTo	=	@Para5
DECLARE @WHFrom		AS NVARCHAR&#40;50&#41; SET @WHFrom 	=	@Para6
DECLARE @WHTo		AS NVARCHAR&#40;50&#41;	SET @WHTo		=	@Para7
DECLARE @DateFrom	AS NVARCHAR&#40;50&#41;	SET @DateFrom	=	@Para8
DECLARE @DateTo		AS NVARCHAR&#40;50&#41;	SET @DateTo		=	@Para9

DECLARE @SqlStr as nvarchar&#40;4000&#41;
DECLARE @dem as INT 
SET @dem = 0

SET ANSI_WARNINGS OFF
SET ARITHABORT OFF
SET QUOTED_IDENTIFIER OFF

END

BEGIN

	CREATE TABLE #TempUnitTable
	&#40;
		idcol int PRIMARY KEY,
		UnitText nvarchar&#40;512&#41;
	&#41;
--DROP TABLE #tbStock
IF EXISTS &#40;	SELECT * FROM dbo.sysobjects WHERE id = object_id&#40;N'&#91;dbo&#93;.&#91;#tbStock&#93;'&#41; 
			AND OBJECTPROPERTY&#40;id, N'IsUserTable'&#41; = 1&#41;
	DROP TABLE &#91;dbo&#93;.&#91;#tbStock&#93;

IF EXISTS &#40;	SELECT * FROM dbo.sysobjects WHERE id = object_id&#40;N'&#91;dbo&#93;.&#91;#tbStockEnd&#93;'&#41; 
			AND OBJECTPROPERTY&#40;id, N'IsUserTable'&#41; = 1&#41;
	DROP TABLE &#91;dbo&#93;.&#91;#tbStockEnd&#93;

IF EXISTS &#40;	SELECT * FROM dbo.sysobjects WHERE id = object_id&#40;N'&#91;dbo&#93;.&#91;#tbStockBegin&#93;'&#41; 
			AND OBJECTPROPERTY&#40;id, N'IsUserTable'&#41; = 1&#41;
	DROP TABLE &#91;dbo&#93;.&#91;#tbStockBegin&#93;
--DROP TABLE QRYTMP_StockImMid
IF EXISTS &#40;	SELECT * FROM dbo.sysobjects WHERE id = object_id&#40;N'&#91;dbo&#93;.&#91;tbStockImMid&#93;'&#41; 
			AND OBJECTPROPERTY&#40;id, N'IsUserTable'&#41; = 1&#41;
	DROP TABLE &#91;dbo&#93;.&#91;tbStockImMid&#93;

--DROP TABLE QRYTMP_StockExMid
IF EXISTS &#40;	SELECT * FROM dbo.sysobjects WHERE id = object_id&#40;N'&#91;dbo&#93;.&#91;tbStockExMid&#93;'&#41; 
			AND OBJECTPROPERTY&#40;id, N'IsUserTable'&#41; = 1&#41;
	DROP TABLE &#91;dbo&#93;.&#91;tbStockExMid&#93;

	CREATE TABLE #tbStockEnd
	&#40;
		WarehouseNo			nvarchar&#40;50&#41;,
		WHName				nvarchar&#40;50&#41;,
		StockCode			nvarchar&#40;50&#41;,
		Description1		nvarchar&#40;512&#41;,
		Description2		nvarchar&#40;512&#41;,
		UnitConvStoc		nvarchar&#40;50&#41;,	--DON VI TINH
		UnitCodeMPC		nvarchar&#40;50&#41;,	--DON VI TINH NHO NHAT
		UnitConvMPC		INT,	--HE SO QUI DOI
--		LotID			nvarchar&#40;20&#41;,	--SO LO
		ExpiryDate		DATETIME,
		UserDefFld1		NVARCHAR&#40;50&#41;,	--SO PHIEU KIEM NGHIEM
		UserDefFld2		NVARCHAR&#40;50&#41;,	--DO AM
		UserDefFld3		NVARCHAR&#40;50&#41;,	--HAM LUONG
		ImQtyMid		numeric&#40;30,4&#41;,	--SO LUONG HANG NHAP
		ImTransfPrice1Mid 	numeric&#40;30,4&#41;,	--GIA TIEN HANG NHAP
		ExQtyMid		numeric&#40;30,4&#41;,	--SO LUONG HANG XUAT
		ExTransfPrice1Mid	numeric&#40;30,4&#41;,	--GIA TIEN HANG XUAT
		QtyEnd			numeric&#40;30,4&#41;,	--SO LUONG HANG CON LAI TRONG KHO
		TransfPrice1End		numeric&#40;30,4&#41;,	--GIA TIEN HANG CON LAI TRONG KHO
		CurrName 		nvarchar&#40;50&#41;,
		FromDate		datetime,
		ToDate			datetime
	,QtyBegin			numeric&#40;30,4&#41;
,	TransfPrice1Begin		numeric&#40;30,4&#41;
	&#41;

	CREATE TABLE #tbStockBegin
	&#40;
		WarehouseNo			nvarchar&#40;50&#41;,
		WHName				nvarchar&#40;50&#41;,
		StockCode			nvarchar&#40;50&#41;,
		Description1		nvarchar&#40;512&#41;,
		Description2		nvarchar&#40;512&#41;,
		UnitConvStoc		nvarchar&#40;50&#41;,	--DON VI TINH
		UnitCodeMPC		nvarchar&#40;50&#41;,	--DON VI TINH NHO NHAT
		UnitConvMPC		INT,	--HE SO QUI DOI
--		LotID			nvarchar&#40;20&#41;,	--SO LO
		ExpiryDate		DATETIME,
		UserDefFld1		NVARCHAR&#40;50&#41;,	--SO PHIEU KIEM NGHIEM
		UserDefFld2		NVARCHAR&#40;50&#41;,	--DO AM
		UserDefFld3		NVARCHAR&#40;50&#41;,	--HAM LUONG
		ImQtyMid		numeric&#40;30,4&#41;,	--SO LUONG HANG NHAP
		ImTransfPrice1Mid 	numeric&#40;30,4&#41;,	--GIA TIEN HANG NHAP
		ExQtyMid		numeric&#40;30,4&#41;,	--SO LUONG HANG XUAT
		ExTransfPrice1Mid	numeric&#40;30,4&#41;,	--GIA TIEN HANG XUAT
		QtyBeGin			numeric&#40;30,4&#41;,	--SO LUONG HANG CON LAI dau ki TRONG KHO
		TransfPrice1Begin		numeric&#40;30,4&#41;,	--GIA TIEN HANG CON LAI TRONG KHO
		CurrName 		nvarchar&#40;50&#41;,
		FromDate		datetime,
		ToDate			datetime
	&#41;
----*******************************************----
--Insert the Unit Text into the temporary table
----*******************************************----
WHILE @dem &lt; 40
	BEGIN
		INSERT INTO #TempUnitTable &#40;idcol, UnitText&#41; VALUES &#40;@dem,' '&#41;
      	SET @dem = @dem + 1
	END

SET @dem = 0

WHILE @dem &lt; 8
	BEGIN
		SET @SqlStr = &quot; UPDATE #TempUnitTable &quot;
					+ &quot; SET #TempUnitTable.UnitText = T1.SC0900&quot; + convert&#40;nvarchar&#40;3&#41;, @dem + 2&#41;
					+ &quot; FROM #TempUnitTable, SC09&quot; + @CompID + &quot;00 T1&quot;
					+ &quot; WHERE T1.SC09001 = '&quot; + @Language + &quot;'&quot;
					+ &quot; AND #TempUnitTable.idcol = &quot; + convert&#40;nvarchar&#40;3&#41;, @dem&#41;
       	EXECUTE  sp_executesql @SqlStr 		
		SET @dem = @dem + 1
	END 

WHILE @dem &lt; 40
	BEGIN
		SET @SqlStr = &quot; UPDATE #TempUnitTable &quot;
					+ &quot; SET #TempUnitTable.UnitText = T1.SC090&quot; + convert&#40;nvarchar&#40;3&#41;, @dem + 2&#41; 
					+ &quot; FROM #TempUnitTable, SC09&quot; + @CompID + &quot;00 T1&quot;
					+ &quot; WHERE T1.SC09001 = '&quot; + @Language + &quot;'&quot;
					+ &quot; AND #TempUnitTable.idcol = &quot; + convert&#40;nvarchar&#40;3&#41;, @dem&#41;
       	EXECUTE  sp_executesql @SqlStr 		
		SET @dem = @dem + 1
	END
	
----*******************************************----
	----tbTmp lay du lieu hoan toan tu bang SC07	
	----nhung duoc cap nhat lai voi TransPrice theo TransType
	----*******************************************----
	CREATE TABLE #tbStock
	&#40;
		WareNo		nvarchar&#40;50&#41; collate Latin1_General_BIN,
		WareNoTo		nvarchar&#40;50&#41; collate Latin1_General_BIN,
		TransDate			datetime ,
		TransType			nvarchar&#40;50&#41; collate Latin1_General_BIN,
		StockCode		nvarchar&#40;512&#41; collate Latin1_General_BIN,
		LotID		nvarchar&#40;512&#41; collate Latin1_General_BIN,
		Qty		numeric&#40;30,4&#41;,
		TransPrice	numeric&#40;30,4&#41;,	
		Amount		NUMERIC&#40;30,4&#41;,
		Reference		nvarchar&#40;50&#41; collate Latin1_General_BIN ,
		OrderNumber		nvarchar&#40;50&#41; collate Latin1_General_BIN ,
		Invoice		NVARCHAR&#40;50&#41;	collate Latin1_General_BIN ,
		Receiver		NVARCHAR&#40;50&#41;	collate Latin1_General_BIN ,
		GLTransaction		NVARCHAR&#40;50&#41;	collate Latin1_General_BIN 
	&#41;
	SET @SqlStr = &quot; SELECT &quot;
				+ &quot;  T2.SC07009 	WareNo&quot;
				+ &quot;, T2.SC07027 	WareNoTo&quot;
				+ &quot;, T2.SC07002 	TransDate&quot;
				+ &quot;, T2.SC07001		TransType&quot;
				+ &quot;, T2.SC07003 	StockCode&quot;
				+ &quot;, T2.SC07021		LotID&quot;
--				+ &quot;, T2.SC07021		BatchID&quot;
				+ &quot;, T2.SC07004 	Qty&quot;
				+ &quot;, T2.SC07005 	TransPrice&quot;
				+ &quot;, T2.SC07005*T2.SC07004	Amount&quot;
				+ &quot;, T2.SC07007		Reference&quot;
				+ &quot;, T2.SC07006		OrderNumber&quot;
				+ &quot;, T2.SC07056		Invoice&quot;
				+ &quot;, T2.SC07011		Receiver&quot;
				+ &quot;, T2.SC07020		GLTransaction&quot;
--				+ &quot;	 INTO #tbStock&quot;
				+ &quot; FROM SC07&quot; + @CompID + &quot;00 T2&quot;
				+ &quot; WHERE	T2.SC07009 BETWEEN '&quot; + @WHFrom + &quot;' AND '&quot; + @WHTo + &quot;'&quot;
				+ &quot; AND	T2.SC07003 BETWEEN '&quot; + @StockFrom + &quot;' AND '&quot; + @StockTo + &quot;'&quot;
				+ &quot; AND T2.SC07002 &lt;= '&quot; + CONVERT&#40;nvarchar&#40;50&#41;, @DateTo, 112&#41; + &quot;'&quot;
--				+ &quot; AND T2.SC07006 &lt;&gt; 'DDCK2008'&quot;
				+ &quot; ORDER BY T2.SC07003, T2.SC07002  ASC&quot;

	insert #tbStock execute sp_executesql @SqlStr
PRINT @SqlStr

--XOA DI CAC DONG CHUYEN KHO TU KN-&gt;KT HOAC KT-&gt;KN : HANG  KIEM NGHIEM 
--DELETE #tbStock
--SELECT * FROM #tbStock
-- WHERE Reference = 'X0513/09'

--SELECT * FROM #tbStock WHERE StockCode = 'B0131'



--SELECT * FROM #tbStock WHERE StockCode = 'B0027'

--delete #tbStock where Reference = 'DD001/08'-- OR OrderNumber = 'DDCK2009'

--SELECT * FROM #tbStock WHERE StockCode = 'C0047'
--	SET @SqlStr = &quot;	UPDATE #tbStock&quot;
--				+ &quot;    SET TransDate = PL03005&quot;
--				+ &quot;	  FROM PL03&quot; + @CompID + &quot;00&quot;
--				+ &quot;  WHERE Invoice = PL03002 AND Receiver = PL03001&quot;
--	execute sp_executesql @SqlStr


	UPDATE #tbStock
	SET Amount = TransPrice
	WHERE TransType = '03' OR TransType = '10'
	
	UPDATE #tbStock
	SET Amount = &#40;-1&#41;* TransPrice
	WHERE TransType = '07'

--SELECT * FROM #tbStock WHERE StockCode = 'B0651' --AND &#40;TransType = '01' OR &#40;TransType = '04' AND Qty &lt; 0&#41;&#41;

	----*******************************************----
	----##tbStockEnd tính số lượng và giá cuối kỳ
	----Bang nay la bang chính để lấy dữ liệu
	----*******************************************----
	
	SET @SqlStr = &quot; INSERT INTO #tbStockEnd &quot;
				+ &quot;  SELECT DISTINCT&quot;
				+ &quot;  T2.WareNo &quot;
				+ &quot;, T3.SC23002 &quot;
				+ &quot;, T2.StockCode &quot;
				+ &quot;, T1.SC01002 	Description1&quot;
				+ &quot;, SUBSTRING&#40;T1.SC01003, 1, ABS&#40;CHARINDEX&#40;'TH',T1.SC01003,1&#41; - 1&#41;&#41; 	Description2&quot;
				+ &quot;, T4.UnitText  	UnitText&quot;
--				+ &quot;, T2.LotID		LotID&quot;
				+ &quot;, T1.SC01136		UnitCodeMPC&quot;
				+ &quot;, T1.SC01142		UnitConvMPC&quot;
				+ &quot;, NULL&quot;
				+ &quot;, ' '&quot;
				+ &quot;, ' '&quot;
				+ &quot;, ' '&quot;
				+ &quot;, 0   &quot;
				+ &quot;, 0   &quot;
				+ &quot;, 0   &quot;
				+ &quot;, 0   &quot;
				+ &quot;, SUM&#40;T2.Qty&#41;  &quot;
				+ &quot;, SUM&#40;T2.Amount&#41; &quot;
				+ &quot;, SY.SYCD009  CurrName&quot; 
				+ &quot;, '&quot; + CONVERT&#40;nvarchar&#40;50&#41;, @DateFrom, 1&#41; + &quot;'&quot;
				+ &quot;, '&quot; + CONVERT&#40;nvarchar&#40;50&#41;, @DateTo, 1&#41; + &quot;'&quot;
+&quot;,0&quot;
+&quot;,0&quot;
				+ &quot;  FROM SC01&quot; + @CompID + &quot;00 T1, #tbStock T2&quot;
				+ &quot;, SC23&quot; + @CompID + &quot;00 T3, #TempUnitTable T4&quot;
				+ &quot;, SYCD&quot; + @CompID + &quot;00 SY&quot;
				+ &quot; WHERE	T2.WareNo BETWEEN '&quot; + @WHFrom + &quot;' AND '&quot; + @WHTo + &quot;'&quot;
				+ &quot; AND	T2.StockCode BETWEEN '&quot; + @StockFrom + &quot;' AND '&quot; + @StockTo + &quot;'&quot;
				+ &quot; AND T2.WareNo =  T3.SC23001&quot;
				+ &quot; AND T1.SC01001 = T2.StockCode&quot;
				+ &quot; AND T2.TransDate  &lt;= '&quot; + CONVERT&#40;nvarchar&#40;50&#41;, @DateTo, 112&#41; + &quot;'&quot;
				+ &quot; AND T4.idcol = T1.SC01133&quot;
				+ &quot; AND SY.SYCD001 = 0 &quot;
				+ &quot; GROUP BY T2.StockCode, T2.WareNo, T3.SC23002, T1.SC01002, T1.SC01003,&quot;
				+ &quot; T1.SC01136, T1.SC01142, T4.UnitText, SY.SYCD009&quot;--- T2.LotID&quot;
				+ &quot; ORDER BY T2.StockCode ASC&quot;
	EXECUTE sp_executesql @SqlStr

--SELECT * FROM #tbStockEnd
	SET @SqlStr = &quot; INSERT INTO #tbStockBegin &quot;
				+ &quot;  SELECT DISTINCT&quot;
				+ &quot;  T2.WareNo &quot;
				+ &quot;, T3.SC23002 &quot;
				+ &quot;, T2.StockCode &quot;
				+ &quot;, T1.SC01002 	Description1&quot;
				+ &quot;, SUBSTRING&#40;T1.SC01003, 1, ABS&#40;CHARINDEX&#40;'TH',T1.SC01003,1&#41; - 1&#41;&#41; 	Description2&quot;
				+ &quot;, T4.UnitText  	UnitText&quot;
--				+ &quot;, T2.LotID		LotID&quot;
				+ &quot;, T1.SC01136		UnitCodeMPC&quot;
				+ &quot;, T1.SC01142		UnitConvMPC&quot;
				+ &quot;, NULL&quot;
				+ &quot;, ' '&quot;
				+ &quot;, ' '&quot;
				+ &quot;, ' '&quot;
				+ &quot;, 0   &quot;
				+ &quot;, 0   &quot;
				+ &quot;, 0   &quot;
				+ &quot;, 0   &quot;
				+ &quot;, SUM&#40;T2.Qty&#41;  &quot;
				+ &quot;, SUM&#40;T2.Amount&#41; &quot;
				+ &quot;, SY.SYCD009  CurrName&quot; 
				+ &quot;, '&quot; + CONVERT&#40;nvarchar&#40;50&#41;, @DateFrom, 1&#41; + &quot;'&quot;
				+ &quot;, '&quot; + CONVERT&#40;nvarchar&#40;50&#41;, @DateTo, 1&#41; + &quot;'&quot;
				+ &quot;  FROM SC01&quot; + @CompID + &quot;00 T1, #tbStock T2&quot;
				+ &quot;, SC23&quot; + @CompID + &quot;00 T3, #TempUnitTable T4&quot;
				+ &quot;, SYCD&quot; + @CompID + &quot;00 SY&quot;
				+ &quot; WHERE	T2.WareNo BETWEEN '&quot; + @WHFrom + &quot;' AND '&quot; + @WHTo + &quot;'&quot;
				+ &quot; AND	T2.StockCode BETWEEN '&quot; + @StockFrom + &quot;' AND '&quot; + @StockTo + &quot;'&quot;
				+ &quot; AND T2.WareNo =  T3.SC23001&quot;
				+ &quot; AND T1.SC01001 = T2.StockCode&quot;
				+ &quot; AND T2.TransDate  &lt; '&quot; + CONVERT&#40;nvarchar&#40;50&#41;, @DateFrom, 112&#41; + &quot;'&quot;
				+ &quot; AND T4.idcol = T1.SC01133&quot;
				+ &quot; AND SY.SYCD001 = 0 &quot;
				+ &quot; GROUP BY T2.StockCode, T2.WareNo, T3.SC23002, T1.SC01002, T1.SC01003,&quot;
				+ &quot; T1.SC01136, T1.SC01142, T4.UnitText, SY.SYCD009&quot;--- T2.LotID&quot;
				+ &quot; ORDER BY T2.StockCode ASC&quot;
	EXECUTE sp_executesql @SqlStr
--select * from #tbStockBegin
print @SqlStr
DELETE #tbStock
 WHERE &#40;&#40;WareNo = 'KN' AND WareNoTo = 'KT'&#41; OR &#40;WareNo = 'KT' AND WareNoTo = 'KN'&#41; 
		OR &#40;WareNo = 'KB' AND WareNoTo = 'KT'&#41; OR &#40;WareNo = 'KB' AND WareNoTo = 'KT'&#41;&#41; 
   AND Receiver = '20' 
AND TransDate BETWEEN '20090201' AND '20091230'

	----*******************************************----
	----tbStockImMid tính số lượng và giá nhập trong kỳ
	----ĐK: theo TransType
	----*******************************************----

	SET @SqlStr = &quot;	 SELECT DISTINCT&quot;
				+ &quot;  T2.WareNo  	WarehouseNo&quot;
				+ &quot;, T2.StockCode 	StockCode&quot;
				+ &quot;, T1.SC01002		Description1&quot;
				+ &quot;, SUBSTRING&#40;T1.SC01003, 1, ABS&#40;CHARINDEX&#40;'TH',T1.SC01003,1&#41; - 1&#41;&#41;		Description2&quot;
				+ &quot;, T4.UnitText	UnitText&quot;
--				+ &quot;, T2.LotID	 	LotID&quot;	
				+ &quot;, T1.SC01136		UnitCodeMPC&quot;
				+ &quot;, T1.SC01142		UnitConvMPC&quot;			
				+ &quot;, SUM&#40;T2.Qty&#41;   	Qty&quot;
				+ &quot;, SUM&#40;round&#40;T2.Amount,4&#41;&#41; Amount&quot;
				+ &quot;, 0   			ExQty&quot;
				+ &quot;, 0   			ExAmount&quot;
				+ &quot;, 0   			EndQty&quot;
				+ &quot;, 0   			EndAmount&quot;
				+ &quot;, SY.SYCD009			CurrName&quot; 
--				+ &quot;, T2.GLTransaction	GLTransaction&quot;
				+ &quot;, '&quot; + CONVERT&#40;nvarchar&#40;50&#41;, @DateFrom, 1&#41; + &quot;'		DateFrom&quot;
				+ &quot;, '&quot; + CONVERT&#40;nvarchar&#40;50&#41;, @DateTo, 1&#41; + &quot;'		DateTo&quot;
				+ &quot;	 INTO tbStockImMid&quot;
				+ &quot;  FROM  SC01&quot; + @CompID + &quot;00 T1, #tbStock T2&quot;
				+ &quot;, SC23&quot; + @CompID + &quot;00 T3, #TempUnitTable T4&quot;
				+ &quot;, SYCD&quot; + @CompID + &quot;00 SY&quot;
				+ &quot; WHERE T2.WareNo BETWEEN '&quot; + @WHFrom + &quot;' AND '&quot; + @WHTo + &quot;'&quot;
				+ &quot; AND	T2.StockCode BETWEEN '&quot; + @StockFrom + &quot;' AND '&quot; + @StockTo + &quot;'&quot;
				+ &quot; AND T2.WareNo =  T3.SC23001&quot;
				+ &quot; AND T1.SC01001 = T2.StockCode&quot;
				+ &quot; AND T4.idcol = T1.SC01133&quot;
				+ &quot; AND SY.SYCD001 = 0 &quot;
				+ &quot;	AND &#40;T2.TransType IN &#40;'00','03'&#41; OR &#40;T2.Qty &gt; 0 AND T2.TransType = '04'&#41;&quot;	--Điều kiện để lấy 
				+ &quot;	OR &#40;T2.TransType = '02' AND T2.Qty &gt; 0&#41;&#41;&quot;						--hàng nhập kho
--				+ &quot;	OR &#40;T2.TransType = '01' AND T2.Qty &gt; 0&#41;&#41;&quot;	
				+ &quot; AND T2.TransDate  &gt;= '&quot; + CONVERT&#40;nvarchar&#40;50&#41;, @DateFrom, 112&#41; + &quot;'&quot;
				+ &quot; AND T2.TransDate  &lt;= '&quot; + CONVERT&#40;nvarchar&#40;50&#41;, @DateTo, 112&#41; + &quot;'&quot;
				+ &quot; GROUP BY T2.StockCode, T2.WareNo, T3.SC23002, T1.SC01002, T1.SC01003,&quot;
				+ &quot; T1.SC01136, T1.SC01142, T4.UnitText, SY.SYCD009&quot;--, T2.GLTransaction&quot;--, T2.LotID&quot;
				+ &quot; ORDER BY T2.StockCode ASC&quot;
	EXECUTE sp_executesql @SqlStr

	--SELECT * FROM tbStockImMid --WHERE StockCode LIKE 'A0281%' --AND WarehouseNo = 'KN'
--	AND SC25002 = GLTransaction 


	----*******************************************----
	----tbStockExMid tính số lượng và giá xuất trong kỳ
	----ĐK: theo TransType
	----*******************************************----
	SET @SqlStr = &quot;	 SELECT DISTINCT&quot;
				+ &quot;  T2.WareNo  	WarehouseNo&quot;
				+ &quot;, T2.StockCode 	StockCode&quot;
				+ &quot;, T1.SC01002		Description1&quot;
				+ &quot;, SUBSTRING&#40;T1.SC01003, 1, ABS&#40;CHARINDEX&#40;'TH',T1.SC01003,1&#41; - 1&#41;&#41;		Description2&quot;
				+ &quot;, T4.UnitText	UnitText&quot;
				+ &quot;, T1.SC01136		UnitCodeMPC&quot;
				+ &quot;, T1.SC01142		UnitConvMPC&quot;
--				+ &quot;, T2.LotID	 	LotID&quot;				
				+ &quot;, 0   			ImQty&quot;
				+ &quot;, 0   			ImAmount&quot;
				+ &quot;, SUM&#40;T2.Qty&#41;   	Qty&quot;
				+ &quot;, SUM&#40;round&#40;T2.Amount,4&#41;&#41; Amount&quot;
				+ &quot;, 0   			EndQty&quot;
				+ &quot;, 0   			EndAmount&quot;
				+ &quot;, SY.SYCD009  CurrName&quot; 
				+ &quot;, '&quot; + CONVERT&#40;nvarchar&#40;50&#41;, @DateFrom, 1&#41; + &quot;'		DateFrom&quot;
				+ &quot;, '&quot; + CONVERT&#40;nvarchar&#40;50&#41;, @DateTo, 1&#41; + &quot;'		DateTo&quot;
				+ &quot;	 INTO tbStockExMid&quot;
				+ &quot;  FROM   SC01&quot; + @CompID + &quot;00 T1, #tbStock T2&quot;
				+ &quot;, SC23&quot; + @CompID + &quot;00 T3, #TempUnitTable T4&quot;
				+ &quot;, SYCD&quot; + @CompID + &quot;00 SY&quot;
				+ &quot; WHERE	T2.WareNo BETWEEN '&quot; + @WHFrom + &quot;' AND '&quot; + @WHTo + &quot;'&quot;
				+ &quot; AND	T2.StockCode BETWEEN '&quot; + @StockFrom + &quot;' AND '&quot; + @StockTo + &quot;'&quot;
				+ &quot; AND T2.WareNo =  T3.SC23001&quot;
				+ &quot; AND T1.SC01001 = T2.StockCode&quot;
				+ &quot; AND T4.idcol = T1.SC01133&quot;
				+ &quot; AND SY.SYCD001 = 0 &quot;	
				+ &quot; 	AND &#40;T2.TransType IN &#40;'01','07','10'&#41; OR &#40;T2.Qty &lt; 0 AND T2.TransType = '04'&#41;&quot;		--Điều kiện để lấy
				+ &quot;	OR &#40;T2.TransType = '02' AND T2.Qty &lt; 0&#41;&#41;&quot;
--				+ &quot; OR &#40;T2.TransType = '01' AND T2.Qty &lt; 0&#41;&#41;&quot;							--hàng xuất kho
				+ &quot; AND T2.TransDate  &gt;= '&quot; + CONVERT&#40;nvarchar&#40;50&#41;, @DateFrom, 112&#41; + &quot;'&quot;
				+ &quot; AND T2.TransDate  &lt;= '&quot; + CONVERT&#40;nvarchar&#40;50&#41;, @DateTo, 112&#41; + &quot;'&quot;
				+ &quot; GROUP BY T2.StockCode, T2.WareNo, T3.SC23002, T1.SC01002, T1.SC01003,&quot;
				+ &quot; T1.SC01136, T1.SC01142, T4.UnitText, SY.SYCD009&quot;--, T2.LotID&quot;
				+ &quot; ORDER BY T2.StockCode ASC&quot;
	EXECUTE sp_executesql @SqlStr

--SELECT * FROM tbStockExMid WHERE StockCode = 'A0281'

	--Them điều kiện kết LotID- 
	UPDATE #tbStockEnd
	SET #tbStockEnd.ImQtyMid = tbStockImMid.Qty
	,#tbStockEnd.ImTransfPrice1Mid = tbStockImMid.Amount
	FROM #tbStockEnd, tbStockImMid
	WHERE #tbStockEnd.WarehouseNo collate Latin1_General_BIN = tbStockImMid.WarehouseNo

	AND #tbStockEnd.StockCode collate Latin1_General_BIN = tbStockImMid.StockCode 
--	AND #tbStockEnd.LotID = tbStockImMid.LotID	--LotID
	
	UPDATE #tbStockEnd
	SET #tbStockEnd.ExQtyMid = tbStockExMid.Qty
	,#tbStockEnd.ExTransfPrice1Mid = tbStockExMid.Amount
	FROM #tbStockEnd, tbStockExMid
	WHERE #tbStockEnd.WarehouseNo collate Latin1_General_BIN = tbStockExMid.WarehouseNo
	AND #tbStockEnd.StockCode collate Latin1_General_BIN = tbStockExMid.StockCode 


	UPDATE #tbStockEnd
	SET #tbStockEnd.QtyBegin = #tbStockBegin.QtyBegin
	,#tbStockEnd.TransfPrice1Begin = #tbStockBegin.TransfPrice1Begin
	FROM #tbStockEnd, #tbStockBegin
	WHERE #tbStockEnd.WarehouseNo collate Latin1_General_BIN = #tbStockBegin.WarehouseNo
	AND #tbStockEnd.StockCode collate Latin1_General_BIN = #tbStockBegin.StockCode 
--	AND #tbStockEnd.LotID = tbStockExMid.LotID	--LotID

	--UPDATE NEU HS QUI DOI = 0--
/*
	UPDATE #tbStockEnd
	SET UnitConvMPC = 1
	WHERE UnitConvMPC = 0

	--NHAN SL VOI HE SO QUI DOI--
	UPDATE #tbStockEnd
	SET ImQtyMid = ImQtyMid * UnitConvMPC, 
	    ExQtyMid = ExQtyMid * UnitConvMPC,
	    QtyEnd = QtyEnd * UnitConvMPC
	    */

	--NHAN SL VOI HE SO QUI DOI--
/*
	UPDATE #tbStockEnd
	SET ImQtyMid = ImQtyMid * ISNULL&#40;QDGBB, 1&#41;, 
	    ExQtyMid = ExQtyMid * ISNULL&#40;QDGBB, 1&#41;,
	    QtyEnd = QtyEnd * ISNULL&#40;QDGBB, 1&#41;
	FROM 	#tbStockEnd, SCGCD0000
	WHERE StockCode = MAHH

*/
	UPDATE #tbStockEnd
	SET UnitCodeMPC = &#40; SELECT UnitText FROM #TempUnitTable	WHERE UnitCodeMPC = idcol&#41;

	--UPDATE Do am, ham luong, Phieu KN	--

	--UPDATE MA PHAN XUONG, TEN PHAN XUONG--

	SET @SqlStr = &quot; UPDATE #tbStockEnd&quot;
		    + &quot; SET UserDefFld1 = SC01010&quot;
		    + &quot; FROM #tbStockEnd, SC01&quot; + @CompID + &quot;00&quot; 
		    + &quot; WHERE StockCode collate Latin1_General_BIN = SC01001&quot;

	EXECUTE sp_executesql @SqlStr

	SET @SqlStr = &quot; UPDATE #tbStockEnd&quot;
		    + &quot; SET UserDefFld1 = SY24003&quot;
		    + &quot; FROM #tbStockEnd, SY24&quot; + @CompID + &quot;00&quot; 
		    + &quot; WHERE UserDefFld1 collate Latin1_General_BIN = SY24002&quot;
		    + &quot; AND 	SY24001 = 'IQ'&quot;

	EXECUTE sp_executesql @SqlStr

	---------------------------------------


/*
	SET @SqlStr = &quot; UPDATE #tbStockEnd&quot;
		    + &quot; SET LotID = SC33009&quot;
		    + &quot; FROM #tbStockEnd, SC33&quot; + @CompID + &quot;00&quot; 
		    + &quot; WHERE WarehouseNo = SC33002 AND StockCode = SC33001 AND LotID = SC33003&quot;

	EXECUTE sp_executesql @SqlStr
*/
	--**********GET RESULT*************--
/*SELECT WarehouseNo, WHName, StockCode, Description1, Description2, UnitConvStoc
			,LotID, ExpiryDate, UserDefFld1, UserDefFld2, UserDefFld3,
			SUM&#40;ImQtyMid&#41; as ImQtyMid, SUM&#40;ExQtyMid&#41; AS ExQtyMid, SUM&#40;QtyEnd&#41; AS QtyEnd, CurrName, FromDate, ToDate
		FROM #tbStockEnd
		WHERE ImQtyMid &lt;&gt; 0.0 OR ExQtyMid &lt;&gt; 0.0 OR QtyEnd &lt;&gt; 0.0
		group by WarehouseNo, WHName, StockCode, Description1, Description2, UnitConvStoc
			,LotID, ExpiryDate, UserDefFld1, UserDefFld2, UserDefFld3, CurrName, FromDate, ToDate
--		AND LotID = '0030408'
*/

	IF @StockFrom LIKE 'A%'
		SELECT *
		FROM #tbStockEnd
		WHERE &#40;ImQtyMid &lt;&gt; 0.0 OR ExQtyMid &lt;&gt; 0.0 OR QtyEnd &lt;&gt; 0.0
				OR ImTransfPrice1Mid &lt;&gt; 0.0 OR ExTransfPrice1Mid &lt;&gt; 0.0 OR TransfPrice1End &lt;&gt; 0.0&#41;
		AND WarehouseNo IN &#40;'K1','K2','K8','K13','K6','K9','K14','K7'&#41;
	ELSE 
		SELECT *
		FROM #tbStockEnd
		WHERE &#40;ImQtyMid &lt;&gt; 0.0 OR ExQtyMid &lt;&gt; 0.0 OR QtyEnd &lt;&gt; 0.0 
				OR ImTransfPrice1Mid &lt;&gt; 0 OR ExTransfPrice1Mid &lt;&gt; 0 OR TransfPrice1End &lt;&gt; 0&#41;

	
SELECT StockCode,ImTransfPrice1Mid
		FROM #tbStockEnd
		WHERE &#40;ImTransfPrice1Mid &lt;&gt; 0.0  &#41;

--SELECT StockCode, SUM&#40;ExTransfPrice1Mid&#41;  FROM #tbStockEnd --WHERE TransDate BETWEEN '090301' AND '090331'
--GROUP BY StockCode
--SELECT StockCode, SUM&#40;ExTransfPrice1Mid&#41;  FROM #tbStockEnd --WHERE TransDate BETWEEN '090301' AND '090331'
--w
--GROUP BY StockCode
--SELECT * FROM #tbStock WHERE TransDate BETWEEN '090601' AND '090630' AND StockCode = 'B0005'

	DROP TABLE #tbStock
	DROP TABLE #tbStockEnd
	DROP TABLE tbStockImMid
	DROP TABLE tbStockExMid
--DROP TABLE tbStock
IF EXISTS &#40;	SELECT * FROM dbo.sysobjects WHERE id = object_id&#40;N'&#91;dbo&#93;.&#91;#tbStock&#93;'&#41; 
			AND OBJECTPROPERTY&#40;id, N'IsUserTable'&#41; = 1&#41;
	DROP TABLE &#91;dbo&#93;.&#91;#tbStock&#93;

IF EXISTS &#40;	SELECT * FROM dbo.sysobjects WHERE id = object_id&#40;N'&#91;dbo&#93;.&#91;#tbStockEnd&#93;'&#41; 
			AND OBJECTPROPERTY&#40;id, N'IsUserTable'&#41; = 1&#41;
	DROP TABLE &#91;dbo&#93;.&#91;#tbStockEnd&#93;

--DROP TABLE QRYTMP_StockImMid
IF EXISTS &#40;	SELECT * FROM dbo.sysobjects WHERE id = object_id&#40;N'&#91;dbo&#93;.&#91;tbStockImMid&#93;'&#41; 
			AND OBJECTPROPERTY&#40;id, N'IsUserTable'&#41; = 1&#41;
	DROP TABLE &#91;dbo&#93;.&#91;tbStockImMid&#93;

--DROP TABLE QRYTMP_StockExMid
IF EXISTS &#40;	SELECT * FROM dbo.sysobjects WHERE id = object_id&#40;N'&#91;dbo&#93;.&#91;tbStockExMid&#93;'&#41; 
			AND OBJECTPROPERTY&#40;id, N'IsUserTable'&#41; = 1&#41;
	DROP TABLE &#91;dbo&#93;.&#91;tbStockExMid&#93;

END

--&#91;XuatNhapTon_KeToan&#93; '01','09','AME','B0001','B9999','KN','KN','090801','090831'</pre>
		</div><br/> </span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>


			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#33CC33">[Discussion]</font></span>&nbsp;&nbsp; Cần ai hiểu sâu về SQL Server giúp đỡ tìm nguyên nhân SQL chậm<a name="215959" id="215959"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">22/07/2010 06:38:05 (+0700) | <a href="/hvaonline/posts/list/35132.html#215959">#8</a> | 215959 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>
<td width="20">
		<img src="/hvaonline/images/avatar/089f41810321eefc3f4eef5d4a388e42.png" border="0" alt="[Avatar]" title="[Avatar]"><br>
	</td>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/67588.html"><b>conmale</b></a><br>
	<font color="#FF3333">Administrator</font></span>
<br>

<span class="uprofile">
		
</span>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 07/05/2004 23:43:15<br>
		Messages: 9353<br>
	
		Location: down under<br>
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/67588.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/67588.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row2">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row2"><span class="postbody">Nhìn chung mấy cái storeproc này có những đoạn query quá rộng (SELECT *) và có quá nhiều sub-queries. Đây là nguyên do tạo ra kém hiệu suất nếu xét trên bình diện truy vấn CSDL. Cách cải thiện là nên tối ưu lại storeproc và nên trao bớt trách nhiệm trên tầng ứng dụng (applications) việc hình thành các query statements cụ thể thay vì phó mặc cho storeproc thực hiện quá nhiều sub-queries.<br/> <br/> MSSQL chạy trên nền 32-bit mà phục vụ cho lượng truy vấn cao và nặng thì hoạt động cực kỳ kém. Cách có thể cải thiện trên bình diện này là migrate sang một máy chủ chạy 64-bit và MSSQL 64-bit.</span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>

		  <tr>
			<td height="20" colspan="2" valign="bottom" class="rowButton"><span class="gensmall">What bringing us together is stronger than what pulling us apart.</span></td>
		  </tr>

			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#33CC33">[Discussion]</font></span>&nbsp;&nbsp; Cần ai hiểu sâu về SQL Server giúp đỡ tìm nguyên nhân SQL chậm<a name="215976" id="215976"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">22/07/2010 09:19:59 (+0700) | <a href="/hvaonline/posts/list/35132.html#215976">#9</a> | 215976 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/64819.html"><b>qtra004</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 19/04/2004 22:36:57<br>
		Messages: 298<br>
	
		Location: Kiwiland<br>
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/64819.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/64819.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row1">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row1"><span class="postbody">Mình cũng đồng ý với ý kiến của anh conmale. Server có 6GB Ram mà bạn chạy 32bit thì không tận dụng được 2GB RAM. <br/> <br/> Bạn thảy cái stored procedure lên cũng chưa thể nói được gì. Nhưng mà mình nghĩ bạn nên tách 1 cái stored proc lớn ra nhiều stored nhỏ hơn và để application gọi các stored proc nhỏ hơn, rồi để application tương tác những kết quả từ những stored proc đó. Bạn cũng nên tập bỏ bớt code không còn dùng nữa trong stored proc thay vì chuyển nó thành comments ( nhìn rối mắt lắm).<br/> <br/> Nhìn sơ qua cái stored proc đầu tiên. Cách làm drop table rồi insert/update table lại mỗi lần stored proc chạy có thể tạo ra deadlock nếu có 1 process khác đang chạy select query tới table đó. Bạn có thể tham khảo thêm về view, view cũng có thể dùng để generate report.<br/> <br/> </span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>

		  <tr>
			<td height="20" colspan="2" valign="bottom" class="rowButton"><span class="gensmall">Carpe diem quam minimum credula postero</span></td>
		  </tr>

			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#33CC33">[Discussion]</font></span>&nbsp;&nbsp; Cần ai hiểu sâu về SQL Server giúp đỡ tìm nguyên nhân SQL chậm<a name="215984" id="215984"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">22/07/2010 10:35:06 (+0700) | <a href="/hvaonline/posts/list/35132.html#215984">#10</a> | 215984 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/71831.html"><b>lama</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 14/06/2004 20:27:02<br>
		Messages: 40<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/71831.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/71831.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row2">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row2"><span class="postbody"><p></p>
		<cite class="blockquote">conmale wrote:</cite><br>
		<blockquote>Nhìn chung mấy cái storeproc này có những đoạn query quá rộng (SELECT *) và có quá nhiều sub-queries. Đây là nguyên do tạo ra kém hiệu suất nếu xét trên bình diện truy vấn CSDL. Cách cải thiện là nên tối ưu lại storeproc và nên trao bớt trách nhiệm trên tầng ứng dụng (applications) việc hình thành các query statements cụ thể thay vì phó mặc cho storeproc thực hiện quá nhiều sub-queries.<br/> <br/> MSSQL chạy trên nền 32-bit mà phục vụ cho lượng truy vấn cao và nặng thì hoạt động cực kỳ kém. Cách có thể cải thiện trên bình diện này là migrate sang một máy chủ chạy 64-bit và MSSQL 64-bit.&nbsp;
		</blockquote><br/> <br/> Các câu lệnh SELECT * em thấy là đúng theo nhu cầu mà ? Từ bảng dữ liệu khoảng trăm mấy cột, mình đã select  đúng các cột cần đưa vào 1 bảng tạm để xử lý (chắc cũng có vấn đề ở đây, em đang check).<br/> <br/> Rất cám ơn anh đã góp ý trao bớt trách nhiệm cho App, so sánh với cách tổ chức của ứng dụng hiện tại (không thấy các stored truy vấn dữ liệu như em nói bên trên) thì chắc đây cũng chính là 1 trong những nguyên nhân chính rồi.<br/> <br/> Ứng dụng này hiện tại thì chưa hỗ trợ 64 bit  nên em chỉ có thể cài 32 bit thôi.<br/> <br/> Thông tin thêm :<br/> <br/> Hic, tối qua em thức tới 1h30 chạy trace thử thì thấy với dữ liệu in trong 1 tháng cho 93 mặt hàng thì in khỏang 10 giây à. Nhưng khi chọn in trong 3 tháng thì mất hơn 1 phút, chọn in từ đầu năm đến giờ cho 250 mặt hàng thì chờ hơn 30 phút chưa thấy ra luôn.<br/> <br/> Lúc chạy trace và cả Active Monitor thấy thời gian gọi stored proc xảy ra cũng nhanh lắm, lâu thì có vài giây, còn lúc chạy nó có lock không cũng không biết, không thấy tình trạng là LOCKED. Các xử lý trong Active Monitor có Request là LOCK (không phải LOCKED) ngay cả khi thử SELECT 1 bảng đơn giản.</span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>


			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#33CC33">[Discussion]</font></span>&nbsp;&nbsp; Cần ai hiểu sâu về SQL Server giúp đỡ tìm nguyên nhân SQL chậm<a name="215987" id="215987"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">22/07/2010 11:03:17 (+0700) | <a href="/hvaonline/posts/list/35132.html#215987">#11</a> | 215987 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>
<td width="20">
		<img src="/hvaonline/images/avatar/089f41810321eefc3f4eef5d4a388e42.png" border="0" alt="[Avatar]" title="[Avatar]"><br>
	</td>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/67588.html"><b>conmale</b></a><br>
	<font color="#FF3333">Administrator</font></span>
<br>

<span class="uprofile">
		
</span>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 07/05/2004 23:43:15<br>
		Messages: 9353<br>
	
		Location: down under<br>
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/67588.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/67588.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row1">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row1"><span class="postbody"><p></p>
		<cite class="blockquote">lama wrote:</cite><br>
		<blockquote><br/> <br/> Các câu lệnh SELECT * em thấy là đúng theo nhu cầu mà ? Từ bảng dữ liệu khoảng trăm mấy cột, mình đã select  đúng các cột cần đưa vào 1 bảng tạm để xử lý (chắc cũng có vấn đề ở đây, em đang check).<br/> &nbsp;
		</blockquote><br/> Nhu cầu là một chuyện và tính hữu hiệu để tạo hiệu suất là một chuyện khác. Đây là nghệ thuật tối ưu hoá đó em. Đối với một SQL query, càng ambiguous (dùng wild card *) thì càng ít hiệu suất bởi vì query như vậy nó sẽ lấy hết tất cả các thông tin từ tất cả các cột và có thể có những cột không cần thiết (và chứa nhiều dữ liệu). Về phần sub-queries thì cố gắng tránh càng nhiều càng tốt bởi vì nó là nguyên nhân chính của tình trạng ỳ ạch trên CSDL. <br/> <br/> <p></p>
		<cite class="blockquote">lama wrote:</cite><br>
		<blockquote><br/> Rất cám ơn anh đã góp ý trao bớt trách nhiệm cho App, so sánh với cách tổ chức của ứng dụng hiện tại (không thấy các stored truy vấn dữ liệu như em nói bên trên) thì chắc đây cũng chính là 1 trong những nguyên nhân chính rồi.<br/> <br/> Ứng dụng này hiện tại thì chưa hỗ trợ 64 bit  nên em chỉ có thể cài 32 bit thôi.<br/> &nbsp;
		</blockquote><br/> Anh không hiểu cấu trúc của ứng dụng em dùng như thế nào nhưng trên mặt nguyên tắc, CSDL có thể chạy trên một máy chủ hoàn toàn tách rời với ứng dụng. Máy chủ ấy có thể chạy trên bất cứ hệ điều hành nào. Ứng dụng có thể truy vấn thông tin trên CSDL từ một máy chủ khác xuyên qua ODBC hay bất cứ phương tiện nào. Bởi thế, ứng dụng không hỗ trợ 64-bit thì cho nó chạy trên một máy khác và tách rời CSDL sang một máy khác chạy 64-bit.<br/> <br/> <p></p>
		<cite class="blockquote">lama wrote:</cite><br>
		<blockquote><br/> Thông tin thêm :<br/> <br/> Hic, tối qua em thức tới 1h30 chạy trace thử thì thấy với dữ liệu in trong 1 tháng cho 93 mặt hàng thì in khỏang 10 giây à. Nhưng khi chọn in trong 3 tháng thì mất hơn 1 phút, chọn in từ đầu năm đến giờ cho 250 mặt hàng thì chờ hơn 30 phút chưa thấy ra luôn.<br/> <br/> Lúc chạy trace và cả Active Monitor thấy thời gian gọi stored proc xảy ra cũng nhanh lắm, lâu thì có vài giây, còn lúc chạy nó có lock không cũng không biết, không thấy tình trạng là LOCKED. Các xử lý trong Active Monitor có Request là LOCK (không phải LOCKED) ngay cả khi thử SELECT 1 bảng đơn giản.&nbsp;
		</blockquote><br/> Chuyên bình thường thôi. CSDL nào cũng vậy, chạy ít query và không có "long life" query thì thường là nhanh nhưng chạy càng nhiều queries thì càng ì ạch và tính ì ạch sẽ gia tăng theo cấp số.</span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>

		  <tr>
			<td height="20" colspan="2" valign="bottom" class="rowButton"><span class="gensmall">What bringing us together is stronger than what pulling us apart.</span></td>
		  </tr>

			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#33CC33">[Discussion]</font></span>&nbsp;&nbsp; Cần ai hiểu sâu về SQL Server giúp đỡ tìm nguyên nhân SQL chậm<a name="215989" id="215989"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">22/07/2010 11:05:38 (+0700) | <a href="/hvaonline/posts/list/35132.html#215989">#12</a> | 215989 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/64819.html"><b>qtra004</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 19/04/2004 22:36:57<br>
		Messages: 298<br>
	
		Location: Kiwiland<br>
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/64819.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/64819.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row2">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row2"><span class="postbody"><p></p>
		<cite class="blockquote">lama wrote:</cite><br>
		<blockquote><br/> <br/> Ứng dụng này hiện tại thì chưa hỗ trợ 64 bit  nên em chỉ có thể cài 32 bit thôi.<br/> <br/> &nbsp;
		</blockquote><br/> <br/> Ứng dụng không hỗ trợ 32bit nhưng database engine (MSSQL) thì có. Cho nên SQL Server box cần cài OS 64 bit và SQL Server 64 bit để tận dụng hết tài nguyên ( 6GB RAM ???) </span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>

		  <tr>
			<td height="20" colspan="2" valign="bottom" class="rowButton"><span class="gensmall">Carpe diem quam minimum credula postero</span></td>
		  </tr>

			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#33CC33">[Discussion]</font></span>&nbsp;&nbsp; Cần ai hiểu sâu về SQL Server giúp đỡ tìm nguyên nhân SQL chậm<a name="215997" id="215997"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">22/07/2010 12:47:59 (+0700) | <a href="/hvaonline/posts/list/35132.html#215997">#13</a> | 215997 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/71831.html"><b>lama</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 14/06/2004 20:27:02<br>
		Messages: 40<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/71831.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/71831.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row1">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row1"><span class="postbody">Rất cám ơn mọi người đã nhiệt tình giúp đỡ, chia sẻ. Nhờ mọi người mà Nguyên sáng ra nhiều điều ( VD lại mới biết là tách SQL Server ra cho chạy 64 bit chẳng hạn, trước giờ cứ trong đầu là App không hỗ trợ thì SQL cũng phải chạy 32bit không à). Nguyên sẽ lần lượt test hết các trường hợp. Hy vọng sẽ có tin vui báo lại sớm.<br/> <br/> Tuy vậy, nếu mọi người ai còn có thể chia sẻ gì về vấn đề này cứ tiếp tục chia sẻ nha :-P Tập hợp các chia sẻ này sẻ là 1 kinh nghiệm rất đáng quý cho Nguyên cũng như nhiều anh/em khác.<br/> </span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>


			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#33CC33">[Discussion]</font></span>&nbsp;&nbsp; Cần ai hiểu sâu về SQL Server giúp đỡ tìm nguyên nhân SQL chậm<a name="215998" id="215998"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">22/07/2010 12:58:27 (+0700) | <a href="/hvaonline/posts/list/35132.html#215998">#14</a> | 215998 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>
<td width="20">
		<img src="/hvaonline/images/avatar/089f41810321eefc3f4eef5d4a388e42.png" border="0" alt="[Avatar]" title="[Avatar]"><br>
	</td>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/67588.html"><b>conmale</b></a><br>
	<font color="#FF3333">Administrator</font></span>
<br>

<span class="uprofile">
		
</span>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 07/05/2004 23:43:15<br>
		Messages: 9353<br>
	
		Location: down under<br>
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/67588.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/67588.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row2">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row2"><span class="postbody"><p></p>
		<cite class="blockquote">lama wrote:</cite><br>
		<blockquote>Rất cám ơn mọi người đã nhiệt tình giúp đỡ, chia sẻ. Nhờ mọi người mà Nguyên sáng ra nhiều điều ( VD lại mới biết là tách SQL Server ra cho chạy 64 bit chẳng hạn, trước giờ cứ trong đầu là App không hỗ trợ thì SQL cũng phải chạy 32bit không à). Nguyên sẽ lần lượt test hết các trường hợp. Hy vọng sẽ có tin vui báo lại sớm.<br/> <br/> Tuy vậy, nếu mọi người ai còn có thể chia sẻ gì về vấn đề này cứ tiếp tục chia sẻ nha :-P Tập hợp các chia sẻ này sẻ là 1 kinh nghiệm rất đáng quý cho Nguyên cũng như nhiều anh/em khác.<br/> &nbsp;
		</blockquote><br/> <br/> Bất cứ thắc mắc nào có đủ dữ kiện, được trình bày rõ ràng và thể hiện sự quan tâm đúng mức đến vấn đề mình đang gặp trở ngại thì sẽ có những góp ý có giá trị thôi em  <img src="/hvaonline/images/smilies/575eda61e93c7ad9d05928580213fd9b.gif" border="0" alt="smilie" align="absbottom"> </span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>

		  <tr>
			<td height="20" colspan="2" valign="bottom" class="rowButton"><span class="gensmall">What bringing us together is stronger than what pulling us apart.</span></td>
		  </tr>

			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#33CC33">[Discussion]</font></span>&nbsp;&nbsp; Cần ai hiểu sâu về SQL Server giúp đỡ tìm nguyên nhân SQL chậm<a name="216086" id="216086"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">23/07/2010 03:10:32 (+0700) | <a href="/hvaonline/posts/list/35132.html#216086">#15</a> | 216086 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/64819.html"><b>qtra004</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 19/04/2004 22:36:57<br>
		Messages: 298<br>
	
		Location: Kiwiland<br>
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/64819.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/64819.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row1">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row1"><span class="postbody"><p></p>
		<cite class="blockquote">lama wrote:</cite><br>
		<blockquote>Rất cám ơn mọi người đã nhiệt tình giúp đỡ, chia sẻ. Nhờ mọi người mà Nguyên sáng ra nhiều điều ( VD lại mới biết là tách SQL Server ra cho chạy 64 bit chẳng hạn, trước giờ cứ trong đầu là App không hỗ trợ thì SQL cũng phải chạy 32bit không à). Nguyên sẽ lần lượt test hết các trường hợp. Hy vọng sẽ có tin vui báo lại sớm.<br/> <br/> Tuy vậy, nếu mọi người ai còn có thể chia sẻ gì về vấn đề này cứ tiếp tục chia sẻ nha :-P Tập hợp các chia sẻ này sẻ là 1 kinh nghiệm rất đáng quý cho Nguyên cũng như nhiều anh/em khác.<br/> &nbsp;
		</blockquote><br/> <br/> Một điều bạn cần lưu ý nữa là vấn đề rearrange/rebuild index. Đối với những tables có nhiều transaction liên tục truy xuất thì vấn đề Index fragmentation là điều không thể tránh khỏi. Theo mình nghĩ bạn nên kiểm tra lại xem mức độ index fragmentation ở những transactional tables xem có phải rebuild lại index không. Bạn có thể setup Maintenance plan để rebuild index mỗi tuần (Chủ Nhật) để cải thiện datbase performance. Mình đã từng trải nghiệm vấn đề này cho 1 số khách hàng lớn rồi. Sau khi re-index thì report từ 1 tiếng xuống còn 2 phút <img src="/hvaonline/images/smilies/b5e9b4f86ce43ca65bd79c894c4a924c.gif" border="0" alt="smilie" align="absbottom"></span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>

		  <tr>
			<td height="20" colspan="2" valign="bottom" class="rowButton"><span class="gensmall">Carpe diem quam minimum credula postero</span></td>
		  </tr>

			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#33CC33">[Discussion]</font></span>&nbsp;&nbsp; Cần ai hiểu sâu về SQL Server giúp đỡ tìm nguyên nhân SQL chậm<a name="216109" id="216109"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">23/07/2010 11:32:38 (+0700) | <a href="/hvaonline/posts/list/35132.html#216109">#16</a> | 216109 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>
<td width="20">
		<img src="/hvaonline/images/avatar/23cd8a7a4957ea4a47f153ac15d6410a.jpeg" border="0" alt="[Avatar]" title="[Avatar]"><br>
	</td>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/216357.html"><b>invalid-password</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 09/03/2010 21:22:46<br>
		Messages: 161<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/216357.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/216357.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row2">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row2"><span class="postbody">Mình cũng xin góp thêm vài viên gạch nữa :<br/> <br/> 1. Trong storeproc mỗi lần report là nó tạo bảng rồi xoá bảng, điều này sẽ làm tăng kích thước file log .LDF rất nhanh. Bạn cần cắt log định kỳ và shrink database để giảm kích thước db. <br/> + Gõ lệnh "backup log tên-database with truncate_only"<br/> + Sau đó shrink database thì kích thước db sẽ giảm nhiều.<br/> <br/> 2. Mỗi lần chạy thì storedproc tạo table, update, và xoá trên những table cùng tên nhau thay vì temp table nhưng không đặt nó trong đoạn begin transaction .. commit tran, nên khi có 2 người làm cùng lúc thì có thể bị error. Bạn có thể sửa tên các table tạm được tạo trong storedproc bằng cách thêm dấu # phía trước (hơi phức tạp và dễ bị thiếu sót).<br/> <br/> 3. Việc chạy chậm có thể do đọc ghi đĩa nhiều chứ không phải thiếu cpu hay ram. Trong storedproc nó hay create table mới và select dữ liệu vào đó, cuối storedproc thì delete table. Bạn thử bỏ những lệnh delete table cuối cùng (bằng cách comment nó) rồi chạy 1 lần. Sau đó xem size của những table tạm này xem có phải rất lớn hay không. Nhớ bỏ comment trở lại.<br/> <br/> 4. Việc chạy chậm có thể do các field không được lập index đầy đủ. Bạn thử chọn 1 table lớn nào đó được select/update trong storedproc, và kiểm tra xem các field nằm trong mệnh đề where có được index hay không. Nếu không thì bạn tạo index cho nó và test lại. Index cũng cần được rebuild định kỳ.<br/> <br/> 5. Việc chạy chậm có thể do ảnh hưởng của việc check các ràng buộc toàn vẹn ở mức database. Nếu db lớn thì nên bỏ kiểm tra ràng buộc (bằng cách bỏ relationship giữa các field) và thực hiện kiểm tra ràng buộc ở mức ứng dụng.<br/> <br/> 6. Thay vì lấy report năm bằng cách chạy 1 report cho cả năm, thì có thể chạy report cho từng tháng và tổng hợp report 12 tháng thành 1 năm thì sẽ nhanh hơn nhiều. Không rõ đối với ứng dụng của bạn có thích hợp làm như vậy không.<br/> <br/> Theo như mô tả thì db của bạn chưa phải quá lớn nên report không đến nỗi chậm thế. Tui biết có 1 database của 1 hãng viễn thông lớn ở VN, mỗi ngày nó phát sinh 30 triệu record (mỗi record là 1 cuộc gọi) vậy mà cuối tháng nó vẫn xuất ra được vài chục triệu report (mỗi report là 1 hoá đơn tính tiền), trong report đã tự động khấu trừ các khuyến mãi, giảm giá, giờ vàng giờ bạc giờ free gì gì đó.<br/> </span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>

		  <tr>
			<td height="20" colspan="2" valign="bottom" class="rowButton"><span class="gensmall"><font color='Yellow'>Spam thêm một bài là góp một viên gạch xây diễn đàn lớn mạnh</font></span></td>
		  </tr>

			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#33CC33">[Discussion]</font></span>&nbsp;&nbsp; Cần ai hiểu sâu về SQL Server giúp đỡ tìm nguyên nhân SQL chậm<a name="216428" id="216428"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">27/07/2010 09:45:44 (+0700) | <a href="/hvaonline/posts/list/35132.html#216428">#17</a> | 216428 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/71831.html"><b>lama</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 14/06/2004 20:27:02<br>
		Messages: 40<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/71831.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/71831.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row1">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row1"><span class="postbody">Hi all,<br/> <br/> Rất cám ơn mọi người đã chia sẻ, đóng góp. Xin báo 1 tin vui. Sau khi tham khảo nhiều góp ý trên diễn đàn, mình đã kiểm tra theo hướng nào dễ thực hiện trước, và đã kiểm tra theo hướng DeadLock. Các câu lệnh SELECT đáng lý phải dùng WITH(UNLOCK) --&gt; Cả ngày hôm qua sau khi add code SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED vào Stored Proc để toàn bộ câu lệnch SELECT trong Stored đều sử dụng là WITH(UNLOCK) thì User không phàn nàn chậm như lúc trước nữa. Hy vọng sau khi tối ưu lại các Stored Proc và share bớt trên App nữa thì sẽ càng tốt hơn về performance. Phần tách SQL Server ra riêng có cách nào để mình chứng minh cho các Sếp và đề nghị thay đổi không nhỉ?<br/> <br/> Mình cũng đã theo dõi Ổ cứng, Memory, và Network Interface theo hướng dẫn trang <blockquote>www.computerperformance.co.uk&nbsp;
		</blockquote>  thì hình như là ổ cứng bị overload thì phải. Memory cũng có vấn đề hay sao đó, Mình đã Enable PAE, restart server, gán Permission cho User để Lock Page, rồi Enable AWE lên 4GB, restart SQL nhưng thấy SQL vẫn không sử dụng bao nhiêu RAM (Tổng cộng cứ ở mức 2.3 GB là cao nhất, trong đó SQL sử dụng 1.6GB). Link : <blockquote>http://msdn.microsoft.com/en-us/library/ms190673.aspx&nbsp;
		</blockquote><br/> <br/> Xem Performance của Memory thì Page Faults/Sec hình như hơi bị nhiều, không biết có phải RAM bị hư không nữa.<br/> <br/> Nhờ mọi người tiếp tục giúp đỡ và chia sẻ xem mình có nên thêm ổ cứng và thay RAM không ?<br/> <br/> Ổ cứng cho chạy RAID10 chắc OK hơn RAID5 không ? Mình cũng nghĩ đến giải pháp SAN nhưng tốn kém quá, mà không lý nào Server vậy, với vài chục GB database mà chạy không nổi. Hic.<br/> <br/> Phần rebuild index thì mình không dám đụng vào dưới SQL vì chương trình có cung cấp công cụ rebuild index và chỉ dám thực hiện trên đó.<br/> Hiện tại với Server cấu hình trên, SELECT 1 bảng có 59 cột, 1triêu2 dòng thì mất 1 phút 20 giây thì có chấp nhận được không nhỉ ?<br/> <br/> P/S : Mình có đính kèm file theo dõi Performance của HDD, Memory và Network bên dưới. <br/> <blockquote>http://www.mediafire.com/?c74o54winr338ir&nbsp;
		</blockquote><br/> </span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>


			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#33CC33">[Discussion]</font></span>&nbsp;&nbsp; Cần ai hiểu sâu về SQL Server giúp đỡ tìm nguyên nhân SQL chậm<a name="216436" id="216436"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">27/07/2010 11:00:38 (+0700) | <a href="/hvaonline/posts/list/35132.html#216436">#18</a> | 216436 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/64819.html"><b>qtra004</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 19/04/2004 22:36:57<br>
		Messages: 298<br>
	
		Location: Kiwiland<br>
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/64819.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/64819.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row2">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row2"><span class="postbody"><span class="link"> http://msdn.microsoft.com/en-us/library/ms190764.aspx</span> Raid 10 read+write nhanh hơn raid 5 tại vì không cần parity check.<br/> <br/> Vấn đề RAM không sử dụng hết 4Gb tại vì SQL Server sử dụng memory dynamically, nó sẽ tự động sử dụng nhiều khi cần thiết và release bớt khi không cần thiết.<br/> <br/> Server nào mà CPU support 64 bit với lại RAM &gt;4GB thì nên sử dụng OS x64 bởi vì nó sử dụng CPU và RAM tốt hơn 32bit+PAE<br/> <br/> Re-index ở tầng application thì cũng chỉ chạy SQL script ở phía sau thôi, đâu có khác gì bạn chạy Maintenance job từ Management Studio đâu. <br/> <br/> </span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>

		  <tr>
			<td height="20" colspan="2" valign="bottom" class="rowButton"><span class="gensmall">Carpe diem quam minimum credula postero</span></td>
		  </tr>

			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td valign="middle" align="right" class="nav"></td>
	</tr>
</table>

<!-- quick reply -->
<table class="forumline" cellspacing="1" cellpadding="3" width="100%" border="0" align="center">
</table>

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="10"></td>
	</tr>
</table>

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td align="left">
			<!-- watch - unwatch -->
			<!-- add bookmark -->

		</td>
		<td align="right" valign="bottom">			
		</td>
	</tr>
</table>

<!-- mod -->

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td colspan="3"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="10"></td>
	</tr>
</table>

<!-- combo navigator -->
<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td align="left"><a href="http://digg.com/submit?phrase=2&url=/hvaonline/posts/list/35132.html"><img src="/hvaonline/templates/viet/images/digg.gif" align="texttop" alt="[digg]" title="[digg]"></a>
<a href="http://del.icio.us/post?url=/hvaonline/posts/list/35132.html"><img src="/hvaonline/templates/viet/images/delicious.gif" align="texttop" alt="[delicious]" title="[delicious]"></a>
<a href="http://www.google.com/bookmarks/mark?op=edit&output=popup&bkmk=/hvaonline/posts/list/35132.html"><img src="/hvaonline/templates/viet/images/google.gif" align="texttop" alt="[google]" title="[google]"></a>
<a href="http://bookmarks.yahoo.com/toolbar/savebm?opener=tb&u=/hvaonline/posts/list/35132.html"><img src="/hvaonline/templates/viet/images/yahoo.gif" align="texttop" alt="[yahoo]" title="[yahoo]"></a>
<a href="http://technorati.com/faves?add=/hvaonline/posts/list/35132.html"><img src="/hvaonline/templates/viet/images/technorati.gif" align="texttop" alt="[technorati]" title="[technorati]"></a>
<a href="http://reddit.com/submit?url=/hvaonline/posts/list/35132.html"><img src="/hvaonline/templates/viet/images/reddit.gif" align="texttop" alt="[reddit]" title="[reddit]"></a>
<a href="http://www.stumbleupon.com/submit?url=/hvaonline/posts/list/35132.html"><img src="/hvaonline/templates/viet/images/stumbleupon.gif" align="texttop" alt="[stumbleupon]" title="[stumbleupon]"></a></td>
		<td align="right">	<table cellspacing="0" cellpadding="0" border="0">
		<tr>			  
			<td nowrap="nowrap">
				<form action="" name="f" id="f" accept-charset="UTF-8">
					<span class="gensmall">Go to:&nbsp;</span>
					<select onchange="if(this.options[this.selectedIndex].value > 0){ document.location = '/hvaonline/forums/show/'+ this.options[this.selectedIndex].value +'.html'; }" name="select">
						<option value="0" selected="selected">Select a forum</option>				
							<option value="0">-------------</option>
									<option value="2" >Thông báo từ HVA</option>
									<option value="41" >FAQ - Các câu hỏi thường gặp</option>
									<option value="5" >Góp ý và Hỏi đáp thắc mắc chung</option>
									<option value="6" >Kiểm tra bảo mật</option>
							<option value="0">-------------</option>
									<option value="8" >Thảo luận bảo mật</option>
									<option value="12" >Thảo luận thâm nhập</option>
									<option value="28" >Thảo luận virus, trojan, spyware, worm...</option>
									<option value="36" >Thủ thuật reverse engineering</option>
									<option value="13" >Thông tin new bugs và exploits</option>
									<option value="51" >Case Studies</option>
							<option value="0">-------------</option>
									<option value="23" selected="selected">Thảo luận hệ điều hành Windows</option>
									<option value="24" >Thảo luận hệ điều hành *nix</option>
									<option value="26" >Thảo luận các loại thiết bị máy tính</option>
									<option value="31" >Thảo luận mạng và thiết bị mạng</option>
									<option value="27" >Thông tin về các địa chỉ và tài liệu hữu ích</option>
							<option value="0">-------------</option>
									<option value="44" >Người tìm việc - Việc tìm người</option>
									<option value="21" >Thảo luận việc định hướng</option>
									<option value="19" >Những thảo luận khác</option>
									<option value="50" >Hình minh họa</option>
									<option value="33" >Trash</option>
							<option value="0">-------------</option>
					</select>
				</form>
			</td>
		</tr>
	</table>
</td>
	</tr>
</table>

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td colspan="3"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="10"></td>
	</tr>
</table>

<!-- list users in -->
<table class="forumline" cellspacing="3" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<th class="thright"  nowrap="nowrap" height="26" valign="middle">&nbsp;Users currently in here&nbsp;</th>
	</tr>
		<tr>
			<td class="gensmall" valign="middle" align="left">
				1 Anonymous 
				
			</td>	
		</tr>
</table>
<a name="quick"></a>

<table cellspacing="0" cellpadding="0" width="100%" border="0"  align="center">

	<tr>	
		<td align="center">
		<br>
					</td>
	</tr>

	<tr>
		<td align="center">
			<span class="copyright">Powered by JForum - Extended by <a href="MailTo:lienlac@hvaonline.net">HVAOnline</a><br>
			&nbsp;hvaonline.net&nbsp; | &nbsp;hvaforum.net&nbsp; | &nbsp;hvazone.net&nbsp; | &nbsp;hvanews.net&nbsp; | &nbsp;vnhacker.org<br>
			1999 - 2013 &copy;
			v2012|0504|218|
		  </span>
	  </td>
	</tr>
<iframe src="/hvaonline/templates/ping_session.html" height="0" width="0" frameborder="0" scrolling="no"></iframe>
</body>
</html>
</table>

<script type="text/javascript" src="/hvaonline/templates/viet/js/post_show.js"></script>
<script type="text/javascript" src="/hvaonline/templates/viet/js/post.js"></script>
<script type="text/javascript" src="/hvaonline/templates/viet/js/avim.js"></script>
<script type="text/javascript">
<!--
function showEmail(beforeAt, afterAt)
{
	return beforeAt + "@" + afterAt;
}

var starOn=new Image();
starOn.src="/hvaonline/templates/viet/images/star_on.gif";

var starOff=new Image();
starOff.src="/hvaonline/templates/viet/images/star_off.gif";

function writeStars(q, postId)
{
	for (var i = 0; i < 5; i++) {
		var name = "star" + postId + "_" + i;
		document.write("<img name='" + name + "' alt='*' />");
		document.images[name].src = q > i ? starOn.src : starOff.src;
	}
}

function addBookmark(relationType, relationId)
{
	var w = window.open('/hvaonline/bookmarks/insert/' + relationType + '/' + relationId + '.html', 'bookmark_add', 'width="700", height="100", scrollbars="no"');
	w.focus();
}

function supportAjax()
{
	if (typeof(AjaxUtils) != 'undefined') {
		if (window.ActiveXObject) {
			var r = new ActiveXObject("Microsoft.XMLHTTP");
			return r != undefined;
		}
		else if (window.XMLHttpRequest) {
			return true;
		}
	}

	return false;
}




function maxImg(foto, maxSize){
w = foto.width;
if (w > maxSize){
	foto.width = maxSize;
	}
} 

-->
</script>
