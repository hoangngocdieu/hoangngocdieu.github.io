<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"> 

<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="-1">
<meta name="description" content="HVA discussion board">
<meta name="keywords" content="Messages posted by lyphuong, jforum, jforum java, jforum forum, forum java, java jforum, java forum, forum, rafael steil, bulletin board, java bb, javabb, hva, hvaonline, hvazone, hvaforum">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="robots" content="index,follow">
<meta name="rating" content="general">
<style type="text/css">
<!-- 
@import url( "http://www.hvaonline.net/hvaonline/templates/viet/styles/style.css");
-->
</style>
<style type="text/css">
<!--
@import url("http://www.hvaonline.net/hvaonline/templates/viet/styles/en_US.css");
-->
</style>
<title>Messages posted by lyphuong - .:: HVAOnline ::.</title>

</head>
<body class="en_US">


<!--
Original theme from phpBB (http://www.phpbb.com) subSilver
Created by subBlue design
http://www.subBlue.com
Modifications by JForum Team 
Extended and customised by HVA Team
Added more features and Black Silver theme designed by HVA
-->
<table width="100%" border="0" cols="2">
	<tr align="right">
		<td class="copyright">
			English
			| 
			<a href="/hvaonline/jforum.html?module=forums&amp;action=setLang&amp;lang=vi_VN" rel="nofollow">Vietnamese</a>
		</td>
	</tr>
</table>
<table width="100%" border="0">
	<tr>
		<td>
			<table cellspacing="0" cellpadding="0" width="100%" border="0">
				<tr>			
        <td>&nbsp;
			</td>
		
        <td width="100%" align="center" valign="middle">
						<p><a href="http://www.hvaonline.net" title="[Logo]">
								<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/hvabanner-final.gif" alt="banner" />
							<br>
            				</a><span class="maintitle"></span>
						</p>
          <table cellspacing="0" cellpadding="2" border="0">
							<tr>
								
              <td valign="top" nowrap="nowrap" align="center">
			  						<a href="/hvaonline/forums/rule.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_rule.gif" alt="[Rule]" title="[Rule]"></a>
									<a id="rule" class="topmenu" href="/hvaonline/forums/rule.html">Rules</a>&nbsp;
									
									<a class="topmenu" href="/hvaonline/forums/list.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_groups.gif" alt="[Home]" title="[Home]"></a>
										<a id="backtosite" class="topmenu" href="/hvaonline/forums/list.html">Main Forum</a>&nbsp;

										<a class="topmenu" href="/hvaonline/portal/list.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_portal.gif" alt="[Portal]" title="[Portal]"></a>
										<a id="portalsite" class="topmenu" href="/hvaonline/portal/list.html">Portal</a>&nbsp;&nbsp;
									<br>
									
										<a href="/hvaonline/user/list.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_members.gif" alt="[Members]" title="[Members]"></a>
										<a id="users" class="topmenu" href="/hvaonline/user/list.html">Member Listing</a>&nbsp;
										
										<a href="/hvaonline/forums/stats.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_stats.gif" alt="[Statistics]" title="[Statistics]"></a>
										<a id="stats" class="topmenu" href="/hvaonline/forums/stats.html">Statistics</a>&nbsp;
										
										<a href="/hvaonline/search/filters.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_search.gif" alt="[Search]" title="[Search]"></a>
										<span class="mainmenu"><a id="search" class="topmenu" href="/hvaonline/search/filters.html"><b>Search</b></a>&nbsp;
									
										<a href="/book/"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_book.gif" alt="[Reading Room]" title="[Reading Room]"></a> 
										<a class="topmenu" href="/hvaonline/readingRoom/list.html">Reading Room</a>&nbsp;

									
									<span class="topmenu"> 
										

	
										<br>
											<a id="register" class="topmenu" href="/hvaonline/user/insert.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_register.gif" border="0" alt="[Register]" title="[Register]"> 
												Register</a>&nbsp;&nbsp;</span>
											<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_login.gif" border="0" alt="[Login]" title="[Login]"> 
											<strong>Login</strong> [&nbsp;
											<a id="login" class="topmenu" href="/hvaonline/user/login.html">http</a>&nbsp;
											|
											<a id="logins" class="topmenu" href="https://www.hvaonline.net/hvaonline/user/logins.html">https </a>&nbsp;]</span>
								</td>
							</tr>
							<tr>
								<td>&nbsp;</td>
							</tr>
						</table>
					</td>
				</tr>
			</table>
		</td>
	</tr>
	<tr>
		<td>

<script type="text/javascript" src="http://www.hvaonline.net/hvaonline/templates/viet/js/post_show.js"></script>
<script type="text/javascript" src="http://www.hvaonline.net/hvaonline/templates/viet/js/post.js"></script>
<script type="text/javascript">
<!--

function showEmail(beforeAt, afterAt)
{
	return beforeAt + "@" + afterAt;
}

var starOn=new Image();
starOn.src="http://www.hvaonline.net/hvaonline/templates/viet/images/star_on.gif";

var starOff=new Image();
starOff.src="http://www.hvaonline.net/hvaonline/templates/viet/images/star_off.gif";

function writeStars(q, postId)
{
	for (var i = 0; i < 5; i++) {
		var name = "star" + postId + "_" + i;
		document.write("<img name='" + name + "' alt='*' />");
		document.images[name].src = q > i ? starOn.src : starOff.src;
	}
}

function addBookmark(relationType, relationId)
{
	var w = window.open('/hvaonline/bookmarks/insert/' + relationType + '/' + relationId + '.html', 'bookmark_add', 'width="700", height="100", scrollbars="no"');
	w.focus();
}

function supportAjax()
{
	if (typeof(AjaxUtils) != 'undefined') {
		if (window.ActiveXObject) {
			var r = new ActiveXObject("Microsoft.XMLHTTP");
			return r != undefined;
		}
		else if (window.XMLHttpRequest) {
			return true;
		}
	}

	return false;
}

-->
</script>

<table cellspacing="0" cellpadding="10" width="98%" align="center" border="0">
	<tr>
		<td class="bodyline">
			<table cellspacing="2" cellpadding="2" width="100%" border="0">
				<tr>
					<td valign="middle" align="left" colspan="2">
						<span class="maintitle"><a href="/hvaonline/posts/listByUser/136044.html" name="top" class="maintitle" id="top">Messages posted by: lyphuong</a></span>
						&nbsp;<a href="/hvaonline/rss/showPostsByUser/136044.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/xml_button.gif" border="0" alt="XML" /></a>
					</td>
				</tr>
			</table>
			
			<table cellspacing="2" cellpadding="2" width="100%" border="0">
				<tr>
					
					<td valign="middle" align="left" colspan="0">
						<span class="nav">
						<a href="/hvaonline/user/profile/136044.html">Profile for lyphuong</a> 
            			<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif"><a href="/hvaonline/posts/listByUser/136044.html">Messages posted by lyphuong</a>
						</span>
					</td>
										
					<td valign="middle" align="right">
						<span class="nav">[ number of posts not being displayed on this page: <span class="moderator">0</span> ]</span>
					</td>
				</tr>
			</table>

			
      <table class="forumline" cellspacing="1" cellpadding="3" width="100%" border="0">
        <tr>
          <th height="26" nowrap="nowrap" class="thleft">&nbsp;</th>
        </tr>

				
        <!-- POST LISTING -->
         
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.html">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/44941.html">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/44941/278936.html#278936,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row1" valign="top">
			<span class="postbody"><p></p>
<cite class="blockquote">vd_ wrote:</cite><br>
<blockquote>bạn nên chia sẻ thêm là bạn giải quyết như thế nào, các bạn khác cũng như tôi sẽ học hỏi được thêm các case để xử lý.&nbsp;
</blockquote><br/><br/> Khi dns trỏ abc.com.vn và def.com.vn vào (2 máy chủ web) 192.168.115 và 192.168.2.119 các máy trong lan dùng browser truy cập vào 2 site (đi thẳng đến máy webserver) không đi qua máy nginx front end proxy (Các tập tin log nginx sẽ không ghi vào được dung lượng là 0)<br/><br/> Khi dns trỏ abc.com.vn và def.com.vn vào 192.168.1.2 (máy nginx front end proxy, iptables) các máy trong lan dùng browser truy cập vào 2 site đi qua máy nginx front end proxy (Các tập tin log nginx nội dung sẽ được ghi)<br/><br/> Đến thời điểm này phần cấu hình nginx hoạt động tốt (nginx.conf, proxy.conf )<br/><br/> Nhưng các browser từ bên ngoài Internet vẫn không truy cập 2 site với tên miền abc.com.vn và def.com.vn.<br/><br/> Vấn đề xét đến các rule của iptables và đây là rule cuối cùng mình thêm thì các browser từ bên ngoài Internet truy cập 2 site.<br/><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>-A PREROUTING -p tcp -dport 80 -j REDIRECT --to-ports 80</pre>
</div><br/><br/> Rule này nó đè làm mất tác dụng các rule để transparent proxy with Squid<br/><br/><br/> <font color='red'><b>Mình tóm lại trường hợp và cách giải quyết để các bạn tham khảo: (Public 2 site ở 2 server khác nhau qua Internet)</b></font><br/><br/> - Có 01 public IP<br/> - Và 02 domain (ABC và XYZ) cùng map về Public IP ở trên<br/> - Mỗi domain nằm trên 1 server khác nhau.<br/><br/> <b><font color='red'>Cài đặt và cấu hình server Firewall: </font></b><br/> 1. Squid để các máy trong lan truy cập Internet.<br/> 2. Cài đặt và cấu hình nginx (nginx multiple backend web servers) như trên.<br/> 3. Thiết lập rule cần thiết cho iptables và thêm rule.<br/><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>-A PREROUTING -p tcp -dport 80 -j REDIRECT --to-ports 80</pre>
</div><br/> </span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.html">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/44941.html">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/44941/278794.html#278794,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row2" valign="top">
			<span class="postbody"><p></p>
<cite class="blockquote">vd_ wrote:</cite><br>
<blockquote>- khi vào 2 site bằng browser thì hiện ra cái gì?<br/> - dns đã trỏ abc.com.vn và def.com.vn vào 192.168.1.2 chưa?&nbsp;
</blockquote><br/><br/> Vấn đề đã giải quyết được rồi, cám ơn <b>vd_</b> và <b>quanta</b> đã định hướng và giúp đỡ cho mình hoàn thành vụ này. làm việc với mấy vụ này dễ bị điên wá !<br/> Thank mọi người !</span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.html">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/44941.html">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/44941/278558.html#278558,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row1" valign="top">
			<span class="postbody"><p></p>
<cite class="blockquote">vd_ wrote:</cite><br>
<blockquote>1. Thông báo lỗi của nginx là gì?<br/> 2. Bạn dùng upstream server1 {... } & upstream server2 {... } rồi reference đến server1 và server2 trong proxy_pass thay vì dùng full domain như hiện tại. Theo tui đoán thì khi bạn dùng proxy_pass<span class="link"> http://def.com.vn;</span> thì nginx không biết bạn muốn pass đến server def.com.vn thực tế hay phần upstream def.com.vn trước đó.<br/> &nbsp;
</blockquote><br/><br/><br/> Các tập tin log sao nó không ghi vào được dung lượng là 0:<br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>-rw-r--r--. 1 nginx root 0 Aug 20 21:09 access.log
-rw-r--r--. 1 nginx root 0 Aug 26 21:48 error.log</pre>
</div><br/><br/> Mình sửa lại upstream bằng tên và proxy_pass theo tên proxy_pass <span class="link"> http://thuvien</span> nhưng vẫn chưa có kết quả khả quan.<br/><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>http {
include /etc/nginx/mime.types;
default_type application/octet-stream;
log_format main '$remote_addr - $remote_user &#91;$time_local&#93; "$request" '
'$status $body_bytes_sent "$http_referer" '
'"$http_user_agent" "$http_x_forwarded_for"';
access_log /var/log/nginx/access.log main;
sendfile on;
#tcp_nopush on;
#keepalive_timeout 0;
keepalive_timeout 65;
#gzip on;
upstream apachephp {
server 192.168.2.115:80;
}
server
{
listen 192.168.1.2:80;
server_name abc.com.vn;
location / {
proxy_pass <span class="link"> http://apachephp;</span>
include /etc/nginx/conf.d/proxy.conf;
#proxy_set_header Host $host;
#proxy_set_header X-Real-IP $remote_addr;
#proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
}
}
upstream thuvien {
server 192.168.2.119:80;
}
server
{
listen 192.168.1.2:80;
server_name def.com.vn;
location / {
proxy_pass <span class="link"> http://thuvien;</span>
include /etc/nginx/conf.d/proxy.conf;
#proxy_set_header Host $host;
#proxy_set_header X-Real-IP $remote_addr;
#proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
}
}
}</pre>
</div></span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.html">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/44941.html">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/44941/278472.html#278472,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row2" valign="top">
			<span class="postbody"><p></p>
<cite class="blockquote">quanta wrote:</cite><br>
<blockquote>@lyphuong: Với Nginx, phần cấu hình cho def.com.vn trỏ về 2.119 đâu bạn?&nbsp;
</blockquote><br/><br/> Mình có sửa lại, đây là phần cấu hình hiện tại<br/><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>http {
include /etc/nginx/mime.types;
default_type application/octet-stream;
log_format main '$remote_addr - $remote_user &#91;$time_local&#93; "$request" '
'$status $body_bytes_sent "$http_referer" '
'"$http_user_agent" "$http_x_forwarded_for"';
access_log /var/log/nginx/access.log main;
sendfile on;
#tcp_nopush on;
#keepalive_timeout 0;
keepalive_timeout 65;
#gzip on;
upstream abc.com.vn {
server 192.168.2.115:80;
}
server
{
listen 192.168.1.2:80;
server_name abc.com.vn;
location / {
proxy_pass <span class="link"> http://abc.com.vn;</span>
include /etc/nginx/conf.d/proxy.conf;
#proxy_set_header Host $host;
#proxy_set_header X-Real-IP $remote_addr;
#proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
}
}
upstream def.com.vn {
server 192.168.2.119:80;
}
server
{
listen 192.168.1.2:80;
server_name def.com.vn;
location / {
proxy_pass <span class="link"> http://def.com.vn;</span>
include /etc/nginx/conf.d/proxy.conf;
#proxy_set_header Host $host;
#proxy_set_header X-Real-IP $remote_addr;
#proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
}
}
}</pre>
</div><br/><br/> /etc/nginx/conf.d/proxy.conf<br/><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>proxy_wwwect off;
proxy_set_header Host $host;
proxy_set_header X-Real-IP $remote_addr;
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
client_max_body_size 100M;
client_body_buffer_size 1m;
proxy_intercept_errors on;
proxy_buffering on;
proxy_buffer_size 128k;
proxy_buffers 256 16k;
proxy_busy_buffers_size 256k;
proxy_temp_file_write_size 256k;
proxy_max_temp_file_size 0;
proxy_read_timeout 300;</pre>
</div><br/> </span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.html">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/44941.html">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/44941/278465.html#278465,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row1" valign="top">
			<span class="postbody">Tình trạng của mình đúng như bạn <b>zinxu</b> mô tả là có 1 IP public và 02 domain nằm tên 02 sever khác nhau<br/> Theo <b>vd_</b> và <b>quanta</b> dùng squid hoặc nginx để giải quyết trường hợp của mình.<br/> Mình đã dùng squid hoặc nginx để cấu hình nhưng chưa thành công, không biết lỗi gì trong tập tin cấu hình.<br/><br/> <p></p>
<cite class="blockquote">zinxu wrote:</cite><br>
<blockquote>Tôi chưa đọc đến phần IPtables, nhưng vì bạn không đề cập đến public IP nên tôi muốn hỏi lại để làm rõ đề bài.<br/><br/> Tôi hiểu đề bài như dưới đây, không biết có đúng không?<br/> - Bạn có 01 public IP<br/> - Và 02 domain (ABC và XYZ) cùng map về Public IP ở trên<br/> - Mỗi domain nằm trên 1 server khác nhau.<br/><br/> Vấn đề:<br/> - Từ Internet vào ABC hay XYZ luôn bị lấy dữ liệu của domain ABC<br/><br/> Nếu như tôi hiểu đúng đề bài, thì về nguyên tắc phải có thiết bị/phần mềm hiểu được HTTP request: để tiếp nhận và từ đó chuyển tiếp yêu cầu đến đúng đích. Theo tôi, ý của bạn <b>vd_</b> ở trên là đúng hướng rồi. Vấn đề chính không phải là firewall hay hệ điều hành, mà là phân tích được thông tin về domain trong gói tin HTTP để chuyển tiếp.<br/><br/> Chúc bạn thành công,&nbsp;
</blockquote></span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.html">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/44941.html">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/44941/278436.html#278436,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row2" valign="top">
			<span class="postbody">Mình cố gắng tìm hiểu cấu hình cho được vụ này chứ hỏi hoài cũng hỏng ổn, mà lay hoay cũng chưa ra.<br/><br/> Theo <b>quanta</b> mình sử dụng squid cấu hình cho Webserver public vẫn chưa được, chưa tìm ra lỗi gì; và <b>vd_</b> dùng nginx vẫn chưa được<br/><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>cache_peer 192.168.2.115 parent 80 0 no-query originserver name=centos6
cache_peer_domain centos6 abc.com.vn
cache_peer 192.168.2.119 parent 80 0 no-query originserver name=servertv
cache_peer_domain servertv def.com.vn</pre>
</div><br/><br/> Mình sử dụng nginx cấu hình vẫn không được: nginx.conf<br/> Firewall: CentOS 6 gồm Iptables, squid<br/> <font color='red'>Eth0 (card mạng ngoài): 192.168.1.2<br/> Eth1 (card mạng trong): 192.168.2.111<br/><br/> WebServer1: 192.168.2.115 (abc.com.vn)</font> vì mình hỏng dám đưa tên miền thật lên trong file cấu hình<br/><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>http {
include /etc/nginx/mime.types;
default_type application/octet-stream;
log_format main '$remote_addr - $remote_user &#91;$time_local&#93; "$request" '
'$status $body_bytes_sent "$http_referer" '
'"$http_user_agent" "$http_x_forwarded_for"';
access_log /var/log/nginx/access.log main;
sendfile on;
#tcp_nopush on;
#keepalive_timeout 0;
keepalive_timeout 65;
#gzip on;
## Basic reverse proxy server ##
## Apache backend for abc.com.vn ##
upstream apachephp {
server 192.168.2.115:80;
}
## Start abc.com.vn##
server {
listen 192.168.1.2:80;
server_name abc.com.vn;
access_log /var/log/nginx/abc.com.vn.access.log main;
error_log /var/log/nginx/abc.com.vn.error.log;
#root /usr/share/nginx/html;
#index index.html index.htm;
## send request back to apache1 ##
location / {
proxy_pass <span class="link"> http://apachephp;</span>
include /etc/nginx/conf.d/proxy.conf;
}
}
## End thongtinkhcn.vinhlong.gov.vn##
}</pre>
</div><br/><br/> /etc/nginx/conf.d/proxy.conf<br/><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>proxy_wwwect off;
proxy_set_header Host $host;
proxy_set_header X-Real-IP $remote_addr;
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
client_max_body_size 100M;
client_body_buffer_size 1m;
proxy_intercept_errors on;
proxy_buffering on;
proxy_buffer_size 128k;
proxy_buffers 256 16k;
proxy_busy_buffers_size 256k;
proxy_temp_file_write_size 256k;
proxy_max_temp_file_size 0;
proxy_read_timeout 300;</pre>
</div><br/><br/> Các tập tin log không ghi vào được dung lượng là 0:<br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>-rw-r--r--. 1 nginx root 0 Aug 20 21:09 access.log
-rw-r--r--. 1 nginx root 0 Aug 26 21:48 error.log
-rw-r--r--. 1 nginx root 0 Aug 21 15:09 abc.com.vn.access.log
-rw-r--r--. 1 nginx root 0 Aug 21 15:09 abc.com.vn.error.log</pre>
</div><br/><br/> Mình sử dụng nginx reverse proxy websever backends trong nội bộ LAN thì truy cập được không không thể public ra ngoài Internet<br/> </span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.html">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/44941.html">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/44941/277833.html#277833,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row1" valign="top">
			<span class="postbody"><p></p>
<cite class="blockquote">vd_ wrote:</cite><br>
<blockquote>Tuỳ theo tên miền mà route traffic, như vậy việc quyết định route traffic là ở lớp application -&gt; iptable không thể dùng được, phải dùng reverse proxy.<br/><br/> Squid có thể đươc, tuy không chuyên.<br/><br/> Thường người ta sẽ dùng nginx, mod_proxy, haproxy, varnish v.v... để làm việc này.&nbsp;
</blockquote><br/><br/> Mình vẫn còn đang lây quây vấn đề này vấn chưa xong, vấn đề của mình một WebServer1 là HĐH Windows 2003, còn một WebServer2 CentOS 6<br/><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>WebServer1: 192.168.2.115 &#40;abc.com.vn&#41;
WebServer2: 192.168.2.119 &#40;def.com.vn&#41;</pre>
</div><br/><br/> </span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.html">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/44941.html">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/44941/277760.html#277760,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row2" valign="top">
			<span class="postbody"><blockquote>- iptables hoạt động ở tầng nào? Trong khi đó cái hostname kia (def.com.vn) nằm ở tầng nào? Một request từ ngoài vào, đến 192.168.1.2, cổng 80 làm sao iptables biết chuyển nó đi đâu?<br/> - Thứ tự xử lý các rules của iptables ra sao? &nbsp;
</blockquote><br/><br/> Dù abc.com.vn hay def.com.vn đi vào nó đều phân giải thành cùng một IP do đó nó thực thi ưu tiên rule từ trên xuống<br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>iptables -t nat -A PREROUTING -p tcp --dport 80 -d 192.168.1.2 -i eth0 -j DNAT --to 192.168.2.115:80</pre>
</div><br/> Nên lúc nào nó cũng đi vào nội dung website tên miền websever1: 192.168.2.115<br/><br/> Quanta cho mình hỏi Có lẽ phải NAT thêm port 53 DNS cho nó để nó hiểu được là abc.com.vn hay def.com.vn để đi đúng vào hostname hỏng biết phải không để mai mình thử xem sao<br/> </span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.html">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/44941.html">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/44941/277352.html#277352,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row1" valign="top">
			<span class="postbody">Hiện tại từ Internet bên ngoài chỉ mới truy cập được vào website của WebServer1: 192.168.2.115 với tên miền là abc.com.vn<br/><br/> Hiện tại mình gặp vấn đề còn lại mong mọi người giúp đỡ, cám ơn mọi người<br/><br/> Chưa thiết lập được để Internet bên ngoài truy cập được vào website của WebServer2: 192.168.2.119 với tên miền là def.com.vn<br/><br/> Khi truy cập tên miền def.com.vn thì nó chạy vào nội dung website tên miền websever1: 192.168.2.115<br/><br/><br/> <b>Thiết lập mạng</b><br/> <font color='red'>Firewall: CentOS 6 gồm Iptables, squid<br/> Eth0 (card mạng ngoài): 192.168.1.2<br/> Eth1 (card mạng trong): 192.168.2.111</font><br/><br/> Các WebServer trong LAN, sử dụng mỗi tên miền cho website riêng<br/><br/> <font color='red'>WebServer1: 192.168.2.115 (abc.com.vn)<br/><br/> WebServer2: 192.168.2.119 (def.com.vn)</font><br/><br/> <b>Hiện tại cấu hình Iptables như sau:</b><br/><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>iptables -t nat -A PREROUTING -p tcp --dport 80 -d 192.168.1.2 -i eth0 -j DNAT --to 192.168.2.115:80
iptables -t nat -A PREROUTING -p tcp --dport 80 -d 192.168.1.2 -i eth0 -j DNAT --to 192.168.2.119:80
iptables -t nat -A POSTROUTING -p tcp --dport 80 -o eth0 -j SNAT --to 192.168.1.2
iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
iptables -A FORWARD -i eth0 -o eth1 -m state --state RELATED,ESTABLISHED -j ACCEPT
/sbin/iptables -A FORWARD -i eth1 -o eth0 -j ACCEPT
iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport 80 -j ACCEPT
iptables -A INPUT -i eth0 -p tcp -m tcp --dport 8080 -j ACCEPT
iptables -A INPUT -m tcp -p tcp --dport 53 -j ACCEPT
iptables -A INPUT -m udp -p tcp --dport 53 -j ACCEPT</pre>
</div><br/><br/> Tập tin <b>/etc/sysconfig/iptables</b><br/><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre># Generated by iptables-save v1.4.7 on Thu Jul 11 16:46:05 2013
*nat
<img src="/hvaonline/images/smilies/575eda61e93c7ad9d05928580213fd9b.gif" border="0" alt="smilie" align="absbottom">REROUTING ACCEPT &#91;26:5297&#93;
<img src="/hvaonline/images/smilies/575eda61e93c7ad9d05928580213fd9b.gif" border="0" alt="smilie" align="absbottom">OSTROUTING ACCEPT &#91;0:0&#93;
:OUTPUT ACCEPT &#91;34:2040&#93;
-A PREROUTING -d 192.168.1.2/32 -i eth0 -p tcp -m tcp --dport 80 -j DNAT --to-destination 192.168.2.115:80
-A PREROUTING -d 192.168.1.2/32 -i eth0 -p tcp -m tcp --dport 80 -j DNAT --to-destination 192.168.2.119:80
-A POSTROUTING -o eth0 -p tcp -m tcp --dport 80 -j SNAT --to-source 192.168.1.2
-A POSTROUTING -o eth0 -j MASQUERADE
COMMIT
# Completed on Thu Jul 11 16:46:05 2013
# Generated by iptables-save v1.4.7 on Thu Jul 11 16:46:05 2013
*filter
:INPUT ACCEPT &#91;0:0&#93;
:FORWARD ACCEPT &#91;0:0&#93;
:OUTPUT ACCEPT &#91;366:198764&#93;
-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT -p icmp -j ACCEPT
-A INPUT -i lo -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 80 -j ACCEPT
-A INPUT -i eth1 -p tcp -m tcp --dport 8080 -j ACCEPT
-A INPUT -m tcp -p tcp --dport 53 -j ACCEPT
-A INPUT -m udp -p tcp --dport 53 -j ACCEPT
-A INPUT -j REJECT --reject-with icmp-host-prohibited
-A FORWARD -j REJECT --reject-with icmp-host-prohibited
-A FORWARD -i eth0 -o eth1 -m state --state RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -i eth1 -o eth0 -j ACCEPT
COMMIT
# Completed on Thu Jul 11 16:46:05 2013</pre>
</div><br/> </span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/8.html">Thảo luận bảo mật</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/41145.html">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/41145/253394.html#253394,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row2" valign="top">
			<span class="postbody">Trong trường hợp này không biết là do script chèn vào code rồi từ đó nó tự đông post bài vào csdl, hay la người dùng phần mềm để tấn công. Trong trường hợp này mình muốn tìm cách khắc phục sự cố để rút kinh nghiệm bảo mật thì phải giải quyết thế nào. Mong mòi người giúp</span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/8.html">Thảo luận bảo mật</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/41145.html">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/41145/253369.html#253369,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row1" valign="top">
			<span class="postbody">Mình làm forum PHPBB3 đưa lên host http://lyphuong.byethost4.com/forum/ . Lúc đầu thì nó bình thường Không biết thế nào mà nó tự động post bài vào CSDL wá trời, mấy bài tiếng anh, tiếng nga là bị post tự động đến giới hạn 50MB của byethost.com là hư forum. Mình chưa có kinh nghiệm bảo mật mong mọi người tìm lỗi giúp, và chỉ cách bảo mật đối với forum PHPBB3.<br/> Thank !</span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.html">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/40142.html">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/40142/248110.html#248110,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row2" valign="top">
			<span class="postbody">Mình đã tìm thấy lỗi khi <font color='red'>mount cifs</font> không download được là do hàm <font color='red'>is_file và filesize</font> không làm việc trong tập tin xử lý download.php.<br/> Trong PHP có 4 hàm: <font color='red'>file_exists, is_file, filesize, is_dir</font><br/> - Nếu các tập tin đặt trực tiếp tại máy chủ Web Apache, chay PHP thì 4 hàm làm việc tốt.<br/> - Nếu các tập tin, thư mục được <font color='red'>mount cifs</font> đến thì hàm <font color='red'>file_exists làm việc</font>, nhưng 3 hàm <font color='red'>is_file, filesize, is_dir không làm việc</font><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>&lt;?php
echo file_exists&#40;'/share/dulieuweb/tailieuso/48471.pdf'&#41;; // hàm trả về 1 làm việc tốt
echo is_file&#40;'/share/dulieuweb/tailieuso/48471.pdf'&#41;; // hàm không làm việc
echo filesize&#40;'/share/dulieuweb/tailieuso/48471.pdf'&#41;; // hàm không làm việc
echo is_dir&#40;'/share/dulieuweb/tailieuso'&#41;; // hàm không làm việc
?&gt;</pre>
</div><br/> Sử dụng Google Search với từ khoá &quot;mount cifs is_file&quot; sẽ tìm thấy giải thích<br/> <blockquote><br/><span class="link"> http://php.net/manual/en/function.is-dir.php</span><br/> Just a note for anyone who encounters is_dir() returning false on CIFS mount points or directories within those mount points on 2.6.31 and newer kernels: Apparently in new kernels they've started using the CIFS serverino option by default. With Windows shares this causes huge inode numbers and which apparently can cause is_dir() to return false. Adding the noserverino option to the CIFS mount will prevent this. This may only occur on 32 systems but I don't have a 64 bit install to test against.&nbsp;
</blockquote><br/> Trên mạng có chỉ cách sử dụng <font color='red'>mount cifs</font> thêm option <font color='red'>noserverino</font><br/> Các hàm <font color='red'>file_exists, is_file, filesize, is_dir</font> đã làm việc, vấn đề download đã làm việc tốt.<br/> Cám ơn Anh conmale, cám ơn mọi người.<br/><br/><br/> </span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.html">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/40142.html">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/40142/247981.html#247981,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row1" valign="top">
			<span class="postbody"><blockquote>Thử mount thay vì vào /share/dulieuweb, thì mount vào /var/www/share/dulieuweb xem?&nbsp;
</blockquote><br/><br/> Mình có làm trường hợp này luôn rồi<br/> <b>Phần các tập tin đặt trong thư mục ứng dụng web</b><br/> Em cũng có kiểm tra mount các tập tin đến trong thư mục ứng dụng web <font color='red'>"/var/www/html/csdlkhcn"</font><br/> Khi mount đến máy chủ Web có đường dẫn thư mục chứa tập tin là "/var/www/html/csdlkhcn/dulieu/tailieuso"<br/> Định nghĩa đường dẫn<br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>define&#40; 'JPATH_DULIEU', 'http://192.168.2.115/csdlkhcn/dulieu'&#41;; // Duong dan nam trong thu muc ung dung Web</pre>
</div><br/> Quá trình download.php xử lý, kiểm tra đường dẫn đầy đủ đến tập tin 48471.pdf là<br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>http://192.168.2.115/csdlkhcn/dulieu/tailieuso/48471.pdf</pre>
</div><br/><br/> Kết quả vẫn giống như bên trên: tức là tập tin tại máy chủ Web Apache download được; tập tin mount từ thiết bị lưu trữ QNAP đến máy chủ web Apache thì không được</span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.html">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/40142.html">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/40142/247978.html#247978,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row2" valign="top">
			<span class="postbody"><blockquote>Trên apache config chẳng thấy có cái gì liên quan đến "/share/dulieuweb" hết. Cái "/share/dulieuweb" thuộc trong DocRoot nào của apache? Thuộc virtualhost nào (nếu có)?<br/><br/> Trong cấu hình của apache ở trên chỉ có mỗi: DocumentRoot "/var/www/html", vậy cái "/share/dulieuweb" nằm ở đâu trong DocumentRoot này?&nbsp;
</blockquote><br/><br/> Khi mount đến máy chủ Web có đường dẫn thư mục chứa tập tin là <font color='red'>"/share/dulieuweb/tailieuso"<br/> </font><br/> <b>Kiểm tra Link download</b><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>csdlkhcn/download.php?dulieu=tailieuso&file=48463.pdf</pre>
</div><br/> <b>Code định nghĩa đường dẫn:</b><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>define&#40; 'JPATH_DULIEU', '/share/dulieuweb'&#41;; // Duong dan thu muc nam ngoai ung dung Web</pre>
</div><br/> Em không dùng virtualhost<br/> Đường dẫn nằm ngoài thư mục ứng dụng web, tức là "/share/dulieuweb" (tại root)<br/> Tuy không nằm trong DocumentRoot (Không nằm trong <font color='red'>DocumentRoot "/var/www/html"</font> ; hoặc không nằm trong thư mục ứng dụng web <font color='red'>"/var/www/html/csdlkhcn"</font> nhưng vẫn download được tập tin chứa trong đường dẫn "/share/dulieuweb/tailieuso", em đã kiểm tra cả các máy trong LAN và ngoài Internet.<br/> Code php nhận thêm đường dẫn có thư mục tailieuso và cả tập tin cần download<br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>if &#40;$_GET&#91;"dulieu"&#93;=='mov'&#41;
$upload_dir=JPATH_DULIEU.'/movie/';
else if &#40;$_GET&#91;"dulieu"&#93;=='tailieuso'&#41;
$upload_dir=JPATH_DULIEU.'/tailieuso/';
else if &#40;$_GET&#91;"dulieu"&#93;=='dulieucnnn'&#41;
$upload_dir=JPATH_DULIEU.'/dulieucnnn/';
else if &#40;$_GET&#91;"dulieu"&#93;=='detai'&#41;
$upload_dir=JPATH_DULIEU.'/detai/'.$_GET&#91;"dd"&#93;.'/';
else if &#40;$_GET&#91;"dulieu"&#93;=='congviec'&#41;
$upload_dir=JPATH_DULIEU.'/congviec/';
//lay ten file can download tu URL
$filename = isset&#40;$_GET&#91;'file'&#93;&#41;?$_GET&#91;'file'&#93;:'';
$filename=str_replace&#40;".dat",".wmv",$filename&#41;;
// Kiem tra in duongdan den taptin
//echo $upload_dir.$filename;</pre>
</div><br/> Quá trình <font color='orange'>download.php</font> xử lý, kiểm tra đường dẫn đầy đủ đến tập tin <font color='orange'>48471.pdf</font> là<br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>/share/dulieuweb/tailieuso/48471.pdf</pre>
</div><br/><br/> <b>Nó chỉ bị sự cố ở chỗ là:</b><br/> - Trường hợp 1: <font color='red'>Tập tin nằm trực tiếp tại máy chủ Web Apache thì download được</font><br/> - Trường hợp 2: <font color='red'>Tập tin được mount đến máy chủ Web Apache thì download không được</font> (đây là trường hợp cần khắc phục để sử dụng)<br/><br/> Phải chi cả 2 trường hợp đều download không được thì mình nghĩ là lỗi do code php, hay lỗi đường dẫn; đằng này nó chỉ khác ở chổ là <font color='red'>tập tin tai máy chủ web</font>; hay <font color='red'>tập tin mount đến máy chủ web</font> (vị trí đường dẫn đến tập tin thì giống nhau)<br/><br/><br/><br/> <b>Phần các tập tin đặt trong thư mục ứng dụng web</b><br/> Em cũng có kiểm tra mount các tập tin đến trong thư mục ứng dụng web <font color='red'>"/var/www/html/csdlkhcn"</font><br/> Định nghĩa đường dẫn<br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>define&#40; 'JPATH_DULIEU', 'http://192.168.2.115/csdlkhcn/dulieu'&#41;; // Duong dan nam trong thu muc ung dung Web</pre>
</div><br/><br/> Kết quả vẫn giống như bên trên: tức là tập tin tại máy chủ Web Apache download được; tập tin mount từ thiết bị lưu trữ QNAP đến máy chủ web Apache thì không được</span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.html">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/40142.html">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/40142/247959.html#247959,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row1" valign="top">
			<span class="postbody"><blockquote>Thì trình duyệt báo lỗi như thế nào? Như bạn trình bày, mình nghĩ có thể là lỗi lập trình php của web.&nbsp;
</blockquote><br/> Lỗi này là do mình viết code php để quy định khi download không được (có nằm trong code download.php bên dưới)<br/> Mình có nghĩ đến lỗi code php và tìm lỗi nhưng chưa thấy.<br/> <font color='orange'>Nhưng nếu cả 2 trường hợp</font>: tập tin đặt tại máy chủ Web Apache hay tập tin được mount đến máy chủ Web từ thiết bị lưu trữ QNAP <font color='orange'>đều download không được</font> (<font color='orange'>thì chắc chắn là lỗi code php</font>)<br/> <b>Tình huống bên dưới:</b> (nên chưa xác định được lỗi)<br/> - Trường hợp 1: tập tin nằm trực tiếp tại máy chủ Web Apache thì download được<br/> - Trường hợp 2: tập tin được mount đến máy chủ Web Apache thì download không được (đây là trường hợp cần khắc phục để sử dụng)<br/><br/> <blockquote>Bồ thảy cái cấu hình apache lên và nội dung cái download.php lên. Có thể đây là lỗi lập trình php.&nbsp;
</blockquote><br/> <b>httpd.conf</b><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>ServerTokens OS
ServerRoot "/etc/httpd"
PidFile run/httpd.pid
Timeout 60
KeepAlive Off
MaxKeepAliveRequests 100
KeepAliveTimeout 15
&lt;IfModule prefork.c&gt;
StartServers 8
MinSpareServers 5
MaxSpareServers 20
ServerLimit 256
MaxClients 256
MaxRequestsPerChild 4000
&lt;/IfModule&gt;
&lt;IfModule worker.c&gt;
StartServers 4
MaxClients 300
MinSpareThreads 25
MaxSpareThreads 75
ThreadsPerChild 25
MaxRequestsPerChild 0
&lt;/IfModule&gt;
Listen 80
LoadModule auth_basic_module modules/mod_auth_basic.so
LoadModule auth_digest_module modules/mod_auth_digest.so
LoadModule authn_file_module modules/mod_authn_file.so
LoadModule authn_alias_module modules/mod_authn_alias.so
LoadModule authn_anon_module modules/mod_authn_anon.so
LoadModule authn_dbm_module modules/mod_authn_dbm.so
LoadModule authn_default_module modules/mod_authn_default.so
LoadModule authz_host_module modules/mod_authz_host.so
LoadModule authz_user_module modules/mod_authz_user.so
LoadModule authz_owner_module modules/mod_authz_owner.so
LoadModule authz_groupfile_module modules/mod_authz_groupfile.so
LoadModule authz_dbm_module modules/mod_authz_dbm.so
LoadModule authz_default_module modules/mod_authz_default.so
LoadModule ldap_module modules/mod_ldap.so
LoadModule authnz_ldap_module modules/mod_authnz_ldap.so
LoadModule include_module modules/mod_include.so
LoadModule log_config_module modules/mod_log_config.so
LoadModule logio_module modules/mod_logio.so
LoadModule env_module modules/mod_env.so
LoadModule ext_filter_module modules/mod_ext_filter.so
LoadModule mime_magic_module modules/mod_mime_magic.so
LoadModule expires_module modules/mod_expires.so
LoadModule deflate_module modules/mod_deflate.so
LoadModule headers_module modules/mod_headers.so
LoadModule usertrack_module modules/mod_usertrack.so
LoadModule setenvif_module modules/mod_setenvif.so
LoadModule mime_module modules/mod_mime.so
LoadModule dav_module modules/mod_dav.so
LoadModule status_module modules/mod_status.so
LoadModule autoindex_module modules/mod_autoindex.so
LoadModule info_module modules/mod_info.so
LoadModule dav_fs_module modules/mod_dav_fs.so
LoadModule vhost_alias_module modules/mod_vhost_alias.so
LoadModule negotiation_module modules/mod_negotiation.so
LoadModule dir_module modules/mod_dir.so
LoadModule actions_module modules/mod_actions.so
LoadModule speling_module modules/mod_speling.so
LoadModule userdir_module modules/mod_userdir.so
LoadModule alias_module modules/mod_alias.so
LoadModule substitute_module modules/mod_substitute.so
LoadModule rewrite_module modules/mod_rewrite.so
LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_balancer_module modules/mod_proxy_balancer.so
LoadModule proxy_ftp_module modules/mod_proxy_ftp.so
LoadModule proxy_http_module modules/mod_proxy_http.so
LoadModule proxy_ajp_module modules/mod_proxy_ajp.so
LoadModule proxy_connect_module modules/mod_proxy_connect.so
LoadModule cache_module modules/mod_cache.so
LoadModule suexec_module modules/mod_suexec.so
LoadModule disk_cache_module modules/mod_disk_cache.so
LoadModule cgi_module modules/mod_cgi.so
LoadModule version_module modules/mod_version.so
Include conf.d/*.conf
User apache
Group apache
ServerAdmin root@localhost
ServerName 192.168.2.115:80
UseCanonicalName Off
DocumentRoot "/var/www/html"
&lt;Directory /&gt;
Options FollowSymLinks
AllowOverride None
&lt;/Directory&gt;
&lt;Directory "/var/www/html"&gt;
Options Indexes FollowSymLinks
AllowOverride All
Order allow,deny
Allow from all
&lt;/Directory&gt;
&lt;IfModule mod_userdir.c&gt;
#
# UserDir is disabled by default since it can confirm the presence
# of a username on the system &#40;depending on home directory
# permissions&#41;.
#
UserDir disabled
#
# To enable requests to /~user/ to serve the user's public_html
# directory, remove the "UserDir disabled" line above, and uncomment
# the following line instead:
#
#UserDir public_html
&lt;/IfModule&gt;
DirectoryIndex index.html index.html.var
AccessFileName .htaccess
&lt;Files ~ "^\.ht"&gt;
Order allow,deny
Deny from all
Satisfy All
&lt;/Files&gt;
TypesConfig /etc/mime.types
DefaultType text/plain
&lt;IfModule mod_mime_magic.c&gt;
MIMEMagicFile conf/magic
&lt;/IfModule&gt;
HostnameLookups Off
ErrorLog logs/error_log
LogLevel warn
LogFormat &quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %b \&quot;%{Referer}i\&quot; \&quot;%{User-Agent}i\&quot;&quot; combined
LogFormat &quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %b&quot; common
LogFormat &quot;%{Referer}i -&gt; %U&quot; referer
LogFormat &quot;%{User-agent}i&quot; agent
CustomLog logs/access_log combined
ServerSignature On
Alias /icons/ &quot;/var/www/icons/&quot;
&lt;Directory "/var/www/icons"&gt;
Options Indexes MultiViews FollowSymLinks
AllowOverride None
Order allow,deny
Allow from all
&lt;/Directory&gt;
&lt;IfModule mod_dav_fs.c&gt;
# Location of the WebDAV lock database.
DAVLockDB /var/lib/dav/lockdb
&lt;/IfModule&gt;
ScriptAlias /cgi-bin/ "/var/www/cgi-bin/"
&lt;Directory "/var/www/cgi-bin"&gt;
AllowOverride None
Options None
Order allow,deny
Allow from all
&lt;/Directory&gt;
IndexOptions FancyIndexing VersionSort NameWidth=* HTMLTable Charset=UTF-8
AddIconByEncoding &#40;CMP,/icons/compressed.gif&#41; x-compress x-gzip
AddIconByType &#40;TXT,/icons/text.gif&#41; text/*
AddIconByType &#40;IMG,/icons/image2.gif&#41; image/*
AddIconByType &#40;SND,/icons/sound2.gif&#41; audio/*
AddIconByType &#40;VID,/icons/movie.gif&#41; video/*
AddIcon /icons/binary.gif .bin .exe
AddIcon /icons/binhex.gif .hqx
AddIcon /icons/tar.gif .tar
AddIcon /icons/world2.gif .wrl .wrl.gz .vrml .vrm .iv
AddIcon /icons/compressed.gif .Z .z .tgz .gz .zip
AddIcon /icons/a.gif .ps .ai .eps
AddIcon /icons/layout.gif .html .shtml .htm .pdf
AddIcon /icons/text.gif .txt
AddIcon /icons/c.gif .c
AddIcon /icons/p.gif .pl .py
AddIcon /icons/f.gif .for
AddIcon /icons/dvi.gif .dvi
AddIcon /icons/uuencoded.gif .uu
AddIcon /icons/script.gif .conf .sh .shar .csh .ksh .tcl
AddIcon /icons/tex.gif .tex
AddIcon /icons/bomb.gif core
AddIcon /icons/back.gif ..
AddIcon /icons/hand.right.gif README
AddIcon /icons/folder.gif ^^DIRECTORY^^
AddIcon /icons/blank.gif ^^BLANKICON^^
DefaultIcon /icons/unknown.gif
ReadmeName README.html
HeaderName HEADER.html
IndexIgnore .??* *~ *# HEADER* README* RCS CVS *,v *,t
AddLanguage ca .ca
AddLanguage cs .cz .cs
AddLanguage da .dk
AddLanguage de .de
AddLanguage el .el
AddLanguage en .en
AddLanguage eo .eo
AddLanguage es .es
AddLanguage et .et
AddLanguage fr .fr
AddLanguage he .he
AddLanguage hr .hr
AddLanguage it .it
AddLanguage ja .ja
AddLanguage ko .ko
AddLanguage ltz .ltz
AddLanguage nl .nl
AddLanguage nn .nn
AddLanguage no .no
AddLanguage pl .po
AddLanguage pt .pt
AddLanguage pt-BR .pt-br
AddLanguage ru .ru
AddLanguage sv .sv
AddLanguage zh-CN .zh-cn
AddLanguage zh-TW .zh-tw
LanguagePriority en ca cs da de el eo es et fr he hr it ja ko ltz nl nn no pl pt pt-BR ru sv zh-CN zh-TW
ForceLanguagePriority Prefer Fallback
AddDefaultCharset UTF-8
AddType application/x-compress .Z
AddType application/x-gzip .gz .tgz
AddType application/x-x509-ca-cert .crt
AddType application/x-pkcs7-crl .crl
AddHandler type-map var
AddType text/html .shtml
AddOutputFilter INCLUDES .shtml
Alias /error/ "/var/www/error/"
&lt;IfModule mod_negotiation.c&gt;
&lt;IfModule mod_include.c&gt;
&lt;Directory "/var/www/error"&gt;
AllowOverride None
Options IncludesNoExec
AddOutputFilter Includes html
AddHandler type-map var
Order allow,deny
Allow from all
LanguagePriority en es de fr
ForceLanguagePriority Prefer Fallback
&lt;/Directory&gt;
&lt;/IfModule&gt;
&lt;/IfModule&gt;
BrowserMatch &quot;Mozilla/2&quot; nokeepalive
BrowserMatch &quot;MSIE 4\.0b2;&quot; nokeepalive downgrade-1.0 force-response-1.0
BrowserMatch &quot;RealPlayer 4\.0&quot; force-response-1.0
BrowserMatch &quot;Java/1\.0&quot; force-response-1.0
BrowserMatch &quot;JDK/1\.0&quot; force-response-1.0
BrowserMatch &quot;Microsoft Data Access Internet Publishing Provider&quot; wwwect-carefully
BrowserMatch &quot;MS FrontPage&quot; wwwect-carefully
BrowserMatch &quot;^WebDrive&quot; wwwect-carefully
BrowserMatch &quot;^WebDAVFS/1.&#91;0123&#93;&quot; wwwect-carefully
BrowserMatch &quot;^gnome-vfs/1.0&quot; wwwect-carefully
BrowserMatch &quot;^XML Spy&quot; wwwect-carefully
BrowserMatch &quot;^Dreamweaver-WebDAV-SCM1&quot; wwwect-carefully</pre>
</div><br/><br/> <b>download.php</b><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>&lt;?php
ob_start&#40;&#41;;
?&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt;
&lt;title&gt;File Download&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;?php
// Ham thuc hien download
function send_file&#40;$upload_dir,$name&#41; {
ob_end_clean&#40;&#41;;
$path = $upload_dir.$name;
if &#40;!is_file&#40;$path&#41; or connection_status&#40;&#41;!=0&#41; return&#40;FALSE&#41;;
header&#40;&quot;Cache-Control: no-store, no-cache, must-revalidate&quot;&#41;;
header&#40;&quot;Cache-Control: post-check=0, pre-check=0&quot;, false&#41;;
header&#40;&quot;Pragma: no-cache&quot;&#41;;
header&#40;&quot;Expires: &quot;.gmdate&#40;&quot;D, d M Y H:i:s&quot;, mktime&#40;date&#40;&quot;H&quot;&#41;+2, date&#40;&quot;i&quot;&#41;, date&#40;&quot;s&quot;&#41;, date&#40;&quot;m&quot;&#41;, date&#40;&quot;d&quot;&#41;, date&#40;&quot;Y&quot;&#41;&#41;&#41;.&quot; GMT&quot;&#41;;
header&#40;&quot;Last-Modified: &quot;.gmdate&#40;&quot;D, d M Y H:i:s&quot;&#41;.&quot; GMT&quot;&#41;;
header&#40;&quot;Content-Type: application/octet-stream&quot;&#41;;
header&#40;&quot;Content-Length: &quot;.&#40;string&#41;&#40;filesize&#40;$path&#41;&#41;&#41;;
header&#40;&quot;Content-Disposition: attachment; filename=$name&quot;&#41;;
header&#40;&quot;Content-Transfer-Encoding: binary\n&quot;&#41;;
if &#40;$file = fopen&#40;$path, 'rb'&#41;&#41; {
while&#40;!feof&#40;$file&#41; and &#40;connection_status&#40;&#41;==0&#41;&#41; {
print&#40;fread&#40;$file, 1024*8&#41;&#41;;
flush&#40;&#41;;
}
fclose&#40;$file&#41;;
}
return&#40;&#40;connection_status&#40;&#41;==0&#41; and !connection_aborted&#40;&#41;&#41;;
}
?&gt;
&lt;?php
// Dinh nghia duong dan goc
define&#40; 'JPATH_DULIEU', '/share/dulieuweb'&#41;; // Duong dan thu muc nam ngoai ung dung Web
//define&#40; 'JPATH_DULIEU', 'http://192.168.2.115/csdlkhcn/dulieu'&#41;; // Duong dan nam trong thu muc ung dung Web
//define&#40; 'JPATH_DULIEU', 'D:/dulieuweb'&#41;;
// Kiem tra bien nhan ve tu URL de lay dung thu muc
//echo $_GET&#91;&quot;dulieu&quot;&#93;;
if &#40;$_GET&#91;&quot;dulieu&quot;&#93;=='mov'&#41;
$upload_dir=JPATH_DULIEU.'/movie/';
else if &#40;$_GET&#91;&quot;dulieu&quot;&#93;=='tailieuso'&#41;
$upload_dir=JPATH_DULIEU.'/tailieuso/';
else if &#40;$_GET&#91;&quot;dulieu&quot;&#93;=='dulieucnnn'&#41;
$upload_dir=JPATH_DULIEU.'/dulieucnnn/';
else if &#40;$_GET&#91;&quot;dulieu&quot;&#93;=='detai'&#41;
$upload_dir=JPATH_DULIEU.'/detai/'.$_GET&#91;&quot;dd&quot;&#93;.'/';
else if &#40;$_GET&#91;&quot;dulieu&quot;&#93;=='congviec'&#41;
$upload_dir=JPATH_DULIEU.'/congviec/';
//lay ten file can download tu URL
$filename = isset&#40;$_GET&#91;'file'&#93;&#41;?$_GET&#91;'file'&#93;:'';
$filename=str_replace&#40;&quot;.dat&quot;,&quot;.wmv&quot;,$filename&#41;;
// Kiem tra in duongdan den taptin
//echo $upload_dir.$filename;
//Close the session to allow for header&#40;&#41; to be sent
// Goi ham send_file thuc hien download neu download khong duoc thi bao loi
session_write_close&#40;&#41;;
if&#40;!send_file&#40;$upload_dir,$filename&#41;&#41; {
print '&lt;meta http-equiv="content-type" content="text/html; charset=UTF-8" /&gt;';
die &#40;&quot;Tập tin không tìm thấy trên Server !&quot;&#41;;
} else {
//Log the download
}
?&gt;
&lt;/body&gt;
&lt;/html&gt;
&lt;?php ob_end_flush&#40;&#41;; ?&gt;</pre>
</div><br/><br/> <blockquote>Trước mắt là PHP báo một lỗi liên quan tới header&nbsp;
</blockquote><br/> Log Lỗi này thì: cả 2 trường hợp đều có lỗi này (Tập tin nằm trực tiếp tại máy chủ Web Apache thì download được, hay Tập tin được mount đến máy chủ Web Apache thì download không được), nên có lẽ không phải lỗi này. Mình cũng trong quá trình khắc phục lỗi này. </span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.html">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/40142.html">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/40142/247924.html#247924,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row2" valign="top">
			<span class="postbody"><blockquote>Câu này mơ hồ quá. Những log nào chứng minh rằng tập tin không download được khi dùng QNAP? Bồ cho vài ví dụ xem?&nbsp;
</blockquote><br/> Đã Xóa tất cả nội dung trong Log và sau đó em kiểm tra download một tập tin (nên log chỉ có mấy dòng đó thôi). Bên dưới là log download tập tin không được khi dùng QNAP, nó không ghi nhận gì vấn đề download không được.<br/><br/> <b>Access log</b><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>192.168.2.111 - - &#91;23/Sep/2011:02:23:02 +0700&#93; "GET /csdlkhcn/download.php?dulieu=tailieuso&file=48470.pdf HTTP/1.1" 200 112 "http://192.168.2.115/csdlkhcn/tai-lieu-so-hoa.html" "Mozilla/5.0 &#40;Windows; U; Windows NT 5.2; en-US; rv:1.9.2.22&#41; Gecko/20110902 Firefox/3.6.22"
192.168.2.111 - - &#91;23/Sep/2011:02:23:02 +0700&#93; "GET /favicon.ico HTTP/1.1" 200 1406 "-" "Mozilla/5.0 &#40;Windows; U; Windows NT 5.2; en-US; rv:1.9.2.22&#41; Gecko/20110902 Firefox/3.6.22"
192.168.2.111 - - &#91;23/Sep/2011:02:26:02 +0700&#93; "GET /csdlkhcn/tai-lieu-so-hoa.html HTTP/1.1" 200 46437 "http://192.168.2.115/csdlkhcn/index.php" "Mozilla/5.0 &#40;Windows; U; Windows NT 5.2; en-US; rv:1.9.2.22&#41; Gecko/20110902 Firefox/3.6.22"
192.168.2.111 - - &#91;23/Sep/2011:02:26:05 +0700&#93; "GET /csdlkhcn/download.php?dulieu=tailieuso&file=48463.pdf HTTP/1.1" 200 112 "http://192.168.2.115/csdlkhcn/tai-lieu-so-hoa.html" "Mozilla/5.0 &#40;Windows; U; Windows NT 5.2; en-US; rv:1.9.2.22&#41; Gecko/20110902 Firefox/3.6.22"</pre>
</div><br/><br/> <b>Error log</b><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>&#91;Fri Sep 23 02:16:56 2011&#93; &#91;notice&#93; caught SIGTERM, shutting down
&#91;Fri Sep 23 02:19:43 2011&#93; &#91;notice&#93; suEXEC mechanism enabled &#40;wrapper: /usr/sbin/suexec&#41;
&#91;Fri Sep 23 02:19:43 2011&#93; &#91;notice&#93; Digest: generating secret for digest authentication ...
&#91;Fri Sep 23 02:19:43 2011&#93; &#91;notice&#93; Digest: done
&#91;Fri Sep 23 02:19:43 2011&#93; &#91;notice&#93; Apache/2.2.15 &#40;Unix&#41; DAV/2 configured -- resuming normal operations
&#91;Fri Sep 23 02:22:59 2011&#93; &#91;error&#93; &#91;client 192.168.2.111&#93; PHP Notice: Undefined variable: header_code in /var/www/html/csdlkhcn/components/com_chronoconnectivity/chronoconnectivity.html.php on line 56, referer:<span class="link"> http://192.168.2.115/csdlkhcn/index.php</span>
&#91;Fri Sep 23 02:26:02 2011&#93; &#91;error&#93; &#91;client 192.168.2.111&#93; PHP Notice: Undefined variable: header_code in /var/www/html/csdlkhcn/components/com_chronoconnectivity/chronoconnectivity.html.php on line 56, referer:<span class="link"> http://192.168.2.115/csdlkhcn/index.php</span></pre>
</div><br/><br/> <blockquote>Như vậy thì QNAP share bằng Samba và apache server mount QNAP với CIFS?&nbsp;
</blockquote><br/> Đúng rồi, QNAP được share bằng Samba và apache server mount QNAP với CIFS (như lệnh mount).<br/> <blockquote>Nếu mount options với file_mode và dir_mode là 0777 như trên thì làm sao có được:&nbsp;
</blockquote><br/> Xin lỗi, Ban đầu em chỉ mount không có option với file_mode và dir_mode là 0777, nên nó là<br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>drwxr-xr-x 1 root root 0 Apr 13 16:09 .
drwxr-xr-x. 3 root root 4096 Aug 26 21:33 ..
drwxr-xr-x 1 root root 0 Oct 25 2010 congviec
drwxr-xr-x 1 root root 0 May 26 16:30 detai
drwxr-xr-x 1 root root 0 Jun 28 15:34 dulieucnnn
drwxr-xr-x 1 root root 0 Sep 13 09:19 images
-rwxr-xr-x 1 root root 44 Sep 14 2005 index.html
drwxr-xr-x 1 root root 0 Aug 16 10:54 movie
drwxr-xr-x 1 root root 0 Aug 18 16:03 tailieuso</pre>
</div><br/><br/> Sau đó mới mount lại thêm option với file_mode và dir_mode là 0777 nhưng vẫn download không được<br/><br/> <blockquote>Vậy người dùng không download được cái gì trong<br/> các thư mục trên? Cụ thể là thư mục nào? Bồ liệt kê nội dung ngay thư<br/> mục bị sự cố xem?<br/> Bồ cũng thử xem ngay trên máy chạy apache, bồ<br/> copy file đến /zzz/yy coi thử được không? Đồng thời, thử switch sang<br/> account nào dùng để chạy apache và thử "read" files nằm trong /zzz/yy<br/> coi thử được không?&nbsp;
</blockquote><br/><br/> Quyền trên thư mục<br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>drwxrwxrwx. 1 root root 0 Aug 18 16:03 tailieuso</pre>
</div><br/><br/> Đây là vài tập tin trong thư mục cần download <b>tailieuso</b>, còn nhiều tập tin nữa và tên tập tin cần download là <b>48463.pdf</b> có trong thư mục này (mà máy chủ Web Apachhe đã mount từ QNAP)<br/><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>total 108761886
drwxrwxrwx. 1 root root 0 Aug 18 16:03 .
drwxrwxrwx. 1 root root 0 Apr 13 16:09 ..
-rwxrwxrwx. 1 root root 96256 Nov 13 2009 03.doc
-rwxrwxrwx. 1 root root 16630078 Mar 26 2003 10000.pdf
-rwxrwxrwx. 1 root root 17850979 Apr 26 2003 10001.pdf
-rwxrwxrwx. 1 root root 10165743 Apr 26 2003 10002.pdf
-rwxrwxrwx. 1 root root 23445714 Apr 26 2003 10003.pdf
-rwxrwxrwx. 1 root root 41681921 Apr 26 2003 10004.pdf</pre>
</div><br/><br/> Ghi và đọc tập tin trên thư mục tailieuso đều được.<br/><br/> <b><font color='red'>Nó có đặc điểm này:</font> </b><br/> Nếu download tập tin, dùng đường dẫn trực tiếp đến tập tin trực tiếp thì được (Các tập tin đặt tại máy chủ Web Apache, hay được mount từ thiết bị lưu trữ QNAP đều được)<br/><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>http://xxx/xxx/xxx/tailieuso/48471.pdf</pre>
</div><br/><br/> Nhưng khi dùng viết code php download để không hiển thị đường dẫn đến tập tin<br/><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>csdlkhcn/download.php?dulieu=tailieuso&file=48463.pdf</pre>
</div><br/><br/> - Trường hợp 1: tập tin nằm trực tiếp tại máy chủ Web Apache thì download được<br/><br/> - Trường hợp 2: tập tin được mount đến máy chủ Web Apache thì download không được (<font color='red'>đây là trường hợp cần khắc phục để sử dụng</font>)</span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.html">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/40142.html">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/40142/247874.html#247874,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row1" valign="top">
			<span class="postbody">Em xem Logs Apache nó giống nhau khi: các tập tin tại máy chủ web Apache thì download được, hay các tập tin đặt từ thiết bị lưu trữ QNAP mount sang máy chủ web Apache không download được.<br/><br/> - Máy chủ Web Apache sử dụng HĐH CentOS sử dụng filesystem ext4 (IP: xxx.xxx.xxx.115)<br/> - QNAP là một thiết bị lưu trữ khác nó sử dụng HĐH Linux, chia sẽ dữ liệu (IP: xxx.xxx.xxx.118)<br/><br/> Lệnh mount trên máy chủ web Apache HĐH CentOS<br/> - mount -t cifs //xxx.xxx.xxx.118/yy /zzz/yy -o username=xxx,password=xxx,iocharset=utf8,file_mode=0777,dir_mode=0777</span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.html">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/40142.html">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/40142/247823.html#247823,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row2" valign="top">
			<span class="postbody">Anh Conmale có thể chỉ cách khắc phục trường hợp này giùm. Thank !</span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.html">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/40142.html">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/40142/247600.html#247600,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row1" valign="top">
			<span class="postbody">Chào anh<br/> - Em làm hoài mà nó vẫn chưa được.<br/> <font color='red'>- Đây là log Apache</font><br/> <b>Access log</b><br/> <blockquote>192.168.2.111 - - [23/Sep/2011:02:23:02 +0700] "GET /csdlkhcn/download.php?dulieu=tailieuso&file=48470.pdf HTTP/1.1" 200 112 "http://192.168.2.115/csdlkhcn/tai-lieu-so-hoa.html" "Mozilla/5.0 (Windows; U; Windows NT 5.2; en-US; rv:1.9.2.22) Gecko/20110902 Firefox/3.6.22"<br/> 192.168.2.111 - - [23/Sep/2011:02:23:02 +0700] "GET /favicon.ico HTTP/1.1" 200 1406 "-" "Mozilla/5.0 (Windows; U; Windows NT 5.2; en-US; rv:1.9.2.22) Gecko/20110902 Firefox/3.6.22"<br/> 192.168.2.111 - - [23/Sep/2011:02:26:02 +0700] "GET /csdlkhcn/tai-lieu-so-hoa.html HTTP/1.1" 200 46437 "http://192.168.2.115/csdlkhcn/index.php" "Mozilla/5.0 (Windows; U; Windows NT 5.2; en-US; rv:1.9.2.22) Gecko/20110902 Firefox/3.6.22"<br/> 192.168.2.111 - - [23/Sep/2011:02:26:05 +0700] "GET /csdlkhcn/download.php?dulieu=tailieuso&file=48463.pdf HTTP/1.1" 200 112 "http://192.168.2.115/csdlkhcn/tai-lieu-so-hoa.html" "Mozilla/5.0 (Windows; U; Windows NT 5.2; en-US; rv:1.9.2.22) Gecko/20110902 Firefox/3.6.22"&nbsp;
</blockquote><br/><br/> <b>Error log</b><br/> <blockquote>[Fri Sep 23 02:16:56 2011] [notice] caught SIGTERM, shutting down<br/> [Fri Sep 23 02:19:43 2011] [notice] suEXEC mechanism enabled (wrapper: /usr/sbin/suexec)<br/> [Fri Sep 23 02:19:43 2011] [notice] Digest: generating secret for digest authentication ...<br/> [Fri Sep 23 02:19:43 2011] [notice] Digest: done<br/> [Fri Sep 23 02:19:43 2011] [notice] Apache/2.2.15 (Unix) DAV/2 configured -- resuming normal operations<br/> [Fri Sep 23 02:22:59 2011] [error] [client 192.168.2.111] PHP Notice: Undefined variable: header_code in /var/www/html/csdlkhcn/components/com_chronoconnectivity/chronoconnectivity.html.php on line 56, referer:<span class="link"> http://192.168.2.115/csdlkhcn/index.php</span><br/> [Fri Sep 23 02:26:02 2011] [error] [client 192.168.2.111] PHP Notice: Undefined variable: header_code in /var/www/html/csdlkhcn/components/com_chronoconnectivity/chronoconnectivity.html.php on line 56, referer:<span class="link"> http://192.168.2.115/csdlkhcn/index.php&nbsp;</span>
</blockquote><br/><br/> <font color='red'>- Còn đây là permission thư mục chứa tập tin bên trong mình đã mount qua Máy chủ web Apache</font><br/> <blockquote>drwxr-xr-x 1 root root 0 Apr 13 16:09 .<br/> drwxr-xr-x. 3 root root 4096 Aug 26 21:33 ..<br/> drwxr-xr-x 1 root root 0 Oct 25 2010 congviec<br/> drwxr-xr-x 1 root root 0 May 26 16:30 detai<br/> drwxr-xr-x 1 root root 0 Jun 28 15:34 dulieucnnn<br/> drwxr-xr-x 1 root root 0 Sep 13 09:19 images<br/> -rwxr-xr-x 1 root root 44 Sep 14 2005 index.html<br/> drwxr-xr-x 1 root root 0 Aug 16 10:54 movie<br/> drwxr-xr-x 1 root root 0 Aug 18 16:03 tailieuso&nbsp;
</blockquote><br/><br/><br/> </span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.html">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/40142.html">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/40142/247531.html#247531,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row2" valign="top">
			<span class="postbody">Chào mọi người!<br/> - Mình xây dựng trang web: ngôn ngữ PHP, CSDL MySQL, máy chủ Apache chạy trên HĐH CentOS<br/> - Trên web có module download tài liệu là các tập tin .doc, .pdf,.. Các tập tin đặt tại máy chủ Web thì download về bình thường.<br/> - Nhưng khi dùng một thiết bị lưu trữ QNAP (nó chạy HĐH Linux) để chứa các tập tin gốc .doc, .pdf . Mình đã mount thư mục chứa tập tin về máy chủ web Apache; thì trang web không thể download các tập tin này được.<br/> - Mình đã disable SELinux trên máy chủ Web luôn vẫn không download được.<br/> </span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.html">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/32576.html">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/32576/202103.html#202103,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row1" valign="top">
			<span class="postbody">mừng quá mình làm được rồi.<br/> Chương trình của mình là chuyển CSDL từ SQL Sever 2000 với trên 30.000 mẩu tin sang CSDL MySql và viết lại chương trình bằng php sử dụng CSDL MySql.<br/> Mình đã chuyển CSDL xong sang MySql nhưng không sử dụng các table có sẳn vì các truờng chưa phù hợp.<br/> Mình thiết kế lại các table và chuyển dữ liệu từ các table có sẳn sang table của mình.<br/> Vì không phải dữ liệu chuyển từ một table có sẳn sang table cua mình không mà nó còn phụ thuộc vào một số trường hợp.<br/> Dữ liệu của table cần chuyển nó còn phụ thuộc là nó phải nằm trong 3 cấp của lĩnh vực.<br/><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>$cat = array&#40;...&#41;; // có 16 phần tử
$subcat = array&#40;...&#41;; // có 111 phần tử
$subcatdet = array&#40;...&#41; // có 289 phần tử</pre>
</div><br/><br/> Nên mình phải dùng đến 3 vòng lặp for để chuyển<br/><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>for&#40;$indexcat=0; $indexcat &lt; $indexLimitcat; $indexcat++&#41; {
for&#40;$indexsubcat=0; $indexsubcat &lt; $indexLimitsub; $indexsubcat++&#41; {
for&#40;$index=0; $index &lt; $indexLimit; $index++&#41; {
//Lệnh truy vấn SQL và nhận kết quả trả về
}
}
}</pre>
</div><br/><br/><br/> Vì dùng các vòng lặp for thời gian chạy quá lâu nên chỉ chuyển được trên 2000 mẩu tin thì không đủ thời gian chạy<br/> Fatal error: Maximum execution time of 240 seconds exceeded.<br/><br/> Mình đã viết lại cách chuyển dữ liệu không dùng vòng lặp for<br/> Các giá trị thay thế mình viết lại các hàm đề chuyển<br/> Sau đây là một số đoạn lệnh hàm chuyển đổi có dùng trong chương trình.<br/><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>function convert_cat&#40;$val&#41; {
$cat = array&#40;...&#41;; // 16 phần tử
$catid = array&#40;...&#41;; // 16 phần tử
$indexLimit=count&#40;$cat&#41;; //Reset bien $indexLimitcat 16
for&#40;$index=0; $index &lt; $indexLimit; $index++&#41; {
if &#40;$val==$cat&#91;$index&#93;&#41; $val=$catid&#91;$index&#93;;
}
return $val;
}
function convert_subcat&#40;$val&#41; {
$formid = array&#40;...&#41;; // 111 phần tử
$subcat = array&#40;...&#41;; // 111 phần tử
$indexLimit=count&#40;$subcat&#41;;
for&#40;$index=0; $index &lt; $indexLimit; $index++&#41; {
if &#40;$val==$subcat&#91;$index&#93;&#41; $val=$formid&#91;$index&#93;;
}
return $val;
}
function convert_subcatdet&#40;$val&#41; {
$genreid = array&#40;...&#41;; // 289 phần tử
$subcatdet = array&#40;...&#41; // 289 phần tử
$indexLimit=count&#40;$subcatdet&#41;; //Reset bien $indexLimitcat 16
for&#40;$index=0; $index &lt; $indexLimit; $index++&#41; {
if &#40;$val==$subcatdet&#91;$index&#93;&#41; $val=$genreid&#91;$index&#93;;
}
return $val;
}</pre>
</div><br/> Sau đó mình dùng các hàm này quá trình chuyển dữ liệu giữa các table thì quá trình chuyển dữ liệu sẽ rất nhanh và chuyển được toàn bộ trên 30.000 mẫu tin.<br/><br/><br/> </span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.html">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/32576.html">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/32576/200792.html#200792,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row2" valign="top">
			<span class="postbody">Mình cần chuyển CSDL trong MySql bị lỗi Maximum execution time of 240 seconds exceeded<br/> CSDL chuyển trên 30.000 mẫu tin<br/> Nó chạy kết quả nhận dữ liệu gần 2.000 mẫu tin thì không đủ thời gian báo lỗi Fatal error: Maximum execution time of 240 seconds exceeded .<br/><br/> Mình dùng 3 vòng lập FOR lồng vào nhau<br/> Sử dụng 3 mảng đã khai báo số phần tử<br/><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>$cat = array&#40;...&#41;; // có 16 phần tử
$subcat = array&#40;...&#41;; // có 111 phần tử
$subcatdet = array&#40;...&#41; // có 289 phần tử</pre>
</div><br/><br/> Mình thiết lập max_execution_time=240 vẫn không đủ thời gian để chạy<br/><br/> <blockquote>if(!ini_get('safe_mode')) {<br/> set_time_limit(240);<br/> ini_set('max_input_time', 300);<br/> }<br/><br/> $indexLimit=count($subcatdet); //Reset bien $indexLimit 289<br/> $indexLimitsub=count($subcat); //Reset bien $indexLimitsub 111<br/> $indexLimitcat=count($cat); //Reset bien $indexLimitcat 16<br/> for($indexcat=0; $indexcat &lt; $indexLimitcat; $indexcat++) {<br/> for($indexsubcat=0; $indexsubcat &lt; $indexLimitsub; $indexsubcat++) {<br/> for($index=0; $index &lt; $indexLimit; $index++) {<br/><br/> //Lệnh truy vấn SQL và nhận kết quả trả về<br/><br/> }<br/> }<br/> }&nbsp;
</blockquote><br/><br/> Mình đang cần gấp các bạn chỉ giùm mình.</span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.html">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/32235.html">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/32235/198984.html#198984,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row1" valign="top">
			<span class="postbody">Ok máy trạm truy cập Internet được rồi. Thank bạn nhiều.</span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.html">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/32235.html">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/32235/198952.html#198952,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row2" valign="top">
			<span class="postbody">Mình dùng Red Hat Enterprise Linux 5, Squid 3.0<br/><br/> 1. Mình cấu hình file squid.conf máy Linux, và không bật Firewall: System/Administrattion/Security Level and Filrewall (Firewall chọn Disable, SELinux chọn Disable)<br/> Máy trạm cấu hình proxy trong trình duyệt thì máy trạm ra Internet được.<br/><br/> 2. Trường hợp Firewall chọn Enable ở System/Administrattion/Security Level and Filrewall thì phải tiến hành cấu hình iptables để máy trạm truy cập Internet.<br/><br/> Mình đang tiến hành mở rule và port cho máy trạm truy cập Internet và public một máy Webserver trong LAN ra ngoài Internet bằng Iptables</span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.html">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/32235.html">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/32235/198851.html#198851,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row1" valign="top">
			<span class="postbody">Thì mình còn mơ hồ ở chổ là Enable firewall tại máy cài squid, mình nghĩ nếu bật firewall lên thì mình phải cấu hình cho iptables đúng thì mới cho máy trạm truy cập được internet nên mình tiến hành cấu hình iptables nhưng chưa được.<br/> Hiện tại nó có một số cấu hình mặc định<br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre># Firewall configuration written by system-config-securitylevel
# Manual customization of this file is not recommended.
*filter
:INPUT ACCEPT &#91;0:0&#93;
:FORWARD ACCEPT &#91;0:0&#93;
:OUTPUT ACCEPT &#91;0:0&#93;
:RH-Firewall-1-INPUT - &#91;0:0&#93;
-A INPUT -j RH-Firewall-1-INPUT
-A FORWARD -j RH-Firewall-1-INPUT
-A RH-Firewall-1-INPUT -i lo -j ACCEPT
-A RH-Firewall-1-INPUT -p icmp --icmp-type any -j ACCEPT
-A RH-Firewall-1-INPUT -p 50 -j ACCEPT
-A RH-Firewall-1-INPUT -p 51 -j ACCEPT
-A RH-Firewall-1-INPUT -p udp --dport 5353 -d 224.0.0.251 -j ACCEPT
-A RH-Firewall-1-INPUT -p udp -m udp --dport 631 -j ACCEPT
-A RH-Firewall-1-INPUT -p tcp -m tcp --dport 631 -j ACCEPT
-A RH-Firewall-1-INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
-A RH-Firewall-1-INPUT -m state --state NEW -m tcp -p tcp --dport 22 -j ACCEPT
-A RH-Firewall-1-INPUT -j REJECT --reject-with icmp-host-prohibited
COMMIT</pre>
</div><br/><br/> Mình tiến hành mở cổng để cho máy trạm truy cập được Internet nhưng còn bị lỗi</span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.html">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/32235.html">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/32235/198820.html#198820,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row2" valign="top">
			<span class="postbody">Mình bị trường hợp như sau mong chi giùm mình:<br/><br/> Mình cài<b> <font color='red'>squid</font> </b>lên máy <b><font color='red'>Linux version 5</font> </b>để làm proxy cho máy trạm truy cập Internet<br/><br/> <b><font color='brown'>Thứ 1:</font></b><br/> Nếu mình <b><font color='red'>disable firewall</font></b> thì máy trạm truy cập được internet, nhưng bật <b> <font color='red'>enable firewall</font> </b>lên thì máy trạm không truy cập được internet<br/> mình đã cho firewall đi qua: <b><font color='red'>HTTP, HTTTPS, FTP</font></b><br/><br/> Và <b><font color='red'>Disable SELinux</font></b><br/><br/> <b><font color='brown'>Thứ 2:</font></b><br/> Mình muốn Public 1 Webserver ra bên ngoài Internet.<br/><br/> Mình tham khảo bài viết về <b><font color='red'>Iptables</font></b> trên mạng và cấu hình nhưng làm chưa được<br/><br/> <b><font color='brown'>Mô hình mạng của mình như vầy:</font></b><br/><br/> Máy chủ Linux 2 card mạng<br/> WAN IP 192.168.1.2 gắn với ADSL<br/> LAN IP 192.168.2.111 gắn với switch đường mạng trong là 192.168.2.0<br/><br/> Máy Webserver IP 192.168.2.110<br/><br/> Mình đã NAT ADSL Public Webserver và thành công trên Windows dùng ISA, bây giờ học làm trên squid với Linux nhưng nó còn bị lỗi</span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.html">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/32228.html">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/32228/198818.html#198818,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row1" valign="top">
			<span class="postbody">Bạn thử bỏ dấu # trước dòng cache_dir cho nó sử dụng khai báo cache_dir mặc đinh rồi start squid lại xem sao<br/> cache_dir ufs /var/spool/squid 100 16 256</span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.html">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/27544.html">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/27544/168454.html#168454,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row2" valign="top">
			<span class="postbody">Mình đã cài gcc được rồi.<br/><br/> Cài gcc cần <font color='red'>gcc-3.4.3-9.EL4.i386.rpm</font> chứ không phải <font color='red'>gcc4-4.0.0-0.14.EL4.i386.rpm</font>. Mình đã cài <font color='red'>gcc-3.4.3-9.EL4.i386.rpm</font> trong lúc cài nó cần thêm các thư viện và mình đã cài đầy đủ và cuối cùng đã cài được<br/><br/> Và một số thư viên cần thiết<br/> <font color='brown'>glibc-devel-2.3.4-2.i386.rpm<br/> glibc-headers-2.3.4-2.i386.rpm<br/> glibc-kernheaders-2.4-9.1.87.i386.rpm<br/> binutils-2.15.92.0.2-10.EL4.i386.rpm</font><br/><br/> Sau đây là một số lệnh tóm tác trong lúc mình cài:<br/><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>&#91;color=red&#93;#rpm -ivh binutils-2.15.92.0.2-10.EL4.i386.rpm&#91;/color&#93;
Preparing... ########################################### &#91;100%&#93;
package binutils-2.15.92.0.2-10.EL4 is already installed
&#91;color=red&#93;# rpm -ivh gcc4-4.0.0-0.14.EL4.i386.rpm&#91;/color&#93;
Preparing... ########################################### &#91;100%&#93;
1:gcc4 ########################################### &#91;100%&#93;
# gcc4 --version
gcc4 &#40;GCC&#41; 4.0.0 20041214 &#40;Red Hat 4.0.0-0.14.EL4&#41;
Copyright &#40;C&#41; 2004 Free Software Foundation, Inc.
This is free software; see the source for copying conditions. There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
&#91;color=red&#93;&#91;# rpm -ivh gcc-c++-3.4.3-9.EL4.i386.rpm&#91;/color&#93;
error: Failed dependencies:
libstdc++-devel = 3.4.3 is needed by gcc-c++-3.4.3-9.EL4.i386
Suggested resolutions:
libstdc++-devel-3.4.3-9.EL4.i386.rpm
&#91;color=red&#93;# rpm -ivh libstdc++-devel-3.4.3-9.EL4.i386.rpm&#91;/color&#93;
Preparing... ########################################### &#91;100%&#93;
1:libstdc++-devel ########################################### &#91;100%&#93;
&#91;color=red&#93;# rpm -ivh gcc-c++-3.4.3-9.EL4.i386.rpm&#91;/color&#93;
Preparing... ########################################### &#91;100%&#93;
1:gcc-c++ ########################################### &#91;100%&#93;
root@linuxm2 softs&#93;# gcc --version
gcc &#40;GCC&#41; 3.4.3 20041212 &#40;Red Hat 3.4.3-9.EL4&#41;
Copyright &#40;C&#41; 2004 Free Software Foundation, Inc.
This is free software; see the source for copying conditions. There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</pre>
</div><br/><br/> <blockquote><font color='red'># which gcc</font><br/> /usr/bin/gcc<br/> &nbsp;
</blockquote><br/><br/> Sau khi cài xong gcc mình đa cài được ./configure, make, make install, Cám ơn bạn nhé !<br/><br/> </span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.html">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/27544.html">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/27544/168383.html#168383,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row1" valign="top">
			<span class="postbody">Ý của em là cài các gói bằng ./configure, make, make install đều bị lỗi, em lấy nmap để làm ví dụ<br/> Khi cài 1 gói<br/> #./configure<br/> bị lỗi<br/><br/> <blockquote>checking build system type... i686-pc-linux-gnu<br/> checking host system type... i686-pc-linux-gnu<br/> checking for gcc... no<br/> checking for cc... no<br/> checking for cl.exe... no<br/> configure: error: no acceptable C compiler found in $PATH<br/> See `config.log' for more details. &nbsp;
</blockquote><br/><br/> Xem tài liệu<br/> Do thiếu bộ biên dịch gcc. Nên cài gcc gcc4-4.0.0-0.14.EL4.i386.rpm trong lúc cài nó báo lỗi thiếu các thư viên và em đã cài các thư viện bị báo thiếu<br/> glibc-devel-2.3.4-2.i386.rpm, glibc-headers-2.3.4-2.i386.rpm, glibc-kernheaders-2.4-9.1.87.i386.rpm<br/><br/> <blockquote><br/> # rpm -ivh glibc-kernheaders-2.4-9.1.87.i386.rpm<br/> ...<br/> cuối cùng cài<br/> # rpm -ivh gcc4-4.0.0-0.14.EL4.i386.rpm&nbsp;
</blockquote><br/> Các lênh cài trên không còn bị lỗi<br/><br/> Khi cài xong kiểm tra gcc thì đã được cài đặt<br/> <blockquote># gcc4 --version<br/> &nbsp;
</blockquote><br/><br/> Nhưng khi dùng cài lại vẫn bị lỗi<br/> #./configure<br/> <blockquote>checking build system type... i686-pc-linux-gnu<br/> checking host system type... i686-pc-linux-gnu<br/> checking for gcc... no<br/> checking for cc... no<br/> checking for cl.exe... no<br/> configure: error: no acceptable C compiler found in $PATH<br/> See `config.log' for more details. &nbsp;
</blockquote><br/><br/> Đọc tài liệu về cài gcc thấy cần phải cài thêm thư viện <b><font color='red'>binutils</font></b>, nên gỡ bỏ gcc<br/><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>#rpm -qa | grep gcc4
#rpm -e gcc4-4.0.0-0.14.EL4</pre>
</div><br/><br/> Kiểm tra lại thấy gcc không còn nữa, nên định cài <b>binutils</b>, rồi cài lại gcc<br/><br/> Nhưng vẫn chưa được<br/> Vậy để cài được gcc cần cài các thư viên như em liệt kê trên có đúng không, làm như thế nào để cài được gcc, em đang tìm hiểu về Linux nên có những cái chưa biết.<br/> </span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.html">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/27544.html">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/27544/168372.html#168372,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row2" valign="top">
			<span class="postbody">Em sử dụng Linux Redhat Enterprises AS 4.0<br/> Em cài gói phần mềm bị lỗi<br/> [root@linuxm2 nmap-4.76]# ./configure<br/> checking build system type... i686-pc-linux-gnu<br/> checking host system type... i686-pc-linux-gnu<br/> checking for gcc... no<br/> checking for cc... no<br/> checking for cl.exe... no<br/> configure: error: no acceptable C compiler found in $PATH<br/> See `config.log' for more details.<br/> [root@linuxm2 nmap-4.76]#<br/><br/> Em cài rpm gcc để có thể cài đặt<br/><br/> gcc4-4.0.0-0.14.EL4.i386.rpm<br/> glibc-devel-2.3.4-2.i386.rpm<br/> glibc-headers-2.3.4-2.i386.rpm<br/> glibc-kernheaders-2.4-9.1.87.i386.rpm<br/><br/> Dùng ./configure để cài phần mềm bị lỗi như cũ<br/> Có lẽ thiếu gói<br/> binutils-2.15.92.0.2-22.src.rpm<br/><br/><br/> Em dùng các lệnh sau để gỡ bỏ<br/> #rpm -qa | grep gcc4<br/> gcc4-4.0.0-0.14.EL4<br/> #rpm -e gcc4-4.0.0-0.14.EL4<br/> và cài<br/> # rpm -ivh binutils-2.15.92.0.2-22.src.rpm<br/> error: cannot create %sourcedir /usr/src/redhat/SOURCES<br/><br/> Bị lỗi wá trời hết biết rồi, vậy em phải cài gcc trong Linux Redhat Enterprises AS 4.0 như thế nào mới đúng để cài các gói khác.<br/><br/> Chỉ giùm em nhé !<br/><br/><br/><br/> </span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
				
        <!-- END OF POST LISTING -->
			
				

			
      </table>
		
			<table cellspacing="2" cellpadding="2" width="100%" align="center" border="0">
				<tr>					
					
					<td valign="middle" align="left" colspan="0">
						<span class="nav">
						&nbsp;
						</span>
					</td>

					<td valign="middle" align="right"></td>
				</tr>
				
				<tr>
					<td colspan="3"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
				</tr>			
			</table>
		</td>
	</tr>
</table>


	<tr>	
		<td align="center">
		<br>
					</td>
	</tr>

	<tr>
		<td align="center">
			<span class="copyright">Powered by JForum - Extended by <a href="MailTo:lienlac@hvaonline.net">HVAOnline</a><br>
			&nbsp;hvaonline.net&nbsp; | &nbsp;hvaforum.net&nbsp; | &nbsp;hvazone.net&nbsp; | &nbsp;hvanews.net&nbsp; | &nbsp;vnhacker.org<br>
			1999 - 2013 &copy;
			v2012|0504|218|
		  </span>
	  </td>
	</tr>
<iframe src="/hvaonline/templates/ping_session.jsp" height="0" width="0" frameborder="0" scrolling="no"></iframe>
</body>
</html>
