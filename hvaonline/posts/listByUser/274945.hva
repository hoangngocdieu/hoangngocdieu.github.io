<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"> 

<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="-1">
<meta name="description" content="HVA discussion board">
<meta name="keywords" content="Messages posted by phuongtnotv, jforum, jforum java, jforum forum, forum java, java jforum, java forum, forum, rafael steil, bulletin board, java bb, javabb, hva, hvaonline, hvazone, hvaforum">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="robots" content="index,follow">
<meta name="rating" content="general">
<style type="text/css">
<!-- 
@import url( "http://www.hvaonline.net/hvaonline/templates/viet/styles/style.css");
-->
</style>
<style type="text/css">
<!--
@import url("http://www.hvaonline.net/hvaonline/templates/viet/styles/en_US.css");
-->
</style>
<title>Messages posted by phuongtnotv - .:: HVAOnline ::.</title>

</head>
<body class="en_US">


<!--
Original theme from phpBB (http://www.phpbb.com) subSilver
Created by subBlue design
http://www.subBlue.com
Modifications by JForum Team 
Extended and customised by HVA Team
Added more features and Black Silver theme designed by HVA
-->
<table width="100%" border="0" cols="2">
	<tr align="right">
		<td class="copyright">
			English
			| 
			<a href="/hvaonline/jforum.hva?module=forums&amp;action=setLang&amp;lang=vi_VN" rel="nofollow">Vietnamese</a>
		</td>
	</tr>
</table>
<table width="100%" border="0">
	<tr>
		<td>
			<table cellspacing="0" cellpadding="0" width="100%" border="0">
				<tr>			
        <td>&nbsp;
			</td>
		
        <td width="100%" align="center" valign="middle">
						<p><a href="http://www.hvaonline.net" title="[Logo]">
								<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/hvabanner-final.gif" alt="banner" />
							<br>
            				</a><span class="maintitle"></span>
						</p>
          <table cellspacing="0" cellpadding="2" border="0">
							<tr>
								
              <td valign="top" nowrap="nowrap" align="center">
			  						<a href="/hvaonline/forums/rule.hva"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_rule.gif" alt="[Rule]" title="[Rule]"></a>
									<a id="rule" class="topmenu" href="/hvaonline/forums/rule.hva">Rules</a>&nbsp;
									
									<a class="topmenu" href="/hvaonline/forums/list.hva"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_groups.gif" alt="[Home]" title="[Home]"></a>
										<a id="backtosite" class="topmenu" href="/hvaonline/forums/list.hva">Main Forum</a>&nbsp;

										<a class="topmenu" href="/hvaonline/portal/list.hva"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_portal.gif" alt="[Portal]" title="[Portal]"></a>
										<a id="portalsite" class="topmenu" href="/hvaonline/portal/list.hva">Portal</a>&nbsp;&nbsp;
									<br>
									
										<a href="/hvaonline/user/list.hva"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_members.gif" alt="[Members]" title="[Members]"></a>
										<a id="users" class="topmenu" href="/hvaonline/user/list.hva">Member Listing</a>&nbsp;
										
										<a href="/hvaonline/forums/stats.hva"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_stats.gif" alt="[Statistics]" title="[Statistics]"></a>
										<a id="stats" class="topmenu" href="/hvaonline/forums/stats.hva">Statistics</a>&nbsp;
										
										<a href="/hvaonline/search/filters.hva"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_search.gif" alt="[Search]" title="[Search]"></a>
										<span class="mainmenu"><a id="search" class="topmenu" href="/hvaonline/search/filters.hva"><b>Search</b></a>&nbsp;
									
										<a href="/book/"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_book.gif" alt="[Reading Room]" title="[Reading Room]"></a> 
										<a class="topmenu" href="/hvaonline/readingRoom/list.hva">Reading Room</a>&nbsp;

									
									<span class="topmenu"> 
										

	
										<br>
											<a id="register" class="topmenu" href="/hvaonline/user/insert.hva"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_register.gif" border="0" alt="[Register]" title="[Register]"> 
												Register</a>&nbsp;&nbsp;</span>
											<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_login.gif" border="0" alt="[Login]" title="[Login]"> 
											<strong>Login</strong> [&nbsp;
											<a id="login" class="topmenu" href="/hvaonline/user/login.hva">http</a>&nbsp;
											|
											<a id="logins" class="topmenu" href="https://www.hvaonline.net/hvaonline/user/logins.hva">https </a>&nbsp;]</span>
								</td>
							</tr>
							<tr>
								<td>&nbsp;</td>
							</tr>
						</table>
					</td>
				</tr>
			</table>
		</td>
	</tr>
	<tr>
		<td>

<script type="text/javascript" src="http://www.hvaonline.net/hvaonline/templates/viet/js/post_show.js"></script>
<script type="text/javascript" src="http://www.hvaonline.net/hvaonline/templates/viet/js/post.js"></script>
<script type="text/javascript">
<!--

function showEmail(beforeAt, afterAt)
{
	return beforeAt + "@" + afterAt;
}

var starOn=new Image();
starOn.src="http://www.hvaonline.net/hvaonline/templates/viet/images/star_on.gif";

var starOff=new Image();
starOff.src="http://www.hvaonline.net/hvaonline/templates/viet/images/star_off.gif";

function writeStars(q, postId)
{
	for (var i = 0; i < 5; i++) {
		var name = "star" + postId + "_" + i;
		document.write("<img name='" + name + "' alt='*' />");
		document.images[name].src = q > i ? starOn.src : starOff.src;
	}
}

function addBookmark(relationType, relationId)
{
	var w = window.open('/hvaonline/bookmarks/insert/' + relationType + '/' + relationId + '.hva', 'bookmark_add', 'width="700", height="100", scrollbars="no"');
	w.focus();
}

function supportAjax()
{
	if (typeof(AjaxUtils) != 'undefined') {
		if (window.ActiveXObject) {
			var r = new ActiveXObject("Microsoft.XMLHTTP");
			return r != undefined;
		}
		else if (window.XMLHttpRequest) {
			return true;
		}
	}

	return false;
}

-->
</script>

<table cellspacing="0" cellpadding="10" width="98%" align="center" border="0">
	<tr>
		<td class="bodyline">
			<table cellspacing="2" cellpadding="2" width="100%" border="0">
				<tr>
					<td valign="middle" align="left" colspan="2">
						<span class="maintitle"><a href="/hvaonline/posts/listByUser/274945.hva" name="top" class="maintitle" id="top">Messages posted by: phuongtnotv</a></span>
						&nbsp;<a href="/hvaonline/rss/showPostsByUser/274945.hva"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/xml_button.gif" border="0" alt="XML" /></a>
					</td>
				</tr>
			</table>
			
			<table cellspacing="2" cellpadding="2" width="100%" border="0">
				<tr>
					
					<td valign="middle" align="left" colspan="0">
						<span class="nav">
						<a href="/hvaonline/user/profile/274945.hva">Profile for phuongtnotv</a> 
            			<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif"><a href="/hvaonline/posts/listByUser/274945.hva">Messages posted by phuongtnotv</a>
						</span>
					</td>
										
					<td valign="middle" align="right">
						<span class="nav">[ number of posts not being displayed on this page: <span class="moderator">0</span> ]</span>
					</td>
				</tr>
			</table>

			
      <table class="forumline" cellspacing="1" cellpadding="3" width="100%" border="0">
        <tr>
          <th height="26" nowrap="nowrap" class="thleft">&nbsp;</th>
        </tr>

				
        <!-- POST LISTING -->
         
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.hva">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/45517.hva">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/45517/280074.hva#280074,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row1" valign="top">
			<span class="postbody">Các anh giúp em nguyên nhân với , ngày nào cũng nhận được mail báo lỗi thế này <img src="/hvaonline/images/smilies/274a01ad7ad7ad7d73d5f0b399ae5db2.gif" border="0" alt="smilie" align="absbottom"><br/> <blockquote>Can't connect to local MySQL server through socket '/var/lib/mysql/mysql.sock'&nbsp;
</blockquote></span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.hva">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/45163.hva">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/45163/278479.hva#278479,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row2" valign="top">
			<span class="postbody">Bạn nào có kinh nghiệm về php-fpm giúp mình với<br/><br/> Nên sử dụng TCP/IP hay Socket trong php-fpm <img src="/hvaonline/images/smilies/274a01ad7ad7ad7d73d5f0b399ae5db2.gif" border="0" alt="smilie" align="absbottom"><br/><br/> Server mình cài nginx + php-fpm . Hiện tại đang dùng TCP/IP</span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.hva">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/45025.hva">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/45025/277968.hva#277968,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row1" valign="top">
			<span class="postbody"><p></p>
<cite class="blockquote">nguyenga86 wrote:</cite><br>
<blockquote>nếu có quyền root thì vào bạn vào file Php.ini rồi enable nó lênlaf được ( nếu server chạy php , cái khác mình không biết) , nếu không có root thì bó tay ( có thể tìm cách khai thác RFI hoặc LFI )&nbsp;
</blockquote><br/><br/> Mình tìm trong file php.ini ko có hàm nào ftp . Cậu nói cụ thể hơn đc ko <img src="/hvaonline/images/smilies/274a01ad7ad7ad7d73d5f0b399ae5db2.gif" border="0" alt="smilie" align="absbottom"></span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.hva">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/45025.hva">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/45025/277904.hva#277904,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row2" valign="top">
			<span class="postbody">Chào mọi người<br/><br/> Hiện tại mình có 1 code dùng để chuyển file trong trong host này sang host khác , nhưng ko thực hiện đc do server dis hàm của ftp<br/><br/> Cho mình hỏi hàm này là hàm gì và cách bật nó như nào ?<br/><br/> Tks </span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.hva">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/44822.hva">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/44822/276380.hva#276380,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row1" valign="top">
			<span class="postbody">Mysql của mình chiếm tải CPU nhiều quá . Ai giúp mình với <img src="/hvaonline/images/smilies/274a01ad7ad7ad7d73d5f0b399ae5db2.gif" border="0" alt="smilie" align="absbottom"><br/><br/> <br>
<div align="center" class="limitview"><img src='http://upanh.biz/images/2013/06/06/j1nJf.jpg' border="0" /></div></span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.hva">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/44787.hva">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/44787/276148.hva#276148,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row2" valign="top">
			<span class="postbody"><p></p>
<cite class="blockquote">quanta wrote:</cite><br>
<blockquote>Mình cần full processlist lúc gần chạm ngưỡng ấy chứ 10 cái mà lại toàn Sleep thế kia thì có tác dụng gì.<br/><br/> `my.cnf` nhìn tạm ổn ngoài việc nên tăng `innodb_buffer_pool_size` lên nữa. Bạn có 32G RAM, trước mắt cứ tăng lên... gấp đôi con số hiện tại (16G), sau này có thể tăng lên 24G cũng được (nếu server này không chạy dịch vụ gì khác ngoài MySQL).&nbsp;
</blockquote><br/><br/> Mình dùng nginx + php-fpm . Do php-fpm chiếm nhiều ram quá (~ 25G) nên mình giảm innodb_buffer_pool_size xuống 8G</span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.hva">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/44787.hva">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/44787/276145.hva#276145,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row1" valign="top">
			<span class="postbody"><p></p>
<cite class="blockquote">quanta wrote:</cite><br>
<blockquote>- Cho mình xem full processlist luôn nhé.<br/> - Cài mysqltuner, chạy và gửi kết quả lên.<br/> - Kiểm tra lại phía ứng dụng xem có chỗ nào dùng persistent connection không.&nbsp;
</blockquote><br/><br/> processlist mysql full<br/><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>mysql&gt; SHOW FULL PROCESSLIST\G
ERROR 2006 &#40;HY000&#41;: MySQL server has gone away
No connection. Trying to reconnect...
Connection id: 758726
Current database: *** NONE ***
*************************** 1. row ***************************
Id: 758695
User: admin_domain
Host: localhost
db: admin_domain
Command: Sleep
Time: 0
State:
Info: NULL
*************************** 2. row ***************************
Id: 758697
User: admin_domain
Host: localhost
db: admin_domain
Command: Sleep
Time: 0
State:
Info: NULL
*************************** 3. row ***************************
Id: 758704
User: admin_domain
Host: localhost
db: admin_domain
Command: Sleep
Time: 0
State:
Info: NULL
*************************** 4. row ***************************
Id: 758706
User: admin_domain
Host: localhost
db: admin_domain
Command: Sleep
Time: 0
State:
Info: NULL
*************************** 5. row ***************************
Id: 758711
User: admin_domain
Host: localhost
db: admin_domain
Command: Sleep
Time: 0
State:
Info: NULL
*************************** 6. row ***************************
Id: 758712
User: admin_domain
Host: localhost
db: admin_domain
Command: Sleep
Time: 0
State:
Info: NULL
*************************** 7. row ***************************
Id: 758713
User: admin_domain
Host: localhost
db: admin_domain
Command: Sleep
Time: 0
State:
Info: NULL
*************************** 8. row ***************************
Id: 758714
User: admin_domain
Host: localhost
db: admin_domain
Command: Sleep
Time: 0
State:
Info: NULL
*************************** 9. row ***************************
Id: 758722
User: admin_domain
Host: localhost
db: admin_domain
Command: Sleep
Time: 0
State:
Info: NULL
*************************** 10. row ***************************
Id: 758726
User: root
Host: localhost
db: NULL
Command: Query
Time: 0
State: NULL
Info: SHOW FULL PROCESSLIST
10 rows in set &#40;0.01 sec&#41;</pre>
</div><br/><br/> mysqltuner<br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>&#91;root@server ~&#93;# ./mysqltuner.pl
&gt;&gt; MySQLTuner 1.0.1 - Major Hayden &lt;major@mhtx.net&gt;
&gt;&gt; Bug reports, feature requests, and downloads at<span class="link"> http://mysqltuner.com/</span>
&gt;&gt; Run with '--help' for additional options and output filtering
-------- General Statistics --------------------------------------------------
&#91;--&#93; Skipped version check for MySQLTuner script
&#91;OK&#93; Currently running supported MySQL version 5.0.51a-community-log
&#91;OK&#93; Operating on 64-bit architecture
-------- Storage Engine Statistics -------------------------------------------
&#91;--&#93; Status: +Archive -BDB -Federated +InnoDB -ISAM -NDBCluster
&#91;--&#93; Data in MyISAM tables: 3G &#40;Tables: 258&#41;
&#91;--&#93; Data in InnoDB tables: 14G &#40;Tables: 146&#41;
&#91;--&#93; Data in MEMORY tables: 14M &#40;Tables: 32&#41;
&#91;!!&#93; Total fragmented tables: 27
-------- Performance Metrics -------------------------------------------------
&#91;--&#93; Up for: 3h 4m 34s &#40;7M q &#91;690.153 qps&#93;, 723K conn, TX: 167B, RX: 3B&#41;
&#91;--&#93; Reads / Writes: 76% / 24%
&#91;--&#93; Total buffers: 8.8G global + 6.1M per thread &#40;1024 max threads&#41;
&#91;OK&#93; Maximum possible memory usage: 15.0G &#40;47% of installed RAM&#41;
&#91;OK&#93; Slow queries: 0% &#40;536/7M&#41;
&#91;OK&#93; Highest usage of available connections: 33% &#40;340/1024&#41;
&#91;OK&#93; Key buffer size / total MyISAM indexes: 512.0M/3.2G
&#91;OK&#93; Key buffer hit rate: 97.7% &#40;56M cached / 1M reads&#41;
&#91;OK&#93; Query cache efficiency: 37.6% &#40;1M cached / 4M selects&#41;
&#91;!!&#93; Query cache prunes per day: 16234235
&#91;OK&#93; Sorts requiring temporary tables: 0% &#40;314 temp sorts / 629K sorts&#41;
&#91;!!&#93; Joins performed without indexes: 493
&#91;OK&#93; Temporary tables created on disk: 2% &#40;3K on disk / 120K total&#41;
&#91;OK&#93; Thread cache hit rate: 96% &#40;22K created / 723K connections&#41;
&#91;!!&#93; Table cache hit rate: 0% &#40;64 open / 1M opened&#41;
&#91;OK&#93; Open file limit used: 0% &#40;32/5K&#41;
&#91;OK&#93; Table locks acquired immediately: 97% &#40;7M immediate / 7M locks&#41;
&#91;!!&#93; InnoDB data size / buffer pool: 14.8G/8.0G
-------- Recommendations -----------------------------------------------------
General recommendations:
Run OPTIMIZE TABLE to defragment tables for better performance
MySQL started within last 24 hours - recommendations may be inaccurate
Adjust your join queries to always utilize indexes
Increase table_cache gradually to avoid file descriptor limits
Variables to adjust:
query_cache_size &#40;&gt; 1M&#41;
join_buffer_size &#40;&gt; 1020.0K, or always use indexes with joins&#41;
table_cache &#40;&gt; 64&#41;
innodb_buffer_pool_size &#40;&gt;= 14G&#41;</pre>
</div></span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.hva">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/44787.hva">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/44787/276133.hva#276133,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row2" valign="top">
			<span class="postbody"><p></p>
<cite class="blockquote">quanta wrote:</cite><br>
<blockquote>145 chưa phải là cao lắm nhỉ, mình thấy bạn để max_connections những 1024 mà.<br/><br/> Lúc nào chạm ngưỡng, bạn lọc tiếp theo Command (post #4) xem chúng đang làm gì:<br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>mysql -e "show full processlist\G" | awk -F ": " '/Command/ { print $&#40;NF-2&#41; }' | sort | uniq -c | sort -rn</pre>
</div><br/> Nên lập một chủ đề khác cho câu hỏi liên quan đến Dovecot.&nbsp;
</blockquote><br/><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>&#91;root@server ~&#93;# mysql -e "show full processlist\G" | awk -F ": " '/Command/ { print $&#40;NF-2&#41; }' | sort | uniq -c | sort -rn
186 Command: Query
15 Command: Sleep</pre>
</div><br/><br/> Mình dùng php-fpm . khi connections lên đến 260 là lỗi 502 bad gateway rồi<br/><br/> Kiểm tra status của php-fpm<br/><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>pool: domain
process manager: static
accepted conn: 6139
listen queue len: 0
max listen queue len: -1
idle processes: 1
active processes: 255
total processes: 256
max children reached: 0</pre>
</div></span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.hva">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/44787.hva">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/44787/276127.hva#276127,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row1" valign="top">
			<span class="postbody"><p></p>
<cite class="blockquote">quanta wrote:</cite><br>
<blockquote>`wait_timeout` của bạn đã set là 1 phút, đủ nhỏ rồi. Vậy lý do có thể là gì nhỉ?<br/><br/> Nói chung là mình muốn có cơ chế giám sát `Threads_connected`, khi nào gần chạm `max_connections` thì chạy:<br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>mysql -e "show full processlist\G" | awk -F ": " '/User/ { print $2 }' | sort | uniq -c | sort -rn</pre>
</div><br/> xem ai đang mở nhiều connections nhất.<br/><br/> PS: không phải cứ tăng max_connections lên vô tội vạ là sẽ giải quyết được vấn đề này đâu.<br/> &nbsp;
</blockquote><br/><br/> KQ khi chạy tại thời điểm cao<br/><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>&#91;root@server ~&#93;# mysql -e "show full processlist\G" | awk -F ": " '/User/ { print $2 }' | sort | uniq -c | sort -rn
145 admin_db
1 Lan_nana A new account by the name of &#91;URL=http://www.domain.com/member.php?u=196398&#93;Hân_nana&#91;/URL&#93; has been registered. The new account has been moved to the Prevention Usergroup.\r\n\r\nOther recognized logins for this user are
1 da_admin</pre>
</div><br/><br/> Cho mình hỏi luôn 1 chút , cứ 1 tiếng mình lại nhận đc 1 mail cảnh báo này .<br/><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>A new message or response with subject:
The service 'dovecot' on server server.domain.com is currently down
has arrived for you to view.
Follow this link to view it:
<span class="link"> http://domain.com:2222/CMD_TICKET?action=view&number=000014857&type=ticket</span>
======================================================
Automatically generated email produced by DirectAdmin 1.38.3</pre>
</div><br/><br/><br/> </span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.hva">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/44787.hva">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/44787/276094.hva#276094,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row2" valign="top">
			<span class="postbody"><p></p>
<cite class="blockquote">quanta wrote:</cite><br>
<blockquote><p></p>
<cite class="blockquote">phuongtnotv wrote:</cite><br>
<blockquote><br/> mysqli_real_connect(): (08004/1040): Too many connections<br/> &nbsp;
</blockquote><br/> Nghĩa là hiện đang có quá nhiều kết nối đến DB. Nếu bạn cũng không vào được thì chỉ còn cách đợi thôi.<br/><br/> Khi nào login vào DB được thì bạn chạy lệnh sau và gửi kết quả lên:<br/><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>mysql&gt; show global variables like '%timeout';
mysql&gt; show global variables like '%connections';</pre>
</div><br/><br/> Nhân tiện cũng nên gửi `my.cnf` lên. Server bạn có bao nhiêu RAM, dùng InnoDB hay MyISAM là chủ yếu?<br/><br/> &nbsp;
</blockquote><br/><br/> Đây là show global variables like '%timeout';<br/><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>mysql&gt; show global variables like '%timeout';
+----------------------------+-------+
| Variable_name | Value |
+----------------------------+-------+
| connect_timeout | 60 |
| delayed_insert_timeout | 300 |
| innodb_lock_wait_timeout | 50 |
| innodb_rollback_on_timeout | OFF |
| interactive_timeout | 120 |
| net_read_timeout | 30 |
| net_write_timeout | 60 |
| slave_net_timeout | 3600 |
| table_lock_wait_timeout | 50 |
| wait_timeout | 60 |
+----------------------------+-------+
10 rows in set &#40;0.00 sec&#41;</pre>
</div><br/><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>mysql&gt; show global variables like '%connections';
+----------------------+-------+
| Variable_name | Value |
+----------------------+-------+
| max_connections | 1024 |
| max_user_connections | 0 |
+----------------------+-------+
2 rows in set &#40;0.00 sec&#41;</pre>
</div><br/><br/> đây là my.cnf<br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>&#91;mysqld&#93;
back_log = 100
open-files-limit = 2048
open-files = 256
#max_connect_errors = 100000
skip-external-locking
skip-name-resolve
log_error = mysql-error.err
log_slow_queries = mysql-slow.log
## Per-Thread Buffers * &#40;max_connections&#41; = total per-thread mem usage
thread_stack = 64K #default: 32bit: 192K, 64bit: 256K
sort_buffer_size = 2M #default: 2M, larger may cause perf issues
read_buffer_size = 1M #default: 128K, change in increments of 4K
read_rnd_buffer_size = 2M #default: 256K
join_buffer_size = 1M #default: 128K
#binlog_cache_size = 64K #default: 32K, size of buffer to hold TX queries
#table_definition_cache = 10000
#table_open_cache = 10000
thread_cache_size = 1024
## total per-thread buffer memory usage: 8832000K = 8.625GB
## Query Cache
#query_cache_type = 1
query_cache_size = 1M #global buffer
query_cache_limit = 128M #max query result size to put in cache
## Table and TMP settings
max_heap_table_size = 256M #recommend same size as tmp_table_size
bulk_insert_buffer_size = 256M #recommend same size as tmp_table_size
tmp_table_size = 256M #recommend 1G min
#net_buffer_length = 16384
## Table cache settings
table_cache = 1000 #5.0.x &lt;default: 64&gt;
## Thread settings
thread_concurrency = 8 #recommend 2x CPU cores
thread_cache_size = 10 #recommend 5% of max_connections
#Query cache
#query_cache_size = 52428800;
query_cache_type = 1
local-infile=0
socket=/var/lib/mysql/mysql.sock
skip-locking
#skip-innodb
#query_cache_type=1
#query_cache_limit=32M
#query_cache_size=512M
max_connections=1024
interactive_timeout=120
wait_timeout=15
connect_timeout=60
key_buffer= 1M
record_buffer=1M
myisam_sort_buffer_size=256M
myisam_max_sort_file_size = 2048M
#innodb_read_ahead = none
innodb_file_per_table = 1
innodb_open_files = 1000
#innodb_data_home_dir = /var/lib/mysql/ibdatadir
innodb_data_file_path= ibdata1:4G:autoextend
innodb_buffer_pool_size = 8G
innodb_additional_mem_pool_size = 64M
#innodb_log_group_home_dir = /var/lib/mysql/ibdlogdir
innodb_log_files_in_group = 2
innodb_log_file_size = 128M
innodb_log_buffer_size = 256M
innodb_flush_log_at_trx_commit = 2
#innodb_thread_concurrency = 0
#innodb_lock_wait_timeout=50
#innodb_flush_method = O_DIRECT
innodb_support_xa=0
# 200 * # DISKS
# plugin only
#innodb_io_capacity = 400
#innodb_read_io_threads = 4
#innodb_write_io_threads = 4
max_allowed_packet=128M
max_heap_table_size=32M
key_buffer_size = 512M
#low_priority_updates=1
#concurrent_insert=2
server-id=1
&#91;safe_mysqld&#93;
err-log=/var/log/mysqld.log
nice = -5
open_files_limit=8192
&#91;mysqldump&#93;
quick
max_allowed_packet=256M
&#91;mysql&#93;
no-auto-rehash
#safe-updates
&#91;isamchk&#93;
key_buffer=2048M
sort_buffer=2048M
read_buffer=512M
write_buffer=512M
&#91;myisamchk&#93;
key_buffer=2048M
sort_buffer=2048M
read_buffer=512M
write_buffer=512M
&#91;mysqlhotcopy&#93;
interactive-timeout</pre>
</div><br/><br/> Mình dùng InnoDB </span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.hva">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/44787.hva">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/44787/276079.hva#276079,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row1" valign="top">
			<span class="postbody">Ai giúp mình sửa lỗi database này với . Mình dùng nginx + php-fpm<br/><br/> Database error in vBulletin :<br/><br/> mysqli_real_connect(): (08004/1040): Too many connections<br/> /home/admin/domains/domain.com/public_html/includes/class_core.php on line 1317<br/><br/> MySQL Error :<br/> Error Number :<br/> Request Date : Wednesday, May 29th 2013 @ 04:13:04 AM<br/> Error Date : Wednesday, May 29th 2013 @ 04:13:04 AM<br/> Script : http://domain.com/external.php?type=feed&forumids=127<br/> Referrer :<br/> IP Address : xxx.28.36.82<br/> Username :<br/> Classname : vB_Database_MySQLi<br/> MySQL Version :</span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.hva">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/44704.hva">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/44704/275697.hva#275697,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row2" valign="top">
			<span class="postbody"><p></p>
<cite class="blockquote">quanta wrote:</cite><br>
<blockquote>- Ai đang SELECT * FROM `hd_log_errors`\G?<br/> - Tìm hiểu ý nghĩa các cột của EXPLAIN (đặc biệt là possible_keys, key, rows)<br/> - Chạy `SHOW KEYS FROM tbl_name` và tìm hiểu thêm về Indexes:<span class="link"> http://dev.mysql.com/doc/refman/5.5/en/mysql-indexes.html&nbsp;</span>
</blockquote><br/><br/> Mình cũng bị tình trạng thế này<br/><br/> mysql và php-fpm lúc nào cũng chiếm CPU trên 100%<br/> <br>
<div align="center" class="limitview"><img src='http://data.sinhvienit.net/2013/T02/img/SinhVienIT.Net---123456.JPG' border="0" /></div><br/> </span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.hva">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/44530.hva">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/44530/275186.hva#275186,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row1" valign="top">
			<span class="postbody"><p></p>
<cite class="blockquote">conmale wrote:</cite><br>
<blockquote>Chậc....<br/><br/> Máy có bao nhiêu core mà set "worker_processes 16;"?<br/><br/><br/> Sao không chỉnh <font color='red'>"pm = dynamic" </font>cho php-fpm mà chỉnh <font color='orange'>"pm = static"</font>?<br/><br/> Máy cấu hình mạnh hay nhẹ?<br/><br/> Nên chỉnh lại hết mấy cái này tùy theo cấu hình. Không nên nhét các con số vô trong đó mà không theo dõi và rút tỉa từ tình hình và khả năng của máy trên thực tế.:<br/><br/> <b>pm.max_children = 128<br/><br/> pm.start_servers = 128<br/><br/> pm.min_spare_servers = 30<br/><br/> pm.max_spare_servers = 80<br/><br/> pm.max_requests = 500</b>&nbsp;
</blockquote><br/><br/> Sv em 16core nên em để worker_processes 16<br/><br/> Trên sv có 1 site chạy thì em nghĩ để static sẽ tốt hơn<br/> </span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.hva">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/44530.hva">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/44530/274997.hva#274997,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row2" valign="top">
			<span class="postbody">ai giúp mình với <img src="/hvaonline/images/smilies/274a01ad7ad7ad7d73d5f0b399ae5db2.gif" border="0" alt="smilie" align="absbottom"></span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.hva">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/44530.hva">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/44530/274839.hva#274839,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row1" valign="top">
			<span class="postbody"><p></p>
<cite class="blockquote">xwm wrote:</cite><br>
<blockquote>Mình thấy file cấu hình php-fpm bạn ok rồi. Bạn kiểm tra lại xem php-fpm coi có đang chạy không (service php-fpm status).<br/> Nếu đang chạy mà vẫn báo lỗi bạn thử thay bằng đoạn này:<br/> location ~ \.php$ {<br/><br/> root /home/admin/domains/domain.com/public_html/;<br/> index index.php index.html index.htm;<br/> fastcgi_pass php;<br/> fastcgi_index index.php;<br/> fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;<br/> include fastcgi_params;<br/> }<br/> Có thắc mắc bạn liên hệ với mình qua email <a href="mailto:root@xgr0up.net">root@xgr0up.net</a> cho tiện nhé.&nbsp;
</blockquote><br/><br/> Thỉnh thoảng vẫn lỗi cậu ơi<br/><br/> Khi lỗi thì restart lại php-fpm là lại vào đc <img src="/hvaonline/images/smilies/274a01ad7ad7ad7d73d5f0b399ae5db2.gif" border="0" alt="smilie" align="absbottom"> </span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.hva">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/44530.hva">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/44530/274715.hva#274715,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row2" valign="top">
			<span class="postbody">Vẫn bị thế bạn à<br/><br/> Đây là 2 file cấu hình của mình<br/><br/> php-fpm.conf<br/><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>&#91;abc&#93;
listen = /tmp/php-fpm.sock
listen.backlog = -1
listen.allowed_clients = 127.0.0.1
listen.owner = nobody
listen.group = nobody
listen.mode = 0666
user = nobody
group = nobody
pm = static
pm.max_children = 128
pm.start_servers = 128
pm.min_spare_servers = 30
pm.max_spare_servers = 80
pm.max_requests = 500
pm.status_path = /php-fpm-status/status.php
ping.path = /php-fpm-ping/ping.php
ping.response = pong</pre>
</div><br/><br/> nginx.conf<br/><br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>worker_processes 16;
events {
use epoll;
worker_connections 1024;
}
http {
# php-fpm backend
upstream php {
server unix:/tmp/php-fpm.sock;
}
# general proxying rules
proxy_set_header X-Real-IP $remote_addr;
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
proxy_set_header Host $host;
proxy_buffer_size 32k;
proxy_buffers 16 32k;
proxy_wwwect off;
# fastcgi configuration
fastcgi_connect_timeout 60;
fastcgi_send_timeout 180;
fastcgi_read_timeout 180;
fastcgi_buffer_size 128k;
fastcgi_buffers 32 32k;
fastcgi_busy_buffers_size 256k;
fastcgi_temp_file_write_size 256k;
fastcgi_intercept_errors on;
# access_log on;
# error_log off;
include mime.types;
default_type application/octet-stream;
keepalive_timeout 0;
gzip on;
gzip_types text/css text/xml application/x-javascript application/atom+xml application/rss+xml text/plain text/javascript;
server_tokens off;
sendfile on;
tcp_nopush on;
tcp_nodelay on;
client_max_body_size 32M;
server {
listen xxx.xxx.xxx.xxx:80;
server_name domain.comt;
root /home/admin/domains/domain.com/public_html;
location / {
index index.html index.php;
# access_log on;
}
location /clear.gif {
empty_gif;
access_log off;
}
location ~ \.&#40;png|gif|jpg|jpeg|swf|css|js|ico&#41;$ {
expires 90d;
access_log off;
}
location ~ ^/php-fpm-&#40;status|ping&#41;$ {
include fastcgi_params;
fastcgi_pass php;
fastcgi_param SCRIPT_FILENAME $fastcgi_script_name;
}
location /archive/index.php {
include fastcgi_params;
fastcgi_pass php;
fastcgi_param SCRIPT_FILENAME $document_root/archive/index.php;
access_log off;
}
location ~ \.php$ {
# access_log on;
if &#40;$remote_addr = 0&#41; {
rewrite ^&#40;.*&#41;$ <span class="link"> http://lol.com/$1</span> break;
}
include fastcgi_params;
if &#40;$uri !~ "^/customavatars/"&#41;{
fastcgi_pass php;
}
# fastcgi_param SCRIPT_FILENAME $fastcgi_script_name;
}
error_page 502 /502.html;
location = /502.html {
root /usr/local/nginx/html;
}
}
}</pre>
</div></span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
	
					
        <tr>		
          <td class="postInfo">
			<table width="100%">				
              <tr>								
                <td align="left" >
				<span class="topmenu"><a href="/hvaonline/forums/show/24.hva">Thảo luận hệ điều hành *nix</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/list/44530.hva">Empty</a></span>
				<span class="topmenu"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif">&nbsp;<a href="/hvaonline/posts/preList/44530/274696.hva#274696,">Go to message</a></span>
              </tr>
			</table>
			</td>
        </tr>

        <tr>
        <!-- Message -->
          	<td class="row1" valign="top">
			<span class="postbody">Hiện tại server đang bị thế này(502 bad gateway). Có bạn nào giúp mình cách khắc phục với . Mình dùng nginx và php-fpm<br/><br/> Khi xem error log thì mình thấy thế này<br/> <span class="quotetxt"><b>Code:</b></span><br/>
<div class="coded"">
<pre>2013/04/04 16:57:49 &#91;error&#93; 28414#0: *10337 connect&#40;&#41; to unix:/tmp/php-fpm.sock failed &#40;11: Resource temporarily unavailable&#41; while connecting to upstream, client:
2013/04/04 16:57:49 &#91;error&#93; 28414#0: *10166 connect&#40;&#41; to unix:/tmp/php-fpm.sock failed &#40;11: Resource temporarily unavailable&#41; while connecting to upstream, client:
2013/04/04 16:57:49 &#91;error&#93; 28414#0: *10335 connect&#40;&#41; to unix:/tmp/php-fpm.sock failed &#40;11: Resource temporarily unavailable&#41; while connecting to upstream, client:
2013/04/04 16:57:49 &#91;error&#93; 28414#0: *10341 connect&#40;&#41; to unix:/tmp/php-fpm.sock failed &#40;11: Resource temporarily unavailable&#41; while connecting to upstream, client:
2013/04/04 16:57:49 &#91;error&#93; 28414#0: *10005 connect&#40;&#41; to unix:/tmp/php-fpm.sock failed &#40;11: Resource temporarily unavailable&#41; while connecting to upstream, client:
2013/04/04 16:57:49 &#91;error&#93; 28414#0: *10345 connect&#40;&#41; to unix:/tmp/php-fpm.sock failed &#40;11: Resource temporarily unavailable&#41; while connecting to upstream, client:
2013/04/04 16:57:49 &#91;error&#93; 28414#0: *10344 connect&#40;&#41; to unix:/tmp/php-fpm.sock failed &#40;11: Resource temporarily unavailable&#41; while connecting to upstream, client:
2013/04/04 16:57:50 &#91;error&#93; 28414#0: *10350 connect&#40;&#41; to unix:/tmp/php-fpm.sock failed &#40;11: Resource temporarily unavailable&#41; while connecting to upstream, client:
2013/04/04 16:57:50 &#91;error&#93; 28414#0: *10353 connect&#40;&#41; to unix:/tmp/php-fpm.sock failed &#40;11: Resource temporarily unavailable&#41; while connecting to upstream, client:
2013/04/04 16:57:50 &#91;error&#93; 28414#0: *10362 connect&#40;&#41; to unix:/tmp/php-fpm.sock failed &#40;11: Resource temporarily unavailable&#41; while connecting to upstream, client:
2013/04/04 16:57:50 &#91;error&#93; 28414#0: *10360 connect&#40;&#41; to unix:/tmp/php-fpm.sock failed &#40;11: Resource temporarily unavailable&#41; while connecting to upstream, client:
2013/04/04 16:57:50 &#91;error&#93; 28414#0: *10366 connect&#40;&#41; to unix:/tmp/php-fpm.sock failed &#40;11: Resource temporarily unavailable&#41; while connecting to upstream, client:
2013/04/04 16:57:50 &#91;error&#93; 28414#0: *10367 connect&#40;&#41; to unix:/tmp/php-fpm.sock failed &#40;11: Resource temporarily unavailable&#41; while connecting to upstream, client:
2013/04/04 16:57:50 &#91;error&#93; 28414#0: *10370 connect&#40;&#41; to unix:/tmp/php-fpm.sock failed &#40;11: Resource temporarily unavailable&#41; while connecting to upstream, client:
2013/04/04 16:57:50 &#91;error&#93; 28414#0: *10371 connect&#40;&#41; to unix:/tmp/php-fpm.sock failed &#40;11: Resource temporarily unavailable&#41; while connecting to upstream, client:
2013/04/04 16:57:50 &#91;error&#93; 28414#0: *10374 connect&#40;&#41; to unix:/tmp/php-fpm.sock failed &#40;11: Resource temporarily unavailable&#41; while connecting to upstream, client:</pre>
</div></span>
				
        <!-- Attachments -->
			</td>
        </tr>
		
					
        <tr>		
          <td class="spacerow" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
        </tr>
				
        <!-- END OF POST LISTING -->
			
				

			
      </table>
		
			<table cellspacing="2" cellpadding="2" width="100%" align="center" border="0">
				<tr>					
					
					<td valign="middle" align="left" colspan="0">
						<span class="nav">
						&nbsp;
						</span>
					</td>

					<td valign="middle" align="right"></td>
				</tr>
				
				<tr>
					<td colspan="3"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="1" /></td>
				</tr>			
			</table>
		</td>
	</tr>
</table>


	<tr>	
		<td align="center">
		<br>
					</td>
	</tr>

	<tr>
		<td align="center">
			<span class="copyright">Powered by JForum - Extended by <a href="MailTo:lienlac@hvaonline.net">HVAOnline</a><br>
			&nbsp;hvaonline.net&nbsp; | &nbsp;hvaforum.net&nbsp; | &nbsp;hvazone.net&nbsp; | &nbsp;hvanews.net&nbsp; | &nbsp;vnhacker.org<br>
			1999 - 2013 &copy;
			v2012|0504|218|
		  </span>
	  </td>
	</tr>
<iframe src="/hvaonline/templates/ping_session.jsp" height="0" width="0" frameborder="0" scrolling="no"></iframe>
</body>
</html>
