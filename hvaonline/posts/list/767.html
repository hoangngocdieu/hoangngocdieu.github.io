<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"> 

<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="-1">
<meta name="description" content="HVA discussion board">
<meta name="keywords" content="Hidding process không cần hooking API   (by Thug4Lif3), jforum, jforum java, jforum forum, forum java, java jforum, java forum, forum, rafael steil, bulletin board, java bb, javabb, hva, hvaonline, hvazone, hvaforum">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="robots" content="index,follow">
<meta name="rating" content="general">
<style type="text/css">
<!-- 
@import url( "http://www.hvaonline.net/hvaonline/templates/viet/styles/style.css");
-->
</style>
<style type="text/css">
<!--
@import url("http://www.hvaonline.net/hvaonline/templates/viet/styles/en_US.css");
-->
</style>
<title>Hidding process không cần hooking API   (by Thug4Lif3) - .:: HVAOnline ::.</title>

</head>
<body class="en_US">


<!--
Original theme from phpBB (http://www.phpbb.com) subSilver
Created by subBlue design
http://www.subBlue.com
Modifications by JForum Team 
Extended and customised by HVA Team
Added more features and Black Silver theme designed by HVA
-->
<table width="100%" border="0" cols="2">
	<tr align="right">
		<td class="copyright">
			English
			| 
			<a href="/hvaonline/jforum.html?module=forums&amp;action=setLang&amp;lang=vi_VN" rel="nofollow">Vietnamese</a>
		</td>
	</tr>
</table>
<table width="100%" border="0">
	<tr>
		<td>
			<table cellspacing="0" cellpadding="0" width="100%" border="0">
				<tr>			
        <td>&nbsp;
			</td>
		
        <td width="100%" align="center" valign="middle">
						<p><a href="http://www.hvaonline.net" title="[Logo]">
								<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/hvabanner-final.gif" alt="banner" />
							<br>
            				</a><span class="maintitle"></span>
						</p>
          <table cellspacing="0" cellpadding="2" border="0">
							<tr>
								
              <td valign="top" nowrap="nowrap" align="center">
			  						<a href="/hvaonline/forums/rule.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_rule.gif" alt="[Rule]" title="[Rule]"></a>
									<a id="rule" class="topmenu" href="/hvaonline/forums/rule.html">Rules</a>&nbsp;
									
									<a class="topmenu" href="/hvaonline/forums/list.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_groups.gif" alt="[Home]" title="[Home]"></a>
										<a id="backtosite" class="topmenu" href="/hvaonline/forums/list.html">Main Forum</a>&nbsp;

										<a class="topmenu" href="/hvaonline/portal/list.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_portal.gif" alt="[Portal]" title="[Portal]"></a>
										<a id="portalsite" class="topmenu" href="/hvaonline/portal/list.html">Portal</a>&nbsp;&nbsp;
									<br>
									
										<a href="/hvaonline/user/list.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_members.gif" alt="[Members]" title="[Members]"></a>
										<a id="users" class="topmenu" href="/hvaonline/user/list.html">Member Listing</a>&nbsp;
										
										<a href="/hvaonline/forums/stats.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_stats.gif" alt="[Statistics]" title="[Statistics]"></a>
										<a id="stats" class="topmenu" href="/hvaonline/forums/stats.html">Statistics</a>&nbsp;
										
										<a href="/hvaonline/search/filters.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_search.gif" alt="[Search]" title="[Search]"></a>
										<span class="mainmenu"><a id="search" class="topmenu" href="/hvaonline/search/filters.html"><b>Search</b></a>&nbsp;
									
										<a href="/book/"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_book.gif" alt="[Reading Room]" title="[Reading Room]"></a> 
										<a class="topmenu" href="/hvaonline/readingRoom/list.html">Reading Room</a>&nbsp;

									
									<span class="topmenu"> 
										

	
										<br>
											<a id="register" class="topmenu" href="/hvaonline/user/insert.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_register.gif" border="0" alt="[Register]" title="[Register]"> 
												Register</a>&nbsp;&nbsp;</span>
											<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/icon_mini_login.gif" border="0" alt="[Login]" title="[Login]"> 
											<strong>Login</strong> [&nbsp;
											<a id="login" class="topmenu" href="/hvaonline/user/login.html">http</a>&nbsp;
											|
											<a id="logins" class="topmenu" href="https://www.hvaonline.net/hvaonline/user/logins.html">https </a>&nbsp;]</span>
								</td>
							</tr>
							<tr>
								<td>&nbsp;</td>
							</tr>
						</table>
					</td>
				</tr>
			</table>
		</td>
	</tr>
	<tr>
		<td>

<!-- navigator -->
<table cellspacing="2" cellpadding="2" width="100%" border="0" align="center">
	<tr>
		<td valign="baseline" align="left" colspan="0">
			<span class="nav">
			<a class="nav" href="/hvaonline/forums/list.html">Forum Index </a> 
			<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif"> <a class="nav" href="/hvaonline/forums/show/23.html">Thảo luận hệ điều hành Windows </a>
			<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/arrow.gif"> <a class="nav" href="/hvaonline/posts/list/767.html" name="top" id="top">Hidding process không cần hooking API   (by Thug4Lif3)</a>
				&nbsp;<a href="/hvaonline/rss/topicPosts/767.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/xml_button.gif" border="0" alt="XML"></a>
			</span>
		
		</td>

		<td valign="middle" align="right" class="nav"></td>
	</tr>
</table>

<!-- poll show -->

  <!-- POST LISTING -->


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#FF9900">[Programming]</font></span>&nbsp;&nbsp; Hidding process không cần hooking API   (by Thug4Lif3)<a name="2711" id="2711"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">01/07/2006 07:39:07 (+0700) | <a href="/hvaonline/posts/list/767.html#2711">#1</a> | 2711 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/125550.html"><b>lawlesscoder</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 29/06/2006 19:01:59<br>
		Messages: 25<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/125550.html" class="icon_profile"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/125550.html" class="icon_pm"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row1">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row1"><span class="postbody">	    -=[ vnbiocoderz.com – Thug4Lif3 ]=-<br/> 				brings you <br/> <br/> |=--------------=[ Hidding process không cần hooking API ]=---------------=|<br/> |=--------------=[    trên nền Windows NT / XP / 2003    ]=---------------=|<br/> |=------------------------------------------------------------------------=|<br/> |=--------------------=[ Thug4Lif3/vnbiocoderz ]=-------------------------=|<br/> <br/> <br/> 1. Giới thiệu<br/> 2. Những phương pháp hooking & những hạn chế nói chung<br/>    2.1 Hooking user-mode API <br/>        2.1.1 Hooking bằng cách thay đôi các thư viện (DLL hoặc EXE)<br/>        2.1.2 Hooking trong khi chạy - patching trên bộ nhớ ảo của process<br/>        2.1.3 DLL Injection<br/>        2.1.4 Hạn chế<br/>    2.2 Hooking kernel-mode Native API <br/>        2.2.1 How to hook ?<br/>        2.2.2 Hạn chế<br/>    2.3 Khái quát <br/> <br/> 3. Hidding process mà không cần hooking API<br/>    3.1 Windows Objects <br/>        3.1.1 Cấu trúc của Object<br/>    3.2 LIST_ENTRY và double-linked list<br/>    3.3 Process Object<br/>    3.4 Hidding process không cần hooking API<br/>        3.4.1 Exploring wit PsActiveProcessHead and PsinitialSystemProcess<br/>        3.4.2 Hidding process - không cần hooking bất kỳ API nào.<br/> 4. Kết luận<br/> <br/> ----| 1.  Giới thiệu<br/> <br/> Ngày nay, trong nhiều lĩnh vực như hacking, cracking, việc che dấu sự xuất hiện<br/> của các process, các registry key, các device driver .. là một yêu cầu không <br/> thể thiếu được. Hacker cần giấu sự xuất hiện của các backdoor process, các backdoor<br/> port mà họ mở ra trên hệ thống bị hack, các tcp/udp packet ra vào ... Cracker <br/> cần che giấu các debugger process, tránh các phương pháp anti-debug và cơ chế bảo <br/> vệ của software... <br/> <br/> Việc che dấu nói trên thường được thực hiện bằng cách hook các API mà hệ thống sử <br/> dụng để liệt kê process (Nt/ZwQuerySystemInformation với SystemInformationClasss là <br/> SystemProcessesAndThreadsInformation), liệt kê registry (Nt/ZwEnumerateKey với<br/> KeyInformationClass là KeyBasicInformation)... <br/> <br/> Các phương pháp hooking API được áp dụng rộng rãi với nhiều phương pháp hooking <br/> khác nhau, ở các cấp độ nông sâu khác nhau của hệ điều hành. Tuy nhiên, hooking <br/> API có những hạn chế nhất định, nhất là việc phát hiện một API đã bị hook là việc<br/> không khó khăn gì lắm (độ khó và phức tạp còn tuỳ thuộc vào cấp độ hook, càng sâu<br/> vào kernel thì việc phát hiện càng khó). <br/> <br/> Điều này đặt ra một đòi hỏi một phương pháp hidding mới không thông qua hooking API.<br/> Trong bài viết sau đây, Thug xin trình bày một phương pháp có thể áp dụng trên nền <br/> Windows NT/XP/2003. Phương pháp này hoàn toàn thành công trong việc che dấu process,<br/> còn lại các phần khác như hidding registry, hidding tcp/udp ... đang còn trong giai <br/> đoạn nghiên cứu. Hy vọng trong thời gian tới, Thug sẽ có một bài viết hoàn chỉnh đầy<br/> đủ về phương pháp che dấu HOÀN TOÀN process, device driver ... mà không cần hooking <br/> API. <br/> <br/> ----| 2.  Những phương pháp hooking & những hạn chế nói chung <br/> <br/> Hooking API được hiểu nôm na là thay đổi chức năng thực của API theo mục đích riêng<br/> của người hook. Như đã nói ở trên, có rất nhiều phương pháp hooking API. Trước hết, <br/> Thug xin giới thiệu sơ qua về các phương pháp này và các hạn chế của chúng. <br/> <br/> Trước hết, có 2 loại hooking API: trong user-mode (ring3) và kernel-mode (ring0).<br/> <br/> ------| 2.1 Hooking user-mode API <br/> <br/> Hooking trong user-mode là phương pháp thông dụng nhất, và được áp dụng rộng rãi <br/> trong nhiều loại rootkit, các debugger-hider như OllyInvisible (teerayoot) ... <br/> Hooking loại này chỉ nằm trong phạm vi user-mode, nghĩa là trong phạm vi vùng nhớ<br/> từ 00000000h -&gt; 7FFFFFFFh.<br/> <br/> ------| 2.1.1 Hooking bằng cách thay đổi các file thư viện (DLL hoặc EXE)<br/> <br/> Phương pháp này là phương pháp thường được ứng dụng trong virus coding. Cơ chế của <br/> nó là thay đổi, patching các thư viện DLL,EXE trực tiếp trên ổ cứng các function<br/> cần hook như các function liệt kê process. Có thể đè code lên entry point để hướng<br/> code tới nơi ta muốn, hoặc có thể thay đổi toàn bộ DLL bằng DLL của chúng ta.<br/> <br/> ------| 2.1.2 Hooking trong khi chạy - patching trên bộ nhớ ảo của process<br/> <br/> Phương pháp này thực hiện bằng cách dùng API WriteProcessMemory. Tuy nhiên, nó chỉ <br/> áp dụng được khi ta có quyền write đối với process memory. Tương tự như phương pháp<br/> 2.1, phương pháp này cũng là thay đổi entry point của các API hoặc ghi đè code của <br/> các API, nhưng không phải trực tiếp lên file mà là trên virtual memory của process. <br/> <br/> Trong cấu trúc của file PE, có một bảng gọi là IAT (Import Address Table) lưu giữ <br/> các địa chỉ các API mà process cần gọi trong khi chạy (vd: ExitProcess, GetMođuleHanle..)<br/> Các process thực chất là các file PE/EXE được map vào virtual memory và tự động kích<br/> hoạt và chạy bởi Windows. Và IAT cũng được map vào memory <img src="/hvaonline/images/smilies/b5e9b4f86ce43ca65bd79c894c4a924c.gif" border="0" alt="smilie" align="absbottom"> Hooking chỉ còn là công <br/> việc thay đổi các address trong IAT thành địa chỉ các function mà ta muốn.<br/> <br/> ------| 2.1.3 DLL Injection <br/> <br/> Chúng ta có thể chạy thread từ memory của process khác. Điều này nghĩa là <br/> gì? Có nghĩa là chúng ta có thể load code vào memory của process và chạy <br/> code của chúng ta từ đây. Phần code này có nhiệm vụ hook các API. <br/> <br/> Để chạy thread trong memory của process khác, chúng ta dùng API: CreateRemoteThread<br/> <br/> HANDLE CreateRemoteThread(<br/> <br/>     HANDLE hProcess,	<br/>     LPSECURITY_ATTRIBUTES lpThreadAttributes,	<br/>     DWORD dwStackSize,	<br/>     LPTHREAD_START_ROUTINE lpStartAddress,	<br/>     LPVOID lpParameter,	<br/>     DWORD dwCreationFlags,	<br/>     LPDWORD lpThreadId 	<br/>    );<br/> <br/> Tham số quan trọng nhất là lpStartAddress và lpParameter. lpStartAddress là <br/> con trỏ trỏ tới một vùng nhớ trong process mà ta muốn tạo thread vào trong, <br/> là nơi code của chúng ta bắt đầu được thi hành trong memory của process muốn<br/> hook. Tham số lpParameter là con trỏ trỏ tới các tham số của thread do ta <br/> tạo ra. <br/> <br/> Chúng ta có thể tạo thread vào process muốn hook. Vậy còn load code vào memory<br/> process thế nào mà không dùng WriteProcessMemory? Câu trả lời: Chúng ta sẽ dùng<br/> GetProcAddress để lấy địa chỉ của LoadLibrary rồi cho lpStartAddress là địa chỉ<br/> của LoadLibrary, lpParameter trỏ tới tham số là tên DLL của chúng ta, vd như:<br/> thug_hooks_y0u.dll. Hàm LoadLibrary chỉ có một tham số duy nhất là con trỏ trỏ <br/> tới thư viện cần load. <br/> <br/> HINSTANCE LoadLibrary(<br/>     LPCTSTR lpLibFileName <br/>    );	<br/>  <br/> Ở đây lpLibFileName = lpParameter. Khi thread được chạy, nó sẽ bắt đầu ngay từ <br/> địa chỉ của LoadLibrary với tham số là tên thư viện của chúng ta. Khi thread được<br/> bắt đầu chạy, thì phần khởi tạo với tham số như trên được thi hành, và DLL của chúng<br/> ta được load vào memory - lưu ý: memory này là memory của process ta muốn hook, do <br/> thread này nằm trong memory của process này <img src="/hvaonline/images/smilies/b5e9b4f86ce43ca65bd79c894c4a924c.gif" border="0" alt="smilie" align="absbottom"> - và thread này chấm dứt. Tuy <br/> thread đã chấm dứt nhưng DLL của chúng ta thì vẫn nằm trong memory. And then?<br/> Heh, hook the APIz plzzz <img src="/hvaonline/images/smilies/575eda61e93c7ad9d05928580213fd9b.gif" border="0" alt="smilie" align="absbottom"> Chúng ta đã load code vào memory. <br/> <br/> Phương pháp nói trên được gọi là DLL Injection.<br/> <br/> ------| 2.1.4 Hạn chế<br/> <br/> Qua các phương pháp hooking API trong user-mode tuy có nhiều phương pháp khác nhau, song<br/> thực chất đều một mục đích là chỉnh sửa để sao cho code của chúng ta được thực thi trước <br/> các API thực sự. Việc này không tránh khỏi phải thay đổi entry point hoặc các phần để dẫn<br/> tới API như IAT và chúng ta phải viết vào "một nơi nào đó" phần code thay đổi chức năng <br/> của API. Điểm hạn chế nằm ở đây. Chúng ta có thể đơn giản kiểm tra các byte đầu của các <br/> API; theo IAT tới hàm mà IA trỏ tới, so sánh các byte tại đây với các byte đầu của API <br/> mà ta đã biết; kiểm tra runtime-CRC... API nào bị hook sẽ lộ rõ. <br/> <br/> Lấy ví dụ: plugin OllyInvisible (tác giả:teerayoot) hook function NtQuerySystemInformation <br/> bằng cách overwrite các bytes đầu của function này trong ntdll.dll để hide process OllyDbg.exe, <br/> một chương trình debug thông dụng, thường được cracker sử dụng. Bạn có thể download plugin<br/> này tại REA forum: www.reaonline.net (Reverse Engineering Association) - một forum của <br/> nhóm cracker có trình độ ở Việt Nam.<br/> <br/> Hàm ZwQuerySystemInformation:<br/> <br/> Bình thường, khi chưa bị hook:<br/> -------------------------<br/> 77F76152 &gt; B8 AD000000      MOV EAX,0AD<br/> 77F76157   BA 0003FE7F      MOV EDX,7FFE0300<br/> 77F7615C   FFD2             CALL EDX<br/> 77F7615E   C2 1000          RETN 10<br/> -------------------------<br/> <br/> Sau khi bị hook:<br/> -------------------------<br/> 77F76152 &gt;-FF25 1E00115F    JMP DWORD PTR DS:[5F11001E]<br/> 77F76158   0003             ADD BYTE PTR DS:[EBX],AL<br/> 77F7615A   FE               ???                                      ; Unknown command<br/> 77F7615B   7F FF            JG SHORT ntdll.77F7615C<br/> 77F7615D   D2C2             ROL DL,CL<br/> 77F7615F   1000             ADC BYTE PTR DS:[EAX],AL<br/> 77F76161 &gt; B8 AE000000      MOV EAX,0AE<br/> 77F76166   BA 0003FE7F      MOV EDX,7FFE0300<br/> 77F7616B   FFD2             CALL EDX<br/> 77F7616D   C2 0400          RETN 4<br/> -------------------------<br/> <br/> Ta thấy rằng địa chỉ API NtQuerySystemInformation vẫn là 77F76152, xong đoạn code <br/> ở entry point đã được thay bằng 1 đoạn code khác, còn đoạn code thật thì đã được <br/> đẩy xuống 77F76161.<br/> <br/> Để phát hiện ra API này có bị hook hay không, chỉ cần một đoạn code nho nhỏ sau:<br/> <br/> -------------------------<br/> 	call	_next1<br/> 	db	'ntdll',0<br/> _next1:<br/> 	call	LoadLibrary<br/> <br/> 	call	_next2<br/> 	db	'NtQuerySystemInformation',0<br/> _next2:<br/> 	push	eax<br/> 	call	GetProcAddress<br/> 	mov	esi,eax<br/> <br/> 	lodsb<br/> 	cmp	al,0B8h<br/> 	jnz	__we_are_hooked__	; ta có thể kiểm tra thêm, với số byte dài hơn<br/> -------------------------<br/> <br/> Như vậy, có thể thấy rõ ràng hạn chế của hooking API trong user-mode. Ta có thể khắc phục<br/> bằng nhiều biện pháp, nhưng sẽ không bao giờ hoàn toàn che giấu kín kẽ được. Do đó, đòi<br/> hỏi ta cần phải đào sâu hơn nữa vào bên trong hệ điều hành. <br/> <br/> ------| 2.2 Hooking kernel-mode Native API <br/> <br/> Hầu hết các API được sử dụng trong user-mode thực ra đều chỉ là đầu cuối của các API <br/> nằm trong lõi của Windows, được gọi là Native API. Vd: trong user-mode, hàm VirtualAlloc<br/> sẽ gọi hàm VirtualAllocEx; hàm VirtualAllocEx sẽ gọi hàm NtAllocateVirtualMemory trong <br/> ntdll.dll; từ ntdll, Windows sẽ thực thi 2 opcode đặc biệt là sysenter và syscall để chuyển<br/> từ ring3 (user-mode) sang ring0 (kernel-mode), và thực thi phần chính của công việc trong<br/> ntoskrnl.exe - lõi thực sự của Windows NT. <br/> <br/> ------| 2.2.1 How to hook ?<br/> <br/> Các service (hay các kernel-mode API hoặc Native API) hầu hết nằm trong ntoskrnl.exe. Nếu<br/> chúng ta hooking tại đây, các user-mode application sẽ khó nhận biết được sự hooking này, <br/> do code trong user-mode không được phép access tới address dành cho kernel.<br/> <br/> Hooking trong kernel-mode cũng tương tự như trong user-mode, cũng là thay đổi địa chỉ của API<br/> thật bằng hàm của chúng ta. Hãy tìm hiểu một chút về cách hooking trong kernel-mode. <br/> <br/> Các địa chỉ của các Native API được giữ trong một bảng được gọi là SERVICE_DESCRIPTOR_TABLE<br/> <br/> typedef struct _SERVICE_DESCRIPTOR_TABLE<br/> <br/> {	SYSTEM_SERVICE_TABLE	ntoskrnl;<br/> 	SYSTEM_SERVICE_TABLE	win32k;<br/> 	SYSTEM_SERVICE_TABLE	Reserved1;<br/> 	SYSTEM_SERVICE_TABLE	Reserved2;<br/> }<br/> 	SERVICE_DESCRIPTOR_TABLE,<br/> 	*PSERVICE_DESCRIPTOR_TABLE,<br/> 	**PPSERVICE_DESCRIPTOR_TABLE;<br/> <br/> với SYSTEM_SERVICE_TABLE được định nghĩa như sau: <br/> <br/> typedef struct _SYSTEM_SERVICE_TABLE{<br/> 	DWORD	pServiceTable;<br/> 	DWORD	pCounterTable; <br/> 	DWORD	ServiceLimit;<br/> 	DWORD	pArgumentTable;<br/> }<br/> 	SYSTEM_SERVICE_TABLE,<br/> 	*PSYSTEM_SERVICE_TABLE,<br/> 	**PPSYSTEM_SERVICE_TABLE;<br/> <br/> ntoskrnl.exe có export 1 biến gọi là KeServiceDescriptorTable, là con trỏ kiểu <br/> PSERVICE_DESCRIPTOR_TABLE. Và (SYSTEM_SERVICE_TABLE)ntoskrnl.pServiceTable trỏ tới một table<br/> chứa địa chỉ các Native API. Chúng ta chỉ việc thay địa chỉ nói trên bằng địa chỉ function<br/> của chúng ta là xong. <br/> <br/> Let's see:<br/> -------------------------<br/> lkd&gt; dd KeServiceDescriptorTable L 4<br/> 8054aec0  80502588 00000000 0000011c 80502ba4<br/> -------------------------<br/> -&gt; ntoskrnl.pServiceTable = 80502588<br/> <br/> <br/> -------------------------<br/> lkd&gt; dd 80502588<br/> 80502588  805953aa 8057dcb7 8057bb65 805c0cdb<br/> 80502598  80573c7a 8061737e 806194ee 8061952b<br/> 805025a8  8056ae3b 80625e4e 80616e7a 8057aedb<br/> 805025b8  80610e61 8057bec6 80575ecf 8060a667<br/> 805025c8  8057bc7e 8058e58d 805600fc 8055204e<br/> 805025d8  8050fa11 8060e649 80565a55 804e906f<br/> 805025e8  80579402 80581355 8057bb30 8062a9ed<br/> 805025f8  8061a04f 8059589c 8062ac19 8057418c<br/> -------------------------<br/> <br/> Ta đã biết NtQuerySystemInformation có ID là 0xAD (xem vd về OllyInvisible). <br/> Hãy thử tìm địa chỉ của API này xem sao. <br/> Có thể đoán được bằng cách: Địa chỉ API = ID * 4 + ntoskrnl.pServiceTable<br/> <br/> -------------------------<br/> lkd&gt; dd 80502588+0xAD*4 L 4<br/> 8050283c  8058b1f4 8057469f 8057842e 8056af87<br/> lkd&gt; ln 8058b1f4<br/> (8058b1f4)   nt!NtQuerySystemInformation   |  (8058b2ea)   nt!MiCheckForConflictingNode<br/> Exact matches:<br/>     nt!NtQuerySystemInformation = &lt;no type information&gt;<br/> -------------------------<br/> <br/> Tất cả những gì cần làm là viết 1 driver (file *.sys - thực chất cũng là file PE được chạy <br/> trong kernel mode) để thay thế giá trị tại offset 0x8050283c bằng địa chỉ API của chúng ta. <br/> Quá đơn giản, phải không?<br/> <br/> ------| 2.2.2 Hạn chế<br/> <br/> Tương tự như hooking trong user-mode, hooking trong kernel-mode cũng có hạn chế của nó. Thứ <br/> nhất là phải là Administrator, bạn mới có thể load được driver để hook các Native API. Thứ <br/> hai, để phát hiện ra Native API có bị hook hay không, vẫn có thể viết 1 driver riêng, kiểm <br/> tra ntoskrnl.pServiceTable, tìm địa chỉ API rồi so sánh checksum hoặc những byte đầu tiên<br/> với API đã biết, việc hooking này cũng không hề giảm bớt hạn chế của user-mode, có chăng chỉ <br/> là phải có quyền thực thi code trong ring0 mà thôi. <br/> <br/> ------| 2.3 Khái quát<br/> <br/> Còn một số phương pháp hooking khác ngoài những phương pháp trên, song do thời gian <br/> và mục đich của bài viết này không nhằm giới thiệu các phương pháp hooking, nên Thug <br/> sẽ không đề cập tới. <br/> <br/> Qua các phương pháp trên, một điểm dễ nhận thấy là việc phát hiện hooking rất dễ dàng và nói<br/> chung là không được thầm lặng cho lắm <img src="/hvaonline/images/smilies/575eda61e93c7ad9d05928580213fd9b.gif" border="0" alt="smilie" align="absbottom"> Vậy, chúng ta phải hook một số thứ khác, chứ không chỉ<br/> là các API. Điều này lại đòi hỏi ta phải đi sâu hơn vào trong lõi và cơ chế của Windows.<br/> <br/> ----| 3.  Hidding process mà không cần hooking API <br/> <br/> Đây là phần chính của bài viết này. Trước khi trình bày phương pháp của mình, Thug sẽ giới thiệu<br/> khái niệm, cũng như một số kiến thức để hiểu rõ và nắm bắt đúng những gì Thug sẽ trình bày phía <br/> sau. <br/> <br/> Lưu ý: phương pháp của Thug sẽ trình bày sẽ chỉ áp dụng được trong kernel-mode. Gonna make shit <br/> tight, mothafuckaz!<br/> <br/> ------| 3.1 Windows Objects <br/> <br/> Theo quyển "Microsoft Windows Internals(Fourth Edition)", các thành phần của Windows ở<br/> kernel-mode đều được thiết kế hướng đối tượng - object-oriented. Mọi thành phần trong kernel<br/> đều là các object, chúng không tác động hoặc access lên cấu trúc dữ liệu khác mà chỉ truyền tham<br/> số cho nhau qua các giao thức thông thường. Việc thiết kế này nhằm đảm bảo tính cố định, và <br/> an toàn cho rất nhiều các service nằm phía trong kernel của Windows.<br/> <br/> Trong Windows XP và 2003, có 29 loại object khác nhau (Win2000 có 27 loại):<br/> <br/>    [+] Adapter       <br/>    [+] Callback      <br/>    [+] Controler     <br/>    [+] Desktop       <br/>    [+] Device        <br/>    [+] Directory     <br/>    [+] Driver        <br/>    [+] Event         <br/>    [+] EventPair     <br/> <br/>    [+] File             [+] Semaphore<br/>    [+] IoCompletion     [+] SymbolicLink<br/>    [+] Job              [+] Thread<br/>    [+] Key              [+] Timer<br/>    [+] Mutant           [+] Token<br/>    [+] Port             [+] Type<br/>    [+] Process          [+] WaitablePort<br/>    [+] Profile          [+] WindowStation<br/>    [+] Section          [+] WmiGuid<br/> <br/> <br/> Các Object nói trên được xếp thành các thư mục khác nhau như cách tổ chức thư mục thường thấy <br/> trong Windows. <br/> <br/> ------| 3.1.1 Cấu trúc của Object <br/> <br/> Một Object bao gồm 2 phần: object header và object body. <br/> Object header được định nghĩa như sau: <br/> <br/> -------------------------<br/> lkd&gt; dt _OBJECT_HEADER<br/>    +0x000 PointerCount     : Int4B<br/>    +0x004 HandleCount      : Int4B<br/>    +0x004 NextToFree       : Ptr32 Void<br/>    +0x008 Type             : Ptr32 _OBJECT_TYPE<br/>    +0x00c NameInfoOffset   : UChar<br/>    +0x00d HandleInfoOffset : UChar<br/>    +0x00e QuotaInfoOffset  : UChar<br/>    +0x00f Flags            : UChar<br/>    +0x010 ObjectCreateInfo : Ptr32 _OBJECT_CREATE_INFORMATION<br/>    +0x010 QuotaBlockCharged : Ptr32 Void<br/>    +0x014 SecurityDescriptor : Ptr32 Void<br/>    +0x018 Body             : _QUAD<br/> -------------------------<br/> <br/> Để hiểu các thành phần, xin đọc [1]. <br/> <br/> Mỗi object có 1 object body có cấu trúc và nội dung tuỳ thuộc vào kiểu object; tất cả những<br/> object cùng một kiểu có chung một cấu trúc. Bằng cách tạo ra các kiểu object khác nhau và <br/> các service cho chúng, kernel có thể điều khiển việc truy cập/thay đổi dữ liệu trong tất<br/> cả những object body của cùng 1 loại object đó. <br/> <br/> ------| 3.2 LIST_ENTRY và double-linked list<br/> <br/> Một cấu trúc được sử dụng hầu hết trong tất cả các object của Windows, đó là cấu trúc LIST_ENTRY.<br/> Windows sử dụng cấu trúc này để tạo danh sách liên kết khép kín - double linked list. Trong <br/> Windows, một object không chỉ là thành phần của 1 danh sách liên kết, mà là 1 phần của rất rất<br/> nhiều các danh sách liên kết khác nhau được tạo bởi nhiều cấu trúc LIST_ENTRY nhúng trong cấu <br/> trúc của 1 object (chúng ta sẽ thấy rõ điều này ở phần sau khi xem xét process object). <br/> LIST_ENTRY được định nghĩa như sau: (theo Windows DDK - Windows Driver Development Kit):<br/> <br/> <br/> typedef struct _LIST_ENTRY {<br/>   struct _LIST_ENTRY *Flink;<br/>   struct _LIST_ENTRY *Blink;<br/> } LIST_ENTRY, *PLIST_ENTRY;<br/> <br/> <br/> Trong đó, Flink là viết tắt của "Forward link", là con trỏ trỏ tới cấu trúc tiếp theo, còn Blink<br/> là "Backward link" trỏ tới cấu trúc phía trước. 2 thành phần này luôn trỏ tới 1 cấu trúc <br/> LIST_ENTRY khác chứ không phải trỏ tới object. Thông thường, danh sách kết nối này là danh sách<br/> khép kín, nghĩa là Flink trỏ tới cấu trúc LIST_ENTRY đầu tiên trong danh sách, còn Blink lại chỉ<br/> tới cấu trúc LIST_ENTRY cuối cùng của danh sách. Hiển nhiên, nếu 1 danh sách chỉ có 1 cấu trúc<br/> LIST_ENTRY, thì cả Flink và Blink phải chỉ tới chính cấu trúc LIST_ENTRY đó. <br/> <br/> Hình 1. Danh sách liên kết khép kín dựa vào cấu trúc LIST_ENTRY của các object<br/> <br/> Image link: www.vnbiocoderz.com/thug/pix/ill/fig1.JPG<br/> <br/> ------| 3.3 Process Object<br/> <br/> Như đã nói ở trên, Windows coi tất cả đều là Object và phân loại chúng vào các thư mục khác nhau.<br/> Process cũng vậy, nó là một object, bao gồm một object header và object body. Chúng ta không quan<br/> tâm tới phần header mà chỉ quan tâm tới phần body của object này. Cấu trúc phần body của process <br/> object như sau: (trên nền Windows XP SP1). Cấu trúc này gọi là EPROCESS.<br/> <br/>    +0x000 Pcb              : _KPROCESS<br/>    +0x06c ProcessLock      : _EX_PUSH_LOCK<br/>    +0x070 CreateTime       : _LARGE_INTEGER<br/>    +0x078 ExitTime         : _LARGE_INTEGER<br/>    +0x080 RundownProtect   : _EX_RUNDOWN_REF<br/>    +0x084 UniqueProcessId  : Ptr32 Void<br/>    +0x088 ActiveProcessLinks : _LIST_ENTRY<br/>    +0x090 QuotaUsage       : [3] Uint4B<br/>    +0x09c QuotaPeak        : [3] Uint4B<br/>    +0x0a8 CommitCharge     : Uint4B<br/>    +0x0ac PeakVirtualSize  : Uint4B<br/>    +0x0b0 VirtualSize      : Uint4B<br/>    +0x0b4 SessionProcessLinks : _LIST_ENTRY<br/>    +0x0bc DebugPort        : Ptr32 Void<br/>    +0x0c0 ExceptionPort    : Ptr32 Void<br/>    +0x0c4 ObjectTable      : Ptr32 _HANDLE_TABLE<br/>    +0x0c8 Token            : _EX_FAST_REF<br/>    +0x0cc WorkingSetLock   : _FAST_MUTEX<br/>    +0x0ec WorkingSetPage   : Uint4B<br/>    +0x0f0 AddressCreationLock : _FAST_MUTEX<br/>    +0x110 HyperSpaceLock   : Uint4B<br/>    +0x114 ForkInProgress   : Ptr32 _ETHREAD<br/>    +0x118 HardwareTrigger  : Uint4B<br/>    +0x11c VadRoot          : Ptr32 Void<br/>    +0x120 VadHint          : Ptr32 Void<br/>    +0x124 CloneRoot        : Ptr32 Void<br/>    +0x128 NumberOfPrivatePages : Uint4B<br/>    +0x12c NumberOfLockedPages : Uint4B<br/>    +0x130 Win32Process     : Ptr32 Void<br/>    +0x134 Job              : Ptr32 _EJOB<br/>    +0x138 SectionObject    : Ptr32 Void<br/>    +0x13c SectionBaseAddress : Ptr32 Void<br/>    +0x140 QuotaBlock       : Ptr32 _EPROCESS_QUOTA_BLOCK<br/>    +0x144 WorkingSetWatch  : Ptr32 _PAGEFAULT_HISTORY<br/>    +0x148 Win32WindowStation : Ptr32 Void<br/>    +0x14c InheritedFromUniqueProcessId : Ptr32 Void<br/>    +0x150 LdtInformation   : Ptr32 Void<br/>    +0x154 VadFreeHint      : Ptr32 Void<br/>    +0x158 VdmObjects       : Ptr32 Void<br/>    +0x15c DeviceMap        : Ptr32 Void<br/>    +0x160 PhysicalVadList  : _LIST_ENTRY<br/>    +0x168 PageDirectoryPte : _HARDWARE_PTE<br/>    +0x168 Filler           : Uint8B<br/>    +0x170 Session          : Ptr32 Void<br/>    +0x174 ImageFileName    : [16] UChar<br/>    +0x184 JobLinks         : _LIST_ENTRY<br/>    +0x18c LockedPagesList  : Ptr32 Void<br/>    +0x190 ThreadListHead   : _LIST_ENTRY<br/>    +0x198 SecurityPort     : Ptr32 Void<br/>    +0x19c PaeTop           : Ptr32 Void<br/>    +0x1a0 ActiveThreads    : Uint4B<br/>    +0x1a4 GrantedAccess    : Uint4B<br/>    +0x1a8 DefaultHardErrorProcessing : Uint4B<br/>    +0x1ac LastThreadExitStatus : Int4B<br/>    +0x1b0 Peb              : Ptr32 _PEB<br/>    +0x1b4 PrefetchTrace    : _EX_FAST_REF<br/>    +0x1b8 ReadOperationCount : _LARGE_INTEGER<br/>    +0x1c0 WriteOperationCount : _LARGE_INTEGER<br/>    +0x1c8 OtherOperationCount : _LARGE_INTEGER<br/>    +0x1d0 ReadTransferCount : _LARGE_INTEGER<br/>    +0x1d8 WriteTransferCount : _LARGE_INTEGER<br/>    +0x1e0 OtherTransferCount : _LARGE_INTEGER<br/>    +0x1e8 CommitChargeLimit : Uint4B<br/>    +0x1ec CommitChargePeak : Uint4B<br/>    +0x1f0 AweInfo          : Ptr32 Void<br/>    +0x1f4 SeAuditProcessCreationInfo : _SE_AUDIT_PROCESS_CREATION_INFO<br/>    +0x1f8 Vm               : _MMSUPPORT<br/>    +0x238 LastFaultCount   : Uint4B<br/>    +0x23c ModifiedPageCount : Uint4B<br/>    +0x240 NumberOfVads     : Uint4B<br/>    +0x244 JobStatus        : Uint4B<br/>    +0x248 Flags            : Uint4B<br/>    +0x248 CreateReported   : Pos 0, 1 Bit<br/>    +0x248 NoDebugInherit   : Pos 1, 1 Bit<br/>    +0x248 ProcessExiting   : Pos 2, 1 Bit<br/>    +0x248 ProcessDelete    : Pos 3, 1 Bit<br/>    +0x248 Wow64SplitPages  : Pos 4, 1 Bit<br/>    +0x248 VmDeleted        : Pos 5, 1 Bit<br/>    +0x248 OutswapEnabled   : Pos 6, 1 Bit<br/>    +0x248 Outswapped       : Pos 7, 1 Bit<br/>    +0x248 ForkFailed       : Pos 8, 1 Bit<br/>    +0x248 HasPhysicalVad   : Pos 9, 1 Bit<br/>    +0x248 AddressSpaceInitialized : Pos 10, 2 Bits<br/>    +0x248 SetTimerResolution : Pos 12, 1 Bit<br/>    +0x248 BreakOnTermination : Pos 13, 1 Bit<br/>    +0x248 SessionCreationUnderway : Pos 14, 1 Bit<br/>    +0x248 WriteWatch       : Pos 15, 1 Bit<br/>    +0x248 ProcessInSession : Pos 16, 1 Bit<br/>    +0x248 OverrideAddressSpace : Pos 17, 1 Bit<br/>    +0x248 HasAddressSpace  : Pos 18, 1 Bit<br/>    +0x248 LaunchPrefetched : Pos 19, 1 Bit<br/>    +0x248 InjectInpageErrors : Pos 20, 1 Bit<br/>    +0x248 Unused           : Pos 21, 11 Bits<br/>    +0x24c ExitStatus       : Int4B<br/>    +0x250 NextPageColor    : Uint2B<br/>    +0x252 SubSystemMinorVersion : UChar<br/>    +0x253 SubSystemMajorVersion : UChar<br/>    +0x252 SubSystemVersion : Uint2B<br/>    +0x254 PriorityClass    : UChar<br/>    +0x255 WorkingSetAcquiredUnsafe : UChar<br/> <br/> Trong process object body, có các thành phần sau là kiểu LIST_ENTRY:<br/> <br/>    +0x088 ActiveProcessLinks : _LIST_ENTRY<br/>    +0x0b4 SessionProcessLinks : _LIST_ENTRY<br/>    +0x160 PhysicalVadList  : _LIST_ENTRY<br/>    +0x184 JobLinks         : _LIST_ENTRY<br/>    +0x190 ThreadListHead   : _LIST_ENTRY<br/> <br/> Chúng ta quan tâm tới các thành phần sau: <br/> <br/>    +0x084 UniqueProcessId  : Ptr32 Void<br/>    +0x088 ActiveProcessLinks : _LIST_ENTRY<br/>    +0x174 ImageFileName    : [16] UChar<br/> <br/> <br/> <br/> Tại sao lại quan tâm tới các thành phần này ? Đơn giản, UniqeProcessId là id của process, <br/> là 1 số duy nhất được Windows cấp cho mỗi process. Nó có thể 1 phần nào đó đại diện cho sự <br/> xuất hiện của 1 process thay cho tên của process đó. ImageFileName là tên của process, vd <br/> như System hoặc svchost.exe. <br/> <br/> Quan trọng ở đây là thành phần ActiveProcessLinks <img src="/hvaonline/images/smilies/b5e9b4f86ce43ca65bd79c894c4a924c.gif" border="0" alt="smilie" align="absbottom"> Đây là 1 cấu trúc LIST_ENTRY (Flink & Blink)<br/> tạo thành 1 danh sách liên kết khép kín của các process object. Nghĩa là gì? Nghĩa là từ process<br/> của chúng ta, chúng ta có thể biết địa chỉ của các process object khác. Điều này có ý nghĩa đặc <br/> biệt quan trọng, và là điều cốt yếu trong phương pháp "Hidding process không cần hooking API".<br/> <br/> ------| 3.4 Hidding process không cần hooking API<br/> <br/> ------| 3.4.1 Exploring wit PsActiveProcessHead and PsinitialSystemProcess<br/> <br/> Trước khi trình bày phương pháp này, Thug sẽ thực hiện vài động tác khởi động để người đọc có thể<br/> hiểu rõ hơn <img src="/hvaonline/images/smilies/575eda61e93c7ad9d05928580213fd9b.gif" border="0" alt="smilie" align="absbottom"><br/> <br/> Chúng ta biết ActiveProcessLinks là một cấu trúc LIST_ENTRY, nằm trong danh sách liên kết khép<br/> kín gồm các cấu trúc này. Vậy đâu là cấu trúc LIST_ENTRY đầu tiên trong danh sách? Good question.<br/> Kernel của Windows NT là ntoskrnl.exe có một biến gọi là PsActiveProcessHead chứa địa chỉ của <br/> cấu trúc LIST_ENTRY đầu tiên. Tuy nhiên, biến này không được export. Nhưng biến PsinitialSystemProcess<br/> lại được export <img src="/hvaonline/images/smilies/b5e9b4f86ce43ca65bd79c894c4a924c.gif" border="0" alt="smilie" align="absbottom"> Đây là biến trỏ tới cấu trúc EPROCESS hay phần body của process object của <br/> process System. Từ Blink của nó, ta tới được PsActiveProcessHead. <br/> <br/> Đó là lý thuyết, thực hành một chút xem sao: <br/> ----------------------------------------------------------------------------------<br/> lkd&gt; dd PsinitialSystemProcess L 4<br/> 8054df74  81bce838 81bcee70 81bceca0 e10018b0<br/> ----------------------------------------------------------------------------------<br/> -&gt; Process object này có địa chỉ 81bce838. Thử xem có đúng là process System hay không..<br/> <br/> ----------------------------------------------------------------------------------<br/> lkd&gt; db 81bce838 + 0x174 L 8<br/> 81bce9ac  53 79 73 74 65 6d 00 00                          System..<br/> ----------------------------------------------------------------------------------<br/> -&gt; Yeah, đây đúng là process System. 0x174 là relative offset của ImageFileName, remember eh ?<br/> Xem thử xem cấu trúc LIST_ENTRY của nó nào...<br/> <br/> ----------------------------------------------------------------------------------<br/> lkd&gt; dd 81bce838 + 0x88 L 4<br/> 81bce8c0  81a853d0 8054de78 00000000 00000000<br/> ----------------------------------------------------------------------------------<br/> -&gt; Flink = 81a853d0 là địa chỉ thành phần Flink của process object tiếp theo, còn Blink = 8054de78<br/> chính là địa chỉ của PsActiveProcessHead. Kiểm tra xem có đúng không nào ?<br/> <br/> ----------------------------------------------------------------------------------<br/> lkd&gt; ln 8054de78<br/> (8054de78)   nt!PsActiveProcessHead   |  (8054de80)   nt!PspActiveProcessMutex<br/> Exact matches:<br/>     nt!PsActiveProcessHead = &lt;no type information&gt;<br/> ----------------------------------------------------------------------------------<br/> -&gt; Chính xác <img src="/hvaonline/images/smilies/b5e9b4f86ce43ca65bd79c894c4a924c.gif" border="0" alt="smilie" align="absbottom"><br/> <br/> Hãy thử nghiệm một chút về lý thuyết: <br/> <br/> ----------------------------------------------------------------------------------<br/> lkd&gt; dd 8054de78 L 2<br/> 8054de78  81bce8c0 81732bb8<br/> <br/> lkd&gt; dd 81bce8c0 L 2<br/> 81bce8c0  81a410a8 8054de78<br/> <br/> lkd&gt; dd 81a410a8 L 2<br/> 81a410a8  81acf0a8 81bce8c0<br/> <br/> lkd&gt; db 81a410a8 - 0x88 + 0x174 L 20<br/> 81a41194  53 4d 53 53 2e 45 58 45-00 00 00 00 00 00 00 00  SMSS.EXE........<br/> 81a411a4  00 00 00 00 00 00 00 00-00 00 00 00 74 15 a4 81  ............t...<br/> <br/> lkd&gt; dd 81a410a8 - 0x88 + 0x84 L 1<br/> 81a410a4  00000160<br/> ----------------------------------------------------------------------------------<br/> <br/> Ta theo Flink đi qua 2 process object để tới process object thứ 3. Process object này<br/> có Flink tại địa chỉ 81a410a8, cách offset đầu tiên của cấu trúc EPROCESS là 0x88, <br/> và offset của ImageFileName cách offset đầu tiên của cấu trúc EPROCESS là 0x174. <br/> Cho nên offset của ImageFileName là : 81a410a8 - 0x88 + 0x174, từ đó ta có process<br/> name là SMSS.EXE. <br/> Tương tự, ProcessID của process SMSS.EXE này là 0x00000160. Simple, isnt it ?<br/> <br/> Ta cũng có thể lấy địa chỉ của process object body (EPROCESS) của process hiện tại<br/> bằng hàm PsGetCurrentProcess, rồi từ đó lấy địa chỉ của LIST_ENTRY của process hiện<br/> tại trong danh sách ActiveProcessLists.<br/> <br/> 	PEPROCESS <br/>   		PsGetCurrentProcess(<br/> 	);<br/> <br/> Hàm này trả về giá trị là con trỏ tới process object body của process hiện tại.<br/> <br/> <br/> ------| 3.4.2 Hidding process - không cần hooking bất kỳ API nào.<br/> <br/> Đến đây, chắc các bạn cũng đoán ra phương pháp hidding process của Thug. Ý tưởng rất<br/> đơn giản, chúng ta thay đổi, hoặc, có thể coi là xoá đi 1 cấu trúc LIST_ENTRY đại diện<br/> cho process mà chúng ta cần giấu đi trong danh sách ActiveProcessLists. <br/> Chỉ còn một điều, liệu phương pháp này có hiệu quả hay không? Câu trả lời là có. Vì <br/> tất cả các hàm trong kernel liên quan tới process object đều tin tưởng vào danh sách <br/> này để liệt kê hoặc làm những việc khác liên quan tới process object. <br/> <br/> Lấy vd như hàm thông dụng nhất trong việc liệt kê danh sách các active process là hàm<br/> NtQuerySystemInformation với SystemInformationClass là SystemProcessesAnđThreadsInformation.<br/> <br/> Let's disassembly this function. Dùng IDA, ta có thể thấy rằng, NtQuerySystemInformation<br/> gọi hàm SeLocateProcessImageName để xác định ImageName của một process. IDA says: <br/> <br/> <br/> PAGE:00493779 _SeLocateProcessImageName@8 proc near   ; CODE XREF: ExpGetProcessInformation(x,x,x,x,x)+D9p<br/> PAGE:00493779                                         ; NtQueryInformationProcess(x,x,x,x,x)+3FA12p ...<br/> PAGE:00493779<br/> PAGE:00493779 var_C           = dword ptr -0Ch<br/> PAGE:00493779 var_8           = dword ptr -8<br/> PAGE:00493779 var_4           = dword ptr -4<br/> PAGE:00493779 EPROCESS        = dword ptr  8<br/> PAGE:00493779 pOutputName     = dword ptr  0Ch<br/> PAGE:00493779<br/> PAGE:00493779 ; FUNCTION CHUNK AT PAGE:00493E60 SIZE 0000006B BYTES<br/> PAGE:00493779 ; FUNCTION CHUNK AT PAGE:00517CEF SIZE 0000000C BYTES<br/> PAGE:00493779<br/> PAGE:00493779                 push    ebp<br/> PAGE:0049377A                 mov     ebp, esp<br/> PAGE:0049377C                 sub     esp, 0Ch<br/> PAGE:0049377F                 mov     eax, [ebp+pOutputName]<br/> PAGE:00493782                 push    ebx<br/> PAGE:00493783                 xor     ebx, ebx        ; ebx = 0<br/> PAGE:00493785                 mov     [eax], ebx      ; *(ULONG)pOutputName = 0<br/> PAGE:00493787                 mov     eax, [ebp+EPROCESS] ; eax = EPROCESS<br/> PAGE:0049378A                 push    esi             ; esi = EPROCESS, store it on stack<br/> PAGE:0049378B                 lea     esi, [eax+1F4h] ; esi -&gt; SeAuditProcessCreationInfo<br/> PAGE:00493791                 cmp     [esi], ebx      ; This ptr == 0 ??<br/> PAGE:00493793                 push    edi<br/> PAGE:00493794                 mov     [ebp+var_8], ebx<br/> PAGE:00493797                 mov     [ebp+var_4], ebx<br/> PAGE:0049379A                 mov     [ebp+var_C], ebx<br/> PAGE:0049379D                 jz      loc_493E60<br/> PAGE:004937A3<br/> PAGE:004937A3 loc_4937A3:                             ; CODE XREF: SeLocateProcessImageName(x,x)+741j<br/> PAGE:004937A3                 mov     eax, [esi]      ; eax -&gt; Ptr32 _OBJECT_NAME_INFORMATION, which<br/> PAGE:004937A3                                         ; is a UNICODE_STRING<br/> PAGE:004937A5                 movzx   edi, word ptr [eax+2] ; edi = MaxLength of this wide char array<br/> PAGE:004937A9                 push    61506553h       ; Tag<br/> PAGE:004937AE                 add     edi, 8<br/> PAGE:004937B1                 push    edi             ; NumberOfBytes<br/> PAGE:004937B2                 push    ebx             ; PoolType<br/> PAGE:004937B3                 call    _ExAllocatePoolWithTag@12 ; ExAllocatePoolWithTag(x,x,x)<br/> PAGE:004937B8                 cmp     eax, ebx        ; if successful, eax -&gt; new alloc8ed pool<br/> PAGE:004937BA                 jz      loc_493EBF<br/> PAGE:004937C0                 mov     esi, [esi]      ; esi = ptr to (UNICODE_STRING)ImageName<br/> PAGE:004937C2                 mov     ecx, edi        ; ecx = MaxLength + 8<br/> PAGE:004937C4                 mov     edx, ecx<br/> PAGE:004937C6                 shr     ecx, 2          ; ecx = ecx / 4<br/> PAGE:004937C9                 mov     edi, eax        ; edi = dest<br/> PAGE:004937CB                 rep movsd<br/> PAGE:004937CD                 mov     ecx, edx<br/> PAGE:004937CF                 and     ecx, 3<br/> PAGE:004937D2                 rep movsb<br/> PAGE:004937D4                 lea     ecx, [eax+8]<br/> PAGE:004937D7                 mov     [eax+4], ecx<br/> PAGE:004937DA                 mov     ecx, [ebp+pOutputName]<br/> PAGE:004937DD                 mov     [ecx], eax      ; return the pointer to (UNICODE_STRING)ImageName<br/> PAGE:004937DF<br/> PAGE:004937DF loc_4937DF:                             ; CODE XREF: SeLocateProcessImageName(x,x)+6F6j<br/> PAGE:004937DF                                         ; SeLocateProcessImageName(x,x)+73Bj ...<br/> PAGE:004937DF                 mov     eax, [ebp+var_8]<br/> PAGE:004937E2                 pop     edi<br/> PAGE:004937E3                 pop     esi<br/> PAGE:004937E4                 pop     ebx<br/> PAGE:004937E5                 leave<br/> PAGE:004937E6                 retn    8<br/> PAGE:004937E6 _SeLocateProcessImageName@8 endp<br/> <br/> (Còn một fần code nữa phía dưới nhưng cũng không quan trọng, Thug chỉ post những công việc<br/> chính mà funtion này làm).<br/> Thug đã cho comment vào phần code nói trên, nên sẽ không giải thích dài dòng gì nữa. Những gì <br/> function này thực hiện cũng có thể bắt chước như sau: <br/> <br/> 1. Đầu tiên, theo Flink từ PsActiveProcessHead, ta có 1 giá trị Flink như sau: 81ad3c78<br/> ----------------------------------------------------------------------------------<br/> lkd&gt; dd 81abee30<br/> 81abee30  81ad3c78 81a49e30 00001bb0 00006030<br/> 81abee40  0000013b 00001dd0 00006988 0000014c<br/> .........<br/> ----------------------------------------------------------------------------------<br/> <br/> 2. Kiểm tra ImageFileName <br/> <br/> ----------------------------------------------------------------------------------<br/> lkd&gt; db 81ad3c78-0x88+0x174<br/> 81ad3d64  6c 73 61 73 73 2e 65 78-65 00 00 00 00 00 00 00  lsass.exe.......<br/> ........<br/> ----------------------------------------------------------------------------------<br/> <br/> 3. Kiểm tra SeAuditProcessCreationInfo ở offset 0x1f4 relative với EPROCESS.<br/> SeAuditProcessCreationInfo là một biến kiểu _SE_AUDIT_PROCESS_CREATION_INFO. <br/> Kiểu _SE_AUDIT_PROCESS_CREATION_INFO được định nghĩa:<br/> <br/> ----------------------------------------------------------------------------------<br/> lkd&gt; dt _SE_AUDIT_PROCESS_CREATION_INFO<br/>    +0x000 ImageFileName    : Ptr32 _OBJECT_NAME_INFORMATION<br/> ----------------------------------------------------------------------------------<br/> -&gt; thực chất là con trỏ trỏ tới kiểu _OBJECT_NAME_INFORMATION, được định nghĩa<br/> như sau: <br/> <br/> ----------------------------------------------------------------------------------<br/> lkd&gt; dt _OBJECT_NAME_INFORMATION<br/>    +0x000 Name             : _UNICODE_STRING<br/> ----------------------------------------------------------------------------------<br/> <br/> Ah hah, vậy SeAuditProcessCreationInfo thực chất là con trỏ trỏ tới UNICODE_STRING.<br/> <br/> Vậy SeAuditProcessCreationInfo có giá trị là bao nhiêu??<br/> ----------------------------------------------------------------------------------<br/> lkd&gt; dd 81ad3c78-0x88+0x1f4 L 1<br/> 81ad3de4  81b15e20<br/> <br/> lkd&gt; dd 81b15e20<br/> 81b15e20  00660064 81b15e28 0044005c 00760065<br/> ........<br/> ----------------------------------------------------------------------------------<br/> -&gt; UNICODE_STRING: <br/> 	+ Length (in bytes) = 0x0066<br/> 	+ MaxLength 	    = 0x0064<br/> 	+ PWSTR		    = 81b15e28<br/> <br/> ----------------------------------------------------------------------------------<br/> lkd&gt; db 81b15e28<br/> 81b15e28  5c 00 44 00 65 00 76 00-69 00 63 00 65 00 5c 00  \.D.e.v.i.c.e.\.<br/> 81b15e38  48 00 61 00 72 00 64 00-64 00 69 00 73 00 6b 00  H.a.r.d.d.i.s.k.<br/> 81b15e48  56 00 6f 00 6c 00 75 00-6d 00 65 00 32 00 5c 00  V.o.l.u.m.e.2.\.<br/> 81b15e58  57 00 49 00 4e 00 44 00-4f 00 57 00 53 00 5c 00  W.I.N.D.O.W.S.\.<br/> 81b15e68  53 00 79 00 73 00 74 00-65 00 6d 00 33 00 32 00  S.y.s.t.e.m.3.2.<br/> 81b15e78  5c 00 6c 00 73 00 61 00-73 00 73 00 2e 00 65 00  \.l.s.a.s.s...e.<br/> .....<br/> ----------------------------------------------------------------------------------<br/> <br/> See? We got it!<br/> Như vậy, NtQuerySystemInformation với SystemInformationClass là 5 đã gọi hàm <br/> SeLocateProcessImageName để lấy đường dẫn tuyệt đối của process. Và điều quan <br/> trọng ở đây, nó tin tưởng vào EPROCESS và dùng LIST_ENTRY để xác định process. <br/> <br/> Vây, việc xoá một LIST_ENTRY trong ActiveProcess list cũng gần như việc chúng ta xoá<br/> một điểm để từ đó lần ra process object body của process cần giấu. <br/> <br/> Phương pháp này có thể tóm gọn như sau: hãy xem hình minh họa 1. Giả sử ta cần<br/> xoá LIST_ENTRY của process object thứ 2.<br/> <br/> Image link: www.vnbiocoderz.com/thug/pix/ill/fig1.JPG<br/> <br/> Xoá LIST_ENTRY: <br/> <br/> 	+ Flink của Object 1 = &(Flink của Object thứ 3)<br/> 	+ Blink của Object 3 = &(Flink của Object thứ 1)<br/> <br/> Quá đơn giản phải không ? He3, không cần hooking bất kỳ API nào hết phải không?<br/> Make shit tighter <img src="/hvaonline/images/smilies/b5e9b4f86ce43ca65bd79c894c4a924c.gif" border="0" alt="smilie" align="absbottom"> Để che giấu tốt hơn nữa, Thug nghĩ nên xoá trong tất cả các <br/> LIST_ENTRY có trong EPROCESS như:<br/> <br/> ----------------------------------------------------------------------------------<br/>    +0x088 ActiveProcessLinks : _LIST_ENTRY<br/>    +0x0b4 SessionProcessLinks : _LIST_ENTRY<br/>    +0x160 PhysicalVadList  : _LIST_ENTRY<br/>    +0x184 JobLinks         : _LIST_ENTRY<br/>    +0x190 ThreadListHead   : _LIST_ENTRY.<br/> ----------------------------------------------------------------------------------<br/> <br/> và <br/> <br/> ----------------------------------------------------------------------------------<br/>    +0x0c4 ObjectTable      : Ptr32 _HANDLE_TABLE<br/> ----------------------------------------------------------------------------------<br/> <br/> vì thực ra _HANDLE_TABLE cũng là một cấu trúc chứa LIST_ENTRY trỏ tới bảng các <br/> handle của process sử dụng. <br/> <br/> ----------------------------------------------------------------------------------<br/> lkd&gt; dt _HANDLE_TABLE<br/>    +0x000 TableCode        : Uint4B<br/>    +0x004 QuotaProcess     : Ptr32 _EPROCESS<br/>    +0x008 UniqueProcessId  : Ptr32 Void<br/>    +0x00c HandleTableLock  : [4] _EX_PUSH_LOCK<br/>    +0x01c HandleTableList  : _LIST_ENTRY	&lt;------------<br/>    +0x024 HandleContentionEvent : _EX_PUSH_LOCK<br/>    +0x028 DebugInfo        : Ptr32 _HANDLE_TRACE_DEBUG_INFO<br/>    +0x02c ExtraInfoPages   : Int4B<br/>    +0x030 FirstFree        : Uint4B<br/>    +0x034 LastFree         : Uint4B<br/>    +0x038 NextHandleNeedingPool : Uint4B<br/>    +0x03c HandleCount      : Int4B<br/>    +0x040 Flags            : Uint4B<br/>    +0x040 StrictFIFO       : Pos 0, 1 Bit<br/> ----------------------------------------------------------------------------------<br/> <br/> ----| 4.  Kết luận<br/> <br/> Bài viết này đã trình bày những khuyết điểm hạn chế của các phương pháp hooking <br/> thông thường, từ đó đi đến một phương pháp hidding process không cần tới hooking <br/> bất kỳ API nào. Tất nhiên, phương pháp này chỉ sử dụng được trong trường hợp có <br/> thể thi hành code ở cấp độ kernel, hay ở ring0. Hiệu quả của phương pháp này là <br/> khá cao, vì như đã nói ở trên, hầu hết các Native API liên quan đến nhận dạng<br/> process, liệt kê .. như NtQuerySystemInformation, CsrProcessId .. đều TIN TƯỞNG <br/> và DỰA VÀO danh sách LIST_ENTRY các process object nói trên. <br/> Hy vọng thời gian tới, Thug sẽ tìm hiểu rõ hơn và kỹ hơn, để có thể trình bày một <br/> phương pháp hidding registry, key, device driver ... tương tự mà không cần phải <br/> hooking API. <br/> <br/> Have fun.<br/> <br/> "Thug is on da ride, fuckaz gonna die tonight,<br/> Let's get high tonight ..."<br/> <br/> ----| 5.  About video<br/> <br/> Đi kèm bài viết này là 1 video capture từ desktop để chứng minh cho tính hiệu quả<br/> của phương pháp nói trên. <br/> <br/> Trong video có sử dụng một phần code trích ra từ bộ Thug4RK (Thug4RootKit) gồm có 2 chương<br/> trình: <br/> <br/> 1. thug4rk.c: chính là source code của driver thug4rk.sys, sẽ được chạy trong kernel<br/> mode, thực hiện các công việc chính như hook API, hoặc thay đổi các cấu trúc LIST_ENTRY<br/> của ActiveProcessList..<br/> <br/> 2. t4rk-feeder.asm: source code của t4rk-feeder.exe, cung cấp tham số cho driver <br/> như tên các process cần hide ... Trong video nói trên, t4rk-feeder cung cấp cho thug4rk.sys<br/> tên 3 process cần hide: <br/> <br/> + ollydbg.exe<br/> + editplus.exe<br/> + hh.exe<br/> <br/> Đầu tiên, trong video, Thug sẽ sử dụng phương pháp hook NtQuerYSystemInformation với <br/> SYstemInformationClass là SystemProcessesAndThreadsInformation (tất nhiên là ở kernel<br/> mode). Ta có thể thấy rõ ràng địa chỉ API nói trên đã bị thay thế bằng địa chỉ hàm của<br/> chúng ta. Đó chính là địa chỉ của hàm Thug4RKNtQuerySystemInformation. Đây là hàm thay<br/> thế cho NtQuerySystemInformation, bản thân nó gọi NtQuerySystemInformation rồi chỉnh sửa<br/> output thực sự rồi mới trả lại kết quả cho caller.<br/> <br/> Sau đó, là phương pháp mới mà Thug đã trình bày phía trên. Hàm thực hiện công việc này<br/> là hàm TestingNewMethod().Không cần nói gì nhiều hơn, hãy xem kỹ video clip <img src="/hvaonline/images/smilies/b5e9b4f86ce43ca65bd79c894c4a924c.gif" border="0" alt="smilie" align="absbottom"> <br/> <br/> Bạn chú ý theo dõi cửa sổ taskmgr.exe các process này và số process trước và sau khi<br/> sử dụng từng phương pháp. <br/> </span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>


			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Hidding process không cần hooking API   (by Thug4Lif3)<a name="3233" id="3233"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">03/07/2006 03:26:15 (+0700) | <a href="/hvaonline/posts/list/767.html#3233">#2</a> | 3233 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>
<td width="20">
		<img src="http://www.hvaonline.net/hvaonline/images/avatar/d0d22c03ae0c31f3017022fd3a4249bf.jpg" border="0" alt="[Avatar]" title="[Avatar]"><br>
	</td>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/106758.html"><b>thuanld</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 26/04/2005 14:29:07<br>
		Messages: 10<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/106758.html" class="icon_profile"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/106758.html" class="icon_pm"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row2">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row2"><span class="postbody">chào bác, cái này thì hay thiệt nhưng mà em còn kém quá. Hoan nghênh bác đã viết bài chia sẻ</span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>


			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Hidding process không cần hooking API   (by Thug4Lif3)<a name="3330" id="3330"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">03/07/2006 08:23:40 (+0700) | <a href="/hvaonline/posts/list/767.html#3330">#3</a> | 3330 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/125707.html"><b>THE LAST LEAF</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 30/06/2006 16:22:20<br>
		Messages: 9<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/125707.html" class="icon_profile"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/125707.html" class="icon_pm"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row1">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row1"><span class="postbody">Hic vấn đề là mấy cái code minh hoạ thì không thấy đâu </span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>


			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Hidding process không cần hooking API   (by Thug4Lif3)<a name="3775" id="3775"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">04/07/2006 20:49:39 (+0700) | <a href="/hvaonline/posts/list/767.html#3775">#4</a> | 3775 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/125534.html"><b>dungcoi_vb</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 29/06/2006 17:17:06<br>
		Messages: 100<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/125534.html" class="icon_profile"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/125534.html" class="icon_pm"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row2">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row2"><span class="postbody">chà THE LAST LEAF bên cau lạc bộ VB cũng qua đây sao, hahaha<br/> à bài viết nảy lấy từ www.conmaz.com , anh trên kia ko lấy cho ví dụ là vì kỹ thuật này rất khó hỉu và cao siêu (Tui nghĩ là vậy). Các huynh có biết tên chủ dề bài viết là gì ko " Háck hệ điều hành đó" thay vì nó dùng các hàm API nó lại đi vào thẳng cấu trúc truyền dữ liệu (Quá khó phải ko?)</span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>


			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="http://www.hvaonline.net/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td valign="middle" align="right" class="nav"></td>
	</tr>
</table>

<!-- quick reply -->
<table class="forumline" cellspacing="1" cellpadding="3" width="100%" border="0" align="center">
</table>

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="10"></td>
	</tr>
</table>

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td align="left">
			<!-- watch - unwatch -->
			<!-- add bookmark -->

		</td>
		<td align="right" valign="bottom">			
		</td>
	</tr>
</table>

<!-- mod -->

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td colspan="3"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="10"></td>
	</tr>
</table>

<!-- combo navigator -->
<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td align="left"><a href="http://digg.com/submit?phrase=2&url=http://www.hvaonline.net/hvaonline/posts/list/767.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/digg.gif" align="texttop" alt="[digg]" title="[digg]"></a>
<a href="http://del.icio.us/post?url=http://www.hvaonline.net/hvaonline/posts/list/767.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/delicious.gif" align="texttop" alt="[delicious]" title="[delicious]"></a>
<a href="http://www.google.com/bookmarks/mark?op=edit&output=popup&bkmk=http://www.hvaonline.net/hvaonline/posts/list/767.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/google.gif" align="texttop" alt="[google]" title="[google]"></a>
<a href="http://bookmarks.yahoo.com/toolbar/savebm?opener=tb&u=http://www.hvaonline.net/hvaonline/posts/list/767.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/yahoo.gif" align="texttop" alt="[yahoo]" title="[yahoo]"></a>
<a href="http://technorati.com/faves?add=http://www.hvaonline.net/hvaonline/posts/list/767.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/technorati.gif" align="texttop" alt="[technorati]" title="[technorati]"></a>
<a href="http://reddit.com/submit?url=http://www.hvaonline.net/hvaonline/posts/list/767.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/reddit.gif" align="texttop" alt="[reddit]" title="[reddit]"></a>
<a href="http://www.stumbleupon.com/submit?url=http://www.hvaonline.net/hvaonline/posts/list/767.html"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/stumbleupon.gif" align="texttop" alt="[stumbleupon]" title="[stumbleupon]"></a></td>
		<td align="right">	<table cellspacing="0" cellpadding="0" border="0">
		<tr>			  
			<td nowrap="nowrap">
				<form action="" name="f" id="f" accept-charset="UTF-8">
					<span class="gensmall">Go to:&nbsp;</span>
					<select onchange="if(this.options[this.selectedIndex].value > 0){ document.location = '/hvaonline/forums/show/'+ this.options[this.selectedIndex].value +'.html'; }" name="select">
						<option value="0" selected="selected">Select a forum</option>				
							<option value="0">-------------</option>
									<option value="2" >Thông báo từ HVA</option>
									<option value="41" >FAQ - Các câu hỏi thường gặp</option>
									<option value="5" >Góp ý và Hỏi đáp thắc mắc chung</option>
									<option value="6" >Kiểm tra bảo mật</option>
							<option value="0">-------------</option>
									<option value="8" >Thảo luận bảo mật</option>
									<option value="12" >Thảo luận thâm nhập</option>
									<option value="28" >Thảo luận virus, trojan, spyware, worm...</option>
									<option value="36" >Thủ thuật reverse engineering</option>
									<option value="13" >Thông tin new bugs và exploits</option>
									<option value="51" >Case Studies</option>
							<option value="0">-------------</option>
									<option value="23" selected="selected">Thảo luận hệ điều hành Windows</option>
									<option value="24" >Thảo luận hệ điều hành *nix</option>
									<option value="26" >Thảo luận các loại thiết bị máy tính</option>
									<option value="31" >Thảo luận mạng và thiết bị mạng</option>
									<option value="27" >Thông tin về các địa chỉ và tài liệu hữu ích</option>
							<option value="0">-------------</option>
									<option value="44" >Người tìm việc - Việc tìm người</option>
									<option value="21" >Thảo luận việc định hướng</option>
									<option value="19" >Những thảo luận khác</option>
									<option value="50" >Hình minh họa</option>
									<option value="33" >Trash</option>
							<option value="0">-------------</option>
					</select>
				</form>
			</td>
		</tr>
	</table>
</td>
	</tr>
</table>

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td colspan="3"><img src="http://www.hvaonline.net/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="10"></td>
	</tr>
</table>

<!-- list users in -->
<table class="forumline" cellspacing="3" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<th class="thright"  nowrap="nowrap" height="26" valign="middle">&nbsp;Users currently in here&nbsp;</th>
	</tr>
		<tr>
			<td class="gensmall" valign="middle" align="left">
				1 Anonymous 
				
			</td>	
		</tr>
</table>
<a name="quick"></a>

<table cellspacing="0" cellpadding="0" width="100%" border="0"  align="center">

	<tr>	
		<td align="center">
		<br>
					</td>
	</tr>

	<tr>
		<td align="center">
			<span class="copyright">Powered by JForum - Extended by <a href="MailTo:lienlac@hvaonline.net">HVAOnline</a><br>
			&nbsp;hvaonline.net&nbsp; | &nbsp;hvaforum.net&nbsp; | &nbsp;hvazone.net&nbsp; | &nbsp;hvanews.net&nbsp; | &nbsp;vnhacker.org<br>
			1999 - 2013 &copy;
			v2012|0504|218|
		  </span>
	  </td>
	</tr>
<iframe src="/hvaonline/templates/ping_session.jsp" height="0" width="0" frameborder="0" scrolling="no"></iframe>
</body>
</html>
</table>

<script type="text/javascript" src="http://www.hvaonline.net/hvaonline/templates/viet/js/post_show.js"></script>
<script type="text/javascript" src="http://www.hvaonline.net/hvaonline/templates/viet/js/post.js"></script>
<script type="text/javascript" src="http://www.hvaonline.net/hvaonline/templates/viet/js/avim.js"></script>
<script type="text/javascript">
<!--
function showEmail(beforeAt, afterAt)
{
	return beforeAt + "@" + afterAt;
}

var starOn=new Image();
starOn.src="http://www.hvaonline.net/hvaonline/templates/viet/images/star_on.gif";

var starOff=new Image();
starOff.src="http://www.hvaonline.net/hvaonline/templates/viet/images/star_off.gif";

function writeStars(q, postId)
{
	for (var i = 0; i < 5; i++) {
		var name = "star" + postId + "_" + i;
		document.write("<img name='" + name + "' alt='*' />");
		document.images[name].src = q > i ? starOn.src : starOff.src;
	}
}

function addBookmark(relationType, relationId)
{
	var w = window.open('/hvaonline/bookmarks/insert/' + relationType + '/' + relationId + '.html', 'bookmark_add', 'width="700", height="100", scrollbars="no"');
	w.focus();
}

function supportAjax()
{
	if (typeof(AjaxUtils) != 'undefined') {
		if (window.ActiveXObject) {
			var r = new ActiveXObject("Microsoft.XMLHTTP");
			return r != undefined;
		}
		else if (window.XMLHttpRequest) {
			return true;
		}
	}

	return false;
}




function maxImg(foto, maxSize){
w = foto.width;
if (w > maxSize){
	foto.width = maxSize;
	}
} 

-->
</script>
