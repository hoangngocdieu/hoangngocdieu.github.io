<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"> 

<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="-1">
<meta name="description" content="HVA discussion board">
<meta name="keywords" content="Thư giãn với shell script một tý., jforum, jforum java, jforum forum, forum java, java jforum, java forum, forum, rafael steil, bulletin board, java bb, javabb, hva, hvaonline, hvazone, hvaforum">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="robots" content="index,follow">
<meta name="rating" content="general">
<style type="text/css">
<!-- 
@import url( "/hvaonline/templates/viet/styles/style.css");
-->
</style>
<style type="text/css">
<!--
@import url("/hvaonline/templates/viet/styles/en_US.css");
-->
</style>
<title>Thư giãn với shell script một tý. - .:: HVAOnline ::.</title>

</head>
<body class="en_US">


<!--
Original theme from phpBB (http://www.phpbb.com) subSilver
Created by subBlue design
http://www.subBlue.com
Modifications by JForum Team 
Extended and customised by HVA Team
Added more features and Black Silver theme designed by HVA
-->
<table width="100%" border="0" cols="2">
	<tr align="right">
		<td class="copyright">
			English
			| 
			<a href="/hvaonline/jforum.html?module=forums&amp;action=setLang&amp;lang=vi_VN" rel="nofollow">Vietnamese</a>
		</td>
	</tr>
</table>
<table width="100%" border="0">
	<tr>
		<td>
			<table cellspacing="0" cellpadding="0" width="100%" border="0">
				<tr>			
        <td>&nbsp;
			</td>
		
        <td width="100%" align="center" valign="middle">
						<p><a href="" title="[Logo]">
								<img src="/hvaonline/templates/viet/images/hvabanner-final.gif" alt="banner" />
							<br>
            				</a><span class="maintitle"></span>
						</p>
          <table cellspacing="0" cellpadding="2" border="0">
							<tr>
								
              <td valign="top" nowrap="nowrap" align="center">
			  						<a href="/hvaonline/forums/rule.html"><img src="/hvaonline/templates/viet/images/icon_mini_rule.gif" alt="[Rule]" title="[Rule]"></a>
									<a id="rule" class="topmenu" href="/hvaonline/forums/rule.html">Rules</a>&nbsp;
									
									<a class="topmenu" href="/hvaonline/forums/list.html"><img src="/hvaonline/templates/viet/images/icon_mini_groups.gif" alt="[Home]" title="[Home]"></a>
										<a id="backtosite" class="topmenu" href="/hvaonline/forums/list.html">Main Forum</a>&nbsp;

										<a class="topmenu" href="/hvaonline/portal/list.html"><img src="/hvaonline/templates/viet/images/icon_mini_portal.gif" alt="[Portal]" title="[Portal]"></a>
										<a id="portalsite" class="topmenu" href="/hvaonline/portal/list.html">Portal</a>&nbsp;&nbsp;
									<br>
									
										<a href="/hvaonline/user/list.html"><img src="/hvaonline/templates/viet/images/icon_mini_members.gif" alt="[Members]" title="[Members]"></a>
										<a id="users" class="topmenu" href="/hvaonline/user/list.html">Member Listing</a>&nbsp;
										
										<a href="/hvaonline/forums/stats.html"><img src="/hvaonline/templates/viet/images/icon_mini_stats.gif" alt="[Statistics]" title="[Statistics]"></a>
										<a id="stats" class="topmenu" href="/hvaonline/forums/stats.html">Statistics</a>&nbsp;
										
										<a href="/hvaonline/search/filters.html"><img src="/hvaonline/templates/viet/images/icon_mini_search.gif" alt="[Search]" title="[Search]"></a>
										<span class="mainmenu"><a id="search" class="topmenu" href="/hvaonline/search/filters.html"><b>Search</b></a>&nbsp;
									
										<a href="/book/"><img src="/hvaonline/templates/viet/images/icon_mini_book.gif" alt="[Reading Room]" title="[Reading Room]"></a> 
										<a class="topmenu" href="/hvaonline/readingRoom/list.html">Reading Room</a>&nbsp;

									
									<span class="topmenu"> 
										

	
										<br>
											<a id="register" class="topmenu" href="/hvaonline/user/insert.html"><img src="/hvaonline/templates/viet/images/icon_mini_register.gif" border="0" alt="[Register]" title="[Register]"> 
												Register</a>&nbsp;&nbsp;</span>
											<img src="/hvaonline/templates/viet/images/icon_mini_login.gif" border="0" alt="[Login]" title="[Login]"> 
											<strong>Login</strong> [&nbsp;
											<a id="login" class="topmenu" href="/hvaonline/user/login.html">http</a>&nbsp;
											|
											<a id="logins" class="topmenu" href="https://www.hvaonline.net/hvaonline/user/logins.html">https </a>&nbsp;]</span>
								</td>
							</tr>
							<tr>
								<td>&nbsp;</td>
							</tr>
						</table>
					</td>
				</tr>
			</table>
		</td>
	</tr>
	<tr>
		<td>

<!-- navigator -->
<table cellspacing="2" cellpadding="2" width="100%" border="0" align="center">
	<tr>
		<td valign="baseline" align="left" colspan="0">
			<span class="nav">
			<a class="nav" href="/hvaonline/forums/list.html">Forum Index </a> 
			<img src="/hvaonline/templates/viet/images/en_US/arrow.gif"> <a class="nav" href="/hvaonline/forums/show/24.html">Thảo luận hệ điều hành *nix </a>
			<img src="/hvaonline/templates/viet/images/en_US/arrow.gif"> <a class="nav" href="/hvaonline/posts/list/20793.html" name="top" id="top">Thư giãn với shell script một tý.</a>
				&nbsp;<a href="/hvaonline/rss/topicPosts/20793.html"><img src="/hvaonline/templates/viet/images/xml_button.gif" border="0" alt="XML"></a>
			</span>
		
		</td>

		<td valign="middle" align="right" class="nav"></td>
	</tr>
</table>

<!-- poll show -->

  <!-- POST LISTING -->


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Thư giãn với shell script một tý.<a name="123436" id="123436"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">06/04/2008 06:14:51 (+0700) | <a href="/hvaonline/posts/list/20793.html#123436">#1</a> | 123436 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>
<td width="20">
		<img src="/hvaonline/images/avatar/8473446b734702b73ac2972b7bbf7bf7.jpg" border="0" alt="[Avatar]" title="[Avatar]"><br>
	</td>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/140396.html"><b>Phó Hồng Tuyết</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 20/04/2007 20:02:10<br>
		Messages: 275<br>
	
		Location: Nơi Sâu Thẳm Tâm Hồn<br>
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/140396.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/140396.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
			<a href="http:// ???-những gì còn lại !" target="_new"><img src="/hvaonline/templates/viet/images/icon_www.gif" alt="[WWW]" title="[www]"></a>
		
			<a href="http://edit.yahoo.com/config/send_webmesg?.target=codervietnam&amp;.src=pg"><img src="/hvaonline/templates/viet/images/icon_yim.gif" alt="[Yahoo!]" title="[YIM]"></a>
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row1">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row1"><span class="postbody"><b>Chương I. cách tạo và viết một shell cơ bản.</b><br/> khuyến cáo nên sử dụng lệnh sau để tạo script:<br/> cách tạo<br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>vi
vim</pre>
		</div><br/> ví dụ tạo script basic<br/> gõ lệnh :<br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>$ vi  basic.bash</pre>
		</div><br/> hoặc<br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>$ vi  basic.sh</pre>
		</div><br/> hoặc<br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>$ vim  basic.bash</pre>
		</div><br/> một lưu ý nên sử dụng các phần mở rộng của script là .bash và .sh ( nó bảo đảm cho sự nguyên bản của một script shell )<br/> cách setup một script.<br/> đầu tiên bạn phải set permission cho script của bạn.<br/> câu lệnh:<br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>$ chmod +x basic
$ chmod 755 basic</pre>
		</div><br/> cách chạy một script<br/> sử dụng các câu lệnh sau:<br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>$ bash basic</pre>
		</div><br/> hoặc<br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>$ sh basic</pre>
		</div><br/> hoặc<br/> $ ./basic<br/> <br/> ví dụ : Viết một shell script đơn giản.<br/> vi hello.sh<br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>clear
echo "Hello $USER"
echo "Today is ";date
echo "Number of user login : " ; who | wc -l
echo "Calendar"
cal
exit 0</pre>
		</div><br/> mở rộng shell hello.sh<br/> code<br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>clear
echo "Xin chao $USER"
echo "Hom Nay La Ngay ";date
echo "So Lan Login Cua Ban Trong Ngay La : " ; who | wc -l
echo "Tong So ip Ket Noi Den Server La : ";netstat -nat | grep :80 | wc -l
echo "Kiem Tra So Bo : SYS REC ";netstat -n -p |grep SYN_REC | wc -l
echo "Kiem Tra So Bo : SYS ";netstat -nap | grep SYN | wc -l
echo "Kiem Tra So Bo : TIME WAIT ";netstat -nap | grep TIME_WAIT | wc -l
echo "Kiem Tra So Bo : ESTABLISHED ";netstat -nap | grep ESTABLISHED | wc -l
echo "Kiem Tra So Bo : TCP/UDP ";netstat -anp |grep 'tcp\|udp' | awk '{print $5}' | cut -d: -f1 | sort | uniq -c | sort -n
echo "Calendar"
cal
exit 0</pre>
		</div><br/> <br/> sau đó bấm ESC tiếp bấm bấm : đánh vào x để save nội dung script đã viết.<br/> sau đó sử dụng lệnh này để set permission.<br/> chmod 700 hello.sh<br/> chạy thử:<br/> ./hello.sh<br/> Thật đễ phải không bạn.<br/> ( đang trong quá trình học, nếu có sai xót mong các bậc đàn anh đi trước niệm tình chỉ cho em ).<br/> ngoài ra các bạn có thể thêm các cmd sau bằng cách :<br/> <br/> echo "Noi dung" ;cmd<br/> <br/> VD mở rộng với các cmd :<br/> This is useful to find out if your server is under attack or not. You can also list abusive IP address using this method.<br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>netstat -nat | awk '{print $6}' | sort | uniq -c | sort -n</pre>
		</div><br/> Dig out more information about a specific ip address or Busy server can give out more information:<br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>netstat -nat |grep {IP-address} | awk '{print $6}' | sort | uniq -c | sort -n</pre>
		</div><br/> {IP-address} : ip server của bạn trong trường hợp nhiều ip thì nó chính là ip Default. ( Ex..) &lt;== quên tiếng anh viết bằng gì rồi.<br/> Get List Of All Unique IP Address<br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>netstat -nat | awk '{ print $5}' | cut -d: -f1 | sed -e '/^$/d' | uniq</pre>
		</div><br/> total of all unique IP address, enter:<br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>netstat -nat | awk '{ print $5}' | cut -d: -f1 | sed -e '/^$/d' | uniq | wc -l</pre>
		</div><br/> If you think your Linux box is under attack, print out a list of open connections on your box and sorts them by according to IP address, enter:<br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>netstat -atun | awk '{print $5}' | cut -d: -f1 | sed -e '/^$/d' |sort | uniq -c | sort -n</pre>
		</div><br/> Display Summary Statistics for Each Protocol<br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>netstat -s | less
netstat -t -s | less
netstat -u -s | less
netstat -w -s | less
netstat -s</pre>
		</div><br/> </span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>

		  <tr>
			<td height="20" colspan="2" valign="bottom" class="rowButton"><span class="gensmall">"Một người thành công không có ý nghĩ đổ thừa  thất bại do ...."</span></td>
		  </tr>

			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Re: Thư giãn với shell script một tý.<a name="123438" id="123438"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">06/04/2008 06:19:20 (+0700) | <a href="/hvaonline/posts/list/20793.html#123438">#2</a> | 123438 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>
<td width="20">
		<img src="/hvaonline/images/avatar/8473446b734702b73ac2972b7bbf7bf7.jpg" border="0" alt="[Avatar]" title="[Avatar]"><br>
	</td>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/140396.html"><b>Phó Hồng Tuyết</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 20/04/2007 20:02:10<br>
		Messages: 275<br>
	
		Location: Nơi Sâu Thẳm Tâm Hồn<br>
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/140396.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/140396.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
			<a href="http:// ???-những gì còn lại !" target="_new"><img src="/hvaonline/templates/viet/images/icon_www.gif" alt="[WWW]" title="[www]"></a>
		
			<a href="http://edit.yahoo.com/config/send_webmesg?.target=codervietnam&amp;.src=pg"><img src="/hvaonline/templates/viet/images/icon_yim.gif" alt="[Yahoo!]" title="[YIM]"></a>
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row2">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row2"><span class="postbody">Gửi một E-mail thông báo cho bạn khi server bị ddos.<br/> sử dụng lệnh nano để tạo một scipt.<br/> VD : nano /root/emailsend.sh<br/> code<br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>#!/bin/bash
LOAD=$&#40;awk '{print int&#40;$1&#41;}' /proc/loadavg&#41;
HOSTNAME=$&#40;hostname&#41;
IP=$&#40;hostname -i&#41;
EMAIL=&#40;youremail@domain.com &lt;a href="mailto:youremaul2@domain.com"&gt;youremaul2@domain.com&lt;/a&gt;&#41;
if &#91; $LOAD -ge 5 &#93;
then
{
printf "Hostname : $HOSTNAME\n"
printf "IP : $IP\n"
printf "Current Load : $LOAD"
printf "\n\n==================\nMySQL Process List\n==================\n\n"
mysqladmin proc
printf "\n\n==================\nMySQL Extended Status\n==================\n\n"
mysqladmin extended status
printf "\n\n===================\nServer Process List\n===================\n\n"
ps -ef
printf "\n\n==================\nNobody Processes\n==================\n\n"
ps --User nobody
printf "\n\n==================\nTOP Snapshot\n==================\n\n"
top -n1 -b
printf "\n\n==================\nMemory Usage\n==================\n\n"
free -m
printf "\n\n==================\nDisk Usage\n==================\n\n"
df -h
printf "\n\n==================\n Apache Connections \n==================\n\n"
netstat -alpn | grep :80 | awk '{print $5}' | cut -d: -f 1 | sort | uniq -c | sort -n
} | mail -s "$HOSTNAME Overloaded !!!" $EMAIL&#91;@&#93;
fi</pre>
		</div><br/> E MAIL=(youremail@domain.com &lt;a href="mailto:youremaul2@domain.com"&gt;youremaul2@domain.com&lt;/a&gt<img src="/hvaonline/images/smilies/068ae40523a24c9ef54edefd375e542d.gif" border="0" alt="smilie" align="absbottom"> &lt;== đoạn này bị mã hóa. mã gốc là : EMAIL=(youremail@ domain.com youremaul2@ domain.com) &lt;== mình để khoảng cách để nó không bị trường hợp như trên.<br/> với : [ $LOAD -ge 5 ] =5. bạn có thể thay đổi thông số này. ( nếu là D webserver nên để là 1 hoặc 2 )<br/> đổi (youremail@domain.com <a href="mailto:youremaul2@domain.com">youremaul2@domain.com</a>)<br/> thành email mà bạn muốn send.<br/> chmod 700 emailsend.sh<br/> add cron  * * * * * /root/emailsend.sh.sh<br/> ( khuyên nên add cron với 10 phút )<br/> kết thúc./.<br/> <br/> Mở rộng: bạn có thể send một email và reboot lại server khi overloaded đến một mức nào đó.<br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre># Set up limit below
NOTIFY="6.0"

# admin user email id
EMAIL="root"

# Subject for email
SUBJECT="Alert $&#40;hostname&#41; load average"

# -----------------------------------------------------------------

# Os Specifc tweaks do not change anything below ;&#41;
OS="$&#40;uname&#41;"
TRUE="1"
if &#91; "$OS" == "FreeBSD" &#93;; then
        TEMPFILE="$&#40;mktemp /tmp/$&#40;basename $0&#41;.tmp.XXX&#41;"
	FTEXT='load averages:'
elif &#91; "$OS" == "Linux" &#93;; then
        TEMPFILE="$&#40;mktemp&#41;"
	FTEXT='load average:'
fi


# get first 5 min load
F5M="$&#40;uptime | awk -F "$FTEXT" '{ print $2 }' | cut -d, -f1&#41;"
# 10 min
F10M="$&#40;uptime | awk -F "$FTEXT" '{ print $2 }' | cut -d, -f2&#41;"
# 15 min
F15M="$&#40;uptime | awk -F "$FTEXT" '{ print $2 }' | cut -d, -f3&#41;"

# mail message
# keep it short coz we may send it to page or as an short message &#40;SMS&#41;
echo "Load average Crossed allowed limit $NOTIFY." &gt;&gt; $TEMPFILE
echo "Hostname: $&#40;hostname&#41;" &gt;&gt; $TEMPFILE
echo "Local Date & Time : $&#40;date&#41;" &gt;&gt; $TEMPFILE

# Look if it crossed limit
# compare it with last 15 min load average
RESULT=$&#40;echo "$F15M &gt; $NOTIFY" | bc&#41;

# if so send an email
if &#91; "$RESULT" == "$TRUE" &#93;; then
        mail -s "$SUBJECT" "$EMAIL" &lt; $TEMPFILE
fi

# remove file 
rm -f $TEMPFILE</pre>
		</div><br/>  các bạn có thể điều chỉnh NOTIFY="6.0" với 6.0 là average<br/> <br/> ( đang trong quá trình học, nếu có sai xót mong các bậc đàn anh đi trước niệm tình chỉ cho em ).</span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>

		  <tr>
			<td height="20" colspan="2" valign="bottom" class="rowButton"><span class="gensmall">"Một người thành công không có ý nghĩ đổ thừa  thất bại do ...."</span></td>
		  </tr>

			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; nếu mysql server bị treo hoặc bị ddos và không chạy, thì sao nhỉ.<a name="123452" id="123452"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">06/04/2008 07:22:24 (+0700) | <a href="/hvaonline/posts/list/20793.html#123452">#3</a> | 123452 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>
<td width="20">
		<img src="/hvaonline/images/avatar/8473446b734702b73ac2972b7bbf7bf7.jpg" border="0" alt="[Avatar]" title="[Avatar]"><br>
	</td>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/140396.html"><b>Phó Hồng Tuyết</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 20/04/2007 20:02:10<br>
		Messages: 275<br>
	
		Location: Nơi Sâu Thẳm Tâm Hồn<br>
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/140396.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/140396.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
			<a href="http:// ???-những gì còn lại !" target="_new"><img src="/hvaonline/templates/viet/images/icon_www.gif" alt="[WWW]" title="[www]"></a>
		
			<a href="http://edit.yahoo.com/config/send_webmesg?.target=codervietnam&amp;.src=pg"><img src="/hvaonline/templates/viet/images/icon_yim.gif" alt="[Yahoo!]" title="[YIM]"></a>
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row1">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row1"><span class="postbody">vi runmssql.bash<br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>MUSER="root"
# mật mã của admin hoặc root
MPASS="SET-ROOT-PASSWORD"
# hostnames của sql thường là localhost
MHOST="localhost"
# câu lệnh dùng để khởi động lại mysql
MSTART="/etc/init.d/mysql start"
# email được gửi
EMAILID="notification@somewhere-corp.com"
# đường dẫn đến mail progames 
MAILCMD="$&#40;which mail&#41;"
# đường dẫn đến  mysqladmin
MADMIN="$&#40;which mysqladmin&#41;"
MAILMESSAGE="/tmp/mysql.fail.$$"
$MADMIN -h $MHOST -u $MUSER -p${MPASS} ping 2&gt;/dev/null 1&gt;/dev/null
if &#91; $? -ne 0 &#93;; then
	echo "" &gt;$MAILMESSAGE
	echo "Error: MySQL Server is not running/responding ping request"&gt;&gt;$MAILMESSAGE
	echo "Hostname: $&#40;hostname&#41;" &gt;&gt;$MAILMESSAGE
	echo "Date & Time: $&#40;date&#41;" &gt;&gt;$MAILMESSAGE
	$MSTART&gt;/dev/null
	o=$&#40;ps cax | grep -c ' mysqld$'&#41;
	if &#91; $o -eq 1 &#93;; then
		sMess="MySQL Server MySQL server successfully restarted"
	else
		sMess="MySQL server FAILED to restart"
	fi
	echo "Current Status: $sMess" &gt;&gt;$MAILMESSAGE
	echo "" &gt;&gt;$MAILMESSAGE
	echo "*** This email generated by $&#40;basename $0&#41; shell script ***" &gt;&gt;$MAILMESSAGE
	echo "*** Please don't reply this email, this is just notification email ***" &gt;&gt;$MAILMESSAGE
	$MAILCMD -s "MySQL server" $EMAILID &lt; $MAILMESSAGE
else # MySQL is running :&#41; and do nothing
	:
fi
# remove file
rm -f $MAILMESSAGE</pre>
		</div><br/> <b>ESC</b> + : + <b>X</b><br/> chmod 700<br/> add cron với thời gian tùy bạn.<br/> theo mình nghĩ nên để là 1h.<br/> Ở phần này có cái em không hiểu.<br/> $(basename $0)  &lt;== cái này có nghĩa là gì.<br/> tuy nhiên script trên chạy tốt. ( nó chạy mà có cái em không hiểu mới đau ).</span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>

		  <tr>
			<td height="20" colspan="2" valign="bottom" class="rowButton"><span class="gensmall">"Một người thành công không có ý nghĩ đổ thừa  thất bại do ...."</span></td>
		  </tr>

			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; nếu mysql server bị treo hoặc bị ddos và không chạy, thì sao nhỉ.<a name="123630" id="123630"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">07/04/2008 01:21:46 (+0700) | <a href="/hvaonline/posts/list/20793.html#123630">#4</a> | 123630 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/164690.html"><b>kholostoi</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 05/04/2008 00:41:53<br>
		Messages: 27<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/164690.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/164690.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row2">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row2"><span class="postbody"><blockquote><br/> Ở phần này có cái em không hiểu.<br/> $(basename $0)  &lt;== cái này có nghĩa là gì.<br/> tuy nhiên script trên chạy tốt. ( nó chạy mà có cái em không hiểu mới đau ).<br/> &nbsp;
		</blockquote><br/> <br/> xem man basename. vd: $basename /usr/bin/ls  --&gt; kết quả là : ls<br/> $0 la tên của chương trình đang chạy: vd chương trình của bạn: $0 chính là ..(đường dẫn)../runmssql.bash</span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>


			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Re: Thư giãn với shell script một tý.<a name="123631" id="123631"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">07/04/2008 01:31:56 (+0700) | <a href="/hvaonline/posts/list/20793.html#123631">#5</a> | 123631 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>
<td width="20">
		<img src="/hvaonline/images/avatar/8473446b734702b73ac2972b7bbf7bf7.jpg" border="0" alt="[Avatar]" title="[Avatar]"><br>
	</td>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/140396.html"><b>Phó Hồng Tuyết</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 20/04/2007 20:02:10<br>
		Messages: 275<br>
	
		Location: Nơi Sâu Thẳm Tâm Hồn<br>
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/140396.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/140396.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
			<a href="http:// ???-những gì còn lại !" target="_new"><img src="/hvaonline/templates/viet/images/icon_www.gif" alt="[WWW]" title="[www]"></a>
		
			<a href="http://edit.yahoo.com/config/send_webmesg?.target=codervietnam&amp;.src=pg"><img src="/hvaonline/templates/viet/images/icon_yim.gif" alt="[Yahoo!]" title="[YIM]"></a>
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row1">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row1"><span class="postbody">Cám ơn bạn giờ mình đã hiểu. <br/> Đang tiếp tục tiếp mấy cái shell basic . mong đừng cười mình nhé. Rất mong được góp ý thẳng thắn để mình học hỏi thêm nhiều.<br/> <br/> Thanks.</span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>

		  <tr>
			<td height="20" colspan="2" valign="bottom" class="rowButton"><span class="gensmall">"Một người thành công không có ý nghĩ đổ thừa  thất bại do ...."</span></td>
		  </tr>

			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Chương 2. Một Shell script anti ddos của inetbase.com ( zaf@vsnl.com )<a name="123826" id="123826"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">07/04/2008 23:14:32 (+0700) | <a href="/hvaonline/posts/list/20793.html#123826">#6</a> | 123826 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>
<td width="20">
		<img src="/hvaonline/images/avatar/8473446b734702b73ac2972b7bbf7bf7.jpg" border="0" alt="[Avatar]" title="[Avatar]"><br>
	</td>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/140396.html"><b>Phó Hồng Tuyết</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 20/04/2007 20:02:10<br>
		Messages: 275<br>
	
		Location: Nơi Sâu Thẳm Tâm Hồn<br>
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/140396.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/140396.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
			<a href="http:// ???-những gì còn lại !" target="_new"><img src="/hvaonline/templates/viet/images/icon_www.gif" alt="[WWW]" title="[www]"></a>
		
			<a href="http://edit.yahoo.com/config/send_webmesg?.target=codervietnam&amp;.src=pg"><img src="/hvaonline/templates/viet/images/icon_yim.gif" alt="[Yahoo!]" title="[YIM]"></a>
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row2">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row2"><span class="postbody">Đầu tiên các bạn có thể vào đây để xem thông tin về script này.<br/> <span class="link"> http://www.inetbase.com/scripts/ddos/</span><br/> để bắt đầu mình sẽ phân tích từ files cài đặt.<br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>#!/bin/sh
if &#91; -d '/usr/local/ddos' &#93;; then
	echo; echo; echo "Please un-install the previous version first"
	exit 0
else
	mkdir /usr/local/ddos
fi
clear
echo; echo 'Installing DOS-Deflate 0.6'; echo
echo; echo -n 'Downloading source files...'
wget -q -O /usr/local/ddos/ddos.conf<span class="link"> http://www.inetbase.com/scripts/ddos/ddos.conf</span>
echo -n '.'
wget -q -O /usr/local/ddos/LICENSE<span class="link"> http://www.inetbase.com/scripts/ddos/LICENSE</span>
echo -n '.'
wget -q -O /usr/local/ddos/ignore.ip.list<span class="link"> http://www.inetbase.com/scripts/ddos/ignore.ip.list</span>
echo -n '.'
wget -q -O /usr/local/ddos/ddos.sh<span class="link"> http://www.inetbase.com/scripts/ddos/ddos.sh</span>
chmod 0755 /usr/local/ddos/ddos.sh
cp -s /usr/local/ddos/ddos.sh /usr/local/sbin/ddos
echo '...done'

echo; echo -n 'Creating cron to run script every minute.....&#40;Default setting&#41;'
/usr/local/ddos/ddos.sh --cron &gt; /dev/null 2&gt;&1
echo '.....done'
echo; echo 'Installation has completed.'
echo 'Config file is at /usr/local/ddos/ddos.conf'
echo 'Please send in your comments and/or suggestions to &lt;a href="mailto:zaf@vsnl.com"&gt;zaf@vsnl.com&lt;/a&gt;'
echo
cat /usr/local/ddos/LICENSE | less</pre>
		</div><br/> đoạn script trên sẽ tải về server bạn 4files.<br/> chmod files ddps.sh là 0775<br/> cuối cùng là add cron để chạy script.<br/> tiếp đến để hiểu rõ con script này nên phân tích cách hoạt động của nó. files cấu hình của script là ddos.conf<br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>##### Paths of the script and other files
PROGDIR="/usr/local/ddos"
PROG="/usr/local/ddos/ddos.sh"
IGNORE_IP_LIST="/usr/local/ddos/ignore.ip.list"
CRON="/etc/cron.d/ddos.cron"
APF="/etc/apf/apf"
IPT="/sbin/iptables"

##### frequency in minutes for running the script
##### Caution: Every time this setting is changed, run the script with --cron
#####          option so that the new frequency takes effect
FREQ=1

##### How many connections define a bad IP? Indicate that below.
NO_OF_CONNECTIONS=150

##### APF_BAN=1 &#40;Make sure your APF version is atleast 0.96&#41;
##### APF_BAN=0 &#40;Uses iptables for banning ips instead of APF&#41;
APF_BAN=1

##### KILL=0 &#40;Bad IPs are'nt banned, good for interactive execution of script&#41;
##### KILL=1 &#40;Recommended setting&#41;
KILL=1

##### An email is sent to the following address when an IP is banned.
##### Blank would suppress sending of mails
EMAIL_TO="root"

##### Number of seconds the banned ip should remain in blacklist.
BAN_PERIOD=600</pre>
		</div><br/> chắc hẳn khi nhìn vào đoạn #### thì không cần mình giải thích nhỉ <img src="/hvaonline/images/smilies/b5e9b4f86ce43ca65bd79c894c4a924c.gif" border="0" alt="smilie" align="absbottom"><br/> tùy theo nhu cầu của bạn mà config nó. sao cho phù hợp với server của bạn. ( cái này quyết định tính hiệu quả của script )<br/> tiếp theo phân tích files ddos.sh để xem cấu trúc làm việc của nó.<br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>#!/bin/sh
##############################################################################
# DDoS-Deflate version 0.6 Author: Zaf &lt;zaf@vsnl.com&gt;                        #
##############################################################################
# This program is distributed under the "Artistic License" Agreement         #
#                                                                            #
# The LICENSE file is located in the same directory as this program. Please  #
#  read the LICENSE file before you make copies or distribute this program   #
##############################################################################
load_conf&#40;&#41;
{
	CONF="/usr/local/ddos/ddos.conf"
	if &#91; -f "$CONF" &#93; && &#91; ! "$CONF" ==	"" &#93;; then
		source $CONF
	else
		head
		echo "\$CONF not found."
		exit 1
	fi
}

head&#40;&#41;
{
	echo "DDoS-Deflate version 0.6"
	echo "Copyright &#40;C&#41; 2005, Zaf &lt;zaf@vsnl.com&gt;"
	echo
}

showhelp&#40;&#41;
{
	head
	echo 'Usage: ddos.sh &#91;OPTIONS&#93; &#91;N&#93;'
	echo 'N : number of tcp/udp	connections &#40;default 150&#41;'
	echo 'OPTIONS:'
	echo '-h | --help: Show	this help screen'
	echo '-c | --cron: Create cron job to run this script regularly &#40;default 1 mins&#41;'
	echo '-k | --kill: Block the offending ip making more than N connections'
}

unbanip&#40;&#41;
{
	UNBAN_SCRIPT=`mktemp /tmp/unban.XXXXXXXX`
	TMP_FILE=`mktemp /tmp/unban.XXXXXXXX`
	UNBAN_IP_LIST=`mktemp /tmp/unban.XXXXXXXX`
	echo '#!/bin/sh' &gt; $UNBAN_SCRIPT
	echo "sleep $BAN_PERIOD" &gt;&gt; $UNBAN_SCRIPT
	if &#91; $APF_BAN -eq 1 &#93;; then
		while read line; do
			echo "$APF -u $line" &gt;&gt; $UNBAN_SCRIPT
			echo $line &gt;&gt; $UNBAN_IP_LIST
		done &lt; $BANNED_IP_LIST
	else
		while read line; do
			echo "$IPT -D INPUT -s $line -j DROP" &gt;&gt; $UNBAN_SCRIPT
			echo $line &gt;&gt; $UNBAN_IP_LIST
		done &lt; $BANNED_IP_LIST
	fi
	echo "grep -v --file=$UNBAN_IP_LIST $IGNORE_IP_LIST &gt; $TMP_FILE" &gt;&gt; $UNBAN_SCRIPT
	echo "mv $TMP_FILE $IGNORE_IP_LIST" &gt;&gt; $UNBAN_SCRIPT
	echo "rm -f $UNBAN_SCRIPT" &gt;&gt; $UNBAN_SCRIPT
	echo "rm -f $UNBAN_IP_LIST" &gt;&gt; $UNBAN_SCRIPT
	echo "rm -f $TMP_FILE" &gt;&gt; $UNBAN_SCRIPT
	. $UNBAN_SCRIPT &
}

add_to_cron&#40;&#41;
{
	rm -f $CRON
	sleep 1
	service crond restart
	sleep 1
	echo "SHELL=/bin/sh" &gt; $CRON
	if &#91; $FREQ -le 2 &#93;; then
		echo "0-59/$FREQ * * * * root /usr/local/ddos/ddos.sh &gt;/dev/null 2&gt;&1" &gt;&gt; $CRON
	else
		let "START_MINUTE = $RANDOM % &#40;$FREQ - 1&#41;"
		let "START_MINUTE = $START_MINUTE + 1"
		let "END_MINUTE = 60 - $FREQ + $START_MINUTE"
		echo "$START_MINUTE-$END_MINUTE/$FREQ * * * * root /usr/local/ddos/ddos.sh &gt;/dev/null 2&gt;&1" &gt;&gt; $CRON
	fi
	service crond restart
}


load_conf
while &#91; $1 &#93;; do
	case $1 in
		'-h' | '--help' | '?' &#41;
			showhelp
			exit
			;;
		'--cron' | '-c' &#41;
			add_to_cron
			exit
			;;
		'--kill' | '-k' &#41;
			KILL=1
			;;
		 *&#91;0-9&#93;* &#41;
			NO_OF_CONNECTIONS=$1
			;;
		* &#41;
			showhelp
			exit
			;;
	esac
	shift
done

TMP_PREFIX='/tmp/ddos'
TMP_FILE="mktemp $TMP_PREFIX.XXXXXXXX"
BANNED_IP_MAIL=`$TMP_FILE`
BANNED_IP_LIST=`$TMP_FILE`
echo "Banned the following ip addresses on `date`" &gt; $BANNED_IP_MAIL
echo &gt;&gt;	$BANNED_IP_MAIL
BAD_IP_LIST=`$TMP_FILE`
netstat -ntu | awk '{print $5}' | cut -d: -f1 | sort | uniq -c | sort -nr &gt; $BAD_IP_LIST
cat $BAD_IP_LIST
if &#91; $KILL -eq 1 &#93;; then
	IP_BAN_NOW=0
	while read line; do
		CURR_LINE_CONN=$&#40;echo $line | cut -d" " -f1&#41;
		CURR_LINE_IP=$&#40;echo $line | cut -d" " -f2&#41;
		if &#91; $CURR_LINE_CONN -lt $NO_OF_CONNECTIONS &#93;; then
			break
		fi
		IGNORE_BAN=`grep -c $CURR_LINE_IP $IGNORE_IP_LIST`
		if &#91; $IGNORE_BAN -ge 1 &#93;; then
			continue
		fi
		IP_BAN_NOW=1
		echo "$CURR_LINE_IP with $CURR_LINE_CONN connections" &gt;&gt; $BANNED_IP_MAIL
		echo $CURR_LINE_IP &gt;&gt; $BANNED_IP_LIST
		echo $CURR_LINE_IP &gt;&gt; $IGNORE_IP_LIST
		if &#91; $APF_BAN -eq 1 &#93;; then
			$APF -d $CURR_LINE_IP
		else
			$IPT -I INPUT -s $CURR_LINE_IP -j DROP
		fi
	done &lt; $BAD_IP_LIST
	if &#91; $IP_BAN_NOW -eq 1 &#93;; then
		dt=`date`
		if &#91; $EMAIL_TO != "" &#93;; then
			cat $BANNED_IP_MAIL | mail -s "IP addresses banned on $dt" $EMAIL_TO
		fi
		unbanip
	fi
fi
rm -f $TMP_PREFIX.*</pre>
		</div><br/> Hôm nay mình tạm dừng ở đây vì có một số điểm chưa thông khi đọc script này. với lại đang soan cái log để nhờ các anh chi mình là sao server bi treo.</span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>

		  <tr>
			<td height="20" colspan="2" valign="bottom" class="rowButton"><span class="gensmall">"Một người thành công không có ý nghĩ đổ thừa  thất bại do ...."</span></td>
		  </tr>

			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Re: Thư giãn với shell script một tý.<a name="123844" id="123844"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">08/04/2008 00:01:11 (+0700) | <a href="/hvaonline/posts/list/20793.html#123844">#7</a> | 123844 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/122389.html"><b>mR.Bi</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 22/03/2006 13:17:49<br>
		Messages: 812<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/122389.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/122389.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
			<a href="http://vndev.net" target="_new"><img src="/hvaonline/templates/viet/images/icon_www.gif" alt="[WWW]" title="[www]"></a>
		
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row1">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row1"><span class="postbody">hì, hackercoder!<br/> <br/> Mình thấy đoạn sript "chống ddos" này chỉ là một giải pháp tình thế vì dựa nhiều vào việc ban và ignore Ip list. Có thể nó có tác dụng trong trường hợp bị ddos ầm ầm từ một ip cụ thể nào đó, nhưng gây ra tình trạng người dùng bình thường cũng bị ban, mặc dù họ vô tội!<br/> <br/> </span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>

		  <tr>
			<td height="20" colspan="2" valign="bottom" class="rowButton"><span class="gensmall"> All of my life I have lived by a code and the code is simple: "honour your parent, love your woman and defend your children"</span></td>
		  </tr>

			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Chương 2. Một Shell script anti ddos của inetbase.com ( zaf@vsnl.com )<a name="123881" id="123881"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">08/04/2008 03:09:40 (+0700) | <a href="/hvaonline/posts/list/20793.html#123881">#8</a> | 123881 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/83486.html"><b>subnetwork</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 05/09/2004 06:08:09<br>
		Messages: 1666<br>
	
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/83486.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/83486.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
			<a href="http://chamsocmaychu.com" target="_new"><img src="/hvaonline/templates/viet/images/icon_www.gif" alt="[WWW]" title="[www]"></a>
		
			<a href="http://edit.yahoo.com/config/send_webmesg?.target=nixmicrosoft&amp;.src=pg"><img src="/hvaonline/templates/viet/images/icon_yim.gif" alt="[Yahoo!]" title="[YIM]"></a>
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row2">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row2"><span class="postbody"><p></p>
		<cite class="blockquote">hackercoder wrote:</cite><br>
		<blockquote>Đầu tiên các bạn có thể vào đây để xem thông tin về script này.<br/> <span class="link"> http://www.inetbase.com/scripts/ddos/</span><br/> để bắt đầu mình sẽ phân tích từ files cài đặt.<br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>#!/bin/sh
if &#91; -d '/usr/local/ddos' &#93;; then
	echo; echo; echo "Please un-install the previous version first"
	exit 0
else
	mkdir /usr/local/ddos
fi
clear
echo; echo 'Installing DOS-Deflate 0.6'; echo
echo; echo -n 'Downloading source files...'
wget -q -O /usr/local/ddos/ddos.conf<span class="link"> http://www.inetbase.com/scripts/ddos/ddos.conf</span>
echo -n '.'
wget -q -O /usr/local/ddos/LICENSE<span class="link"> http://www.inetbase.com/scripts/ddos/LICENSE</span>
echo -n '.'
wget -q -O /usr/local/ddos/ignore.ip.list<span class="link"> http://www.inetbase.com/scripts/ddos/ignore.ip.list</span>
echo -n '.'
wget -q -O /usr/local/ddos/ddos.sh<span class="link"> http://www.inetbase.com/scripts/ddos/ddos.sh</span>
chmod 0755 /usr/local/ddos/ddos.sh
cp -s /usr/local/ddos/ddos.sh /usr/local/sbin/ddos
echo '...done'

echo; echo -n 'Creating cron to run script every minute.....&#40;Default setting&#41;'
/usr/local/ddos/ddos.sh --cron &gt; /dev/null 2&gt;&1
echo '.....done'
echo; echo 'Installation has completed.'
echo 'Config file is at /usr/local/ddos/ddos.conf'
echo 'Please send in your comments and/or suggestions to &lt;a href="mailto:zaf@vsnl.com"&gt;zaf@vsnl.com&lt;/a&gt;'
echo
cat /usr/local/ddos/LICENSE | less</pre>
		</div><br/> đoạn script trên sẽ tải về server bạn 4files.<br/> chmod files ddps.sh là 0775<br/> cuối cùng là add cron để chạy script.<br/> tiếp đến để hiểu rõ con script này nên phân tích cách hoạt động của nó. files cấu hình của script là ddos.conf<br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>##### Paths of the script and other files
PROGDIR="/usr/local/ddos"
PROG="/usr/local/ddos/ddos.sh"
IGNORE_IP_LIST="/usr/local/ddos/ignore.ip.list"
CRON="/etc/cron.d/ddos.cron"
APF="/etc/apf/apf"
IPT="/sbin/iptables"

##### frequency in minutes for running the script
##### Caution: Every time this setting is changed, run the script with --cron
#####          option so that the new frequency takes effect
FREQ=1

##### How many connections define a bad IP? Indicate that below.
NO_OF_CONNECTIONS=150

##### APF_BAN=1 &#40;Make sure your APF version is atleast 0.96&#41;
##### APF_BAN=0 &#40;Uses iptables for banning ips instead of APF&#41;
APF_BAN=1

##### KILL=0 &#40;Bad IPs are'nt banned, good for interactive execution of script&#41;
##### KILL=1 &#40;Recommended setting&#41;
KILL=1

##### An email is sent to the following address when an IP is banned.
##### Blank would suppress sending of mails
EMAIL_TO="root"

##### Number of seconds the banned ip should remain in blacklist.
BAN_PERIOD=600</pre>
		</div><br/> chắc hẳn khi nhìn vào đoạn #### thì không cần mình giải thích nhỉ <img src="/hvaonline/images/smilies/b5e9b4f86ce43ca65bd79c894c4a924c.gif" border="0" alt="smilie" align="absbottom"><br/> tùy theo nhu cầu của bạn mà config nó. sao cho phù hợp với server của bạn. ( cái này quyết định tính hiệu quả của script )<br/> tiếp theo phân tích files ddos.sh để xem cấu trúc làm việc của nó.<br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>#!/bin/sh
##############################################################################
# DDoS-Deflate version 0.6 Author: Zaf &lt;zaf@vsnl.com&gt;                        #
##############################################################################
# This program is distributed under the "Artistic License" Agreement         #
#                                                                            #
# The LICENSE file is located in the same directory as this program. Please  #
#  read the LICENSE file before you make copies or distribute this program   #
##############################################################################
load_conf&#40;&#41;
{
	CONF="/usr/local/ddos/ddos.conf"
	if &#91; -f "$CONF" &#93; && &#91; ! "$CONF" ==	"" &#93;; then
		source $CONF
	else
		head
		echo "\$CONF not found."
		exit 1
	fi
}

head&#40;&#41;
{
	echo "DDoS-Deflate version 0.6"
	echo "Copyright &#40;C&#41; 2005, Zaf &lt;zaf@vsnl.com&gt;"
	echo
}

showhelp&#40;&#41;
{
	head
	echo 'Usage: ddos.sh &#91;OPTIONS&#93; &#91;N&#93;'
	echo 'N : number of tcp/udp	connections &#40;default 150&#41;'
	echo 'OPTIONS:'
	echo '-h | --help: Show	this help screen'
	echo '-c | --cron: Create cron job to run this script regularly &#40;default 1 mins&#41;'
	echo '-k | --kill: Block the offending ip making more than N connections'
}

unbanip&#40;&#41;
{
	UNBAN_SCRIPT=`mktemp /tmp/unban.XXXXXXXX`
	TMP_FILE=`mktemp /tmp/unban.XXXXXXXX`
	UNBAN_IP_LIST=`mktemp /tmp/unban.XXXXXXXX`
	echo '#!/bin/sh' &gt; $UNBAN_SCRIPT
	echo "sleep $BAN_PERIOD" &gt;&gt; $UNBAN_SCRIPT
	if &#91; $APF_BAN -eq 1 &#93;; then
		while read line; do
			echo "$APF -u $line" &gt;&gt; $UNBAN_SCRIPT
			echo $line &gt;&gt; $UNBAN_IP_LIST
		done &lt; $BANNED_IP_LIST
	else
		while read line; do
			echo "$IPT -D INPUT -s $line -j DROP" &gt;&gt; $UNBAN_SCRIPT
			echo $line &gt;&gt; $UNBAN_IP_LIST
		done &lt; $BANNED_IP_LIST
	fi
	echo "grep -v --file=$UNBAN_IP_LIST $IGNORE_IP_LIST &gt; $TMP_FILE" &gt;&gt; $UNBAN_SCRIPT
	echo "mv $TMP_FILE $IGNORE_IP_LIST" &gt;&gt; $UNBAN_SCRIPT
	echo "rm -f $UNBAN_SCRIPT" &gt;&gt; $UNBAN_SCRIPT
	echo "rm -f $UNBAN_IP_LIST" &gt;&gt; $UNBAN_SCRIPT
	echo "rm -f $TMP_FILE" &gt;&gt; $UNBAN_SCRIPT
	. $UNBAN_SCRIPT &
}

add_to_cron&#40;&#41;
{
	rm -f $CRON
	sleep 1
	service crond restart
	sleep 1
	echo "SHELL=/bin/sh" &gt; $CRON
	if &#91; $FREQ -le 2 &#93;; then
		echo "0-59/$FREQ * * * * root /usr/local/ddos/ddos.sh &gt;/dev/null 2&gt;&1" &gt;&gt; $CRON
	else
		let "START_MINUTE = $RANDOM % &#40;$FREQ - 1&#41;"
		let "START_MINUTE = $START_MINUTE + 1"
		let "END_MINUTE = 60 - $FREQ + $START_MINUTE"
		echo "$START_MINUTE-$END_MINUTE/$FREQ * * * * root /usr/local/ddos/ddos.sh &gt;/dev/null 2&gt;&1" &gt;&gt; $CRON
	fi
	service crond restart
}


load_conf
while &#91; $1 &#93;; do
	case $1 in
		'-h' | '--help' | '?' &#41;
			showhelp
			exit
			;;
		'--cron' | '-c' &#41;
			add_to_cron
			exit
			;;
		'--kill' | '-k' &#41;
			KILL=1
			;;
		 *&#91;0-9&#93;* &#41;
			NO_OF_CONNECTIONS=$1
			;;
		* &#41;
			showhelp
			exit
			;;
	esac
	shift
done

TMP_PREFIX='/tmp/ddos'
TMP_FILE="mktemp $TMP_PREFIX.XXXXXXXX"
BANNED_IP_MAIL=`$TMP_FILE`
BANNED_IP_LIST=`$TMP_FILE`
echo "Banned the following ip addresses on `date`" &gt; $BANNED_IP_MAIL
echo &gt;&gt;	$BANNED_IP_MAIL
BAD_IP_LIST=`$TMP_FILE`
netstat -ntu | awk '{print $5}' | cut -d: -f1 | sort | uniq -c | sort -nr &gt; $BAD_IP_LIST
cat $BAD_IP_LIST
if &#91; $KILL -eq 1 &#93;; then
	IP_BAN_NOW=0
	while read line; do
		CURR_LINE_CONN=$&#40;echo $line | cut -d" " -f1&#41;
		CURR_LINE_IP=$&#40;echo $line | cut -d" " -f2&#41;
		if &#91; $CURR_LINE_CONN -lt $NO_OF_CONNECTIONS &#93;; then
			break
		fi
		IGNORE_BAN=`grep -c $CURR_LINE_IP $IGNORE_IP_LIST`
		if &#91; $IGNORE_BAN -ge 1 &#93;; then
			continue
		fi
		IP_BAN_NOW=1
		echo "$CURR_LINE_IP with $CURR_LINE_CONN connections" &gt;&gt; $BANNED_IP_MAIL
		echo $CURR_LINE_IP &gt;&gt; $BANNED_IP_LIST
		echo $CURR_LINE_IP &gt;&gt; $IGNORE_IP_LIST
		if &#91; $APF_BAN -eq 1 &#93;; then
			$APF -d $CURR_LINE_IP
		else
			$IPT -I INPUT -s $CURR_LINE_IP -j DROP
		fi
	done &lt; $BAD_IP_LIST
	if &#91; $IP_BAN_NOW -eq 1 &#93;; then
		dt=`date`
		if &#91; $EMAIL_TO != "" &#93;; then
			cat $BANNED_IP_MAIL | mail -s "IP addresses banned on $dt" $EMAIL_TO
		fi
		unbanip
	fi
fi
rm -f $TMP_PREFIX.*</pre>
		</div><br/> Hôm nay mình tạm dừng ở đây vì có một số điểm chưa thông khi đọc script này. với lại đang soan cái log để nhờ các anh chi mình là sao server bi treo.&nbsp;
		</blockquote><br/> <br/> <span class="link"> http://rfxnetworks.com/apf.php</span><br/> <br/> Rắc rối <img src="/hvaonline/images/smilies/b5e9b4f86ce43ca65bd79c894c4a924c.gif" border="0" alt="smilie" align="absbottom"><br/> <br/> Nên đọc script nó nói cái gì trước tiên, sau đó mới cài đặt, thử nghiệm nó trên server . Không phải đoạn script nào củng "đè" cài đặt vào server của mình được cả nên cân nhắc cẩn thận việc cài đặt phần mềm trên máy chủ .<br/> <br/> Nghiên cứu viết đoạn script cho riêng mình sử dụng iptables thay vì "lụm" các đoạn script được share trên internet . <br/> <br/> Vài thiển ý cá nhân</span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>

		  <tr>
			<td height="20" colspan="2" valign="bottom" class="rowButton"><span class="gensmall">Quản lý máy chủ, cài đặt, tư vấn, thiết kế, bảo mật hệ thống máy chủ dùng *nix<br>http://chamsocmaychu.com</span></td>
		  </tr>

			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Script PHP anti ddos bổ sung và mở rộng chương 2.<a name="123946" id="123946"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">08/04/2008 08:06:44 (+0700) | <a href="/hvaonline/posts/list/20793.html#123946">#9</a> | 123946 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>
<td width="20">
		<img src="/hvaonline/images/avatar/8473446b734702b73ac2972b7bbf7bf7.jpg" border="0" alt="[Avatar]" title="[Avatar]"><br>
	</td>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/140396.html"><b>Phó Hồng Tuyết</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 20/04/2007 20:02:10<br>
		Messages: 275<br>
	
		Location: Nơi Sâu Thẳm Tâm Hồn<br>
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/140396.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/140396.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
			<a href="http:// ???-những gì còn lại !" target="_new"><img src="/hvaonline/templates/viet/images/icon_www.gif" alt="[WWW]" title="[www]"></a>
		
			<a href="http://edit.yahoo.com/config/send_webmesg?.target=codervietnam&amp;.src=pg"><img src="/hvaonline/templates/viet/images/icon_yim.gif" alt="[Yahoo!]" title="[YIM]"></a>
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row1">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row1"><span class="postbody">Em cám ơn anh <b>tranhuuphuoc </b>đã góp ý. Đúng như anh nói. nếu không hiểu nó viết gì thì khi cài vào máy chủ thì chỉ có chết. <br/> những script trên em đã thử nghiệm ở VPS. thấy nó chạy mà chưa phát sinh lỗi gì nên em post lên đây để các bạn khác tham khảo.<br/> Các bạn chú ý. Thử thì được nhưng đặc biệt hạn chế khi sử dụng nó để cài lên máy chủ nhé. Khi nào hiểu hết ý nghĩa của các câu lệnh hoặc hiểu con script này nói gì thì hãy áp dụng.<br/> xin dừng xem dây là script chống ddos nhé. nó chỉ là một trong những script mình sưu tầm và mình đưa vào các bài post theo các chương từ từ nâng cao.<br/> các chương gồm có.<br/> chương một vd với script cơ bản, tạo và thực hành một số lệnh.<br/> chương 2 một số script với ứng dụng đơn giản được năng cao hơn một chút.<br/> chương 3 tạo một Script firewall bằng iptables căn bản.<br/> chương 4 năng cao của script firewall của iptables.<br/> ....<br/> và tất cả những gì mà mình học lóm được của tụi IT nước ngoài. cũng như các thủ đoạn của dân IT nước ngoài.<br/> <br/> mục đích mình post là gì?<br/> <br/> mình là một người tay ngang không phải là dân it thứ thiêt. mình chỉ có một đam mê với it ( it đúng nghĩa ). chưa hề có một bằng cấp nào về it cả. Kể cả một cái bằng sơ đẳng là bằng A tin học ( xóa mù ấy ) cũng không có. mình muốn chia sẻ ít kinh nghiệm của mình với các bạn tay ngang như mình. Khi mình bắt đầu tham gia vào lĩnh vực IT mình không biết bắt đầu từ đâu. đặc biệt chẳng có tí kiến thức gì.<br/> nhưng dần dần với nỗi đam mê của mình mình cũng từng bước từng bước, bước vào thế giới IT bằng những bước đi khập khiễng.<b><br/> Xin lỗi đã đi xa vấn đề bây giời chở lại vấn đề chính.</b><br/> Ở phần này mình share một script anti floods, x-flash. Scipt này hoàn thành được phần lớn là nhờ code : Anh Quốc Bảo, sử dụng capcha Free. Mình đã xin phép anh ấy để puplic script này. ( nếu các bạn thấy script này thỏa mãn nhu cầu của bạn xin hãy gửi lời cám ơn đến anh ấy )<br/> Cơ chế hoạt động của script.<br/> Script chỉ có tác dụng trên tầng application.<br/> Hỗ trợ tất cả các loại forum, các loại cms, các website được viết bằng ngôn ngữ .php <br/> Script phát huy tối đa tác dụng khi web hỗ trợ php.ini.<br/> Script phát huy 50% khi sử dụng .htaccess.<br/> Scipt hoạt động tốt nhất trên nền OS linux, đặc biệt là fedora 6 sử dụng CPL D.Admin.<br/> Đầu tiên script sẽ bắt nhập capcha khi một clien gửi một http request đến server<br/> sau khi kiểm tra bằng capcha sẽ ghi lại cookie của clien. và ip của clien được ghi vào một vị trí nhất định. tại đây script sẽ lấy ip để đếm số lần hit/s/all files của website. nếu trong một thời gian nào đó ( do bạn quy định ) sẽ chuyển đến đoạn sử lý riêng. ( ở đoạn này các bạn có thể tỳ ý thêm bớt để cho scipt hoạt động theo ý của các bạn - có thể ban hoặc chuyển hướng ddos tại đây -- gợi ý dùng java va html để chuyển hướng hoặc sử dụng cron add một shell sử dụng iptables để vô hiệu hóa ip đó )<br/> Đầu tiên các bạn download script này tại đây.<br/> <span class="link"> http://rapidshare.com/files/105498946/anti-flood.rar</span><br/> sau khi giải nén các bạn upload các folder anti-flood,class,png_bank và các files anti.php, anti.capcha.php, captcha_img.php<br/> lên thư mục root của website.<br/> chmod 0777 anti-flood,block,ip<br/> chmod  0444 3 files anti.php, anti.capcha.php, captcha_img.php <br/> bạn mở files php.ini lên tìm dòng này<br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>auto_prepend_file =</pre>
		</div><br/> điều chỉnh nó thành<br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>auto_prepend_file = /srv/www/vhosts/yourdomain.com/httpdocs &#40;hoặc Puplic_html&#41; /anti.php</pre>
		</div><br/> save lại. ( nếu là server restart http )<br/> bạn mở files anti.php lên<br/> hiệu chỉnh lại các thông số sau sao cho phù hợp với mục đích sử dụng của bạn<br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>$max_hits = 30;
$max_alive = 3;
$interval = 5;
$delay = 3600;</pre>
		</div><br/> Giới hạn 1 IP truy cập vào không quá {$max_hits} trong vòng {$interval} giây, nếu ip đó truy cập quá mức sẽ ban trong {$delay} giây.<br/> <br/> Sau khi thiết lập xong bạn nên add cron để del các files ở folder block,ip vào lúc 0 giời là hay nhất.<br/> bạn cũng có thể cho scipt chạy ngầm bằng cách bỏ nhập capcha bằng cách mở files anti.php lên tìm dòng này<br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>require_once dirname&#40;__FILE__&#41; . "/anti.capcha.php";
sửa lại thành 
//require_once dirname&#40;__FILE__&#41; . "/anti.capcha.php";</pre>
		</div><br/> chúc các bạn vui vẻ và có thêm đam mê khi bước vào thế giới IT.<br/> <br/> Một lần nữa cám ơn anh <b>tranhuuphuoc </b> xin anh thấy em sai ở điểm nào anh cứ nói để em có cái nhìn đa phương về vấn đề em đã nêu.<br/> <br/> Cám ơn hai bạn <b>mR.Bi</b>, <b>kholostoi</b> xin chân thành cám ơn hai bạn đã góp ý cho mình.</span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>

		  <tr>
			<td height="20" colspan="2" valign="bottom" class="rowButton"><span class="gensmall">"Một người thành công không có ý nghĩ đổ thừa  thất bại do ...."</span></td>
		  </tr>

			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		


<table cellspacing="0" cellpadding="0" width="100%" align="center" border="1">
	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr>

		

		<th nowrap="nowrap" class="thright" height="20" valign="middle" align="left">&nbsp;&nbsp;<span class="posttype"><font color="#777777">[Question]</font></span>&nbsp;&nbsp; Chuơng III. basic secure server  ( script có tính tương đối ).<a name="125627" id="125627"></a></th>
        <th class="thleft" nowrap="nowrap" width="300" height="20" valign="middle" align="right">17/04/2008 01:32:59 (+0700) | <a href="/hvaonline/posts/list/20793.html#125627">#10</a> | 125627 </th>
		
      </tr>
	</table>

	<table cellspacing="0" cellpadding="3" width="100%" align="center" border="0">
      <tr> 
		<!-- Username & profile -->
          	<td class="rowButton" valign="top">
<table cellspacing="3" cellpadding="3" width="100%" align="left" border="0">
<tr>
<td width="20">
		<img src="/hvaonline/images/avatar/8473446b734702b73ac2972b7bbf7bf7.jpg" border="0" alt="[Avatar]" title="[Avatar]"><br>
	</td>

<td align="left">
<span class="uprofile"><a href="/hvaonline/user/profile/140396.html"><b>Phó Hồng Tuyết</b></a><br>
	<font color="#CCCCCC">Member</font></span>
<br>

<span class="uprofile">
		
</span>
	<table cellspacing="0" cellpadding="0" border="0" width="20" height="8">
		<tr>
			<td>
				<img src="/hvaonline/templates/viet/images/minus.gif" alt="[Minus]" title="[Minus]"></a>	</td>
			<td height="4" width="16">
				<span class="warn">&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;</span>	</td>
			<td>
				<img src="/hvaonline/templates/viet/images/plus.gif" alt="[Plus]" title="[Plus]"></a>
			</td>
		</tr>
	</table>

<!-- --></td>
	<td align="left" class="gen" width="180">
		Joined: 20/04/2007 20:02:10<br>
		Messages: 275<br>
	
		Location: Nơi Sâu Thẳm Tâm Hồn<br>
	
	
			<span class="offline">Offline </span>
	<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
  <tr>
	<td valign="middle" nowrap="nowrap"> 
		<a href="/hvaonline/user/profile/140396.html" class="icon_profile"><img src="/hvaonline/templates/viet/images/en_US/icon_profile.gif" alt="[Profile]" title="[Profile]"></a>
		<a href="/hvaonline/pm/sendTo/140396.html" class="icon_pm"><img src="/hvaonline/templates/viet/images/en_US/icon_pm.gif" alt="[PM]" title="[PM]"></a>

		
			<a href="http:// ???-những gì còn lại !" target="_new"><img src="/hvaonline/templates/viet/images/icon_www.gif" alt="[WWW]" title="[www]"></a>
		
			<a href="http://edit.yahoo.com/config/send_webmesg?.target=codervietnam&amp;.src=pg"><img src="/hvaonline/templates/viet/images/icon_yim.gif" alt="[Yahoo!]" title="[YIM]"></a>
		
		
	</td>
</tr>
  <tr>
    <td valign="middle" nowrap="nowrap">
	
</td>
  </tr>
</table>
	</td>
</tr>
</table>
</td>
      </tr>
	</table>
	
	<table cellspacing="1" cellpadding="3" width="100%" align="center" border="0">
      <tr>
        <!-- Message -->
        <td colspan="2" valign="top" class="row2">
				<!-- should view editeBy or not -->
			  <!-- which to view -->
                <table cellspacing="3" cellpadding="3" width="100%" align="center" border="0">
                  <tr>
                    <td valign="top" class="row2"><span class="postbody">ở chương này mình giới thiệu với các bạn hai shell script có tính năng kiểm tra sơ bộ độ an toàn của server unix nói chung. Script này có tính chất tương đối đối với các bạn tay ngang như mình.<br/> <b>1. Lynis</b><br/> Description<br/> Security and system auditing tool<br/> Project information<br/> Lynis is an auditing tool for Unix (specialists). It scans the system configuration and creates an overview of system information and security issues usable by professional auditors.<br/> <br/> This software aims in assisting automated auditing of Unix based systems and can be used in addition to other software, like security scanners, system benchmarking and fine tuning tools.<br/> <br/> Intended audience:<br/> Security specialists, system auditors, system/network managers.<br/> <br/> Current state:<br/> Stable releases are available, development is active.<br/> <br/> <br>
			<div align="center" class="limitview"><img src='http://www.rootkit.nl/images/lynis-screenshot.png' border="0"  /></div><br/> <br/> System requirements:<br/> - Compatible operating system (see 'Supported operating systems')<br/> - Default shell<br/> <br/> Supported operating systems<br/> Tested on:<br/> - CentOS 5<br/> - Debian 4.0<br/> - Fedora Core 4 and higher<br/> - FreeBSD 6.2, 7.0<br/> - Mac OS X 10.4<br/> - OpenBSD 4.2<br/> - OpenSuSE<br/> - Ubuntu 7.04, 7.10<br/> <br/> Currently unsupported:<br/> - All others (though some will work)<br/> <br/> cách cài đặt.<br/> bạn login vào server của bạn, dùng lệnh sau:<br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>wget<span class="link"> http://www.rootkit.nl/files/lynis-1.1.1.tar.gz</span></pre>
		</div><br/> <br/> tiếp đó giải nén nó.<br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>tar xfvz lynis-1.1.1.tar.gz</pre>
		</div><br/> <br/> tiếp dùng lệnh<br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>cd lynis</pre>
		</div><br/> <br/> kiểm tra tất cả.<br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>./lynis -c</pre>
		</div><br/> <br/> sau đó các bạn sẽ có một bảng tổng kết. phần nào chưa được điều chỉnh hoặc điều chỉnh nhưng độ an toàn thấp sẽ hiện lên màu đỏ. các bạn theo đó mà giải quyết vấn đề.<br/> <br/> 2. <b>Linux Security Auditing Tool (LSAT)</b><br/> <br/> các chức năng :<br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>checkbpass:
- This module check for a boot loader password
- Currently only for grub and lilo

checkcfg:
- This module is performed last
- RedHat specific. Just prints out /sbin/chkconfig --list so that
  the user can perform a visual inspection.

checkdotfiles:
- Looks for .forward, .exrc, .rhosts and .netrc files on the system.
- Does not span "other" filesystems. 

checkfiles:
- checks that /tmp and /var/tmp have sitcky bit set
- checks utmp, wtmp, motd, mtab for chmod 644.
- checks /usr, /var dirs/files for root ownership.

checkftpusers:
- checks that all accounts in /etc/passwd are in /etc/ftpusers.

checkhostsfiles:
- Reads /etc/hosts.allow and /etc/hosts.deny files
- Checkes deny for ALL:ALL statement.
- Checks allow for any ALL statements.

checkinetd:
- Checks either /etc/inetd.conf or /etc/xinetd.d/* 
- If inetd.conf, it checks for entries not hashed out.
	&#40;All entries should be commented out :&#41;
- If xinetd.d it checks all files in that dir for disable = yes.

checkinittab:
- Check to see if the default runlevel is 5. If it is, give the user a warning.

checkipv4:
- Checks for common forwarding and ignore settings in ipv4.

checkissue:
- checks to make sure that /etc/motd, /etc/issue and /etc/issue.net
  do not exist, or if they do, warn the user.

checkkbd:
- checks that ctrlaltdel function is disabled under linux.
- checks for KEYBOARD_DISABLE to be enabled under Solaris.

checklimits:
- performs simple check of limits.conf file

checklogging:
- simple check to see if the auth and authpriv logging facilities are on.
  This is mostly for older versions of linux, as I know redhat and others
  have this on by default now...

checkmodules:
- checks to see if loadable kernel modules are enabled

checkmd5:
- performs a system-wide md5sum on all regular files.
- only executes if -m switch is used
- output is in lsatmd5.out, previous output in lsatmd5.old

checknet:
- checks what ports the system is listening to.
- &#40;may not check _all_ ports. I have to RTFM on this one&#41;

checknetforward:
- checks that ipv4 forwarding is disabled under linux
- checks that ipforwarding & source routing are disabled under Solaris
- checks that norouter & defaultrouter exist under Solaris

checknetp:
- checks that no interface is in Promiscuous mode

checkopenfiles:
- checks for all open files on the system using lsof &#40;if installed&#41;

checkpasswd:
- checks /etc/passwd for unneeded accounts.
- checks that only root is SUID=0.

checkrcperms:
- checks files in init.d dir to see if they are chmod 700

checkpkgs:
- Checks list of packages &#40;rpms, debs&#41; installed on the system.
- Checks against a list of "should not have" rpms.
- &#40;this list quite possibly needs to be expanded&#41;

checkrc:
- checks /etc/rcn.d or /etc/rc.d/init.d and reports unneeded scripts.

checkrpm: &#40;redhat specific&#41;
- check to see if we are on redhat, and if we are...
- use the built in rpm -Va to verify rpms on the system.

checksecuretty:
-check to see if only tty&#91;0-6&#93; are in /etc/securetty

checkset:
- Checks system for all setuid/setgid files.
- Also checks for block or char files in /dev/ that do not belong.

checkssh:
- check some security features of ssh for instance:
  root logins, X11 forwarding and the like.

checkumask:
- checks that the default umask on the system is sensible.

checkwrite:
- Checks system for world writable files.

checkwww:
- check to see if ExecCGIs are enabled.
- check to see who is running httpd/apache.</pre>
		</div><br/> <br/> kết quả được thể hiện như sau :<br/> <br/> <span class="quotetxt"><b>Code:</b></span><br/>
		<div class="coded"">
		<pre>changelog is not chmod 644.
config.status is not chmod 644.
configure is not chmod 644.
lsat is not chmod 644.
lsat.html is not chmod 644.
lsat.pod is not chmod 644.
/var/run/syslog-ng.pid is not chmod 644.
changelog is not chmod 644.
config.status is not chmod 644.
configure is not chmod 644.
lsat is not chmod 644.
lsat.html is not chmod 644.
lsat.pod is not chmod 644.
Check above files for chmod 644.
...................


...........</pre>
		</div><br/> <br/> bản này đầy đủ hơn. các bạn có thể vào <span class="link"> http://usat.sourceforge.net/</span><br/> để biết rõ các chi tiết.<br/> chúc các bạn ngày càng pro hơn với server mình quản lý.<br/> <br/> P/s : script anti ddos viết bằng PHP mình đã del rồi. đang sửa một số code cho phù hợp. hiện tại nó chỉ có tác dụng trên D. webserver<br/> </span></td>
                  </tr>
                </table>
          <!-- Attachments -->
			  		</td>
      </tr>

		  <tr>
			<td height="20" colspan="2" valign="bottom" class="rowButton"><span class="gensmall">"Một người thành công không có ý nghĩ đổ thừa  thất bại do ...."</span></td>
		  </tr>

			<tr>
		        <td valign="bottom" class="row1" align="center"><div class="action" align="center">
	<table width="100%" border="0">
  		<tr>
		<td align="left">
					</td>
		<td align="right">
			<!--  -->
			
		


		
		
		<a class="nav" href="#top"><img src="/hvaonline/templates/viet/images/en_US/icon_up.gif" alt="[Up]" title="[Up]"></a>
			<img src="/hvaonline/templates/viet/images/en_US/icon_print.gif" alt="[Print Copy]" title="[Print Copy]"></a>
		</td>
  	</tr>
	</table>
</div></td>
		  </tr>
	</table>

<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
	<tr>
    	<td class="catbottomslim" height="1"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="5"></td>
  	</tr>
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="20"></td>
	</tr>
</table>

		

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td valign="middle" align="right" class="nav"></td>
	</tr>
</table>

<!-- quick reply -->
<table class="forumline" cellspacing="1" cellpadding="3" width="100%" border="0" align="center">
</table>

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="10"></td>
	</tr>
</table>

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td align="left">
			<!-- watch - unwatch -->
			<!-- add bookmark -->

		</td>
		<td align="right" valign="bottom">			
		</td>
	</tr>
</table>

<!-- mod -->

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td colspan="3"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="10"></td>
	</tr>
</table>

<!-- combo navigator -->
<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td align="left"><a href="http://digg.com/submit?phrase=2&url=/hvaonline/posts/list/20793.html"><img src="/hvaonline/templates/viet/images/digg.gif" align="texttop" alt="[digg]" title="[digg]"></a>
<a href="http://del.icio.us/post?url=/hvaonline/posts/list/20793.html"><img src="/hvaonline/templates/viet/images/delicious.gif" align="texttop" alt="[delicious]" title="[delicious]"></a>
<a href="http://www.google.com/bookmarks/mark?op=edit&output=popup&bkmk=/hvaonline/posts/list/20793.html"><img src="/hvaonline/templates/viet/images/google.gif" align="texttop" alt="[google]" title="[google]"></a>
<a href="http://bookmarks.yahoo.com/toolbar/savebm?opener=tb&u=/hvaonline/posts/list/20793.html"><img src="/hvaonline/templates/viet/images/yahoo.gif" align="texttop" alt="[yahoo]" title="[yahoo]"></a>
<a href="http://technorati.com/faves?add=/hvaonline/posts/list/20793.html"><img src="/hvaonline/templates/viet/images/technorati.gif" align="texttop" alt="[technorati]" title="[technorati]"></a>
<a href="http://reddit.com/submit?url=/hvaonline/posts/list/20793.html"><img src="/hvaonline/templates/viet/images/reddit.gif" align="texttop" alt="[reddit]" title="[reddit]"></a>
<a href="http://www.stumbleupon.com/submit?url=/hvaonline/posts/list/20793.html"><img src="/hvaonline/templates/viet/images/stumbleupon.gif" align="texttop" alt="[stumbleupon]" title="[stumbleupon]"></a></td>
		<td align="right">	<table cellspacing="0" cellpadding="0" border="0">
		<tr>			  
			<td nowrap="nowrap">
				<form action="" name="f" id="f" accept-charset="UTF-8">
					<span class="gensmall">Go to:&nbsp;</span>
					<select onchange="if(this.options[this.selectedIndex].value > 0){ document.location = '/hvaonline/forums/show/'+ this.options[this.selectedIndex].value +'.html'; }" name="select">
						<option value="0" selected="selected">Select a forum</option>				
							<option value="0">-------------</option>
									<option value="2" >Thông báo từ HVA</option>
									<option value="41" >FAQ - Các câu hỏi thường gặp</option>
									<option value="5" >Góp ý và Hỏi đáp thắc mắc chung</option>
									<option value="6" >Kiểm tra bảo mật</option>
							<option value="0">-------------</option>
									<option value="8" >Thảo luận bảo mật</option>
									<option value="12" >Thảo luận thâm nhập</option>
									<option value="28" >Thảo luận virus, trojan, spyware, worm...</option>
									<option value="36" >Thủ thuật reverse engineering</option>
									<option value="13" >Thông tin new bugs và exploits</option>
									<option value="51" >Case Studies</option>
							<option value="0">-------------</option>
									<option value="23" >Thảo luận hệ điều hành Windows</option>
									<option value="24" selected="selected">Thảo luận hệ điều hành *nix</option>
									<option value="26" >Thảo luận các loại thiết bị máy tính</option>
									<option value="31" >Thảo luận mạng và thiết bị mạng</option>
									<option value="27" >Thông tin về các địa chỉ và tài liệu hữu ích</option>
							<option value="0">-------------</option>
									<option value="44" >Người tìm việc - Việc tìm người</option>
									<option value="21" >Thảo luận việc định hướng</option>
									<option value="19" >Những thảo luận khác</option>
									<option value="50" >Hình minh họa</option>
									<option value="33" >Trash</option>
							<option value="0">-------------</option>
					</select>
				</form>
			</td>
		</tr>
	</table>
</td>
	</tr>
</table>

<table cellspacing="0" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<td colspan="3"><img src="/hvaonline/templates/viet/images/spacer.gif" alt="" width="1" height="10"></td>
	</tr>
</table>

<!-- list users in -->
<table class="forumline" cellspacing="3" cellpadding="0" width="100%" border="0" align="center">
	<tr>
		<th class="thright"  nowrap="nowrap" height="26" valign="middle">&nbsp;Users currently in here&nbsp;</th>
	</tr>
		<tr>
			<td class="gensmall" valign="middle" align="left">
				1 Anonymous 
				
			</td>	
		</tr>
</table>
<a name="quick"></a>

<table cellspacing="0" cellpadding="0" width="100%" border="0"  align="center">

	<tr>	
		<td align="center">
		<br>
					</td>
	</tr>

	<tr>
		<td align="center">
			<span class="copyright">Powered by JForum - Extended by <a href="MailTo:lienlac@hvaonline.net">HVAOnline</a><br>
			&nbsp;hvaonline.net&nbsp; | &nbsp;hvaforum.net&nbsp; | &nbsp;hvazone.net&nbsp; | &nbsp;hvanews.net&nbsp; | &nbsp;vnhacker.org<br>
			1999 - 2013 &copy;
			v2012|0504|218|
		  </span>
	  </td>
	</tr>
<iframe src="/hvaonline/templates/ping_session.html" height="0" width="0" frameborder="0" scrolling="no"></iframe>
</body>
</html>
</table>

<script type="text/javascript" src="/hvaonline/templates/viet/js/post_show.js"></script>
<script type="text/javascript" src="/hvaonline/templates/viet/js/post.js"></script>
<script type="text/javascript" src="/hvaonline/templates/viet/js/avim.js"></script>
<script type="text/javascript">
<!--
function showEmail(beforeAt, afterAt)
{
	return beforeAt + "@" + afterAt;
}

var starOn=new Image();
starOn.src="/hvaonline/templates/viet/images/star_on.gif";

var starOff=new Image();
starOff.src="/hvaonline/templates/viet/images/star_off.gif";

function writeStars(q, postId)
{
	for (var i = 0; i < 5; i++) {
		var name = "star" + postId + "_" + i;
		document.write("<img name='" + name + "' alt='*' />");
		document.images[name].src = q > i ? starOn.src : starOff.src;
	}
}

function addBookmark(relationType, relationId)
{
	var w = window.open('/hvaonline/bookmarks/insert/' + relationType + '/' + relationId + '.html', 'bookmark_add', 'width="700", height="100", scrollbars="no"');
	w.focus();
}

function supportAjax()
{
	if (typeof(AjaxUtils) != 'undefined') {
		if (window.ActiveXObject) {
			var r = new ActiveXObject("Microsoft.XMLHTTP");
			return r != undefined;
		}
		else if (window.XMLHttpRequest) {
			return true;
		}
	}

	return false;
}




function maxImg(foto, maxSize){
w = foto.width;
if (w > maxSize){
	foto.width = maxSize;
	}
} 

-->
</script>
